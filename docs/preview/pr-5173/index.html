<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <title>PokéClicker</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="utf-8"/>
    <link href="assets/images/favicon.ico" rel="icon" type="image/x-icon"/>
    <script>window.featureFlags = {"preloadUnreleasedTowns":false};</script>

    <!--jQuery-->
    <script src="libs/jquery.min.js"></script>

    <!--Knockout-->
    <script src="libs/knockout-latest.js"></script>

    <!--Sortable-->
    <script src="libs/Sortable.min.js"></script>

    <!-- New module-based code from './modules' -->
    <script src="scripts/modules.min.js?v=0.10.23"></script>

    <!--Minified scripts-->
    <script src="scripts/script.min.js?v=0.10.23"></script>

    <!--Popper.js-->
    <script src="libs/popper.min.js"></script>

    <!--Bootstrap-->
    <link href="libs/bootstrap.min.css" rel="stylesheet">
    <script src="libs/bootstrap.min.js"></script>

    <!--Notify-->
    <script src="libs/bootstrap-notify.min.js"></script>

    <!--Intro.js-->
    <script src="libs/intro.min.js"></script>
    <link href="libs/introjs.css" rel="stylesheet">
    <link href="libs/introjs-modern.css" rel="stylesheet">

    <!--Minified styles-->
    <link href="styles/styles.min.css?v=0.10.23" rel="stylesheet">

    <style>
        #game.loading {
            display: none !important;
        }

        #saveSelector {
            position: absolute;
            top: 0;
            left: 0;
            min-height: 100vh;
            width: 100vw;
            background-color: #79c9fa;
            background-size: cover;
            z-index: 101;
            overflow: auto;
        }

        #loader {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 100vw;
            background-color: #79c9fa;
            background-size: cover;
            z-index: 99;
            overflow: hidden;
        }

        .loader-wrapper {
            height: 100vh;
            width: 100vw;
            position: relative;
        }
    </style>
</head>
<body class="no-select" data-bind="class: 'no-select ' + Settings.getSetting('theme').observableValue() + ' ' + Settings.getSetting('backgroundImage').observableValue(), attr : {'oncontextmenu' : 'return !' + Settings.getSetting('disableRightClickMenu').observableValue().toString() + ';'}">
<div id="dynamic-background">
    <!-- Sky -->
    <div id="sky1" class="sky sky-0" style="opacity: 1;"></div>
    <div id="sky2" class="sky sky-1" style="opacity: 0;"></div>

    <!-- Sun & Moon -->
    <div id="orbital">
        <div id="sun" style="top: 570.474px; left: 1234.9px;"></div>
        <div id="moon" style="bottom: 595.351px; right: 1212.76px;"></div>
    </div>

    <!-- Ground -->
    <div id="ground1" class="ground ground-0" style="opacity: 1;"></div>
    <div id="ground2" class="ground ground-1" style="opacity: 0;"></div>

    <!-- Clouds -->
    <div class="cloud-container">
        <div id="clouds">
            <div class="cloud1 cloud1-0" id="cloud1One"></div>
        </div>
    </div>
</div>

<div id="toaster" class="mw-100"></div>
<link id="theme-link" href="https://bootswatch.com/4/yeti/bootstrap.min.css" rel="stylesheet" data-bind="attr: {href: 'https://bootswatch.com/4/' + Settings.getSetting('theme').observableValue() + '/bootstrap.min.css'}">

<!--$DEV_BANNER-->
<div class="modal" data-keyboard="false" data-backdrop="static" id="developmentModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h5 class="modal-title">Welcome to the development site!</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <p></p>
                <i class="text-warning">This is the development version of the game, do not take your save from this version to the main game!</i>
                <hr/>
                <p>Bringing your save back over to the main game will very likely cause problems, whenever testing something new please re-import a fresh save file to avoid any bugs.</a>.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">Let's GO!</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function checkDevModal(event) {
        $('#developmentModal').modal('show');
    });
</script>


<!-- Splash Screen -->
<div class="d-flex align-items-center justify-content-center background-night py-4" id="saveSelector">
    <div class="justify-content-center container row">
        <div class="col-6">
            <img style="width:100%" src="assets/images/pokeclickerlogo.png">
        </div>
        <div class="col-12 d-flex align-items-center justify-content-center my-3 flex-column flex-md-row">
            <a class="mb-1 mr-md-1" href="https://discord.gg/a6DFe4p" target="_blank">
                <img alt="Join our Discord!" src="https://img.shields.io/discord/450412847017754644?color=7289DA&label=Discord&logo=discord&logoColor=7289DA&style=for-the-badge">
            </a>
            <a class="mb-1 mr-md-1" href="https://github.com/pokeclicker/pokeclicker" target="_blank">
                <img alt="Visit our GitHub!" src="https://img.shields.io/github/package-json/v/pokeclicker/pokeclicker/master?label=GitHub&logo=github&style=for-the-badge">
            </a>
            <a class="mb-1 mr-md-1" href="https://wiki.pokeclicker.com/" target="_blank">
                <img alt="Check out the Wiki!" src="https://img.shields.io/badge/wiki-link-blue?logo=wikimedia-commons&style=for-the-badge">
            </a>
        </div>
        <div id="use-our-client-message" style="color: white; display: none; font-size: .875em;">
            Play offline & improve performance by downloading our desktop client <b><a href="https://github.com/RedSparr0w/Pokeclicker-desktop/releases/latest" target="_blank">here</a></b>.
            You can even find a Pokémon exclusive to the client when you reach the Sevii Islands!<br/><br/>
        </div>
        <div class="save-container justify-content-center container row"></div>

        <div class="new-import-buttons justify-content-center container row">
            <label class="btn btn-success col-md-4 col-xs-12 mx-1" onclick="Save.key = Rand.string(6); document.querySelector('#saveSelector').remove(); App.start();">New Save</label>
            <label for="import-save" class="btn btn-warning col-md-4 col-xs-12 mx-1" onclick="Save.key = Rand.string(6);">Import Save</label>
        </div>

    </div>

    <div class="dropdown-menu py-0" id="saveSelectorContextMenu">
        <a class="dropdown-item" href="#">Action</a>
        <a class="dropdown-item" href="#">Another action</a>
        <a class="dropdown-item" href="#">Something else here</a>
    </div>
</div>

<template id="trainerCardTemplate">
    <div class="trainer-card-container mb-3 col-lg-4 col-md-6 col-sm-12 xol-xs-12">
        <div class="trainer-card clickable card font-weight-bold">
            <div class="card-body">
                <div class="position-absolute context-menu-button px-1" style="top: 0; left: 2px; cursor: help;">⋮</div>
                <div class="position-absolute small trainer-id" style="top: 0; right: 5px;"></div>
                <h5 class="align-middle font-weight-bold">
                    <img class="trainer-image"/>
                    <span class="trainer-name"></span>
                </h5>
                <table class="table table-sm table-borderless col-8">
                    <tbody>
                        <tr>
                            <td>Badges:</td>
                            <td class="trainer-badges text-right">0</td>
                        </tr>
                        <tr>
                            <td>Pokédex:</td>
                            <td class="trainer-pokedex text-right">0</td>
                        </tr>
                        <tr>
                            <td>Time:</td>
                            <td class="trainer-time text-right">0</td>
                        </tr>
                    </tbody>
                </table>
                <img class="trainer-pokemon-image" />
                <small class="trainer-version">v0.0.0</small>
                <div class="challenge-badges"></div>
            </div>
        </div>
    </div>
</template>

<div class="loader background-night" id="loader">
    <br>
    <div class="loader-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 offset-sm-3">
                    <img style="width:100%" src="assets/images/pokeclickerlogo.png">
                </div>
            </div>
        </div>
        <div class="loader-content">
            <img src="assets/images/pokeball/Pokeball.svg" class="loader-pokeball"/>
            <div class="progress" style="margin-top:10px;">
                <div id="preload-progress-bar" class="progress-bar bg-primary" role="progressbar" style="width:0%;">
                    <span id="preload-progress-text">Loading...</span>
                </div>
            </div>
        </div>
    </div>

</div>


<!-- Game menu-->
<div id="startMenu" class="dropdown clearfix" style="position:absolute; right:0; top:0; z-index: 100;">
    <button class="btn btn-secondary mr-1 float-left" style="display: none;"
        data-bind="visible: Settings.getSetting('disableAutoSave').observableValue,
            click: () => { Save.store(player) },
            tooltip: {
                html: true,
                title: `Save the game.<br/>Shortcut: ${Settings.getSetting('hotkey.forceSave').prefix}${Settings.getSetting('hotkey.forceSave').observableValue()}`,
                trigger: 'hover',
                placement: 'bottom'
            }">
        <img src="assets/images/floppy-disk.svg" height="20px" width="20px" style="margin-top: -3px;">
    </button>
    <button class="btn btn-secondary mr-1 float-left"
        data-bind="visible: Settings.getSetting('showMuteButton').observableValue(),
            click: () => { Settings.getSetting('sound.muted').toggle() },
            tooltip: { title: Settings.getSetting('sound.muted').observableValue() ? 'Click to unmute all sounds.' : 'Click to mute all sounds.', trigger: 'hover', placement: 'bottom' }">
        <img src="assets/images/volume-high.svg" height="20px" width="20px" style="margin-top: -3px;"
            data-bind="attr: { src: `assets/images/${Settings.getSetting('sound.muted').observableValue() ? 'volume-xmark' : 'volume-high'}.svg` }">
    </button>
    <button class="btn btn-secondary dropdown-toggle float-right" type="button" data-toggle="dropdown">
        Start Menu
        <span class="caret"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right">
        <li>
            <a class="dropdown-item" href="#pokedexModal" data-toggle="modal">Pokédex</a>
        </li>
        <li>
            <a class="dropdown-item" href="#showItemsModal" data-toggle="modal">Items</a>
        </li>
        <li data-bind="attr: {  title: App.game.gems.canAccess() ? '' : 'Progress further to unlock...'}">
            <a class="dropdown-item" href="#" data-bind="click:function(){App.game.gems.openGemModal()},
            attr: {class: App.game.gems.canAccess() ? 'dropdown-item' : 'dropdown-item disabled all-pointers'}">Gems</a>
        </li>
        <li>
            <a class="dropdown-item" href="#profileModal" data-toggle="modal">Profile</a>
        </li>
        <li>
            <a class="dropdown-item" href="#badgeCaseModal" data-toggle="modal">Badge Case</a>
        </li>
        <li>
            <a class="dropdown-item" href="#saveModal" data-toggle="modal">Save</a>
        </li>
        <li>
            <a class="dropdown-item" href="#settingsModal" data-toggle="modal">Settings</a>
        </li>
        <li>
            <a class="dropdown-item" href="#eventsModal" data-toggle="modal">Events</a>
        </li>
        <li>
            <button class="dropdown-item" href="#statisticsModal" data-toggle="modal">Statistics</button>
        </li>
        <li>
            <a class="dropdown-item" href="#achievementsModal" data-toggle="modal" onclick="AchievementHandler.filterAchievementList(true);">Achievements</a>
        </li>
        <li>
            <a class="dropdown-item" href="#logBookModal" data-toggle="modal">Log Book</a>
        </li>
        <li>
            <a class="dropdown-item" href="#damageCalculatorModal" data-toggle="modal">Damage Calculator</a>
        </li>
        <li>
            <a class="dropdown-item" href="#challengeModeModal" data-toggle="modal">Challenge Modes</a>
        </li>
        <li>
            <a class="dropdown-item" href="#changelogModal" data-toggle="modal">Changelog</a>
        </li>
        <li>
            <a class="dropdown-item" href="#FAQModal" data-toggle="modal">FAQ</a>
        </li>
        <li>
            <a class="dropdown-item" href="#creditsModal" data-toggle="modal">Credits</a>
        </li>
        <li>
            <a class="dropdown-item" href="#externalLinksModal" data-toggle="modal">External Links</a>
        </li>
        <li>
            <a class="dropdown-item" href="https://github.com/pokeclicker/pokeclicker/issues" target="_blank">Report a bug</a>
        </li>

    </ul>
</div>


<!-- Get Keyitem modal-->
<div class="modal" id="keyItemModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content" style="text-align: center">
            <div class="modal-header">
                <div style="width: 100%;">
                    <img src="assets/images/npcs/Professor Oak.png">
                    <h5 class="modal-title" id="keyItemModalLabel">New key item!</h5>
                </div>
            </div>
            <!-- ko with: App.game.keyItems.itemList.find(k=> k.id == KeyItemController.latestGainedItem()) -->
            <div class="modal-body">
                <h5><strong>Congratulations!</strong></h5>
                <span>You have gained a</span><br>
                <img class="key-item" src="" data-bind="attr:{ title: $data.displayName,  src: 'assets/images/keyitems/' + KeyItemType[KeyItemController.latestGainedItem()] + '.png'}"/><br>
                <span>
                    <strong data-bind="text: $data.displayName">Name</strong>
                </span><br>
                <span data-bind="html: $data.description">Description</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="click: $data.unlockRewardOnClose">Close</button>
            </div>
            <!-- /ko -->
        </div>
    </div>
</div>


<!-- Show profile modal -->
<div class="modal noselect fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left p-2">
                <div class="form-row p-0" id="profileEdit">
                    <div class="form-group col-5">
                        <label>Name</label>
                        <input autocomplete="off" class="form-control" oninput="App.game.profile.name(this.value)" placeholder="name" data-bind="value: App.game.profile.name()"/>
                    </div>
                    <div class="form-group col-7">
                        <label>Pokémon</label>
                        <div class="dropdown">
                            <button class="btn btn-dropdown custom-select text-left" type="button" data-toggle="dropdown" data-display="static">
                                <div class="text-truncate btn-text" data-bind="with: App.game.party.getPokemon(App.game.profile.pokemon())">
                                    <span data-bind="text: `#${($data.id > 0 ? Math.floor($data.id).toString() : '???').padStart(3, 0)} ${$data.displayName}`"></span>
                                    <span data-bind="visible: $data.shiny">✨</span>
                                    <span data-bind="visible: $data.shadow !== GameConstants.ShadowStatus.None">
                                        <img style="width: 18px;" src="assets/images/status/shadow.svg"/>
                                    </span>
                                </div>
                            </button>
                            <div class="dropdown-menu px-2 w-100" style="max-height: 280px; overflow-y: auto;">
                                <input type="text" class="form-control form-control-sm" placeholder="Search" data-bind="textInput: App.game.profile.pokemonSearch" />
                                <div class="dropdown-divider"></div>
                                <!-- ko if: DisplayObservables.modalState.profileModal === 'show' -->
                                <div data-bind="foreach: App.game.profile.getCaughtPokemonList()">
                                    <button class="dropdown-item small px-1" type="button" data-bind="click: () => { App.game.profile.pokemon($data.id); App.game.profile.pokemonShiny(false); App.game.profile.pokemonFemale(false); App.game.profile.pokemonShadow(false); }">
                                        <span data-bind="text: `#${($data.id > 0 ? Math.floor($data.id).toString() : '???').padStart(3, 0)} ${$data.displayName}`"></span>
                                        <span data-bind="visible: $data.shiny">✨</span>
                                        <span data-bind="visible: $data.shadow !== GameConstants.ShadowStatus.None">
                                            <img style="width: 16px;" src="assets/images/status/shadow.svg"/>
                                        </span>
                                    </button>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>

                    <div class="form-group col-4">
                        <label>Shiny</label>
                        <label class="form-check-label toggler-wrapper style-1 float-right">
                            <input class="form-check-input" type="checkbox" id="profile-shiny-toggle"
                                data-bind="checked: App.game.profile.pokemonShiny, enable: App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), true)">
                            <div class="toggler-slider" data-bind="tooltip: { title: !App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), true) ? `Shiny ${PokemonHelper.getPokemonById(App.game.profile.pokemon()).name} is not unlocked yet` : '', trigger: 'hover' }">
                                <div class="toggler-knob" data-bind="css: { 'checkbox-disabled': !App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), true) }"></div>
                            </div>
                        </label>
                    </div>
                    <!-- ko if: SubRegions.isSubRegionUnlocked(GameConstants.Region.hoenn, GameConstants.HoennSubRegions.Orre) -->
                    <div class="form-group col-4">
                        <label>Shadow</label>
                        <label class="form-check-label toggler-wrapper style-1 float-right">
                            <input class="form-check-input" type="checkbox" id="profile-shadow-toggle"
                                data-bind="checked: App.game.profile.pokemonShadow, enable: App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), false, true)">
                            <div class="toggler-slider" data-bind="tooltip: { title: !App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), false, true) ? `Shadow ${PokemonHelper.getPokemonById(App.game.profile.pokemon()).name} is not unlocked yet or does not exist` : '', trigger: 'hover' }">
                                <div class="toggler-knob" data-bind="css: { 'checkbox-disabled': !App.game.party.alreadyCaughtPokemon(App.game.profile.pokemon(), false, true) }"></div>
                            </div>
                        </label>
                    </div>
                    <!-- /ko -->
                    <!-- ko if: PokemonHelper.getPokemonById(App.game.profile.pokemon()).gender.visualDifference -->
                    <div class="form-group col-4">
                        <label>Gender</label>
                        <label class="form-check-label toggler-wrapper style-1 float-right"
                            data-bind="css: { 'gender-toggle': PokemonHelper.getPokemonById(App.game.profile.pokemon()).gender.visualDifference }">
                            <input class="form-check-input" type="checkbox" id="profile-female-toggle"
                                data-bind="checked: App.game.profile.pokemonFemale, enable: PokemonHelper.getPokemonById(App.game.profile.pokemon()).gender.visualDifference">
                            <div class="toggler-slider">
                                <div class="toggler-knob"></div>
                            </div>
                        </label>
                    </div>
                    <!-- /ko -->
                    <div class="form-group col-12">
                        <label>Text Color</label>
                        <p class="p-0" data-bind="style: { background: App.game.profile.textColor() }">
                          <label style="width:100%; min-height: 28px; padding:0px; margin: 0px;"><input style="opacity: 0;" type="color" data-bind="value: App.game.profile.textColor"/></label>
                        </p>
                    </div>
                    <div class="form-group col-6">
                        <a class="btn btn-block btn-primary text-left" href="#profileTrainerModal" data-toggle="modal">Trainer <img style="position:absolute; right: 10px;" data-bind="attr: { src: `assets/images/profile/trainer-${App.game.profile.trainer() || 0}.png` }"/></a>
                    </div>
                    <div class="form-group col-6">
                        <a class="btn btn-block btn-primary text-left" href="#profileBackgroundModal" data-toggle="modal">Background <knockout style="position:absolute; right: 10px;" data-bind="text: `#${App.game.profile.background()}`"></knockout></a>
                    </div>
                </div>
                <div id="profile-trainer-card"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal noselect fade" id="profileTrainerModal" tabindex="-1" role="dialog" aria-labelledby="profileTrainerModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Select a Trainer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- ko foreach: new Array(Profile.MAX_TRAINER).fill(0) -->
                <button style="position: relative;" class='btn'
                    data-dismiss='modal'
                    data-bind='click: () => {
                        App.game.profile.trainer($index());
                        $("#profileTrainerModal").modal("hide");
                    },'>
                    <img data-bind="attr: { src: `assets/images/profile/trainer-${$index()}.png` }"/>
                </button>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>

<div class="modal noselect fade" id="profileBackgroundModal" tabindex="-1" role="dialog" aria-labelledby="profileBackgroundModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Select a Background</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- ko foreach: new Array(Profile.MAX_BACKGROUND).fill(0) -->
                <button style="position: relative; height: 160px; width: 100%;"
                    data-dismiss='modal'
                    data-bind='click: () => {
                        App.game.profile.background($index());
                        $("#profileBackgroundModal").modal("hide");
                    },
                    class: `btn trainer-card trainer-bg-${$index()}`'>
                </button>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>


<!-- Show keyitems modal-->
<!-- Show Items modal-->
<div class="modal fade" id="showItemsModal" tabindex="-1" role="dialog"
     aria-labelledby="showItemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content" style="text-align: center">
            <div class="modal-header p-0" style='justify-content: space-around;'>
                <ul class="nav nav-tabs nav-fill w-100">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#evoStones">Evolution Items</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#itemBag">Item Bag</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#keyItems">Key Items</a></li>
                </ul>
            </div>

            <div class="modal-body p-0">
                <div class="tab-content">
                    <div id="evoStones" class="tab-pane active p-3">
                        <!--<h3 data-bind="text: ItemList[ItemHandler.stoneSelected()].displayName"></h3>-->
                        <div class="row">
                            <div class="col-12 d-lg-none d-block">
                                <button class="w-100 my-1 btn btn-secondary" type="button" data-toggle="collapse"
                                        data-target="#evo-item-list" aria-expanded="false" aria-controls="evo-item-list">
                                    Evolution Item
                                </button>
                            </div>
                            <!-- Evo items -->
                            <div class="col-lg-6 col-12 collapse dont-collapse-lg justify-content-center" id="evo-item-list">
                                <h4>Evolution Items</h4>
                                <div class="scrolling-div" data-bind="foreach: Object.keys(GameConstants.StoneType).filter(stone => isNaN(stone) && stone !== 'None')">
                                    <div class="col-12 evolutionListItem">
                                        <button class="btn btn-secondary smallButton list-group-item-action pl-2"
                                                data-bind="css:{'item-selected': ItemHandler.stoneSelected() === $data},
                                                    click: function(){ ItemHandler.stoneSelected($data); ItemHandler.pokemonSelected('')},
                                                    visible: ItemList[$data].unlockedRegion <= player.highestRegion() || player.amountOfItem($data) > 0">
                                            <div class="d-flex align-items-center">
                                                <img class="mr-3" data-bind="attr: {src: ItemList[$data].image }" style="max-width: 32px;">
                                                <div class="flex-grow-1 mr-1" data-bind="text: ItemList[$data].displayName"></div>
                                                <div class="mr-1" data-bind="text: player.itemList[$data]().toLocaleString('en-US')"></div>
                                                <!-- ko if: ItemList[$data] instanceof CaughtIndicatingItem -->
                                                <div class="mr-1" data-bind="template: { name: 'caughtStatusTemplate', data: {'status': ItemList[$data].getCaughtStatus()}}"></div>
                                                <!-- /ko -->
                                                <div data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                                    'pokerus': ItemList[$data].getPokerusStatus(),
                                                    'evsProgress': ItemList[$data].getPokerusProgress() }}"></div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 d-lg-none d-block">
                                <button class="w-100 my-1 btn btn-secondary" type="button" data-toggle="collapse"
                                        data-target="#evo-pokemon-list" aria-expanded="false" aria-controls="evo-pokemon-list">
                                    Pokémon
                                </button>
                            </div>
                            <!-- Pokemon list -->
                            <div class="col-lg-6 col-12 collapse dont-collapse-lg justify-content-center" id="evo-pokemon-list">
                                <h4>Pokémon</h4>
                                <div class="scrolling-div"
                                    data-bind="foreach: PartyController.getPokemonsWithEvolution(GameConstants.StoneType[ItemHandler.stoneSelected()])">
                                    <div class="col-12 evolutionListItem">
                                        <button class="btn btn-secondary smallButton list-group-item-action d-flex align-items-center"
                                            data-bind="click: function() {ItemHandler.pokemonSelected(name)}, css:{ 'pokemon-selected': ItemHandler.pokemonSelected() === name}">
                                            <img class="smallImage pr-0 mr-3" data-bind="attr:{src: 'assets/images/' + (App.game.party.alreadyCaughtPokemon($data.id, true) ? 'shiny' : '') + 'pokemon/' + id +'.png' }"/>
                                            <span class="flex-grow-1 mr-1" data-bind="text: displayName"></span>
                                            <span class="mr-1" data-bind="using: { statuses: PartyController.getStoneEvolutionsCaughtData($data.id, GameConstants.StoneType[ItemHandler.stoneSelected()]) }">
                                                <span class="stoneEvolutionStatuses" data-bind="foreach: statuses">
                                                    <span class="" data-bind="template: { name: 'caughtStatusTemplate', data: $data }"></span>
                                                </span>
                                            </span>
                                            <span data-bind="using: { statuses: PartyController.getStoneEvolutionsPokerusData($data.id, GameConstants.StoneType[ItemHandler.stoneSelected()]) }">
                                                <span class="stoneEvolutionStatuses" data-bind="foreach: statuses">
                                                    <span class="" data-bind="template: { name: 'pokerusStatusTemplate', data: { pokerus: $data.status, evs: $data.evs } }"></span>
                                                </span>
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Amount buttons -->
                            <div class="col-12 pt-3">
                                <div class="row justify-content-center">
                                    <div class="col-md-6 col-12">
                                        <div class="btn-group btn-block">
                                            <!-- ko using: PartyController.hasMultipleStoneEvolutionsAvailable(ItemHandler.pokemonSelected(), GameConstants.StoneType[ItemHandler.stoneSelected()]), as: 'multipleEvolution' -->
                                            <button class="btn btn-success btn-block" data-bind="click: function(){ItemHandler.useStones()},
                                                    tooltip: {
                                                    title: 'If a shiny is found, the game will stop using evolution items.' + (multipleEvolution ? '<br/>If the requirements for more than one evolution is fulfilled, a random evolution will be selected.' : ''),
                                                    trigger: 'hover',
                                                    boundary: 'window',
                                                    html: true,
                                                    }">
                                                Use evolution items!
                                            </button>
                                            <!-- /ko -->
                                            <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-bind="text: ItemHandler.amountSelected().toLocaleString('en-US') + '&nbsp;'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            </button>
                                            <div class="dropdown-menu" data-bind="foreach: [1, 10, 100, 1000, Infinity]">
                                                <button class="dropdown-item" type="button" data-bind="click: function(){ItemHandler.amountSelected($data)}, text: $data.toLocaleString('en-US')"></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="itemBag" class="tab-pane p-3">

                        <!-- ko if: Object.values(ItemList).some((i) => i instanceof QuestItem && i.isActive() && player.itemList[i.name]()) -->
                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-questItems">
                            <h5 class="m-0 text-light">Quest Items</h5>
                        </div>
                        <div id="itemBag-questItems" class="collapse show">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: Object.values(ItemList).filter((i) => i instanceof QuestItem && i.isActive() && player.itemList[i.name]()) -->
                                    <div class="col-6 col-lg-3 mb-2">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                            data-bind="template: { name: 'otherItemTemplate', data: $data.name }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-vitamins">
                            <h5 class="m-0 text-light">Vitamins</h5>
                        </div>
                        <div id="itemBag-vitamins" class="collapse show">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: GameHelper.enumNumbers(GameConstants.VitaminType) -->
                                    <div class="col-6 col-lg-3 mb-2">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                            data-bind="template: { name: 'otherItemTemplate', data: GameConstants.VitaminType[$data]},
                                                click: () => { VitaminController.currentlySelected($data); $('#pokemonVitaminModal').modal('show'); }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                                <div class="row justify-content-center mb-1">
                                    <button type="button" class="btn btn-secondary btn-sm" data-bind="click: () => { $('#pokemonVitaminExpandedModal').modal('show') }">All Vitamins</button>
                                </div>
                            </div>
                        </div>

                        <!-- ko if: GameHelper.enumStrings(GameConstants.ConsumableType).some(type => player.itemList[type]()) -->
                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-consumables">
                            <h5 class="m-0 text-light">Consumables</h5>
                        </div>
                        <div id="itemBag-consumables" class="collapse show">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: GameHelper.enumStrings(GameConstants.ConsumableType).filter(type => player.itemList[type]()).map(type => ItemList[type]) -->
                                    <div class="col-6 col-lg-3 mb-2">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                            data-bind="template: { name: 'otherItemTemplate', data: $data.name },
                                            click: () => { ConsumableController.currentlySelected($data.type); $('#consumableModal').modal('show'); }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-heldItems">
                            <h5 class="m-0 text-light">Held Items</h5>
                        </div>
                        <div id="itemBag-heldItems" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: Object.values(HeldItem.getSortedHeldItems()) -->
                                    <h5 class="card-title col-12 mb-2" data-bind="text: $data.title, visible: $data.items.some(i => i.isUnlocked())"></h5>
                                    <!-- ko foreach: $data.items -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                            data-bind="template: { name: 'otherItemTemplate', data: $data.name },
                                                click: () => { HeldItem.heldItemSelected($data); $('#heldItemModal').modal('show'); }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-pokeblocks">
                            <h5 class="m-0 text-light">Contest Treats</h5>
                        </div>
                        <div id="itemBag-pokeblocks" class="collapse show">
                            <p><i>These items are currently not testable</i></p>
                            <div class="card-body pt-2 p-1" data-bind="visible: false">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: Object.values(ItemList).filter((i) => i instanceof PokeBlock) -->
                                    <div class="col-6 col-lg-3 mb-2">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px; image-rendering: pixelated;"
                                        data-bind="template: { name: 'otherItemTemplate', data: $data.name },
                                        click: () => { PokeBlockController.currentlySelected($data.type); $('#pokeblockModal').modal('show'); }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-underground-treasure">
                            <h5 class="m-0 text-light">Underground Treasure</h5>
                        </div>
                        <div id="itemBag-underground-treasure" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === UndergroundItemValueType.Diamond) -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                             data-bind="template: { name: 'otherItemTemplate', data: $data.itemName }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-gem-plates">
                            <h5 class="m-0 text-light">Gem Plates</h5>
                        </div>
                        <div id="itemBag-gem-plates" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === UndergroundItemValueType.Gem) -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                             data-bind="template: { name: 'otherItemTemplate', data: $data.itemName }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-fossils">
                            <h5 class="m-0 text-light">Fossils</h5>
                        </div>
                        <div id="itemBag-fossils" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <h5 class="card-title col-12 mb-2">Fossils</h5>
                                    <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === UndergroundItemValueType.Fossil) -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                             data-bind="template: { name: 'otherItemTemplate', data: $data.itemName }">
                                        </div>
                                    </div>
                                    <!-- /ko -->

                                    <h5 class="card-title col-12 mb-2">Fossil Pieces</h5>
                                    <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === UndergroundItemValueType.FossilPiece) -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                             data-bind="template: { name: 'otherItemTemplate', data: $data.itemName }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-shards">
                            <h5 class="m-0 text-light">Shards</h5>
                        </div>
                        <div id="itemBag-shards" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center">
                                    <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === UndergroundItemValueType.Shard) -->
                                    <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                        <div class="btn btn-secondary text-left w-100 px-1" style="cursor: default; padding-top: 1px; padding-bottom: 2px;"
                                             data-bind="template: { name: 'otherItemTemplate', data: $data.itemName }">
                                        </div>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>

                        <!-- ko if: Object.values(ItemList).some((i) => i instanceof MegaStoneItem && player.itemList[i.name]()) -->
                        <div class="bg-primary text-left rounded-0 px-3 py-2 mb-1" data-toggle="collapse" data-target="#itemBag-megaStones">
                            <h5 class="m-0 text-light">Mega Stones</h5>
                        </div>
                        <div id="itemBag-megaStones" class="collapse show mt-1">
                            <div class="card-body pt-2 p-1">
                                <div class="row justify-content-center" data-bind="foreach: Object.values(ItemList).filter((i) => i instanceof MegaStoneItem && player.itemList[i.name]())">
                                    <div class="col-6 col-lg-3 mb-2">
                                        <div class="btn btn-secondary px-1 py-0 d-flex align-items-center text-left" style="pointer-events: none;">
                                            <img width="42px" data-bind="attr: { src: $data.image }">
                                            <div class="flex-grow-1 small ml-2" style="min-width: 0;">
                                                <div class="text-truncate" data-bind="text: GameConstants.humanifyString($data.name)"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>

                    <div id="keyItems" class="tab-pane p-3">
                        <div class="m-0">
                            <div class="row no-gutters justify-content-sm-center"
                                data-bind="foreach: App.game.keyItems.itemList">
                                <div class="col-2">
                                    <img class="clickable key-item" src=""
                                        data-bind="attr:{
                                        src: 'assets/images/keyitems/' + KeyItemType[$data.id] + '.png'},
                                css: {'key-item-locked': !App.game.keyItems.hasKeyItem($data.id),
                                'key-item-selected': KeyItemController.inspectedItem() == $data.id
                                },
                                event: {
                                    mouseover: function(){KeyItemController.hover($data.id)},
                                    mouseout : function(){KeyItemController.hoverRelease()}
                                    }">
                                </div>
                            </div>

                            <div class="oak-item-info">
                                <!-- ko with: App.game.keyItems.itemList.find(k=> k.id == KeyItemController.inspectedItem()) -->
                                <div class="row justify-content-sm-center">
                                    <div class="col-xs-10">
                                        <b><span data-bind="text: $data.displayName"></span></b>
                                    </div>
                                </div>
                                <div class="row justify-content-sm-center">
                                    <div class="col-xs-10">
                                        <knockout data-bind="if: App.game.keyItems.hasKeyItem(KeyItemController.inspectedItem())">
                                            <p data-bind="html: $data.description"></p>
                                        </knockout>
                                        <knockout data-bind="ifnot: App.game.keyItems.hasKeyItem(KeyItemController.inspectedItem())">
                                            <p>?????</p>
                                        </knockout>
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="otherItemTemplate">
    <div class="d-flex w-100" data-container="body" data-bind="tooltip: {
        title: ItemList[$data] ? `<u>${ItemList[$data].displayName}</u><br/>${ItemList[$data].description || ''}` : '',
        trigger: 'hover',
        placement:'top',
        html: true,
        boundary: 'scrollParent',
    }">
        <img width="42px" data-bind="attr: { src: ItemList[$data].image }" onerror="this.src='assets/images/badges/Unknown.png';">
        <div class="flex-grow-1 small align-self-end ml-2" style="min-width: 0;">
            <div class="text-truncate" data-bind="text: ItemList[$data].displayName"></div>
            <div data-bind="text: player.itemList[$data]().toLocaleString('en-US')"></div>
        </div>
    </div>
</script>


<!-- Dungeon guides modal-->
<div class="modal noselect fade" id="dungeonGuidesModal" tabindex="-1" role="dialog" aria-labelledby="dungeonGuidesModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Hire a Dungeon Guide (BETA)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left p-2">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a class="nav-link active" href="#dungeonGuidesModalHireTab" data-toggle="tab">Hire</a></li>
                    <li class="nav-item"><a class="nav-link" href="#dungeonGuidesModalHelpTab" data-toggle="tab">Help</a></li>
                </ul>
                <div class="tab-content">
                    <!-- Hiring Tab -->
                    <div id="dungeonGuidesModalHireTab" class="tab-pane fade active show">
                        <!-- ko if: player.town instanceof DungeonTown -->
                        <div class="row m-0 justify-content-center d-flex" data-bind="foreach: DungeonGuides.available()" style="max-width: 100%;">
                            <div class="card text-left col-md-4 col-sm-6 col-xs-12 p-0 align-items-stretch">
                                <h5 class="card-header">
                                    <knockout data-bind="text: $data.name">Name</knockout>
                                    <img class="float-right pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` }">
                                </h5>
                                <div class="card-body p-0 text-center">
                                    <div class="card h-100">
                                        <div class="card-header p-1">
                                            Description
                                        </div>
                                        <div class="card-body p-1 flex-grow-0" data-bind="html: $data.description">
                                            Description
                                        </div>
                                        <div class="card-header p-1">
                                            Cost / Run
                                        </div>
                                        <div class="card-body p-1 flex-grow-1" data-bind="foreach: $data.calcCost(1, player.town.dungeon.tokenCost, player.region)">
                                            <knockout class="w-100" data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.amount, 'currency': $data.currency}}">cost</knockout><br/>
                                        </div>
                                        <div class="card-header p-1">
                                            Movement Speed
                                        </div>
                                        <div class="card-body p-1 flex-grow-0" data-bind="text: `${($data.interval / 1000).toLocaleString('en-US')} seconds`">
                                            Speed
                                        </div>
                                        <div class="card-header p-1">
                                            Statistics
                                        </div>
                                        <div class="card-body p-1 flex-grow-0">
                                            <knockout data-bind="text: `Total Attempts: ${App.game.statistics.dungeonGuideAttempts[$data.index]().toLocaleString()}`">Attempts</knockout><br/>
                                            <knockout data-bind="text: `Total Clears: ${App.game.statistics.dungeonGuideClears[$data.index]().toLocaleString()}`">Clears</knockout>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <butto class="btn btn-block btn-primary" href="#dungeonGuidesSubModal" data-toggle="modal" data-bind="click: () => DungeonGuides.selected($data.index)">Hire!</butto>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>

                    <!-- Help Tab -->
                    <div id="dungeonGuidesModalHelpTab" class="tab-pane fade col-10 offset-1 text-center">
                        <h4><u>Help</u></h4>
                        <p>Dungeon guides will automatically guide you through the dungeon, opening any chest they come accross, go down ladders they find and start boss battles.</p>
                        <p>You must pay an upfront cost for however many attempts you want to run of the dungeon <span class="text-danger">(non refundable)</span>, they will however give you a discount the more runs you purchase in one go.</p>
                        <p>They do not guarantee a successful dungeon clear, and will charge regardless of the outcome.</p>
                        <p>Each guide operates at their own speed, with some possessing a sense for specific dungeon tiles and others actively avoiding particular tiles whenever possible.</p>
                        <p class="text-warning"><i>NOTE: This is a <strong>beta</strong> feature, so things are likely to change in future updates;<br/>feel free to post any feedback/bugs in the <a href="https://discord.gg/a6DFe4p" target="_blank">Discord</a>.</i></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal noselect fade" id="dungeonGuidesSubModal" tabindex="-1" role="dialog" aria-labelledby="dungeonGuidesSubModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Explore Dungeon</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left p-2">
                <!-- ko if: player.town instanceof DungeonTown -->
                <table class="table table-striped table-hover m-0 text-center">
                    <tbody>
                        <tr>
                            <td>Dungeon Attempts</td>
                        </tr>
                        <tr>
                            <td class="p-0">
                                <input type="number" class="form-control" min="1" step="1" data-bind="value: DungeonGuides.clears"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guide Cost</td>
                        </tr>
                        <tr>
                            <td data-bind="foreach: DungeonGuides.calcCost()">
                                <knockout data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.amount, 'currency': $data.currency}}"></knockout><br/>
                            </td>
                        </tr>
                        <tr>
                            <td>Dungeon Cost</td>
                        </tr>
                        <tr data-bind="with: DungeonGuides.calcDungeonCost()">
                            <td data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.amount, 'currency': $data.currency}}"></td>
                        </tr>
                        <tr class="bg-danger">
                            <td>ALL CHARGES NON REFUNDABLE</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>
                                <button class="btn btn-block btn-primary" data-dismiss="modal" data-bind="click: () => DungeonGuides.hire()">Start!</button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>

<div class="modal noselect fade" id="dungeonGuidesDungeonModal" tabindex="-1" role="dialog" aria-labelledby="dungeonGuidesDungeonModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Dungeon Guide</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <!-- ko if: player.town instanceof DungeonTown && DungeonGuides.hired() -->
                    <div class="card text-left col-12 p-0" data-bind="with: DungeonGuides.hired()">
                        <h5 class="card-header">
                            <knockout data-bind="text: $data.name">Name</knockout>
                            <img class="float-right pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` }">
                        </h5>
                        <div class="card-body p-0">
                            <table class="table table-striped table-hover table-bordered table-sm m-0" style="overflow: visible;">
                                <tbody class="text-center">
                                    <tr>
                                        <th>Description</th>
                                    </tr>
                                    <tr>
                                        <td data-bind="html: $data.description">Description</td>
                                    </tr>
                                    <tr>
                                        <th>Cost / Run</th>
                                    </tr>
                                    <tr>
                                        <td data-bind="foreach: $data.calcCost(1, player.town.dungeon.tokenCost, player.region)">
                                            <knockout data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.amount, 'currency': $data.currency}}"></knockout><br/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Movement Speed</th>
                                    </tr>
                                    <tr>
                                        <td data-bind="text: `${($data.interval / 1000).toLocaleString('en-US')} seconds`">Speed</td>
                                    </tr>
                                    <tr>
                                        <th>Statistics</th>
                                    </tr>
                                    <tr>
                                        <td data-bind="text: `Total Attempts: ${App.game.statistics.dungeonGuideAttempts[$data.index]().toLocaleString()}`">Attempts</td>
                                    </tr>
                                    <tr>
                                        <td data-bind="text: `Total Clears: ${App.game.statistics.dungeonGuideClears[$data.index]().toLocaleString()}`">Clears</td>
                                    </tr>
                                    <tr>
                                        <th>Attempts Remaining</th>
                                    </tr>
                                    <tr>
                                        <td data-bind="text: DungeonGuides.clears()">Attempts</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>
                                            <button class="btn btn-block btn-danger" data-bind="click: () => $data.fire()" data-dismiss="modal" aria-label="fire">Fire!</button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>


<!-- Encounters Info modal-->
<div class="modal fade noselect" id="routeInfoModal" tabindex="-1" role="dialog" aria-labelledby="routeInfoModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h4 class="modal-title" data-bind="text: RouteInfo.getFullName()">name</h4>
                <button type="button" class="btn btn-danger position-absolute" data-dismiss="modal" style="right:0; top:0; font-size: 18px; font-weight: 700;">×</button>
            </div>
            <div class="modal-body pt-0" style="background-color: inherit;">
                <!-- ko foreach: { data: Object.entries(RouteInfo.pokemonList()), as: 'pokemons' } -->
                <div class="bg-primary text-left rounded px-3 py-2 mb-1 d-flex align-items-center" data-toggle="collapse" data-bind="attr: { 'data-target': `#route-${pokemons[0]}` }">
                    <h5 class="my-0 mx-1 text-light d-inline-block" data-bind="text: (pokemons[0] == 'roamers' ? 'Roamers' : 'Encounters')">Roamer Status</h5>
                </div>
                <div class="collapse show" data-bind="attr: { 'id': `route-${pokemons[0]}` }">
                    <ul class="row justify-content-center w-100 p-0 m-0" data-bind="foreach: pokemons[1]">
                        <li class="col-sm-4 col-md-3 col-lg-2 pokedexEntry" data-bind="style:{background: PokedexHelper.getBackgroundColors($data.name)}">
                            <span class="id pokedex-top-text" data-bind="text: ($data.id > 0 ? Math.floor($data.id) + '' : '???').padStart(3, 0)">number</span>
                            <div data-bind="visible: App.game.party.alreadyCaughtPokemonByName(name)" style="position: absolute;right: 2px;top: -15px;">
                                <img width="18px" src="" data-bind="attr: { src: `assets/images/pokeball/Pokeball${App.game.party.alreadyCaughtPokemon($data.id, true) ? '-shiny' : ''}.svg`}"/>
                            </div>
                            <!-- ko if: App.game.party.alreadyCaughtPokemonByName(name) -->
                            <div data-bind="if: App.game.party.getPokemon($data.id)?.pokerus" style="position: absolute;left: 2px;top: -11px;">
                                <img width="32px" src="" data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[App.game.party.getPokemon($data.id)?.pokerus]}.png`},
                                tooltip: {
                                    title: App.game.party.getPokemon($data.id)?.pokerus >= GameConstants.Pokerus.Contagious ? `EVs: ${App.game.party.getPokemon($data.id)?.evs().toLocaleString('en-US')}` : '',
                                    placement: 'bottom',
                                    trigger: 'hover'
                                }"/>
                            </div>
                            <!-- /ko -->
                            <!-- ko with: RouteInfo.getInformations($data) -->
                            <div style="position: absolute;left: 2px;bottom: 5px;">
                                <img width="24px" src="" data-bind="attr: { src: `assets/images/encountersInfo/route/${$data.image}` },
                                tooltip: {
                                    title: $data.tooltip,
                                    placement: 'bottom',
                                    trigger: 'hover'
                                }"/>
                            </div>
                            <!-- /ko -->
                            <img src="" class="pokedex-pokemon-sprite" data-bind="css: { 'pokemon-not-seen': !PokedexHelper.pokemonSeen($data.id)(), 'pokemon-seen-but-not-caught': !App.game.party.alreadyCaughtPokemonByName(name) && PokedexHelper.pokemonSeen($data.id)() }, attr:{ src: PokemonHelper.getImage($data.id, undefined, undefined, GameConstants.ShadowStatus.None)}">
                            <span class="pokedex-bottom-text text-truncate px-1" data-bind="text: PokedexHelper.pokemonSeen($data.id)() ? PokemonHelper.displayName($data.name) : '???',
                            tooltip: {
                                title: PokemonHelper.displayName($data.name),
                                trigger: 'hover',
                                placement: 'bottom'
                            }">name</span>
                        </li>
                    </ul>
                </div>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>

<div class="modal fade noselect" id="dungeonInfoModal" tabindex="-1" role="dialog" aria-labelledby="dungeonInfoLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h4 class="modal-title" data-bind="text: DungeonInfo.getFullName()">name</h4>
                <button type="button" class="btn btn-danger position-absolute" data-dismiss="modal" style="right:0; top:0; font-size: 18px; font-weight: 700;">×</button>
            </div>
            <div class="modal-body pt-0" style="background-color: inherit;">
                <!-- ko foreach: { data: Object.entries(DungeonInfo.getLootList()), as: 'lootEntries' } -->
                <div class="bg-primary text-left rounded px-3 py-2 mb-1 d-flex align-items-center" data-toggle="collapse" data-bind="attr: { 'data-target': `#tier-${lootEntries[0]}` }">
                    <img width="42px" data-bind="attr: { src: `assets/images/dungeons/chest-${lootEntries[0]}.png` }" />
                    <h5 class="my-0 mx-1 text-light d-inline-block" data-bind="text: GameConstants.camelCaseToString(lootEntries[0])">Tier name</h5>
                </div>
                <div class="collapse show" data-bind="attr: { 'id': `tier-${lootEntries[0]}` }">
                    <div class="card-body pt-2 p-1">
                        <div class="row justify-content-center">
                            <!-- ko foreach: { data: lootEntries[1], as: 'item' } -->
                            <div class="col-6 col-lg-4 mb-2">
                                <!-- ko using: PokemonHelper.getPokemonByName(item.loot).name != 'MissingNo.' && !App.game.party.getPokemonByName(item.loot), as: 'isPokemonAndNotCaught' -->
                                    <!-- ko using: isPokemonAndNotCaught ? '???' : DungeonInfo.getLootName(item.loot), as: 'lootName' -->
                                        <div class="btn btn-secondary px-1 py-0 d-flex align-items-center text-left" style="cursor: default;">
                                            <img width="42px" data-bind="attr: { src: DungeonInfo.getLootImage(item.loot) },
                                                style: { 'filter': isPokemonAndNotCaught ? 'brightness(0)' : '' }">
                                            <div class="flex-grow-1 small ml-2" style="min-width: 0;">
                                                <div class="text-truncate" data-bind="text: lootName"></div>
                                            </div>
                                            <img width="24px" class="lock" src="assets/images/breeding/lock.svg" data-bind="
                                            tooltip: {
                                                title: item.requirement?.hint() || '',
                                                placement: 'bottom',
                                                trigger: 'hover'
                                            }, visible: item.requirement && !item.requirement.isCompleted()" />
                                        </div>
                                    <!-- /ko -->
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>


<!--Templates -->
<script type="text/html" id="currencyTemplate">
    <span style="display: inline;">
        <!-- ko if: $data.currency == GameConstants.Currency.money -->
        <img alt="Money" src="assets/images/currency/money.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.dungeonToken -->
        <img alt="Dungeon Tokens" src="assets/images/currency/dungeonToken.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.questPoint -->
        <img alt="Quest Points" src="assets/images/currency/questPoint.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.diamond -->
        <img alt="Diamonds" src="assets/images/underground/diamond.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.farmPoint -->
        <img alt="Farm Points" src="assets/images/currency/farmPoint.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.battlePoint -->
        <img alt="Battle Points" src="assets/images/currency/battlePoint.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
        <!-- ko if: $data.currency == GameConstants.Currency.contestToken -->
        <img alt="Contest Points" src="assets/images/currency/contestToken.svg" data-bind="style: {height: $data.height || '24px', width: $data.width || $data.height || '24px'}"/>
        <!-- /ko -->
		
        <span data-bind="text: ($data.reduced || ($data.amount > $data.reducedThreshold) || !$data.amount) ? GameConstants.formatNumber($data.amount) : $data.amount.toLocaleString('en-US')">0</span>
    </span>
</script>

<script type="text/html" id="amountTemplate">
    <span data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.amount, 'currency': $data.currency}}"></span>
</script>

<!-- Example usage -->
<!-- <span data-bind="template: { name: 'currencyTemplate', data: {'amount': FarmController.plotPrice(), 'currency': GameConstants.Currency.farmPoint}}"></span> -->

<script type="text/html" id="caughtStatusTemplate">
    <knockout style="display: inline;">
        <!-- ko if: $data.status == CaughtStatus.NotCaught -->
        <img data-bind="tooltip: {trigger: 'hover', title: 'You have not captured this Pokémon yet!', placement: 'top'}"
             class="pokeball-smallest"
             src="assets/images/pokeball/None.svg"
        />
        <!-- /ko -->
        <!-- ko if: $data.status == CaughtStatus.Caught -->
        <img data-bind="tooltip: {trigger: 'hover', title: 'You have captured this Pokémon!', placement: 'top'}"
             class="pokeball-smallest"
             src="assets/images/pokeball/Pokeball.svg"
        />
        <!-- /ko -->
        <!-- ko if: $data.status == CaughtStatus.CaughtShiny -->
        <img data-bind="tooltip: {trigger: 'hover', title: 'You have captured this Pokémon shiny!', placement: 'top'}"
             class="pokeball-smallest"
             src="assets/images/pokeball/Pokeball-shiny.svg"
        />
        <!-- /ko -->
        <!-- ko if: $data.locked -->
        <img class="lock" src="assets/images/breeding/lock.svg" data-bind="
            tooltip: {
                title: $data.lockHint,
                html: true,
                placement: 'top',
                trigger: 'hover'
            }">
        <!-- /ko -->
    </knockout>
</script>

<!-- Example usage -->
<!-- <span data-bind="template: { name: 'caughtStatusTemplate', data: {'status': PartyController.getCaughtStatus(id)}}"></span> -->

<script type="text/html" id="pokerusStatusTemplate">
    <knockout style="display: inline;">
        <!-- ko if: $data.pokerus -->
        <img width="" src="" data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[$data.pokerus]}.png`, width: $data.width },
            tooltip: {
                title:  ($data.evs !== undefined ? `EVs: ${$data.evs.toLocaleString('en-US')}` : '') + ($data.evsProgress ?? ''),
                trigger: 'hover',
                placement: 'top',
            }"/>
        <!-- /ko -->
    </knockout>
</script>

<script type="text/html" id="eggSVGTemplate">
  <svg class="egg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 126.7 126.7" data-bind="attr: {'data-type1': PokemonType[$data.pokemonType1], 'data-type2': PokemonType[$data.pokemonType2]}">
    <defs>
      <filter id="b" width="1.193" height="1.123" x="-.096" y="-.061" color-interpolation-filters="sRGB">
        <feGaussianBlur stdDeviation=".402"/>
      </filter>
      <filter id="a" width="1.067" height="1.045" x="-.034" y="-.023" color-interpolation-filters="sRGB">
        <feGaussianBlur stdDeviation="1.168"/>
      </filter>
    </defs>
    <path class="egg-main" d="M111.5 76.2a48.2 47.7 0 11-96.3 0c0-26.3 21.5-74.7 48.1-74.7s48.2 48.4 48.2 74.7z"/>
    <g data-bind="html: BreedingController.getEggSpots($data.pokemon)"></g>
    <path fill-opacity=".1" d="M63.3 1.5s34.377 56.31 22.684 83.558c-11.693 27.25-58.004 25.939-58.004 25.939 37.3 33.053 83.737 5.438 83.52-33.997-.147-26.6-21.6-75.5-48.2-75.5z" filter="url(#a)"/>
    <path fill="#fff" fill-opacity=".3" d="M47.106 33.508a4.8 8 0 01-4.284 7.952 4.8 8 0 01-5.204-6.246 4.8 8 0 013.167-9.293 4.8 8 0 015.884 4.252" filter="url(#b)" transform="rotate(13.2 42.307 33.508)"/>
    <path fill="#111" d="M63.3 126.7A49.7 49.7 0 0113.7 77c0-14 5.6-33 14.3-48.5C38.3 10.1 50.8 0 63.3 0c12.5 0 25 10.1 35.4 28.5A109 109 0 01113 77a49.7 49.7 0 01-49.7 49.7zM63.3 3C48 3 36.3 20 30.6 30a105 105 0 00-14 47 46.7 46.7 0 0093.4 0c0-13.5-5.5-32-14-47C90.5 20 78.8 3 63.4 3z"/>
  </svg>
</script>

<script type="text/html" id="multiOptionTemplate">
    <div class="btn-group" data-bind="foreach: $data.optionValues">
        <button class="btn btn-secondary amount-button list-group-item-action"
                data-bind="click: function() {$parent.observable($data)},
                          text: $data.toLocaleString('en-US'),
                          css:{ 'pokemon-selected': $parent.observable() === $data}">
        </button>
    </div>
</script>

<script type="text/html" id="pokemonNameTemplate">
    <knockout data-bind="text: $data.pokemon.displayName"></knockout>
    <knockout data-bind="template: { name: 'pokemonGenderTemplate', data: { 'pokemon': $data.pokemon } }">Pokémon gender</knockout>
</script>

<!-- Example usage -->
<!-- <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': Battle.enemyPokemon() } }">Pokémon name</knockout> -->

<script type="text/html" id="pokemonSpriteTemplate">
    <img class="enemy"
        data-bind="attr:{ src: PokemonHelper.getImage($data.pokemon.id, $data.pokemon.shiny, $data.pokemon.gender, $data.pokemon.shadow) }"
        src=""/>
</script>

<!-- Example usage -->
<!-- <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': Battle.enemyPokemon() } }">Pokémon sprite</knockout> -->

<script type="text/html" id="pokemonGenderTemplate">
    <!-- ko ifnot: $data.pokemon.displayName.includes('♂') || $data.pokemon.displayName.includes('♀') -->
        <!-- ko if: $data.pokemon.gender == GameConstants.BattlePokemonGender.Male -->
        <knockout data-bind="html: `<i class='gender-icon-male'>♂</i>`"></knockout>
        <!-- /ko -->

        <!-- ko if: $data.pokemon.gender == GameConstants.BattlePokemonGender.Female -->
        <knockout data-bind="html: `<i class='gender-icon-female'>♀</i>`"></knockout>
        <!-- /ko -->
    <!-- /ko -->
</script>

<!-- Example usage -->
<!-- <knockout data-bind="template: { name: 'pokemonGenderTemplate', data: { 'pokemon': Battle.enemyPokemon() } }">Pokémon gender</knockout> -->

<script type="text/html" id="pokemonAttackTemplate">
  <span style="display: inline;">
      Pokémon Attack:
      <span data-bind="
         text: App.game.party.pokemonAttackObservable().toLocaleString('en-US'),
         tooltip: {
            html: true,
            title: Battle.pokemonAttackTooltip,
            trigger: 'hover',
         }
         "></span>
  </span>
</script>

<!-- Example usage -->
<!-- <knockout data-bind="template: { name: 'pokemonAttackTemplate', data: { 'pokemon': Battle.enemyPokemon() } }">Pokémon sprite</knockout> -->

<script type="text/html" id="multiSelectDropdownTemplate">
    <div class="dropdown">
        <button class="btn btn-dropdown custom-select btn-multiselect-dropdown text-left" type="button" data-toggle="dropdown" data-bind="class: $data.buttonClass">
            <div class="text-truncate btn-text"
                data-bind="text: typeof $data.buttonText === 'function' ? $data.buttonText() : $data.buttonText"></div>
        </button>
        <div class="dropdown-menu multiselect-dropdown px-2">
            <!-- ko if: $data.showSelectAll -->
            <div class="text-center pb-1 mb-1 border-bottom border-secondary">
                <button type="button" class="btn btn-secondary btn-sm btn-block"
                    data-bind="text: (typeof $data.selectAllText === 'function' ? $data.selectAllText() : $data.selectAllText) || 'Select All',
                        click: () => $data.selectAllClick?.()">Select All</button>
            </div>
            <!-- /ko -->
            <div data-bind="foreach: $data.options">
                <div class="form-check d-flex align-items-center">
                    <input type="checkbox" class="form-check-input mt-0" style="cursor: pointer;"
                        data-bind="
                            attr: { id: `${$parent.id}-item${$index()}` },
                            checked: $parent.bindingField,
                            checkedValue: $data[$parent.optionsValue] ?? $data">
                    <label class="form-check-label text-truncate w-100 p-1" style="max-width: 200px; cursor: pointer;"
                        data-bind="
                            text: $data[$parent.optionsText] ?? $data,
                            attr: { for: `${$parent.id}-item${$index()}` },
                            class: $parent.itemLabel?.class,
                            style: $parent.itemLabel?.style?.($data)"
                        onclick="event.stopPropagation();"></label>
                </div>
            </div>
        </div>
    </div>
</script>


<!--
-------------------
-- Example Usage --
-------------------

<knockout data-bind="template: { name: 'multiSelectDropdownTemplate',
    data: {
        id: `helper-category${$index()}`,
        options: PokemonCategories.categories(),
        optionsText: 'name',
        optionsValue: 'id',
        bindingField: $data.categories,
        buttonText: () => {
            return $data.categories().map(id => PokemonCategories.categories().find(c => c.id === id)?.name()).join('; ') || 'All Categories';
        },
        buttonClass: 'btn-secondary btn-sm',
        itemLabel: {
            class: 'text-white small',
            style: (item) => ({ 'background-color': item.color() })
        },
        showSelectAll: true,
        selectAllText: 'All Categories',
        selectAllClick: () => $data.categories([]),
    }}">
</knockout>

----------------
-- Properties --
----------------

id - (Required) Unique identifier for this dropdown menu.
options - (Required) Array of items to display on the dropdown.
optionsText - (Optional) Property to use as the display text for the item. Will use the item itself if not defined.
optionsValue - (Optional) Property to use as the value when the item is selected. Will use the item itself if not defined.
bindingField - (Required) Observable array backing field for the selected items.
buttonText - (Required) String or function to set the text of the dropdown button.
buttonClass - (Optional) Additional classes to customize the dropdown button.
itemLabel - (Optional)
  class - (Optional) Additional classes to customize the item labels.
  style - (Optional) Function to customize CSS styling of the item labels.
showSelectAll - (Optional) Boolean value to display the Select All button. Default is false.
selectAllText - (Optional) String or function to set the text of the Select All button. Default is 'Select All'.
selectAllClick - (Optional) Function called when the Select All button is clicked.

-->

<script type="text/html" id="currency-display-template">
    <div class="currency-display d-flex flex-wrap mx-1 my-2 justify-content-center">
        <img src="" class="mx-1" height="25px" data-bind="attr: { src: `assets/images/currency/${GameConstants.Currency[$data.currency]}.svg` },
            tooltip: {
                html: true,
                title: $data.tooltip,
                trigger: 'hover',
                placement: 'top'
            }">
        <div class="" data-bind="text: App.game.wallet.amountText($data.currency),
            attr: { id: `animateCurrency-${GameConstants.Currency[$data.currency]}` },
            tooltip: {
                title: Settings.getSetting('currencyMainDisplayReduced').observableValue()
                    ? App.game.wallet.currencies[$data.currency]().toLocaleString('en-US')
                    : '',
                trigger: 'hover',
                placement: 'bottom'
            }">0</div>
    </div>
</script>

<script type="text/html" id="wanderingPokémonDisplay">
    <!-- ko if: App.game.party.getPokemon(pokemonMap[$data].id)?.pokerus -->
    <img class="dungeon-pokemon-pkrs" src="" data-bind="
    attr:{ src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[App.game.party.getPokemonByName($data)?.pokerus]}.png` },
    tooltip: {
        title: `EVs: ${App.game.party.getPokemonByName($data).evs().toLocaleString('en-US')}`,
        placement: 'bottom',
        trigger: 'hover'
    }" />
    <!-- /ko -->
    <img class="dungeon-pokemon-preview" src="" data-bind="attr:{ src: PokemonHelper.getImage(pokemonMap[$data].id, App.game.party.getPokemonByName($data)?.shiny ?? false, undefined, GameConstants.ShadowStatus.None) },
    css: { 'dungeon-pokemon-locked': !App.game.party.alreadyCaughtPokemonByName($data) }" onerror="this.src='assets/images/pokemon/0.png';"/>
    <sup class="shiny" data-bind="visible: App.game.party.alreadyCaughtPokemonByName($data, true)">✨</sup>
    <img class="lock" src="assets/images/breeding/lock.svg" data-bind="hidden: pokemonMap[$data].nativeRegion <= player.highestRegion(),
    tooltip: {
      title: `Reach ${GameConstants.camelCaseToString(GameConstants.Region[pokemonMap[$data].nativeRegion])} to attract this Pokémon!`,
        placement: 'top',
        trigger: 'hover'
    }">
</script>

<!-- Example usage -->
<!-- <span data-bind="template: { name: 'wanderingPokémonDisplay', data: 'Pikachu'}"></span> -->


<div id="game" class="container loading" data-bind="css: {'container': Settings.getSetting('gameDisplayStyle').observableValue() === 'standard3', 'container-fluid': Settings.getSetting('gameDisplayStyle').observableValue() !== 'standard3'}">
    <div class="row justify-content-center">
        <!--The id title is needed for a default marker for money animation to display when not in a wild battle where the playerMoney span is not visible-->
        <h1 id="gameTitle">PokéClicker</h1>
    </div>
    <div class="row justify-content-lg-center" style="text-align: center">

        <!--The next two divs switch around on large screens. This way, battle screen/map is on top on smaller screens-->
        <!--left column-->
        <div class="col-lg-3 col-md-6 order-lg-first" data-bind="css: {
            'col-lg-3': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
            'col-lg-4': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
        }">
            <div class="row p-0">
                <div id="left-column-2" class="col-12" data-bind="css: {
                    'col-lg-12': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
                    'col-lg-6': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                }"></div>
                <div id="left-column" class="col-12" data-bind="css: {
                    'col-lg-12': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
                    'col-lg-6': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                }">

                    <!-- pokeball selector -->
                    <div id="pokeballSelector" class="card sortable border-secondary mb-3" data-bind="visible: player.regionStarters[GameConstants.Region.kanto]() != GameConstants.Starter.None">
    <div class="card-header p-0" data-toggle="collapse" href="#pokeballSelectorBody">
        <span>Poké Balls</span>
    </div>
    <!-- ko if: QuestLineHelper.isQuestLineCompleted('Tutorial Quests') -->
    <img class="clickable" src="assets/images/fa-cog.svg"
        style="position: absolute; right: 20px; top: 0px; width: auto; height: 41px; padding: 8px; padding-right: 4px;"
        data-toggle="modal"
        href="#pokeballSelectorAdvModal"
    />
    <!-- /ko -->
    <button type="button" class="btn btn-info"
            style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px; padding: 4px;"
            data-bind="tooltip: { title: 'Select which Poké Ball to use on Pokémon depending on their status. Right click (or long press on mobile) can be used to toggle filter enabled/disabled.', trigger: 'hover', placement:'left' }">
        ?
    </button>
    <div id="pokeballSelectorBody" class="card-body p-0 show">
        <div class="table-responsive d-flex flex-column" data-bind="resizable: { setting: 'pokeballSelector' }">
            <div class="flex-grow-1 flex-shrink-1" style="overflow: auto;">
                <table class="table table-sm m-0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Ball</th>
                            <th>Qty</th>
                        </tr>
                    </thead>
                    <tbody id="pokeballFilters" data-bind="foreach: App.game.pokeballFilters.displayList">
                        <tr data-bind="css: { 'pokeballFilterDisabled': !$data.enabled() }, attr: { 'data-name': $data.name }, event: { contextmenu: () => $data.enabled(!$data.enabled()) }">
                            <td><span data-bind="
                                text: $data.name,
                                tooltip: {
                                    title: $data.description,
                                    trigger: 'hover',
                                    boundary: 'window',
                                    animation: false,
                                    html: true,
                                }
                            "></td>
                            <td>
                                <img class="pokeball-small clickable"
                                    data-bind="
                                        attr: {src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.ball()] + '.svg'},
                                        css: { 'pokeball-selected': $data.enabled() },
                                        tooltip: {
                                            title: $data.ball() === GameConstants.Pokeball.None ? 'None' : ItemList[GameConstants.Pokeball[$data.ball()]].displayName,
                                            trigger: 'hover', animation: false,
                                            placement: 'right'
                                        },
                                        click: function() {App.game.pokeballs.selectedSelection($data.ball); App.game.pokeballs.selectedTitle($data.name); $('#pokeballSelectorModal').modal('show')}
                                    "
                                />
                            </td>
                            <td data-bind="with: {
                                count: App.game.pokeballs.getBallQuantity($data?.ball())
                            }">
                                <span data-bind="
                                    text: count ? GameConstants.formatNumber(count) : '-',
                                    tooltip: count && {
                                        title: count.toLocaleString('en-US'),
                                        trigger: 'hover',
                                        animation: false
                                    }
                                "></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Reserved space for resize drag handle -->
            <div class="card-footer py-2"></div>
        </div>
    </div>
    <script type="text/html" id="selectedPokeballCountTemplate">

    </script>
</div>


                    <!-- Battle Item container-->
                    <div id="battleItemContainer" class="card sortable border-secondary mb-3" data-bind="hidden: Settings.getSetting('hideChallengeRelatedModules').observableValue() && App.game.challenges.list.disableBattleItems.active() && !App.game.badgeCase.hasBadge(BadgeEnums.Heat)">
  <div data-bind="hidden: Settings.getSetting('hideChallengeRelatedModules').observableValue() && App.game.challenges.list.disableBattleItems.active()">
    <div class="card-header p-0" data-toggle="collapse" href="#battleItemContainerBody">
      <span>Battle Items</span>
    </div>
    <button type="button" class="btn btn-sm btn-primary"
            style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;"
            data-bind="text: EffectEngineRunner.multipliers[EffectEngineRunner.multIndex()]"
            onclick="EffectEngineRunner.incrementMultiplier()"
            oncontextmenu="EffectEngineRunner.decrementMultiplier(); return false"
            title="Controls"
            data-toggle="popover"
            data-html="true"
            data-content="Left/right click to cycle amount<br/>Click on item image to use"
            data-placement="right"
            data-trigger="hover">1
    </button>
    <div id="battleItemContainerBody" class="card-body p-0 show">
      <p data-bind="visible: App.game.challenges.list.disableBattleItems.active()" class="bg-danger my-0">
          Battle Items are disabled.
      </p>
      <!-- Battle Items -->
      <table class="table table-bordered m-0">
        <tbody>
          <tbody data-bind="foreach: GameHelper.chunk(6, Object.keys(ItemList).filter(i=>ItemList[i].constructor.name == 'BattleItem'))">
            <tr data-bind="foreach: $data">
                <td class="amount p-0" data-bind="text: GameHelper.formatAmount(player.itemList[$data]()),tooltip:{title:player.itemList[$data]().toLocaleString('en-US'),trigger:'hover',placement:'top',animation:false}"></td>
            </tr>
            <tr data-bind="foreach: $data">
                <td class="p-0" data-bind="attr: {
                                disabled: !player.itemList[$data]()
                            },
                            css: {
                                'bg-primary': EffectEngineRunner.getEffect($data) > 5,
                                'bg-warning': EffectEngineRunner.getEffect($data) <= 5 && EffectEngineRunner.getEffect($data) > 0,
                                'bg-secondary': !EffectEngineRunner.isActive($data)()
                            },
                            event: {
                                click: function(){ItemHandler.useItem($data, EffectEngineRunner.amountToUse())}
                            },
                            tooltip: {
                              title: '<strong>' + ItemList[$data].displayName + '</strong>' + '<br/>' + ItemList[$data].description,
                              trigger: 'hover',
                              placement: $(window).innerWidth() < 768 ? 'bottom' : 'left',
                              html: true
                            }">
                <img src="" class="clickable" data-bind="attr: { src: ItemList[$data].image }" width="26px">

            </td>
            </tr>
            <tr data-bind="foreach: $data">
                <td class="text-light p-0">
              <!-- ko if: EffectEngineRunner.getEffect($data) > 0 -->
                <code data-bind="text: player.effectTimer[$data](),tooltip: {title:GameConstants.formatSecondsToTime(player.effectList[$data]()),trigger:'hover',placement:'bottom',html:true}"></code>
              <!-- /ko -->
                </td>
            </tr>
          </tbody>
        </tbody>
      </table>
    </div>
  </div>

  <div class="position-relative" data-bind="visible: App.game.badgeCase.hasBadge(BadgeEnums.Heat)">
    <div class="card-header p-0 position-relative" data-toggle="collapse" href="#fluteItemContainerBody">
      <span>Flutes</span>
      <button type="button" class="btn"
        style="position: absolute; left: 0px; top: 0px; width: auto; height: 41px; padding: 4px;"
        data-bind="visible: FluteEffectRunner.additionalInfoTooltip().length !== 0,
        tooltip: {
            title: FluteEffectRunner.additionalInfoTooltip(),
            trigger: 'hover',
            placement:'left',
            html: true,
          }">ⓘ
    </button>
    </div>
      <button type="button" class="btn btn-sm btn-primary"
          style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;"
          onclick="App.game.gems.openGemModal()"
          title="Controls"
          data-toggle="popover"
          data-html="true"
          data-content="Click to see your total gems<br/>Click on flutes to toggle effects"
          data-placement="right"
          data-trigger="hover">
      <img src="assets/images/keyitems/Gem_case.png">
    </button>
    <div id="fluteItemContainerBody" class="card-body p-0 show">
      <!-- Flutes -->
      <table class="table table-bordered m-0">
        <tbody>
          <tbody data-bind="foreach: GameHelper.chunk(6, Object.keys(ItemList).filter(i=>ItemList[i].constructor.name == 'FluteItem'))">
            <tr data-bind="foreach: $data">
              <td class="amount p-0" data-bind="text: GameHelper.formatAmount(FluteEffectRunner.getLowestGem(ItemList[$data].name)),
                tooltip:{
                  title:FluteEffectRunner.fluteGemTooltip(ItemList[$data]),
                  trigger:'hover',
                  placement:'top',
                  animation:false,
                  sanitize: false,
                  html:true
                }">
              </td>
            </tr>
            <tr data-bind="foreach: $data">
              <td class="p-0" data-bind="attr: {
                              disabled: !player.itemList[$data]()
                          },
                          css: {
                              'bg-primary': FluteEffectRunner.getEffect($data) > 30,
                              'bg-warning': FluteEffectRunner.getEffect($data) <= 30 && FluteEffectRunner.getEffect($data) > 0,
                              'bg-secondary': !FluteEffectRunner.isActive($data)(),
                          },
                          style: {
                              'opacity': player.itemList[$data]() || FluteEffectRunner.isActive($data)() ? '1' : '0.1'
                          },
                          event: {
                              click: function(){ItemHandler.useItem($data)}
                          },
                          tooltip: {
                            title: ItemList[$data].getFormattedTooltip(ItemList[$data]),
                            trigger: 'hover',
                            placement: $(window).innerWidth() < 768 ? 'bottom' : 'left',
                            sanitize: false,
                            html: true
                          }">
                <img src="" class="clickable" data-bind="attr: { src: ItemList[$data].image }" width="26px">
              </td>
            </tr>
            <tr data-bind="foreach: $data">
              <td class="text-light p-0" data-bind="
                tooltip: {
                  title: FluteEffectRunner.fluteTooltip($data),
                  trigger:'hover',
                  placement:'bottom',
                  html:true
              }">
              <!-- ko if: FluteEffectRunner.getEffect($data) > 0 -->
                <code data-bind="
                text: player.effectTimer[$data]()">
                </code>
              <!-- /ko -->
              </td>
            </tr>
          </tbody>
        </tbody>
      </table>
    </div>
  </div>

  <div data-bind="hidden: !App.game.zMoves.canAccess() || (Settings.getSetting('hideChallengeRelatedModules').observableValue() && App.game.challenges.list.disableBattleItems.active())">
    <div class="card-header p-0" data-toggle="collapse" href="#zCrystalItemContainerBody">
        <span>Z-Crystals</span>
      </div>
      <div id="zCrystalItemContainerBody" class="card-body p-0 show">
        <p data-bind="visible: App.game.challenges.list.disableBattleItems.active()" class="bg-danger my-0">
          Z-Moves are disabled.
        </p>
        <table class="table table-bordered m-0" data-bind="visible: App.game.zMoves.canAccess()">
          <tbody>
            <tbody data-bind="visible : !App.game.zMoves.isActive(), foreach : GameHelper.chunk(6, GameConstants.zCrystalItemType)">
              <tr data-bind="foreach : $data">
                <td class="p-0" data-bind="attr: {
                                            disabled: !ItemHandler.hasItem($data) || App.game.zMoves.isActive()
                                          },
                                          style: {
                                            'opacity': ItemHandler.hasItem($data) && !App.game.zMoves.isActive() ? '1' : '0.1'
                                          },
                                          css: {
                                            'bg-primary' : App.game.zMoves.isActive() && App.game.zMoves.type() === ItemList[$data].type,
                                            'bg-secondary': !App.game.zMoves.isActive() || App.game.zMoves.type() !== ItemList[$data].type
                                          },
                                          event: {
                                            click: function(){ItemHandler.useItem($data)}
                                          },
                                          tooltip: {
                                            title: '<strong>' + ItemList[$data].displayName + '</strong>' + '<br/>' + ItemList[$data].getDescription(),
                                            trigger: 'hover',
                                            placement: $(window).innerWidth() < 768 ? 'bottom' : 'left',
                                            html: true
                                          }">
                  <img src="" class="clickable" data-bind="attr: { src: ItemList[$data].image }" width="26px">
                </td>
              </tr>
            </tbody>
            <tbody data-bind="visible: App.game.zMoves.isActive()">
              <tr>
                <td class="p-0 bg-primary" colspan="2" rowspan="3" data-bind="tooltip: { title: ItemList[GameConstants.zCrystalItemType[App.game.zMoves.type()]].displayName + '<br/>' + ItemList[GameConstants.zCrystalItemType[App.game.zMoves.type()]].getDescription(), trigger: 'hover', placement: 'bottom', html: true }">
                  <img src="" data-bind="attr: { src: ItemList[GameConstants.zCrystalItemType[App.game.zMoves.type()]].image,  }">
                </td>
                <td class="p-0 bg-secondary" colspan="4" rowspan="2">
                  <p class="mb-0" data-bind="text: `${App.game.zMoves.getMultiplier() < 1 ? '' : '+'}${(App.game.zMoves.getMultiplier() - 1).toLocaleString('en-US', { style: 'percent' })} Attack to all your ${PokemonType[App.game.zMoves.type()]}-type Pokémon`">bonus</p>
                </td>
              </tr>
              <tr></tr>
              <tr>
                <td class="p-0" colspan="4" rowspan="1">
                  <code data-bind="text: `${App.game.zMoves.formattedTime()} left`">00:00 left</code>
                </td>
              </tr>
            </tbody>
          </tbody>
        </table>
      </div>
  </div>
</div>


                    <!-- Pokémon List container-->
                    <script type="text/html" id="PartySortSettingTemplate">
    <div class="row no-gutters" style="align-items: center">
        <div class="input-group">
            <select
                class="custom-select"
                onchange="Settings.setSettingByName(this.name, SortOptions[SortOptions[this.value]])"
                data-bind="foreach: $data.options, attr: {name}"
            >
                <option data-bind="text: $data.text, value: $data.value, attr:{ selected: $parent.observableValue() == $data.value}"></option>
            </select>
            <div class="input-group-append bg-primary text-light">
                <label
                    for="partySortDirection"
                    class="clickable m-0 pl-2 pr-2"
                    style="font-size: 22px;"
                    data-bind="
                        text: Settings.getSetting('partySortDirection').observableValue() ? '⥄' : '⥂',
                        tooltip: { title: Settings.getSetting('partySortDirection').observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)', trigger: 'hover', placement:'top' }"
                >⥂</label>
                <input
                    id="partySortDirection"
                    style="vertical-align: middle"
                    class="hidden"
                    type="checkbox"
                    data-bind="checked: Settings.getSetting('partySortDirection').observableValue()"
                    onchange="Settings.setSettingByName('partySortDirection', this.checked)"
                />
            </div>
        </div>
    </div>
</script>
<div id="pokemonListContainer" class="card sortable border-secondary mb-3" data-bind="visible: player.regionStarters[GameConstants.Region.kanto]() != GameConstants.Starter.None">
    <div class="card-header p-0" data-toggle="collapse" href="#pokemonListBody">
        <span>Pokémon List</span>
    </div>
    <div id="pokemonListBody" class="card-body p-0 show">
        <div class="table-responsive d-flex flex-column"  data-bind="resizable: { setting: 'pokemonList' }">
            <div class="flex-grow-1 flex-shrink-1" style="overflow: auto;">
                <div data-bind="template: { name: 'PartySortSettingTemplate', data: Settings.getSetting('partySort')}"></div>
                <table id="pokemonList" class="table table-striped table-hover table-sm m-0">
                    <thead>
                        <tr>
                            <td></td>
                            <td>
                                <div>
                                    <div class="pokemonName">
                                        <span>Name</span>
                                    </div>
                                    <div class="pokemonAttack">Attack</div>
                                    <div class="pokemonLevel">Level</div>
                                </div>
                            </td>
                        </tr>
                    </thead>

                    <tbody data-bind="let: { lazyPokemonList: lazyLoad('lazyPokemonList', $element, PartyController.getSortedList, { pageSize: 20, reset: () => (DisplayObservables.collapseState.pokemonListBody === 'hidden'), pause: () => DisplayObservables.collapseState.pokemonListBody !== 'show' }) }">
                    <!-- ko if: DisplayObservables.collapseState.pokemonListBody !== 'hidden' -->
                        <!-- ko foreach: lazyPokemonList, childrenComplete: () => { lazyLoadCallback('lazyPokemonList'); } -->
                        <tr data-toggle="modal" href="#pokemonStatisticsModal" data-bind="hidden: $data.breeding, click: () => { App.game.statistics.selectedPokemonID($data.id) }">
                            <td>
                                <img
                                    class="smallImage"
                                    data-bind="attr: { src: PokemonHelper.getImage($data.id) }"
                                    src=""
                                    alt=""
                                />
                            </td>
                            <td>
                                <div>
                                    <div class="pokemonName">
                                        <span data-bind="text: displayName">Name</span>
                                        <sup data-bind="visible: App.game.party.alreadyCaughtPokemon($data.id, true)">✨</sup>
                                        <img class="shadow-icon" src="assets/images/status/shadow.svg" data-bind="visible: $data.shadow == GameConstants.ShadowStatus.Shadow"/>
                                        <img class="shadow-icon" src="assets/images/status/purified.svg" data-bind="visible: $data.shadow == GameConstants.ShadowStatus.Purified"/>
                                        <!-- ko foreach: PokemonHelper.getMegaStones($data.name).filter(s => player.hasMegaStone(s.megaStone)) -->
                                        <img width="20px" data-bind="attr: { src: $data.image },
                                            tooltip: {
                                                title: pokemonMap[$parent.name].evolutions.flatMap(e => e.restrictions)
                                                    .find(r => r instanceof MegaEvolveRequirement && r.megaStone == $data.megaStone)?.hint() ?? '',
                                                trigger: 'hover',
                                                placement: 'bottom'
                                        }"/>
                                        <!-- /ko -->
                                    </div>
                                    <div class="pokemonAttack" data-bind="text: attack.toLocaleString('en-US')"></div>
                                    <div class="pokemonLevel" data-bind="text: level"></div>
                                </div>
                            </td>
                        </tr>
                        <!-- /ko -->
                    <!-- /ko -->
                    </tbody>
                </table>
            </div>
            <!-- Reserved space for resize drag handle -->
            <div class="card-footer py-2"></div>
        </div>
    </div>
</div>

                </div>
            </div>
        </div>

        <!--Middle column-->
        <div id="middle-column" class="col-lg-6 col-md-12 order-md-first" data-bind="css: {
            'col-lg-6': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
            'col-lg-4': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
        }">
            <div id="middle-top-sort-column">
                <!-- Achievement Tracker -->
                <div
  id="achivementTrackerContainer"
  class="card sortable border-secondary mb-3"
  data-bind="visible: App.game.achievementTracker.canAccess()"
>
  <div class="card-header p-0" data-toggle="collapse" href="#achievementTrackerBody">
    <span style="text-align: center">Achievement Tracker</span>
  </div>
  <button
    class="btn btn-sm btn-primary"
    style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;"
    data-toggle="modal"
    href="#achievementsModal"
    onclick="AchievementHandler.filterAchievementList(true);"
  >
    List
  </button>
  <div
    id="achievementTrackerBody"
    class="card-body show p-0"
  >
    <!-- ko if: !App.game.achievementTracker.hasTrackedAchievement() -->
    <div
      class="clickable table-warning text-light p-2"
      href="#achievementsModal"
      data-toggle="modal"
    >
      Select an achievement to track!
    </div>
    <!-- /ko -->

    <!-- ko if: App.game.achievementTracker.hasTrackedAchievement()-->
    <table class="table table-sm m-0">
      <tbody>
        <tr>
          <td colspan="2" data-bind="text: App.game.achievementTracker.trackedAchievement().description">
            Achievement Description
          </td>
        </tr>
        <tr>
          <td class="p-0">
            <div class="progress p-0">
              <div
                class="progress-bar bg-primary"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="100"
                data-bind="attr:{ style: 'width:' + App.game.achievementTracker.trackedAchievement().getProgressPercentage() + '%'}, css: {
                           'bg-success': App.game.achievementTracker.trackedAchievement().isCompleted(),
                           'bg-primary': !App.game.achievementTracker.trackedAchievement().isCompleted()
                         }">
                <span data-bind="text: App.game.achievementTracker.trackedAchievement().getProgressText">0 / 1000</span>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- /ko -->
  </div>
 </div>


                <!-- Currency container -->
                <div id="currencyContainer" class="card sortable border-secondary mb-3" data-bind="visible: player.regionStarters[GameConstants.Region.kanto]() != GameConstants.Starter.None">
    <div class="card-header p-0" data-toggle="collapse" href="#currencyBody">
        <span>Currency</span>
    </div>
    <div id="currencyBody" class="card-body p-0 show">
        <div class="currency-wrapper p-1" data-bind="css: { 'short-currencies': Settings.getSetting('currencyMainDisplayReduced').observableValue() }">
            <div class="currency-line">
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.money, tooltip: 'Pokédollars<br /><br />Gained by defeating Pokémon and trainers in battle.' } }"></div>
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.dungeonToken, tooltip: 'Dungeon Tokens<br /><br />Gained by catching wild Pokémon.' } }"></div>
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.questPoint, tooltip: 'Quest Points<br /><br />Gained by completing Quests.' } }"></div>
            </div>

            <!-- ko if: Settings.getSetting('currencyMainDisplayExtended').observableValue() -->
            <div class="currency-line">
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.farmPoint, tooltip: 'Farm Points<br /><br />Gained by harvesting berries on the Farm.' } }"></div>
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.diamond, tooltip: 'Diamonds<br /><br />Gained by selling treasure found in the Underground.' } }"></div>
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.battlePoint, tooltip: 'Battle Points<br /><br />Gained at the Battle Frontier.' } }"></div>
                <div data-bind="template: { name: 'currency-display-template', data: { currency: GameConstants.Currency.contestToken, tooltip: 'Contest Tokens<br /><br />Gained by competing in Contests.' } },
                    visible: App.game.wallet.currencies[GameConstants.Currency.contestToken]() > 0"></div>
            </div>
            <!-- /ko -->
        </div>
    </div>
</div>

            </div>
            <div id="battleContainer" class="card sortable-disabled border-secondary mb-3">
                <!--RouteBattleView-->
                <!--Use the base battle layout for fighting, dungeons and battle frontier.-->

                <div class="battle-view card-body p-0 justify-content-center no-gutters no-select"
                    data-bind="if: (App.game.gameState === GameConstants.GameState.fighting ||
                        App.game.gameState === GameConstants.GameState.dungeon ||
                        App.game.gameState === GameConstants.GameState.paused ||
                        App.game.gameState === GameConstants.GameState.town ||
                        App.game.gameState === GameConstants.GameState.gym ||
                        App.game.gameState == GameConstants.GameState.battleFrontier ||
                        App.game.gameState == GameConstants.GameState.temporaryBattle ||
                        App.game.gameState == GameConstants.GameState.contest),
                        class: MapHelper.calculateBattleCssClass()">

                    <!-- Route Battles -->
                    <div id="routeBattleContainer" class="row justify-content-center no-gutters" data-bind="if: App.game.gameState === GameConstants.GameState.fighting">
                        <div class="col no-gutters clickable" data-bind="click: function() {Battle.clickAttack()}" style="height: 280px; display: block;">
                            <div class="pageItemTitle d-flex justify-content-center">
                                <div class="title-left"></div>
                                <div class="d-flex align-items-center px-2">
                                    <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': Battle.enemyPokemon() } }" style="font-size: 1.6rem;">Pokémon name</knockout>
                                    <knockout class="ml-2" data-bind="template: { name: 'caughtStatusTemplate', data: {'status': PartyController.getCaughtStatus(Battle.enemyPokemon().id)}}"></knockout>
                                    <knockout class="ml-2" style="position: relative;"
                                        data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                            'pokerus': PartyController.getPokerusStatus(Battle.enemyPokemon().id),
                                            'evs': App.game.party.getPokemon(Battle.enemyPokemon().id)?.evs() }}">
                                    </knockout>
                                </div>
                                <div class="title-right">
                                    <div class="d-flex align-items-center mr-1 ml-auto" data-bind="using: App.game.statistics.dungeonsCleared[GameConstants.getDungeonIndex(player.town.name)]()">
                                        <div class="px-1 clickable" data-bind="tooltip: { title: 'See the Pokémon available on this route.', trigger: 'hover' }, click: function() { $('#routeInfoModal').modal('show') }" data-original-title="" title="">
                                            <img src="assets/images/encountersInfo/encountersInfo.png">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div data-bind="visible: !Battle.catching()">
                                    <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': Battle.enemyPokemon() } }">Pokémon sprite</knockout>
                                </div>
                                <div data-bind="visible: Battle.catching()" class="catchChance">
                                    <img class="pokeball-animated"
                                         data-bind="attr:{ src: 'assets/images/pokeball/' + GameConstants.Pokeball[Battle.pokeball()] + '.svg'}"
                                         src=""/>
                                    <br>
                                    Catch Chance:
                                    <knockout data-bind="text: Math.floor(Battle.catchRateActual()) + '%'">Catch Rate</knockout>
                                </div>
                            </div>
                            <div class="progress hitpoints" style="height: 20px;">
                                <div class="progress-bar bg-danger" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + Battle.enemyPokemon().healthPercentage() + '%' }"
                                     aria-valuemin="0" aria-valuemax="100">
                                     <span data-bind="text: Battle.enemyPokemon().health().toLocaleString('en-US') + ' / ' + Battle.enemyPokemon().maxHealth().toLocaleString('en-US')" style="font-size: 12px;"></span>
                                </div>
                            </div>

                            <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
                              <table width="100%">
                                  <tr>
                                    <!-- Routes --->
                                    <!-- ko if: App.game.gameState === GameConstants.GameState.fighting -->
                                    <td width="50%">
                                      <span style="display: inline;">
                                        <knockout data-bind="text: Routes.getName(player.route, player.region)"></knockout>
                                        <!--If all Pokémon in the dungeon are caught or caught shiny-->
                                        <knockout data-bind="if: RouteHelper.routeCompleted(player.route, player.region, false)">
                                            <img class="pokeball-smallest"
                                                 data-bind="attr: { src: `assets/images/pokeball/Pokeball${RouteHelper.routeCompleted(player.route, player.region, true) ? '-shiny' : ''}.svg`},
                                                 tooltip: {
                                                trigger: 'hover', placement: 'bottom', title: `You have captured all Pokémon${RouteHelper.routeCompleted(player.route, player.region, true) ? ' shiny' : ''} on this route!`
                                              }"/>
                                        </knockout>

                                        <!--Pokérus image-->
                                        <knockout data-bind="if: RouteHelper.minPokerusCheck(RouteHelper.getAvailablePokemonList(player.route, player.region, true))">
                                            <img data-bind="attr:{ src: 'assets/images/breeding/pokerus/' + GameConstants.Pokerus[RouteHelper.minPokerus(RouteHelper.getAvailablePokemonList(player.route, player.region, true))] + '.png' },
                                            tooltip: { title: RouteHelper.routePokerusEVs(player.route, player.region), trigger: 'hover', placement: 'bottom', html: true }"
                                          src=""/>
                                        </knockout>
                                      </span>
                                    </td>
                                    <td width="50%">
                                      <knockout data-bind="using: App.game.statistics.routeKills[player.region][player.route]()">
                                          <knockout data-bind="text: $data.toLocaleString('en-US')">0</knockout>
                                          <knockout data-bind="visible: $data < GameConstants.ROUTE_KILLS_NEEDED">/ 10</knockout>
                                          &nbsp;Pokémon defeated
                                      </knockout>
                                    </td>
                                    <!-- /ko -->
                                  </tr>
                                  <tr>
                                    <td width="50%">
                                        <knockout data-bind="template: { name: 'pokemonAttackTemplate', data: { 'pokemon': Battle.enemyPokemon() } }"></knockout>
                                    </td>
                                    <td width="50%" data-bind="css: { 'text-muted': App.game.challenges.list.disableClickAttack.active() }">
                                        <span style="display: inline;" data-bind="tooltip: {
                                            title: 'See the Click Attack tab in the Start → Statistics menu for details.',
                                            placement: 'bottom',
                                            trigger: 'hover'
                                        }">
                                            Click Attack:
                                            <span data-bind="text: App.game.party.calculateClickAttack().toLocaleString('en-US')"></span>
                                        </span>
                                    </td>
                                  </tr>
                                </table>
                            </h2>
                        </div>
                    </div>

                    <!-- Dungeon Battles -->
                    <div class="row justify-content-center no-gutters" data-bind="if: App.game.gameState === GameConstants.GameState.dungeon">
    <div class="col no-gutters clickable" style="height: 280px; display: block;"
        data-bind="click: function() { DungeonRunner.handleInteraction() }">
        <h2 class="pageItemTitle mobileBattleTitle" style="display: block;">
            <knockout data-bind="if: DungeonBattle.enemyPokemon() && DungeonBattle.enemyPokemon().health()">
                <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': DungeonBattle.enemyPokemon() } }">Pokémon name</knockout>
                <!-- ko if: !DungeonBattle.trainer() -->
                <knockout data-bind="template: { name: 'caughtStatusTemplate', data: {'status': PartyController.getCaughtStatus(DungeonBattle.enemyPokemon().id)}}"></knockout>
                <knockout style="position: relative; top: -1px;"
                    data-bind="template: { name: 'pokerusStatusTemplate', data: {
                        'pokerus': PartyController.getPokerusStatus(DungeonBattle.enemyPokemon().id),
                        'evs': App.game.party.getPokemon(DungeonBattle.enemyPokemon().id)?.evs() }}">
                </knockout>
                <!-- /ko -->
            </knockout>
            <knockout data-bind="if: !DungeonBattle.enemyPokemon() || !DungeonBattle.enemyPokemon().health()">
                &nbsp;
            </knockout>

            <knockout class="left">
                <!-- ko if: DungeonBattle.trainer() -->
                <knockout data-bind="text: DungeonBattle.trainer().name">Trainer name</knockout>
                <!-- /ko -->
            </knockout>

            <!-- ko ifnot: DungeonBattle.trainer() -->
            <knockout class="right" data-bind="css: { 'text-danger': DungeonRunner.timeLeftSeconds() < 20, 'text-primary': DungeonRunner.timeLeftSeconds() >= 20 }">
                <h4><strong data-bind="text: DungeonRunner.timeLeftSeconds() + 's'"></strong></h4>
            </knockout>
            <!-- /ko -->
            <!-- ko if: DungeonBattle.trainer() -->
            <knockout class="right">
                <span data-bind="foreach: new Array(DungeonBattle.defeatedTrainerPokemon())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest pokeball-defeated"/>
                </span>
                <span data-bind="foreach: new Array(DungeonBattle.remainingTrainerPokemon())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest"/>
                </span>
            </knockout>
            <!-- /ko -->
            <div class="progress timer">
                <div class="progress-bar bg-danger" role="progressbar"
                     data-bind="attr:{ style: 'width:' + DungeonRunner.timeLeftPercentage() + '%' },
                     css: { 'bg-danger': DungeonRunner.timeLeftSeconds() < 20, 'bg-primary': DungeonRunner.timeLeftSeconds() >= 20 }"
                     aria-valuemin="0" aria-valuemax="100">
                     <span data-bind="text: DungeonRunner.timeLeftSeconds() + 's'" style="font-size: 12px;"></span>
                </div>
            </div>
        </h2>

        <!-- ko if: (DungeonRunner.fighting() || DungeonBattle.catching)  -->
        <div data-bind="if: DungeonBattle.enemyPokemon">
            <div class="trainer" data-bind="if: DungeonBattle.trainer() && !DungeonBattle.trainer().options?.hideTrainer">
                <img data-bind="attr:{ src: DungeonBattle.trainer().image }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
            </div>
            <div class="dungeon-enemy">
                <div data-bind="ifnot: DungeonBattle.catching">
                    <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': DungeonBattle.enemyPokemon() } }">Pokémon sprite</knockout>
                </div>
                <div data-bind="if: DungeonBattle.catching" class="catchChance">
                    <img class="pokeball-animated"
                         data-bind="attr:{ src: 'assets/images/pokeball/' + GameConstants.Pokeball[DungeonBattle.pokeball()] + '.svg' }"
                         src=""/>
                    <br>
                    Catch Chance:
                    <knockout data-bind="text: Math.floor(DungeonBattle.catchRateActual()) + '%'">Catch Rate</knockout>
                </div>
            </div>
            <div class="progress hitpoints dungeonhitpoints" style="height: 20px;">
                <div class="progress-bar bg-danger" role="progressbar"
                     data-bind="attr:{ style: 'width:' + DungeonBattle.enemyPokemon().healthPercentage() + '%'}, css: { 'healthbar-boss': DungeonRunner.fightingBoss(), 'bg-danger': !DungeonRunner.fightingBoss()}"
                     aria-valuemin="0" aria-valuemax="100">
                     <span data-bind="text: DungeonBattle.enemyPokemon().health().toLocaleString('en-US') + ' / ' + DungeonBattle.enemyPokemon().maxHealth().toLocaleString('en-US')" style="font-size: 12px;"></span>
                </div>
            </div>
        </div>
        <!-- /ko -->
        <!-- ko if: DungeonRunner.map.currentTile().type() === GameConstants.DungeonTileType.chest -->
        <div data-bind="with: DungeonRunner.map.currentTile()">
            <div class="dungeon-chest" style="height: 95px">
                <img data-bind='attr: { src: `assets/images/dungeons/chest-${$data.metadata.tier}.png` }'/>
            </div>
            <button class="btn btn-warning chest-button">
                <p>Open <span data-bind="text: $data.metadata.tier"></span> chest</p>
                <p>(+20% Enemy HP)</p>
            </button>
        </div>
        <!-- /ko -->
        <!-- ko if: (DungeonRunner.map.currentTile().type() === GameConstants.DungeonTileType.boss && !DungeonRunner.fightingBoss()) -->
        <div>
            <button class="btn btn-danger dungeon-button">Start Bossfight</button>
        </div>
        <!-- /ko -->
        <!-- ko if: (DungeonRunner.map.currentTile().type() === GameConstants.DungeonTileType.ladder) -->
        <div>
            <button class="btn btn-warning dungeon-button">Go to next floor</button>
        </div>
        <!-- /ko -->
        <!-- ko if: DungeonRunner.map.currentTile().type() === GameConstants.DungeonTileType.entrance && DungeonRunner.map.playerMoved() && !DungeonGuides.hired() -->
        <div>
            <button class="btn btn-warning dungeon-button">Leave Dungeon</button>
        </div>
        <!-- /ko -->
        <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
          <table width="100%">
              <tr>
                <td width="50%">
                  <knockout data-bind="text: DungeonRunner.dungeon.name">Dungeon name</knockout>
                  <!--If all Pokémon in the dungeon are caught or caught shiny-->
                  <knockout data-bind="if: DungeonRunner.dungeonCompleted(DungeonRunner.dungeon, false)">
                      <img class="pokeball-smallest"
                           data-bind="attr: { src: `assets/images/pokeball/Pokeball${DungeonRunner.dungeonCompleted(DungeonRunner.dungeon, true) ? '-shiny' : ''}.svg`},
                           tooltip: {
                            trigger: 'hover', placement: 'bottom', title: `You have captured all Pokémon${DungeonRunner.dungeonCompleted(DungeonRunner.dungeon, true) ? ' shiny' : ''} in this dungeon!`
                        }"/>
                  </knockout>

                  <!--Pokérus image-->
                  <knockout data-bind="if: RouteHelper.minPokerusCheck(DungeonRunner.dungeon.allAvailablePokemon())">
                      <img data-bind="attr:{ src: 'assets/images/breeding/pokerus/' + GameConstants.Pokerus[RouteHelper.minPokerus(DungeonRunner.dungeon.allAvailablePokemon())] + '.png' },
                      tooltip: { title: RouteHelper.dungeonPokerusEVs(DungeonRunner.dungeon), trigger: 'hover', placement: 'bottom', html: true }"
                    src=""/>
                  </knockout>

                  <!-- ko if: player.town.dungeon.allAvailableShadowPokemon().length -->
                  <img height="19" src="assets/images/status/shadow.svg" data-bind="
                    css: { 'dungeon-pokemon-locked': player.town.dungeon.allAvailableShadowPokemon().some(p => (App.game.party.getPokemonByName(p)?.shadow ?? GameConstants.ShadowStatus.None) < GameConstants.ShadowStatus.Shadow) },"/>
                  <!-- /ko -->
                </td>
                <td width="50%">
                  <knockout data-bind="text: `${App.game.statistics.dungeonsCleared[GameConstants.getDungeonIndex(DungeonRunner.dungeon.name)]().toLocaleString('en-US')} Clears`"></knockout>
                </td>
              </tr>
              <tr>
                <td width="50%">
                    <knockout data-bind="template: { name: 'pokemonAttackTemplate', data: { 'pokemon': Battle.enemyPokemon() } }"></knockout>
                </td>
                <td width="50%" data-bind="css: { 'text-muted': App.game.challenges.list.disableClickAttack.active() }">
                    <span style="display: inline;">Click Attack:
                        <span data-bind="text: App.game.party.calculateClickAttack().toLocaleString('en-US')"></span>
                    </span>
                </td>
              </tr>
          </table>
        </h2>
    </div>
</div>


                    <!-- Gym Battles -->
                    
<div class="row justify-content-center no-gutters" data-bind="if: App.game.gameState === GameConstants.GameState.gym">
    <div class="col no-gutters clickable" data-bind="click: function() {GymBattle.clickAttack()}" style="height: 280px; display: block;">
        <h2 class="pageItemTitle mobileBattleTitle" style="display: block;">
            <knockout>
                <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': GymBattle.enemyPokemon() } }">Pokémon name</knockout>
            </knockout>

            <knockout class="right">
                <span data-bind="foreach: new Array(GymBattle.pokemonsDefeatedComputable())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest pokeball-defeated"/>
                </span>
                <span data-bind="foreach: new Array(GymBattle.pokemonsUndefeatedComputable())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest"/>
                </span>
            </knockout>

            <div class="progress timer">
                <div class="progress-bar bg-danger" role="progressbar"
                     data-bind="attr:{ style: 'width:' + GymRunner.timeLeftPercentage() + '%' },
                     css: { 'bg-danger': GymRunner.timeLeftSeconds() < 10, 'bg-primary': GymRunner.timeLeftSeconds() >= 10 }"
                     aria-valuemin="0" aria-valuemax="100">
                     <span data-bind="text: GymRunner.timeLeftSeconds() + 's'" style="font-size: 12px;"></span>
                </div>
            </div>
        </h2>

        <div id="gymGoContainer" data-bind="if: Settings.getSetting('showGymGoAnimation').observableValue">
          <div class="row" style="display: inline-block; vertical-align: middle;">
            <div class="col-sm-6 offset-sm-3">
              <img style="width:100%" id="gymGo" src="assets/gifs/go.gif">
            </div>
          </div>
        </div>

        <div class="trainer">
            <img data-bind="attr:{ src: GymBattle.gym.imagePath }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
        </div>

        <div>
            <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': GymBattle.enemyPokemon() } }">Pokémon sprite</knockout>
        </div>

        <div class="progress hitpoints trainerhitpoints">
            <div class="progress-bar bg-danger" role="progressbar"
                    data-bind="attr:{ style: 'width:' + GymBattle.enemyPokemon().healthPercentage() + '%' }"
                    aria-valuemin="0" aria-valuemax="100">
                <span data-bind="text: GymBattle.enemyPokemon().health().toLocaleString('en-US') + ' / ' + GymBattle.enemyPokemon().maxHealth().toLocaleString('en-US')" style="font-size: 12px;"></span>
            </div>
        </div>

        <button class="btn btn-sm btn-danger stop-auto" data-bind="visible: GymRunner.autoRestart()"
                onclick="GymRunner.autoRestart(false)">
            Stop Auto
        </button>
        <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
            <table width="100%">
              <tr>
                <td with="50%">
                  <knockout data-bind="text: GymBattle.gym.leaderName.replace(/\d/g,'')"></knockout>
                </td>
                <td width="50%">
                  <knockout data-bind="text: `${(GymRunner.gymObservable()?.clears() ?? 0).toLocaleString('en-US')} Clears`"></knockout>
                </td>
              </tr>
              <tr>
                <td width="50%">
                    <knockout data-bind="template: { name: 'pokemonAttackTemplate', data: { 'pokemon': Battle.enemyPokemon() } }"></knockout>
                </td>
                <td width="50%" data-bind="css: { 'text-muted': App.game.challenges.list.disableClickAttack.active() }">
                    <span style="display: inline;">Click Attack:
                        <span data-bind="text: App.game.party.calculateClickAttack().toLocaleString('en-US')"></span>
                    </span>
                </td>
              </tr>
          </table>
        </h2>
    </div>
</div>


                    <!-- One Time Battles -->
                    <div class="row justify-content-center no-gutters" data-bind="if: App.game.gameState === GameConstants.GameState.temporaryBattle">
    <div class="col no-gutters clickable" data-bind="click: function() {TemporaryBattleBattle.clickAttack()}" style="height: 280px; display: block;">
        <h2 class="pageItemTitle mobileBattleTitle" style="display: block;">
            <knockout>
                <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': TemporaryBattleBattle.enemyPokemon() } }">Pokémon name</knockout>
            </knockout>

            <knockout class="right">
                <span data-bind="foreach: new Array(TemporaryBattleBattle.pokemonsDefeatedComputable())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest pokeball-defeated"/>
                </span>
                <span data-bind="foreach: new Array(TemporaryBattleBattle.pokemonsUndefeatedComputable())">
                    <img src="assets/images/pokeball/Pokeball.svg" class="pokeball-smallest"/>
                </span>
            </knockout>

            <div class="progress timer">
                <div class="progress-bar bg-danger" role="progressbar"
                     data-bind="attr:{ style: 'width:' + TemporaryBattleRunner.timeLeftPercentage() + '%' },
                     css: { 'bg-danger': TemporaryBattleRunner.timeLeftSeconds() < 10, 'bg-primary': TemporaryBattleRunner.timeLeftSeconds() >= 10 }"
                     aria-valuemin="0" aria-valuemax="100">
                     <span data-bind="text: TemporaryBattleRunner.timeLeftSeconds() + 's'" style="font-size: 12px;"></span>
                </div>
            </div>
        </h2>

        <div id="temporaryBattleGoContainer" data-bind="if: Settings.getSetting('showGymGoAnimation').observableValue">
          <div class="row" style="display: inline-block; vertical-align: middle;">
            <div class="col-sm-6 offset-sm-3">
              <img style="width:100%" id="temporaryBattleGo" src="assets/gifs/go.gif">
            </div>
          </div>
        </div>

        <div class="trainer" data-bind="if: !TemporaryBattleRunner.battleObservable().optionalArgs.hideTrainer">
            <img data-bind="attr:{ src: TemporaryBattleRunner.battleObservable().getImage() }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
        </div>

        <div data-bind="ifnot: TemporaryBattleBattle.catching">
            <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': TemporaryBattleBattle.enemyPokemon() } }">Pokémon sprite</knockout>
        </div>

        <div data-bind="if: TemporaryBattleBattle.catching" class="catchChance">
            <img class="pokeball-animated"
                 data-bind="attr:{ src: 'assets/images/pokeball/' + GameConstants.Pokeball[TemporaryBattleBattle.pokeball()] + '.svg' }"
                 src=""/>
            <br>
            Catch Chance:
            <knockout data-bind="text: Math.floor(TemporaryBattleBattle.catchRateActual()) + '%'">Catch Rate</knockout>
        </div>

        <div class="progress hitpoints trainerhitpoints">
            <div class="progress-bar bg-danger" role="progressbar"
                    data-bind="attr:{ style: 'width:' + TemporaryBattleBattle.enemyPokemon().healthPercentage() + '%' }"
                    aria-valuemin="0" aria-valuemax="100">
                <span data-bind="text: TemporaryBattleBattle.enemyPokemon().health().toLocaleString('en-US') + ' / ' + TemporaryBattleBattle.enemyPokemon().maxHealth().toLocaleString('en-US')" style="font-size: 12px;"></span>
            </div>
        </div>
        <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
            <knockout>
                <knockout data-bind="text: TemporaryBattleBattle.battle.getDisplayName()"></knockout>
            </knockout>
            <table width="100%">
                <tr>
                    <td width="50%">
                        <knockout data-bind="template: { name: 'pokemonAttackTemplate', data: { 'pokemon': Battle.enemyPokemon() } }"></knockout>
                    </td>
                    <td width="50%" data-bind="css: { 'text-muted': App.game.challenges.list.disableClickAttack.active() }">
                        <span style="display: inline;">Click Attack:
                            <span data-bind="text: App.game.party.calculateClickAttack().toLocaleString('en-US')"></span>
                        </span>
                    </td>
                </tr>
            </table>
        </h2>
    </div>
</div>


                    <!-- Contest Battles -->
                    <div class="row justify-content-center no-gutters" data-bind="if: App.game.gameState === GameConstants.GameState.contest">
  <div class="col no-gutters" style="height: 280px; display: block;">
    <h2 class="pageItemTitle" style="display: block;">
      <div data-bind="text: ContestBattle.getBattleViewTitle()"></div>
      <div data-bind="visible: ContestRunner.running()" class="progress timer" style="z-index: 1;">
        <div class="progress-bar" role="progressbar" style="animation-direction: reverse;"
          data-bind="attr:{ style: 'width:' + ContestRunner.timeLeftPercentage() + '%' },
          css: {
            'bg-danger': !ContestBattle.frenzyMode() && ContestRunner.timeLeftSeconds() < 3,
            'bg-primary': ContestRunner.timeLeftSeconds() >= 10,
            'progress-bar-striped progress-bar-animated bg-warning': ContestBattle.frenzyMode(),
          }"
          aria-valuemin="0" aria-valuemax="100">
          <span data-bind="text: ContestRunner.timeLeftSeconds() + 's'" style="font-size: 12px;"></span>
        </div>
      </div>
    </h2>
        
    <div class="" data-bind="visible: !ContestRunner.running()">
      <div style="margin-top: 60px;">
        <button class="btn w-25 btn-success" onclick="ContestRunner.startContest(ContestRunner.rank(), ContestRunner.type())">Start Contest</button>
        <!-- <button class="btn w-25" onclick="ContestRunner.startContest(ContestRunner.rank(), ContestRunner.type())"
        data-bind="css: {
          'btn-success': ContestHelper.calculatePokemonContestAppeal(ContestRunner.rank(), ContestRunner.type(), [ContestRunner.type()]),
          'btn-danger': !ContestHelper.calculatePokemonContestAppeal(ContestRunner.rank(), ContestRunner.type(), [ContestRunner.type()]),
        }">Start Contest</button> -->
      </div>
      <div class="">
          <div class="justify-content-center">
            <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
                <table width="100%">
                  <th colspan="2" data-bind="text: `${ContestHelper.getContestEmoji(ContestRunner.type())}${ContestRank[ContestRunner.rank()]} Rank ${ContestType[ContestRunner.type()]} Contest Stats${ContestHelper.getContestEmoji(ContestRunner.type())}`"></th>
                  <tr>
                    <!-- <td colspan="2" data-bind="text: `${ContestType[ContestRunner.type()]} Audience Appeal: ${ContestHelper.calculatePokemonContestAppeal(ContestRunner.rank(), ContestRunner.type(), [ContestRunner.type()]).toLocaleString('en-US')}`"></td> -->
                    <td colspan="2" data-bind="text: `Audience Appeal: ${ContestBattle.testAppeal().toLocaleString('en-US')}`"></td>
                  </tr>
                  <tr>
                    <td data-bind="text: `${ContestRunner.rank() != ContestRank.Practice ? 'Highest Score' : 'Last Practice Score'}: ${App.game.statistics.contestHighestScore[ContestRunner.rank()][ContestRunner.type()]().toLocaleString('en-US') ?? 0}`"></td>
                    <td data-bind="text: `Highest Round Won: ${App.game.statistics.contestHighestRound[ContestRunner.rank()][ContestRunner.type()]().toLocaleString('en-US') ?? 0}`"></td>
                  </tr>
                </table>
              </h2>
          </div>
      </div>
    </div>

    <div data-bind="if: ContestRunner.running()">
      <div class="d-flex contestTrainerLine" data-bind="foreach: ContestBattle.trainers()">
        <div style="min-width: 96px;" data-bind="if: ContestBattle.trainers().length > $index()">

          <!-- <div class="mr-3">
            <img class="contestTrainer" data-bind="attr:{ src: ContestBattle.trainers()[$index()].image },
            css: { 'contest-inactive': !ContestBattle.getSpotlightStatus($index()) && !ContestBattle.prepareNextTrainerBatch() }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
          </div> -->
          
          <!-- <div class="mr-5" data-bind="visible: ContestBattle.getSpotlightStatus($index())">
            <img class="contestSpotlight" src="assets/images/contestSpotlight.png" data-bind="
              style: {
                'opacity': !ContestBattle.danceMode() && ($index() != ContestBattle.selectedEnemy()) ? '70%' : '',
                'filter': ContestBattle.getSpotlightGrayscaleStatus($index()) ? 'grayscale(1)' : '',
              }"/>
          </div> -->

          <!-- ko if: !ContestBattle.danceMode() -->
            <knockout class="enemy-contest" data-bind="css: {
              'contest-inactive': !ContestBattle.getSpotlightStatus($index()) && !ContestBattle.prepareNextTrainerBatch(),
              'spectacle': ContestBattle.pokemons()[$index()].status() === ContestOpponentStatus.Spectacle,
            }, template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': ContestBattle.pokemons()[$index()] } }">Pokémon sprite</knockout>
          <!-- /ko -->
            
            <!-- ko if: ContestBattle.danceMode() -->
            <div class="pokemonSprite wandererSprite mx-2" style="position: relative; margin-top: 40px; top: 0; left: 0;"
              data-bind="css: {
                'contest-inactive': !ContestBattle.getSpotlightStatus($index()) && !ContestBattle.prepareNextTrainerBatch(),
                'spectacle': ContestBattle.pokemons()[$index()].status() === ContestOpponentStatus.Spectacle,
              },
              style: {
                'backgroundImage': `url(assets/images/dynamic-background/pokemon/${ContestBattle.pokemons()[$index()].id}.png)`,
                'animation': ContestBattle.getSpotlightStatus($index()) ? '' : 'none',
                'animation-duration': ContestBattle.pokemons()[$index()].danceHearts() <= 0 && ContestBattle.pokemons()[$index()].isRallied() ? '1.2s' : '',
              },
              class: ContestBattleDance.getDancingCss(ContestBattle.pokemons()[$index()])">
            </div>
            <!-- /ko -->

            <div class="progress trainerhitpoints" data-bind="css: {
              'contest-inactive': !ContestBattle.getSpotlightStatus($index()) && !ContestBattle.prepareNextTrainerBatch(),
              'contestpoints': !ContestBattle.danceMode(),
            }">
              <div class="progress-bar bg-danger" role="progressbar"
                      data-bind="attr:{ style: 'width:0%' }"
                      aria-valuemin="0" aria-valuemax="100">
                  <span data-bind="text: ContestBattle.contestHealth(ContestBattle.pokemons()[$index()])" style="font-size: 12px;"></span>
              </div>
            </div>
        </div>
      </div>
      
      <div class="progress hitpoints audienceappealpoints" data-bind="attr: {'contest-type': ContestType[ContestRunner.type()]}">
        <div class="progress-bar" role="progressbar"
                data-bind="style: {
                  'width': ContestRunner.audienceAppealPercentage() + '%',
                  'animation-direction': 'reverse',
                }, css: {
                  'progress-bar-striped progress-bar-animated': ContestRunner.isRallied() || ContestBattle.frenzyMode() || ContestRunner.jamTime() > 0,
                  'bg-dark': ContestRunner.jamTime() > 0,
                }, class: Settings.getSetting('theme').observableValue()"
                aria-valuemin="0" aria-valuemax="100">
            <span data-bind="html: ContestRunner.audienceStatus()" style="font-size: 12px;"></span>
        </div>
      </div>
      <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
        <table width="100%" style="font-size: small;">
          <tr>
            <td colspan="4" data-bind="text: ContestBattle.trainerInfo(ContestBattle.selectedEnemy())">Opponent name</td>
            <td colspan="2" rowspan="3" class="" width="25%">
              <button class="btn btn-block btn-secondary">
                <span data-bind="text: 'Crowd Hype'"></span></br>
                <span data-bind="text: ContestBattle.maxAppealComputable()"></span>
              </button>
            </td>
          </tr>
          <tr data-bind="template: { name: ContestBattle.contestViewGimmickBar(ContestRunner.rank()) }"></tr>
          <tr>
            <td data-bind="text: `Encores: ×${ContestRunner.encoreRound().toLocaleString('en-US')}`">
              Encore Round
            </td>
            <td data-bind="text: `Chain: ×${ContestScore.activeChain().toLocaleString('en-US')}`">
              Combo Chain
            </td>
            <td colspan="2" data-bind="text: `Score: ${Math.round(ContestScore.totalScore()).toLocaleString('en-US')}`">
              Score
            </td>
          </tr>
        </table>
      </h2>
    </div>

  </div>
</div>

<script type="text/html" id="contestBeatTemplate">
  <td colspan="4" data-bind="foreach: GameHelper.enumNumbers(ContestType).filter(e => e != ContestType.Balanced)">
    <span class="badge text-light px-1" data-bind="
                style: {
                  'background-color': ContestHelper.getActiveContestColors($data, ContestBattle.enemyTypes(ContestBattle.selectedEnemy())),
                  'border': ContestRunner.type() === $data ? 'thin solid whitesmoke' : '',
                }">
      <small>
        <strong data-bind="text: ContestType[$data].toUpperCase()" style="color: white;"></strong>
      </small>
    </span>
  </td>
</script>

<script type="text/html" id="contestMovesTemplate">
  <!-- ko foreach: ContestBattle.pokemons()[ContestBattle.selectedEnemy()].usableMoves -->
   <td>
     <span class="badge text-light px-1" data-bind="
                 style: {
                   'background-color': ContestHelper.getActiveContestColors($data.moveType, [$data.moveType]),
                   'border': 'thin solid whitesmoke',
                   'opacity': $data.pp() ? '' : '50%',
                 }">
         <strong data-bind="text: `${ContestHelper.getArrowEmoji($index())}: ${ContestType[$data.moveType].toUpperCase()}`" style="color: white;"></strong>
     </span>
   </td>
  <!-- /ko -->
</script>


                    <!-- Battle Frontier Battles -->
                    <div class="row justify-content-center no-gutters" data-bind="if: App.game.gameState == GameConstants.GameState.battleFrontier">
    <div class="col no-gutters" data-bind="if: BattleFrontierBattle.enemyPokemon" style="height: 280px; display: block;">
        <h2 class="pageItemTitle mobileBattleTitle" style="display: block;">
            <knockout>
                <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': BattleFrontierBattle.enemyPokemon() } }">Pokémon name</knockout>
            </knockout>

            <knockout class="right" data-bind="html: BattleFrontierRunner.pokemonLeftImages">
            </knockout>

            <div class="progress timer">
                <div class="progress-bar bg-danger" role="progressbar"
                        data-bind="attr:{ style: 'width:' + BattleFrontierRunner.timeLeftPercentage() + '%' },
                        css: { 'bg-danger': BattleFrontierRunner.timeLeftSeconds() < 10, 'bg-primary': BattleFrontierRunner.timeLeftSeconds() >= 10 }"
                        aria-valuemin="0" aria-valuemax="100">
                        <span data-bind="text: BattleFrontierRunner.timeLeftSeconds() + 's'" style="font-size: 12px;"></span>
                </div>
            </div>

        </h2>

        <div>
            <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': BattleFrontierBattle.enemyPokemon() } }">Pokémon sprite</knockout>
        </div>
        <div class="progress hitpoints trainerhitpoints">
            <div class="progress-bar bg-danger" role="progressbar"
                    data-bind="attr:{ style: 'width:' + BattleFrontierBattle.enemyPokemon().healthPercentage() + '%' }"
                    aria-valuemin="0" aria-valuemax="100">
                    <span data-bind="text: BattleFrontierBattle.enemyPokemon().health().toLocaleString('en-US') + ' / ' + BattleFrontierBattle.enemyPokemon().maxHealth().toLocaleString('en-US')" style="font-size: 12px;"></span>
            </div>
        </div>
        <h2 class="pageItemFooter" style="display: block; font-size: 1rem;">
            <knockout>
                Stage <knockout data-bind="text: BattleFrontierRunner.stage().toLocaleString('en-US')">0</knockout> / <knockout data-bind="text: BattleFrontierRunner.highest().toLocaleString('en-US')">0</knockout>
            </knockout>
            <table width="100%">
                <tr>
                    <td>
                        <span style="display: inline;">
                            Pokémon Attack:
                            <span data-bind="
                            text: App.game.party.calculatePokemonAttack(
                                PokemonType.None,
                                PokemonType.None,
                                true,
                                GameConstants.Region.none,
                                false,
                                false, 
                                WeatherType.Clear,
                            ).toLocaleString('en-US'),
                            tooltip: {
                                title: Battle.enemyPokemon()
                                    ? `${App.game.party.calculatePokemonAttack(
                                        Battle.enemyPokemon().type1,
                                        Battle.enemyPokemon().type2,
                                        true,
                                        GameConstants.Region.none,
                                        false,
                                        false, 
                                        WeatherType.Clear,
                                    ).toLocaleString('en-US')} against ${pokemonMap[Battle.enemyPokemon().name].type.map(t => PokemonType[t]).join('&nbsp;/&nbsp;')}`
                                    : '',
                                trigger: 'hover'}">
                            </span>
                        </span>
                    </td>
                </tr>
            </table>
        </h2>
    </div>
</div>


                    <!--TownView-->
                    <knockout data-bind="if: App.game.gameState === GameConstants.GameState.town">
<div id="townView" data-bind="style: { backgroundImage: `url('assets/images/towns/${player.town.name.replace(/'/, `\\'`)}.png')` }"
     class="justify-content-center no-gutters no-select">
    <div class="row justify-content-center no-gutters">
        <div class="col no-gutters">
            <div class="pageItemTitle d-flex justify-content-center" data-bind="let: { isDungeon: player.town instanceof DungeonTown && player.town.dungeon }">
                <div class="title-left" data-bind="if: isDungeon">
                    <div class="d-flex align-items-center ml-1 mr-auto">
                        <div class="d-flex flex-column">
                            <!--If all Pokémon in the dungeon are caught or caught shiny-->
                            <div data-bind="if: DungeonRunner.dungeonCompleted(player.town.dungeon, false)" style="font-size: 0;">
                                <img class="pokeball-smallest ml-0" data-bind="attr: { src: `assets/images/pokeball/Pokeball${DungeonRunner.dungeonCompleted(player.town.dungeon, true) ? '-shiny' : ''}.svg` },
                                tooltip: { trigger: 'hover', placement: 'bottom', title: `You have captured all Pokémon${DungeonRunner.dungeonCompleted(player.town.dungeon, true) ? ' shiny' : ''} in this dungeon!`}"/>
                            </div>

                            <!--Pokérus image-->
                            <div data-bind="if: RouteHelper.minPokerusCheck(player.town.dungeon.allAvailablePokemon())" style="font-size: 0;">
                                <img src="" data-bind="
                                attr:{ src: 'assets/images/breeding/pokerus/' + GameConstants.Pokerus[RouteHelper.minPokerus(player.town.dungeon.allAvailablePokemon())] + '.png'},
                                tooltip: {
                                    title: RouteHelper.dungeonPokerusEVs(player.town.dungeon),
                                    placement: 'bottom',
                                    trigger: 'hover',
                                    html: true
                                }" />
                            </div>
                        </div>

                        <!-- ko if: player.town.dungeon.allAvailableShadowPokemon().length -->
                        <div class="ml-1" style="font-size: 0;" data-bind="let: { isMissingShadow: player.town.dungeon.allAvailableShadowPokemon().some(p => (App.game.party.getPokemonByName(p)?.shadow ?? GameConstants.ShadowStatus.None) < GameConstants.ShadowStatus.Shadow) }">
                            <img height="24" src="assets/images/status/shadow.svg" data-bind="
                                css: { 'dungeon-pokemon-locked': isMissingShadow },
                                tooltip: {
                                    title: isMissingShadow ? 'There are uncaught Shadow Pokémon in this dungeon.' : 'All Shadow Pokémon in this dungeon have been captured!',
                                    trigger: 'hover',
                                    placement: 'bottom',
                                }" />
                        </div>
                        <!-- /ko -->
                    </div>
                </div>

                <div class="d-flex justify-content-center px-2" style="font-size: 1.8rem;">
                    <knockout data-bind="text: player.town.name">Town Name</knockout>
                </div>

                <div class="title-right" data-bind="if: isDungeon && QuestLineHelper.isQuestLineCompleted('Tutorial Quests')">
                    <div class="d-flex ml-auto">
                        <knockout class="h4 text-danger no-emoji-font mr-2 mb-0 align-self-center" data-bind="
                            visible: DungeonRunner.isDungeonDebuffed(player.town.dungeon),
                            tooltip: {
                                title: 'This dungeon is debuffed and will be significantly less likely to drop Epic, Legendary, and Mythic loot.',
                                trigger: 'hover',
                            }">⚠</knockout>
                        <div class="d-flex flex-column justify-content-center small mr-1" data-bind="using: App.game.statistics.dungeonsCleared[GameConstants.getDungeonIndex(player.town.name)]()">
                            <div style="line-height: normal;" data-bind="text: $data.toLocaleString('en-US')">0</div>
                            <div style="line-height: normal;">clears</div>
                        </div>
                        <div class="px-1 clickable d-inline-block ml-1 align-self-center" data-bind="tooltip: { title: 'See the Loot available in this dungeon.', trigger: 'hover' }, click: function() { $('#dungeonInfoModal').modal('show') }" data-original-title="" title="">
                            <img src="assets/images/encountersInfo/encountersInfo.png">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row no-gutters">
       <div class="col-4 no-gutters">
           <div class="list-group">
                <!-- ko if: player.town instanceof DungeonTown -->
                <div class="btn-group btn-block" style="margin-top: 0px;">
                    <button class="btn btn-secondary p-0" onclick="DungeonRunner.initializeDungeon(player.town.dungeon)" data-bind="
                        visible: player.town instanceof DungeonTown,
                        if: player.town.dungeon,
                        attr: { class: player.town.dungeon && (App.game.wallet.currencies[GameConstants.Currency.dungeonToken]() >= player.town.dungeon.tokenCost ? 'btn btn-success p-0' : 'btn btn-secondary p-0') + (player.town.dungeon.isUnlocked() ? '' : ' disabled') }">
                        Start<br/>
                        <span data-bind="template: { name: 'currencyTemplate', data: {'amount': player.town.dungeon.tokenCost, 'currency': GameConstants.Currency.dungeonToken}}"></span>
                    </button>
                    <button class="btn btn-info p-0 btn-dungeon-guide" href="#dungeonGuidesModal" data-toggle="modal" data-bind="
                        tooltip: { html: true, title: `Hire a Dungeon Guide!`, trigger: 'hover', placement:'right' },
                        visible: App.game.statistics.dungeonsCleared[GameConstants.getDungeonIndex(player.town.dungeon.name)]() >= 10">↻</button>
                </div>
                <button type="button" class="btn btn-info p-0" data-bind="
                    visible: player.town instanceof DungeonTown && !QuestLineHelper.isQuestLineCompleted('Tutorial Quests'),
                    tooltip: { title: 'Capture Pokémon to gain Dungeon Tokens in order to battle dungeons.', trigger: 'hover', placement:'right' }">?</button>
                <!-- /ko -->

                <!-- ko foreach: player.town.content -->
                <div class="btn-group btn-block" style="margin-top: 0px;">
                    <button data-bind="
                        class: $data.cssClass() + ($data.isUnlocked() ? '' : ' disabled'),
                        text: $data.text(),
                        visible: $data.isVisible(),
                        click: $data.protectedOnclick,
                        tooltip: ($data.tooltip || $data.clears() ? { title: $data.clears() != undefined ? `Total Clears: ${$data.clears().toLocaleString('en-US')}` : $data.tooltip, trigger: 'hover', placement: 'left' } : undefined)
                        "></button>
                    <!-- ko if: $data instanceof Gym -->
                    <button class="btn btn-info p-0 btn-gym-auto-restart" data-bind="
                        tooltip: {
                            html: true,
                            title: $data.autoRestartTooltip,
                            trigger: 'hover',
                            placement:'right'
                        },
                        click: () => GymRunner.startGym($data, true),
                        visible: $data.isUnlocked() && App.game.statistics.gymsDefeated[GameConstants.getGymIndex($data.town)]() >= 10">↻</button>
                    <!-- /ko -->
                </div>
                <!-- /ko -->
           </div>
       </div>
       <div class="col-5"></div>
       <div class="col-3 no-gutters">
           <div class="list-group" data-bind="foreach: player.town.npcs">
               <!-- ko if: $data.isVisible() -->
                <button class="btn btn-info"
                        data-bind="text: $data.name, click: () => NPCController.openDialog($data)">
                    NPC
                </button>
                <!-- /ko -->
           </div>
        </div>

    </div>
    <div style="flex-grow: 1;"></div>
    <knockout data-bind="if: (player.town.dungeon && player.town instanceof DungeonTown && player.town.dungeon.isUnlocked())">
      <div id="dungeonPokemonList" class="card pt-2 pb-3 px-1">
        <!--Display all available Pokémon in this dungeon-->
        <ul class="list-inline mb-0">
          <!-- ko foreach: player.town.dungeon.normalEncounterList.filter(i => !i.hide) -->
          <li class="list-inline-item">
            <!-- ko if: $data.mimic -->
            <img class="boss" data-bind="attr: { src: `assets/images/dungeons/chest-${$data.mimicTier}.png` }, tooltip: {
                title: GameConstants.camelCaseToString($data.mimicTier),
                trigger: 'hover'
            }"/>
            <!-- /ko -->
            <img class="dungeon-pokemon-pkrs" src="" data-bind="
                attr:{ src: $data.pkrsImage },
                tooltip: {
                    title: $data.EVs,
                    placement: 'bottom',
                    trigger: 'hover'
                }" />
            <img class="dungeon-pokemon-preview" src="" data-bind="attr:{ src: $data.image },
                css: { 'dungeon-pokemon-locked': $data.uncaught, 'shadow-trainer': $data.shadowTrainer }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
            <!-- ko if: $data.shadow -->
            <img class="dungeon-pokemon-preview dungeon-pokemon-locked uncaught-shadow" src="" data-bind="attr:{ src: $data.shadowBackground },
            css: { 'uncaught-pokemon': !$data.caught }, visible: !$data.shadowCaught," onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
            <img class="shadow-icon" src="assets/images/status/purified.svg" data-bind="visible: $data.purified"/>
            <!-- /ko -->
            <sup class="shiny" data-bind="visible: $data.shiny">✨</sup>
            <img class="lock" src="assets/images/breeding/lock.svg" data-bind="
                hidden: !$data.lock,
                tooltip: {
                    title: $data.lockMessage,
                    placement: 'left',
                    trigger: 'hover'
                }" />
          </li>
          <!-- /ko -->
          <!--Display all available bosses in this dungeon-->
          <!-- ko foreach: player.town.dungeon.bossEncounterList.filter(i => !i.hide) -->
          <li class="list-inline-item">
            <!-- ko ifnot: $data.shadow -->
            <img class="boss" src="assets/images/dungeons/boss.svg"/>
            <!-- /ko -->
            <img class="dungeon-pokemon-pkrs" src="" data-bind="
                attr:{ src: $data.pkrsImage },
                tooltip: {
                    title: $data.EVs,
                    placement: 'bottom',
                    trigger: 'hover'
                }" />
            <img class="dungeon-pokemon-preview" src="" data-bind="attr:{ src: $data.image },
                css: { 'dungeon-pokemon-locked': $data.uncaught, 'shadow-trainer': $data.shadowTrainer }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
            <sup class="shiny" data-bind="visible: $data.shiny">✨</sup>
            <!-- ko if: $data.shadow -->
            <img class="dungeon-pokemon-preview dungeon-pokemon-locked uncaught-shadow" src="" data-bind="attr:{ src: $data.shadowBackground },
                css: { 'uncaught-pokemon': !$data.caught }, visible: !$data.shadowCaught," onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
            <img class="shadow-icon" src="assets/images/status/purified.svg" data-bind="visible: $data.purified"/>
            <!-- /ko -->
            <img class="lock" src="assets/images/breeding/lock.svg" data-bind="hidden: !$data.lock,
                tooltip: {
                    title: $data.lockMessage,
                    placement: 'top',
                    trigger: 'hover',
                    boundary: 'window'
                }" />
          </li>
          <!-- /ko -->
        </ul>
      </div>
    </knockout>
    <knockout data-bind="if: player.town.content.find(c => c instanceof SafariTownContent)">
        <div id="dungeonPokemonList" class="card pt-2 pb-3 px-1">
          <!--Display all available Pokémon in this Safari-->
          <ul class="list-inline mb-0">
            <!-- ko foreach: SafariPokemonList.getDisplayList() -->
            <li class="list-inline-item">
              <img class="dungeon-pokemon-pkrs" src="" data-bind="
                  attr:{ src: $data.pkrsImage },
                  tooltip: {
                      title: $data.EVs,
                      placement: 'bottom',
                      trigger: 'hover'
                  }" />
              <img class="dungeon-pokemon-preview" src="" data-bind="attr:{ src: $data.image },
                  css: { 'dungeon-pokemon-locked': $data.uncaught }" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png';"/>
              <sup class="shiny" data-bind="visible: $data.shiny">✨</sup>
              <img class="lock" src="assets/images/breeding/lock.svg" data-bind="
                  hidden: !$data.lock,
                  tooltip: {
                      title: $data.lockMessage,
                      placement: 'top',
                      trigger: 'hover',
                      boundary: 'window'
                  }" />
            </li>
            <!-- /ko -->
          </ul>
        </div>
      </knockout>
</div>
</knockout>

                </div>
            </div>

            <!-- ko if: App.game.gameState === GameConstants.GameState.dungeon -->
                <div id="dungeonMap" class="card sortable-disabled border-secondary mb-3 dungeon no-select">
                    <div class="card-header p-0">
                        <div style="position: absolute; left: 2px" data-bind="tooltip: { trigger: 'hover', title: 'Chests opened in current dungeon' }">
                            <img src="assets/images/dungeons/chest.png" height="25px" />
                            <span data-bind="text: `${DungeonRunner.chestsOpened()}/${DungeonRunner.map.totalChests()}`"></span>
                        </div>

                        <div style="position: absolute; right: 4px" data-bind="tooltip: { trigger: 'hover', title: 'Encounters won in current dungeon' }">
                            <img src="assets/images/dungeons/encounter.png" height="25px" />
                            <span data-bind="text: `${DungeonRunner.encountersWon()}/${DungeonRunner.map.totalFights()}`"></span>
                        </div>
                        <span data-bind="text: `${DungeonRunner.dungeon.name}`"></span>
                        <!-- ko if: DungeonGuides.hired() -->
                        <a href="#dungeonGuidesDungeonModal" data-toggle="modal" data-bind="tooltip: {
                            title: `Attempts remaining: ${DungeonGuides.clears()}`,
                            placement: 'top',
                            trigger: 'hover'
                        }">
                            <img class="pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${DungeonGuides.hired().trainerSprite}.png` }">
                        </a>
                        <!-- /ko -->
                    </div>
                    <div class="card-body p-0 text-center">
                        <table class="dungeon-board">
                            <tbody data-bind="foreach: DungeonRunner.map.board()[DungeonRunner.map.playerPosition().floor]">
                                <tr data-bind="foreach: $data">
                                    <td data-bind=" click: function(){DungeonRunner.map.moveToCoordinates($context.$index(), $parentContext.$index()) }, attr: { class: $data.cssClass}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            <!-- /ko -->

            <!-- Battle Frontier Information Container  -->
            
<!-- ko if: App.game.gameState === GameConstants.GameState.battleFrontier -->
<div id="battleFrontierInformation" class="card sortable-disabled border-secondary mb-3 battle-frontier no-select">
    <div class="card-header p-0" data-toggle="collapse" href="#battleFrontierRewards">
        <span>Battle Frontier</span>
    </div>
    <!-- ko ifnot: BattleFrontierRunner.started -->
    <div class="card-body text-center">
        <h5>Welcome to the Battle Frontier!</h5>
        <p>
            Here you will be battling through many stages to earn Battle Points.<br/>
            There is no regional attack debuff or weather effects.<br/>
            You can leave early and return to your checkpoint later on.<br/>
            You'll get special items if you reach special milestone stages.<br/>
            When you are ready, click Start!<br/>
            <i>Note: there is no click damage in the Battle Frontier.</i>
        </p>
        <a class="btn btn-block btn-success text-light" onclick="BattleFrontierRunner.start(false)">Start</a>
        <!-- ko if: BattleFrontierRunner.hasCheckpoint() -->
            <a class="btn btn-block btn-success text-light" onclick="BattleFrontierRunner.start(true)">Start at latest checkpoint (Stage <knockout data-bind="text: BattleFrontierRunner.checkpoint().toLocaleString('en-US')">0</knockout>)</a>
        <!-- /ko -->
        <a class="btn btn-block btn-danger text-light" onclick="App.game.battleFrontier.leave()">Leave</a>
    </div>
    <!-- /ko -->
    <!-- ko if: BattleFrontierRunner.started -->
    <div id="battleFrontierRewards" class="card-body text-center p-0 show">
        <!-- ko let: { availableMilestones: BattleFrontierMilestones.availableMilestones().slice(0, 4) } -->
        <table class="table table-hover table-striped table-bordered table-sm m-0">
            <thead>
                <tr>
                    <th colspan="2">Upcoming Rewards</th>
                </tr>
                <tr>
                    <th>Stage</th>
                    <th class="text-left">Reward</th>
                </tr>
            </thead>
            <tbody>
                <!-- ko foreach: availableMilestones -->
                <tr>
                    <th class="tight" data-bind="text: $data.stage.toLocaleString('en-US')"></td>
                    <td class="text-left">
                        <img width="28px" data-bind="attr:{ src: $data.image }" />
                        <knockout data-bind="text: $data.displayName"></knockout>
                    </td>
                </tr>
                <!-- /ko -->
                <!-- ko ifnot: availableMilestones.length -->
                <tr>
                    <th class="tight">–</td>
                    <td class="text-left">
                        You've received every available reward. Congratulations!
                    </td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
        <!-- /ko -->
        <a class="btn btn-block btn-danger text-light" onclick="BattleFrontierRunner.battleQuit()">Quit Battle</a>
    </div>
    <!-- /ko -->
</div>
<!-- /ko -->


            <!-- Contest Information Container -->
            <!-- ko if: App.game.gameState === GameConstants.GameState.contest -->
<div id="contestInformation" class="card sortable-disabled border-secondary mb-3 contest-hall no-select tab-content">
    <div class="card-header p-0" data-toggle="collapse">
        <span>Contest Hall</span>
    </div>

    <div class="modal-header p-0" style='justify-content: space-around;'>
        <ul class="nav nav-tabs nav-fill w-100">
            <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#contestHall">Contest Hall</a></li>
            <li class="nav-item"><a data-toggle='tab' class="nav-link" href="#contestRewards">Rewards</a></li>
            <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#contestTrainers">Trainers</a></li>
            <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#contestInfo">Help</a></li>
        </ul>
    </div>

    <div id="contestHall" class="tab-pane fade in active show card-body text-center">
        <div data-bind="template: {name: 'contestButtons'}"></div>
        <div class="p-0 modal-body">
            <div class="justify-content-center" data-bind="foreach: { data: ContestRunner.contestRankObservable(), as: 'rank' }">
                <h4 class="card-header mb-1 p-1" data-toggle="collapse" data-bind="attr : {href : '#rankCard_' + $index()}, text: `${ContestRank[rank]} Rank`"></h4>
                <div class="card-body mb-1 p-0 show row" style="justify-content: space-evenly;"  data-bind="attr : {id : 'rankCard_' + $index()}, foreach: { data: ContestRunner.contestTypeObservable(), as: 'type' }">
                    <button class="d-flex flex-column align-items-center p-0 btn btn-secondary"
                        data-bind="click: () => {
                           if (!ContestRunner.running()) {
                            ContestRunner.rank(rank);
                            ContestRunner.type(type);
                           } else {
                            ContestRunner.startContest(rank, type);
                           };
                        },
                        css: {
                            active: ContestRunner.type() == type && ContestRunner.rank() == rank,
                            disabled: !ContestHelper.contestIsUnlocked(rank, type),
                            contestButton3: Settings.getSetting('gameDisplayStyle').observableValue() != 'fullWidth5',
                            contestButton5: Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                        },
                        tooltip: {
                            html: true,
                            title: ContestHelper.contestButtonTooltip(rank, type),
                            trigger: 'hover focus',
                        },
                        attr:{'aria-label': `${ContestRank[rank]} Rank ${ContestType[type]} Contest. ${ContestHelper.contestButtonTooltip(rank, type)}.`}
                        ">
                        <p class="m-0" style="font-weight: bolder;" data-bind="text: `${ContestType[type]}`"></p>
                        <svg class="ribbon" xmlns="http://www.w3.org/2000/svg" width="80px" viewBox="0 0 1280 1280" xmlns:v="https://vecta.io/nano"
                            data-bind="
                                attr: {'contest-type': ContestType[type]},
                                css: { 'pokemon-not-seen': !App.game.statistics.contestHighestRound[rank][type]() && rank != ContestRank.Practice },
                                ">
                            <g data-bind="html: ContestHelper.getRibbonImage(rank, type)"></g>
                        </svg>
                        <p class="mb-0" data-bind="html: 'Appeal' + '<br/>' + `${GameHelper.formatAmount(ContestHelper.calculatePokemonContestAppeal(rank, type, [type]))}`"></p>
                    </button>
                </div>
            </div>
        </div>
        <a class="btn btn-block btn-danger text-light" onclick="ContestHall.leave()">Leave</a>
    </div>

    <div id="contestRewards" class="modal-body tab-pane fade">
        <div data-bind="template: {name: 'contestButtons'}"></div>
        <div class="p-0 modal-body">
            <p style="font-weight: bold; margin: 0;">Contest Reward Log</p>
            <dd><i>Berries and Items will only be appear after being awarded</i></dd>
            <div class="justify-content-center">
                <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;">
                    <thead>
                        <tr>
                            <th>Recent Tokens Rewarded</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="m-0">
                            <td class="text-left">
                                <img style="height: 35px;" src="assets/images/currency/contestToken.svg"/>
                            </td>
                            <td>
                                <span data-bind="text: ContestBattle.tokenReward().toLocaleString('en-US')"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- ko if: ContestBattle.itemRewardLog().some(ir => ir.amount() > 0) -->
            <div class="justify-content-center">
                <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;">
                    <thead>
                        <tr>
                            <th>Recent Items Rewarded</th>
                            <th>Name</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: ContestBattle.itemRewardLog()">
                        <!-- ko if: $data.amount() -->
                        <tr class="m-0">
                            <td class="text-left">
                                <img class="smallImage" data-bind="attr: {src: ItemList[$data.item].image}">
                            </td>
                            <td>
                                <span data-bind="text: ItemList[$data.item].displayName"></span>
                            </td>
                            <td>
                                <span data-bind="text: $data.amount()"></span>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
            <!-- /ko -->
            <!-- ko if: ContestBattle.berryRewardLog().some(br => br.amount() > 0) -->
            <div class="justify-content-center">
                <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;">
                    <thead>
                        <tr>
                            <th colspan="2">Recent Berries Rewarded</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: ContestBattle.berryRewardLog()">
                        <!-- ko if: $data.amount() -->
                        <tr class="m-0">
                            <td class="text-left">
                                <img class="smallImage" data-bind="attr: {src: FarmController.getBerryImage($data.berry)}">
                            </td>
                            <td class="text-left" data-bind="text: `${BerryType[$data.berry]} Berry`">
                            </td>
                            <td>
                                <span data-bind="text: $data.amount()"></span>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
            <!-- /ko -->
        </div>

        <h4>Available Rewards</h4>
        <p>Shaded berries and item rewards are locked. If berries do not become unshaded when selecting a different rank or type, you have to unlock them in the farm first</p>
        <p style="font-weight: bold;">Note: Berries are not rewarded in dance halls</p>

        <div class="mb-3" data-bind="foreach: { data: ContestRunner.contestTypeObservable(), as: 'type' }">
            <button class="btn btn-info"
                data-bind="click: () => {
                    if (!ContestRunner.running()) {
                    ContestRunner.type(type);
                    } else {
                    Notifier.notify({
                        title: 'Pokémon Contest',
                        message: 'You can\'t change the contest type while you are competing!',
                        type: NotificationConstants.NotificationOption.warning,
                    })
                    };
                },
                text: ContestType[type],
                css: {
                    active: ContestRunner.type() == type,
                },
                attr:{'aria-label': `${ContestType[type]}`}
                ">
            </button>
        </div>

        <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;">
            <tbody>
                <tr class="m-0">
                    <td>Weight</td>
                    <td>Berry</td>
                </tr>
                <!-- ko foreach: Array.from(new Set([...Object.entries(ContestHelper.berryRewards).filter(r => r[0] <= ContestRank.Spectacular).flatMap(b=>b[1]).flatMap(b=>b.weight)].sort().reverse())) -->
                <tr class="m-0">
                    <td data-bind="text: $data"></td>
                    <td data-bind="foreach: Object.entries(ContestHelper.berryRewards).filter(r => r[0] <= ContestRank.Spectacular).flatMap(b=>b[1]).filter(b => b.weight === $data)">
                        <img style="max-width: 24px;" data-bind="attr: {src: FarmController.getBerryImage($data.berry)},
                        css: {'contest-inactive': ($data.requirement && !$data.requirement?.isCompleted())
                        || Object.entries(ContestHelper.berryRewards).filter(b => b[0] > ContestRunner.rank()).flatMap(b => b[1]).includes($data)
                        || ContestHelper.isDanceHall(ContestRunner.rank())}">
                    </td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
        <!-- ko with: ContestHelper.itemRewards() -->
        <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;">
            <tbody>
                <tr>
                    <td>Chance</td>
                    <td>Item</td>
                    <td>Requirement</td>
                </tr>
                <!-- ko foreach: $data -->
                <tr class="m-0">
                    <td>
                        <!-- ko if: $data.chance -->
                        <span data-bind="text: `1 / ${$data.chance}`"></span>
                        <!-- /ko -->
                        <!-- ko if: !$data.chance -->
                        <span>Guaranteed</span>
                        <!-- /ko -->
                    </td>
                    <td>
                        <img style="max-width: 24px;" data-bind="attr: {src: ItemList[$data.item].image}, css: {'contest-inactive': $data.requirement && !$data.requirement?.isCompleted()}">
                    </td>
                    <td>
                        <!-- ko if: $data.requirement && !$data.requirement?.isCompleted() -->
                        <span data-bind="text: $data.requirement?.hint()"></span>
                        <!-- /ko -->
                        <!-- ko if: !$data.requirement || $data.requirement?.isCompleted() -->
                        <span>Available</span>
                        <!-- /ko -->
                    </td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
        <!-- /ko -->
    </div>

    <div id="contestTrainers" class="modal-body tab-pane fade">
        <div data-bind="template: { name: 'contestButtons'}"></div>
        <!-- ko if: ContestRunner.rank() === ContestRank.Spectacular -->
        <p style="font-weight: bold;">Shaded rewards are partially locked under what type of contest you partake in.</p>

        <div class="mb-3" data-bind="foreach: { data: ContestRunner.contestTypeObservable(), as: 'type' }">
            <button class="btn btn-info"
                data-bind="click: () => {
                    if (!ContestRunner.running()) {
                    ContestRunner.type(type);
                    } else {
                    Notifier.notify({
                        title: 'Pokémon Contest',
                        message: 'You can\'t change the contest type while you are competing!',
                        type: NotificationConstants.NotificationOption.warning,
                    })
                    };
                },
                text: ContestType[type],
                css: {
                    active: ContestRunner.type() == type,
                },
                attr:{'aria-label': `${ContestType[type]}`}
                ">
            </button>
        </div>

        <!-- /ko -->
        <div class="p-0 modal-body">
            <div class="justify-content-center" style="overflow-x:hidden; height:500px" data-bind="foreach: { data: ContestRunner.contestRankObservable(), as: 'rank' }">
                <h4 class="card-header mb-1 p-1" data-bind="text: `${ContestRank[rank]} Rank Trainers`"></h4>
                <div data-bind="template: {name: 'trainerInfoTable', data: ContestTrainerList.ContestOpponents[rank]}"></div>
            </div>
            <!-- ko if: ContestTrainerList.SpecialEventContestOpponents.some(trainer => trainer.options.requirement.isCompleted()) -->
            <div class="justify-content-center">
                <h4 class="card-header mb-1 p-1">Special Event Trainers</h4>
                <div data-bind="template: {name: 'trainerInfoTable', data: ContestTrainerList.SpecialEventContestOpponents.filter(trainer => trainer.options.requirement.isCompleted())}"></div>
            </div>
            <!-- /ko -->
        </div>
    </div>

    <div id="contestInfo" class="tab-pane fade tab-content">
        <div class="modal-header p-0" style='justify-content: space-around;'>
            <ul class="nav nav-tabs nav-fill w-100">
                <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#contestInfoGen">General</a></li>
                <li class="nav-item"><a data-toggle='tab' class="nav-link" href="#contestInfoType">Contest Types</a></li>
                <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#contestInfoRank">Rank Gameplay</a></li>
            </ul>
        </div>
        <div id="contestInfoGen" class="modal-body tab-pane fade in active show">
            <h4>Gameplay Mechanics - General</h4>

            <p>Audience Appeal: The large bar across the display. It increases whenever you help the selected contest opponent appeal to the crowd. For testing purposes you can change it at will, but
                it's going to be calculated from the sum of your party's Appeal and the effectiveness against the contest type you're in.
                Max it out to win a contest and be awarded with a ribbon and contest tokens.
                You earn extra tokens when you try to increase an already maxed out bar.
            </p>

            <p>Encores: Once you have beaten a contest, you unlock the ability to perform encores. During an encore, you keep your points and chain, but each consecutive round increases the amount of appeal needed to max out the audience bar.</p>

            <p>Health bars: The bars underneat the individual pokemon. They change to reflect their completion and status. Successfully performing an action makes the pokemon appeal to the audience (💖). If the action results in a failure, the pokemon is jammed (🖤). Click on the "Rank Gameplay" tab for further information.</p>

            <p>Crowd Hype: The hearts on the bottom right corner. When all pokemon on stage have performed, their statuses are evaluated to generate Crowd Hype. If no pokemon is jammed, the crowd hype goes up by 1 heart, but if even a single pokemon is jammed, it negatively affects the hype.
                In Hoenn, jamming disengages the audience for a short period of time and prevents Crowd Hype from being generated. It also reduces the amount of audience Appeal that is produced by half. In Sinnoh, jamming decreases the hype bar by 1 with no extra effects.</p>

            <p>Frenzy: Max the Crowd Hype to get the audience in a frenzy for extra points and rewards. Gameplay is slightly altered during a frenzy, and chains cannot be broken for its duration.
            Make use of the limited frenzy time to chain attacks for lots of points. During a frenzy, your audience appeal dealt will also be buffed based on how many contests you've won.</p>

            <p>Chain: How well you perform. Successful actions increase the chain and multiply your score and dealt audience appeal. Higher ranks allow for larger chains.</p>

            <p>Score: Your total points. These indicate how well you've done in a contest. The higher your score the more tokens you get upon completion.</p>

        </div>
        <div id="contestInfoType" class="modal-body tab-pane fade">
            <h4>Contest types and matchups</h4>
            <p>Different Contest Types (also known as Contest Conditions) make up the different contests.
                <!-- The Audience Appeal of each Pokemon is affected by its types and what contest you partake in. -->
                Gameplay mechanics within contests use these matchups as a basis for their effects, which are explained in further detail in the "Rank Gameplay" tab.
            </p>
            <!-- <p>Contest matchups are additive and cap at ×1, meaning a Pokemon with a Cool and Cute Contest type has the same effectiveness in a Beautiful contest as a Pokemon that has a Beautiful type.</p> -->
            <table class="table table-bordered table-striped" data-bind="with: GameHelper.enumNumbers(ContestType)">
                <thead><tr><th colspan="8">Contest Type Effectiveness</th></tr></thead>
                <tr>
                    <td></td>
                    <td colspan="7">Defending Type</td>
                </tr>
                <tr>
                    <td rowspan="8" class="text-center" style="width: 1px; vertical-align: middle;">
                        <div class="d-flex align-items-center justify-content-center">
                            <span style="writing-mode: sideways-lr;">Attacking Type</span>
                        </div>
                    </td>
                    <td></td>
                    <!-- ko foreach: $data -->
                    <td data-bind="text: ContestType[$data]"></td>
                    <!-- /ko -->
                </tr>
                <!-- ko foreach: $data -->
                <tr>
                    <td data-bind="text: ContestType[$data]"></td>
                    <!-- ko foreach: ContestTypeHelper.contestTypeMatrix[$data] -->
                    <td data-bind="text: $data"></td>
                    <!-- /ko -->
                </tr>
                <!-- /ko -->
            </table>
        </div>
        <div id="contestInfoRank" class="modal-body tab-pane fade tab-content">
            <h4>Gameplay Mechanics - Ranks</h4>
            <p>Ranks are subdivided into a variety of different gameplay styles:</p>

                <div class="modal-header p-0" style='justify-content: space-around;'>
                    <ul class="nav nav-tabs nav-fill w-100" style="justify-content: space-evenly;">
                        <li class="nav-item nav-fill row w-100">
                            <a data-toggle='tab' class='nav-link active w-50' href="#ranks1">Hoenn Regular</a>
                            <a data-toggle='tab' class="nav-link w-50" href="#ranks2"
                            data-bind="
                                css: { disabled: !ContestHelper.getContestHallRequirements(ContestRank['Super Normal']).every(r => r.isCompleted()) },
                                visible: new RouteKillRequirement(10, GameConstants.Region.sinnoh, 208),
                                text: new MaxRegionRequirement(GameConstants.Region.sinnoh).isCompleted() ? 'Sinnoh Regular' : '???',
                            ">Sinnoh Regular</a>
                            <a data-toggle='tab' class='nav-link w-50' href="#ranks3"
                            data-bind="
                                css: { disabled: !ContestHelper.getContestHallRequirements(ContestRank.Spectacular).every(r => r.isCompleted()) },
                                visible: new RouteKillRequirement(10, GameConstants.Region.hoenn, 121),
                                text: new MaxRegionRequirement(GameConstants.Region.kalos).isCompleted() ? 'Hoenn Spectacular' : '???',
                            ">Hoenn Spectacular</a>
                            <!-- <a data-toggle='tab' class='nav-link w-50' href="#ranks4"
                            data-bind="
                                css: { disabled: !ContestHelper.getContestHallRequirements(ContestRank['Brilliant Shining']).every(r => r.isCompleted()) },
                                visible: new RouteKillRequirement(10, GameConstants.Region.sinnoh, 208),
                                text: new MaxRegionRequirement(GameConstants.Region.galar).isCompleted() ? 'Sinnoh Brilliant Shining' : '???',
                            ">Sinnoh Brilliant Shining</a> -->
                        </li>
                    </ul>
                </div>
                <div id="ranks1" class="modal-body tab-pane fade in active show">
                    <h5>Hoenn Default</h5>
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>Rank</td>
                            <td>Normal</td>
                            <td>Super</td>
                            <td>Hyper</td>
                            <td>Master</td>
                        </tr>
                        <tr>
                            <td>Location</td>
                            <td>Verdanturf Town</td>
                            <td>Fallarbor Town</td>
                            <td>Slateport City</td>
                            <td>Lilycove City</td>
                        </tr>
                    </table>
                    <!-- <dd><i>All Pokemonare elibigle for this format.</i></dd> -->
                    <div data-bind="template: {name: 'rankInfoHoenn'}"></div>
                </div>

                <div id="ranks2" class="modal-body tab-pane fade">
                    <h5>Sinnoh Default</h5>
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>Rank</td>
                            <td>Super Normal</td>
                            <td>Super Great</td>
                            <td>Super Ultra</td>
                            <td>Super Master</td>
                        </tr>
                        <tr>
                            <td>Location</td>
                            <td colspan="4">Hearthome City</td>
                        </tr>
                    </table>
                    <!-- <dd><i>Pokemon eligibility restrictions for this set have not been implemented yet.</i></dd> -->
                    <div data-bind="template: {name: 'rankInfoSinnoh'}"></div>
                </div>
                <div id="ranks3" class="modal-body tab-pane fade">
                    <h5>Hoenn Spectacular</h5>
                    <dd>The Spectacular Rank Contest Hall is located in Lilycove City</dd>
                    <!-- <dd><i>Only Pokemon of the corresponding contest type are eligible.</i></dd> -->
                    <div data-bind="template: {name: 'rankInfoSpectacular'}"></div>
                </div>
                <div id="ranks4" class="modal-body tab-pane fade">
                    <h2>NOT IMPLEMENTED YET</h2>
                    <h5>Sinnoh Brilliant Shining</h5>
                    <dd>The Brilliant Shining Rank Contest Hall will be located in Hearthome City</dd>
                    <!-- <dd><i>Pokemon eligibility restrictions for this set have not been implemented yet.</i></dd> -->
                    <div data-bind="template: {name: 'rankInfoBrilliantShining'}"></div>
                </div>
        </div>
    </div>

</div>
<!-- /ko -->

<script type="text/html" id="contestButtons">
    <div class="mb-3">
        <button class="btn btn-success" style="min-width: 30%;" onclick="ContestRunner.startContest(ContestRunner.rank(), ContestRunner.type())" data-bind="visible: !ContestRunner.running()">Start Contest</button>
        <button class="btn btn-success" style="min-width: 30%;" onclick="ContestRunner.restartContest()" data-bind="visible: ContestRunner.running()">Restart Contest</button>
        <button class="btn btn-danger" style="min-width: 30%;" onclick="ContestHall.leave();" data-bind="visible: !ContestRunner.running()">Leave</button>
        <button class="btn btn-danger" style="min-width: 30%;" onclick="ContestRunner.endContest();" data-bind="visible: ContestRunner.running()">Stop Contest</button>
        <!-- <button class="btn btn-warning" style="min-width: 30%;">Dressing Room</button> -->
    </div>
    
    <div class="mb-3">
        <button class="btn btn-primary m-0" onclick="ContestBattle.contestAction()">
            Cheer
            <knockout data-bind="text: `[${Settings.getSetting('hotkey.contest.action').observableValue()}]`,
            visible: Settings.getSetting('hotkey.contest.action').observableValue() != 'None'"></knockout>
        </button>
        <button class="btn btn-primary m-0" onclick="ContestBattle.contestMove(Direction.Up)">
            Move ↑
            <knockout data-bind="text: `[${Settings.getSetting('hotkey.dungeon.up').observableValue()}]`,
            visible: Settings.getSetting('hotkey.dungeon.up').observableValue() != 'None'"></knockout>
        </button>
        <button class="btn btn-primary m-0" onclick="ContestBattle.contestMove(Direction.Down)">
            Move ↓
            <knockout data-bind="text: `[${Settings.getSetting('hotkey.dungeon.down').observableValue()}]`,
            visible: Settings.getSetting('hotkey.dungeon.down').observableValue() != 'None'"></knockout>
        </button>
        <button class="btn btn-primary m-0" onclick="ContestBattle.contestMove(Direction.Left)">
            Move ←
            <knockout data-bind="text: `[${Settings.getSetting('hotkey.dungeon.left').observableValue()}]`,
            visible: Settings.getSetting('hotkey.dungeon.left').observableValue() != 'None'"></knockout>
        </button>
        <button class="btn btn-primary m-0" onclick="ContestBattle.contestMove(Direction.Right)">
            Move →
            <knockout data-bind="text: `[${Settings.getSetting('hotkey.dungeon.right').observableValue()}]`,
            visible: Settings.getSetting('hotkey.dungeon.right').observableValue() != 'None'"></knockout>
        </button>
    </div>

    <div class="modal-footer">
        <div class="input-group m-0">
            <div class="input-group-prepend">
                <button class="btn btn-warning smallButton smallFont" data-bind="
                    tooltip: {
                        title: 'Change how much audience appeal you deal per contest action',
                        trigger: 'hover focus',
                    }">
                    Test Appeal
                </button>
            </div>
            <input type="number" class="outline-dark form-control form-control-number"
                value="0" min="0" required
                data-bind="textInput: ContestBattle.testAppeal"
            title=""/>
            <div class="d-md-flex input-group-append">
                <button class="btn btn-warning smallButton smallFont"></button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="contestTypeButtons">  
    <div class="p-0 modal-body">
        <div class="justify-content-center" data-bind="foreach: { data: ContestRunner.contestRankObservable(), as: 'rank' }">
            <h4 class="card-header mb-1 p-1" data-toggle="collapse" data-bind="attr : {href : '#rankCard_' + $index()}, text: `${ContestRank[rank]} Rank`"></h4>
            <div class="card-body mb-1 p-0 show row" style="justify-content: space-evenly;"  data-bind="attr : {id : 'rankCard_' + $index()}, foreach: { data: ContestRunner.contestTypeObservable(), as: 'type' }">
                <button class="d-flex flex-column align-items-center p-0 btn btn-secondary"
                    data-bind="click: () => {
                        if (!ContestRunner.running()) {
                        ContestRunner.rank(rank);
                        ContestRunner.type(type);
                        } else {
                        ContestRunner.startContest(rank, type);
                        };
                    },
                    css: {
                        active: ContestRunner.type() == type && ContestRunner.rank() == rank,
                        disabled: !ContestHelper.contestIsUnlocked(rank, type),
                        contestButton3: Settings.getSetting('gameDisplayStyle').observableValue() != 'fullWidth5',
                        contestButton5: Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                    },
                    tooltip: {
                        html: true,
                        title: ContestHelper.contestButtonTooltip(rank, type),
                        trigger: 'hover focus',
                    },
                    attr:{'aria-label': `${ContestRank[rank]} Rank ${ContestType[type]} Contest. ${ContestHelper.contestButtonTooltip(rank, type)}.`}
                    ">
                    <p class="m-0" style="font-weight: bolder;" data-bind="text: `${ContestType[type]}`"></p>
                    <svg class="ribbon" xmlns="http://www.w3.org/2000/svg" width="80px" viewBox="0 0 1280 1280" xmlns:v="https://vecta.io/nano"
                        data-bind="
                            attr: {'contest-type': ContestType[type]},
                            css: { 'pokemon-not-seen': !App.game.statistics.contestHighestRound[rank][type]() },
                            ">
                        <g data-bind="html: ContestHelper.getRibbonImage(rank, type)"></g>
                    </svg>
                    <p class="mb-0" data-bind="html: 'Appeal' + '<br/>' + `${GameHelper.formatAmount(ContestHelper.calculatePokemonContestAppeal(rank, type, [type]))}`"></p>
                </button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="trainerInfoTable">
    <table class="table table-striped table-hover table-sm mb-1 p-0 show" style="justify-content: space-evenly;"">
        <thead class="sticky-top bg-secondary">
            <tr>
                <th colspan="2">Trainer</th>
                <th>Pokémon</th>
                <!-- ko if: $data.some(trainer => trainer.options?.rankedBerryReward) || $data.some(trainer => trainer.options?.itemReward) -->
                <th colspan="2">Spectacle Favors</th>
                <!-- /ko -->
            </tr>
        </thead>
        <tbody data-bind="foreach: { data: $data, as: 'trainer' }">
            <tr class="m-0">
                <td class="text-left" style="vertical-align: middle;">
                    <img class="smallImage m-0" data-bind="attr:{ src: trainer.image }, css: { 'pokemon-not-seen': trainer.options?.requirement && !trainer.options?.requirement?.isCompleted()}">
                </td>
                <td class="p-0 text-left" style="vertical-align: middle;">
                    <span data-bind="text: trainer.name"></span>
                </td>
                <td class="text-left" style="vertical-align: middle;">
                    <div style="display:flex; flex-wrap:wrap; align-items:center; justify-content:center;">
                    <!-- ko foreach: trainer.getTeam() -->
                        <img class="smallImage m-0" data-bind="attr: { src: PokemonHelper.getImage(pokemonMap[$data.name].id, $data.shiny ?? 0, $data.gender, 0) }, css: { 'pokemon-not-seen': trainer.options?.requirement && !trainer.options?.requirement?.isCompleted()}">
                        <span class="align-middle" data-bind="text: $data.nickname"></span>
                        <!-- ko if: (trainer.getTeam().indexOf($data) + 1) % 2 === 0 -->
                        <br/>
                        <!-- /ko -->
                    <!-- /ko -->
                    </div>
                </td>
                <!-- ko if: trainer.options?.rankedBerryReward || trainer.options?.itemReward -->
                <td style="min-width: 150px; vertical-align: middle;">
                    <div data-bind="if: trainer.options?.rankedBerryReward">
                        <!-- ko foreach: ContestHelper.berryRewards[trainer.options?.rankedBerryReward.rank] -->
                            <img style="max-width: 24px;" data-bind="attr: {src: FarmController.getBerryImage($data.berry)},
                            css: {
                                'contest-inactive': $data.requirement && !$data.requirement?.isCompleted(),
                                'pokemon-not-seen': trainer.options.requirement && !trainer.options.requirement?.isCompleted(),
                            }">
                            <!-- ko if: (ContestHelper.berryRewards[trainer.options?.rankedBerryReward.rank].indexOf($data) + 1) % 5 === 0 -->
                            <br/>
                            <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    <div class="modal-footer p-0" data-bind="visible: trainer.options?.rankedBerryReward && trainer.options?.itemReward"></div>
                    <div data-bind="if: trainer.options?.itemReward">
                        <!-- ko foreach: trainer.options?.itemReward -->
                            <img style="max-width: 24px;" data-bind="attr: {src: ItemList[$data.item].image},
                            css: {
                                'contest-inactive': $data.requirement && !$data.requirement?.isCompleted(),
                                'pokemon-not-seen': trainer.options.requirement && !trainer.options.requirement?.isCompleted(),
                            }">
                            <!-- ko if: (trainer.options?.itemReward.indexOf($data) + 1) % 5 === 0 -->
                            <br/>
                            <!-- /ko -->
                        <!-- /ko -->
                    </div>
                </td>
                <!-- /ko -->
            </tr>
        </tbody>
    </table>
</script>

<script type="text/html" id="rankInfoHoenn">
    <p>Press the spacebar when the hearts are colored to successfully appeal</p>
    <div class="row">
    <!-- ko foreach: GameHelper.enumNumbers(ContestType).filter(type => type < 3) -->
        <!-- ko with: ContestBattle.healthDisplayBeat(ContestBattle.infoBeat() + ContestTypeHelper.contestTypeMatrix[ContestType.Cool][$data] * 2, '❤️', '🖤', '🤍', ContestBattle.infoBeat()) -->
         <div class="col">
            <img data-bind="attr: {src: PokemonHelper.getImage(GameConstants.RegionalStarters[GameConstants.Region.hoenn][$parent], false)}">
            <p data-bind="text: $data"></p>
            <p data-bind="text: `${ContestBattle.infoBeat() + ContestTypeHelper.contestTypeMatrix[ContestType.Cool][$parent] * 2 >= 2 ? 'Success ✔️' : 'Failure ❌'}`"></p>
        </div>
        <!-- /ko -->
    <!-- /ko -->
    </div>

    <p>If you pressed it at the wrong time, the pokemon will become jammed. Jammed pokemon won't excite the crowd and will halve the amount of audience appeal that can be dealt for a short while.</p>
    <p>Time the beat to chain successful appeals and hype the audience into a frenzy.</p>
    <p>During frenzy mode, select moves that the audience likes with the directional keys to gain points. Moves are calculated when you appeal with the spacebar. Use your knowledge of contest types to score a big bonus.</p>
    <p>Berries are rewarded during frenzy depending on the cumulative performance of all Pokemon on stage.</p>
</script>
<script type="text/html" id="rankInfoSinnoh">
    <p>Use the directional keys to make the pokemon dance. If they are out of dance moves, they will dance automatically whenever highlighted.
        Encourage danced-out Pokemon with the spacebar to refill their dance stamina to prevent them from being jammed. Performing a dance move or cheering tired pokemon increases their dance stamina.
        Dance stamina gained depends on the matchup of the current beat and the contest type, giving +2, +1, or +0 💗s.
        Help all the pokemon complete their dance before they become jammed to score Crowd Hype.</p>
        <p>Pokemon of the same species have the same dance moves. The key to victory is knowing your opponent and paying attention to the beat.</p>

    <div class="" style="display: flex; justify-content: center;">
        <div class="pokemonSprite wandererSprite" style="position: relative;"
            data-bind="style: { backgroundImage: 'url(\'assets/images/dynamic-background/pokemon/399.png\')'},
            css: {'walkDown': ContestBattle.infoCrotchetValue() === 0 || ContestBattle.infoCrotchetValue() === 3}">
            <p data-bind="text: `${'💗'.repeat(3 - (ContestBattle.infoCrotchetValue() > 0 ? 1 : 0)
            - (ContestBattle.infoCrotchetValue() > 3 ? 1 : 0))}`"></p>
        </div>
        <div class="pokemonSprite wandererSprite" style="position: relative;"
            data-bind="style: { backgroundImage: 'url(\'assets/images/dynamic-background/pokemon/25.png\')'},
            css: {'walkLeft': ContestBattle.infoCrotchetValue() === 1,
            'walkRight': ContestBattle.infoCrotchetValue() === 2,
            'walkDown': ContestBattle.infoCrotchetValue() === 3 || ContestBattle.infoCrotchetValue() === 0 ,
            }">
            <p data-bind="text: `${ContestBattle.infoCrotchetValue() < 1 ? '⬇️⬅️➡️' :
            ContestBattle.infoCrotchetValue() < 2 ? '⬅️➡️' :
            ContestBattle.infoCrotchetValue() < 3 ? '➡️' : '💗'.repeat(3 - (ContestBattle.infoCrotchetValue() > 3 ? 1 : 0))}`"></p>
        </div>
        <div class="pokemonSprite wandererSprite" style="position: relative;"
            data-bind="style: { backgroundImage: 'url(\'assets/images/dynamic-background/pokemon/417.png\')'},
            css: {'walkDown': ContestBattle.infoCrotchetValue() === 1 || ContestBattle.infoCrotchetValue() === 2}">
            <p data-bind="text: `${'💗'.repeat(3 - (ContestBattle.infoCrotchetValue() > 1 ? 1 : 0)
                - (ContestBattle.infoCrotchetValue() > 2 ? 1 : 0))}`"></p>
        </div>
        <div class="pokemonSprite wandererSprite" style="position: relative;"
            data-bind="style: { backgroundImage: 'url(\'assets/images/dynamic-background/pokemon/54.png\')','animation-duration': ContestBattle.infoCrotchetValue() === 3 ? '1.2s' : ''},
            css: {'walkDown': ContestBattle.infoCrotchetValue() < 4}">
            <p data-bind="text: `${ContestBattle.infoCrotchetValue() === 3 ? '🤍' : ContestBattle.infoCrotchetValue() > 2 ? '🖤' :'💗'.repeat(3 - (ContestBattle.infoCrotchetValue() > 0 ? 1 : 0)
                - (ContestBattle.infoCrotchetValue() > 1 ? 1 : 0))}`"></p>
        </div>
    </div>
    <p>Dance halls don't reward berries, but an opponent's dance hearts will translate into a token bonus during a frenzy.</p>
    <p>Also during frenzy, use moves to amass hearts and increase your score. Pokemon work together when under a spotlight and a move's matchup can increase or decrease the total, so be careful with which moves you select.
        Using bad moves won't lower your score or chain, but will result in a lesser bonus, if at all.
        The last move used by a pokemon will leave it in a finishing pose.
        Strike a group pose that impresses your audience for a small bonus when your hearts are tallied after all pokemon have performed.
        Not performing will cause the pokemon to strike a random pose.
    </p>
    <table class="table table-bordered table-striped" data-bind="with: GameHelper.enumNumbers(ContestType)">
        <thead>
            <tr>
                <th>Contest Type Poses</th>
                <th style="vertical-align: middle;">Poses</th>
                <th style="vertical-align: middle;">Examples</th>
            </tr>
        </thead>
        <tr>
            <td>Cool</td>
            <td>Poses that share a plane</td>
            <td>⬅️⬅️⬅️➡️ or ⬆️⬆️⬆️⬇️</td>
        </tr>
        <tr>
            <td>Beautiful</td>
            <td>Poses that have an opposite somewhere on the stage and at least one opposite link</td>
            <td>➡️➡️⬅️⬅️ or ⬆️⬇️⬆️⬇️</td>
        </tr>
        <tr>
            <td>Cute</td>
            <td>Poses that are different from the previous or second previous pose</td>
            <td>⬆️⬇️⬅️⬆️ or ⬆️⬇️⬅️➡️</td>
        </tr>
        <tr>
            <td>Smart</td>
            <td>Poses that are in the adjacent direction from the previous one</td>
            <td>⬅️⬆️➡️⬇️ or ⬅️⬆️➡️⬆️</td>
        </tr>
        <tr>
            <td>Tough</td>
            <td>Poses that are within 90 degrees of the previous one</td>
            <td>⬆️⬅️⬆️⬅️ or ⬅️⬆️⬅️⬅️</td>
        </tr>
    </table>
</script>
<script type="text/html" id="rankInfoSpectacular">
    <p>Multiple pokemon are highlighted during this rank. Use the selected pokemon's moves to boost the hearts of all the highlighted pokemon.</p>
    <p>Moves of the same type as the contest add +2, moves of adjacent types add +1, and moves of ineffective types subtract a heart. For Balanced contests, you need to chain moves with the previous performed move type.
        In this scenario only, anything preceeding or following a Balanced will be regularly effective and add +2 hearts.</p>
    <p>You can only excite the audience when everyone on stage has full hearts.</p>

    <div class="row" style="display:flex; justify-content:space-evenly">
        <!-- ko foreach: GameHelper.enumNumbers(ContestType).filter(type => type < 5) -->
             <div data-bind="css: {'contest-inactive': Boolean(!ContestBattleSpectacular.moveRange(0)[ContestBattle.infoCrotchetValue()][$index()])}">
                <img data-bind="attr: {src: PokemonHelper.getImage(25, false)}">
                <p data-bind="text: ('❤️').repeat(ContestBattleSpectacular.moveRange(0)[ContestBattle.infoCrotchetValue()][$index()]).concat(('🤍').repeat(5 - ContestBattleSpectacular.moveRange(0)[ContestBattle.infoCrotchetValue()][$index()]))"></p>
            </div>
        <!-- /ko -->
    </div>

    <p>Use the spacebar to attempt a Spectacle (should this be called something else?). If the pokemon's hearts are full it is successful and refills its moves. Otherwise, it loses access to its moves.</p>
    <p>If the pokemon runs out of moves, it gets jammed. Jammed pokemon can still fill their hearts with the help of other pokemon.</p>
    <p>Spectacle status is denoted by ⭐. Trainers will give you favors if you help them dazzle the audience with a Spectacle. This status is more easily achieved during a frenzy, but can be activated during a normal round too.</p>
    <p>During frenzy, lock in a set of moves and perform them with the spacebar.
        If timed for a Spectacle, the cumulative effectiveness of the pokemon's performance will extend the duration of the frenzy and if you're lucky, give you a reward.</p>

    <div class="row">
        <!-- ko foreach: GameHelper.enumNumbers(ContestType).filter(type => type < 3) -->
            <!-- ko with: ContestBattle.healthDisplayBeat(ContestBattle.infoBeat() + ContestTypeHelper.contestTypeMatrix[ContestType.Cool][$data] * 2, '⭐', '❤️', '🔹', ContestBattle.infoBeat()) -->
             <div class="col">
                <img data-bind="attr: {src: PokemonHelper.getImage(GameConstants.RegionalStarters[GameConstants.Region.hoenn][$parent] + 2, false)}">
                <p data-bind="text: $data"></p>
            </div>
            <!-- /ko -->
        <!-- /ko -->
    </div>
    <p>Berries are rewarded during frenzy depending on how well each pokemon's performance was received.</p>
</script>
<script type="text/html" id="rankInfoBrilliantShining">
    <h2>This contest mode is still in development</h2>
    <table class="table table-bordered table-striped" data-bind="with: GameHelper.enumNumbers(ContestType)">
        <thead>
            <tr>
                <th>Contest Type Dance Combos</th>
                <th style="vertical-align: middle;">Moves</th>
                <th style="vertical-align: middle;">Examples</th>
            </tr>
        </thead>
        <tr>
            <td>Cool</td>
            <td>Moves that have a directional link within the last three moves or are all oppositely linked</td>
            <td>⬅️⬅️⬅️ or ⬆️⬇️⬆️</td>
        </tr>
        <tr>
            <td>Beautiful</td>
            <td>Moves that have an opposite link within the last three moves</td>
            <td>➡️➡️⬅️ or ⬆️⬇️➡️</td>
        </tr>
        <tr>
            <td>Cute</td>
            <td>Moves that are different from the previous or second previous pose</td>
            <td>⬆️⬇️⬅️ or ⬇️⬅️➡️</td>
        </tr>
        <tr>
            <td>Smart</td>
            <td>Moves that are in the adjacently linked</td>
            <td>⬅️⬆️➡️ or ⬅️⬆️⬅️</td>
        </tr>
        <tr>
            <td>Tough</td>
            <td>Moves that are within 90 degrees of the previous one</td>
            <td>⬆️⬅️⬆️ or ⬆️⬅️⬅️</td>
        </tr>
    </table>
</script>


            <!-- Town Map  -->
            <div id="middle-bottom-sort-column">
    <div id="townMap" class="card sortable border-secondary mb-3" data-bind="visible: App.game.keyItems.hasKeyItem(KeyItemType.Town_map) && (App.game.gameState === GameConstants.GameState.fighting || App.game.gameState === GameConstants.GameState.gym || App.game.gameState === GameConstants.GameState.town||
        App.game.gameState === GameConstants.GameState.shop || App.game.gameState === GameConstants.GameState.farm || App.game.gameState === GameConstants.GameState.temporaryBattle || App.game.gameState === GameConstants.GameState.paused)">
        <div class="card-header p-0" data-toggle="collapse" href="#mapBody">
            <span data-bind="text: `Town Map (${GameConstants.camelCaseToString(GameConstants.Region[player.region])})`">Town Map</span>
        </div>
        <button class='btn btn-sm' style="position: absolute; left: 0px; top: 0px; width: auto; height: 41px;" data-toggle="popover" data-trigger="hover" data-html="true" data-title="Map Legend:"
        data-content=""
        data-placement="bottom" data-bind="attr: {'data-content': `<div class='row map-legend'>
                <div class='col-12'>
                    Map locations will be coloured based on the following:
                </div>
                ${MapHelper.getUsableFilters().map(setting => {
                    return `<div class='col-10 legend-item ${setting.name}'>
                        <span>${setting.displayName}:</span>
                    </div>
                    <div class='col-2'>
                        <span class='float-right px-4 bg-${setting.name.substring(2)}'>&nbsp;</span>
                    </div>`
                }).join('\n')}
                <div class='col-12'>
                    <i>NOTE: Colors and priority can be customized in the settings menu</i>
                </div>
            </div>`}">ⓘ</button>
        <button class='btn btn-sm' style="position: absolute; right: 96px; top: 0px; width: auto; height: 41px; cursor: default;"
        data-bind='style: { background: DayCycle.color() },
            tooltip: {
                title: DayCycle.tooltip(),
                html: true,
                placement: "bottom",
                trigger: "hover"
            }'>
            <img width=30px src="" data-bind="attr: { src: DayCycle.image() }"/>
        </button>
        <button class='btn btn-sm' style="position: absolute; right: 48px; top: 0px; width: auto; height: 41px; cursor: default;"
        data-bind='style: { background: Weather.color() },
            tooltip: {
                title: Weather.tooltip(),
                html: true,
                placement: "bottom",
                trigger: "hover"
            }'>
            <img width=30px src="" data-bind="attr: { src: Weather.image() }"/>
        </button>
        <button class='btn btn-sm' style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;" data-toggle="modal" data-target="#moonPhaseModal"
            data-bind='style: { background: MoonCycle.color() },
                tooltip: {
                    title: `${MoonCycle.tooltip()}<br/><br/>Click for more information.`,
                    html: true,
                    placement: "bottom",
                    trigger: "hover"
                }'>
            <img width=30px src="" data-bind="attr: { src: MoonCycle.image() }"/>
        </button>
        <div id="mapBody" class="card-body p-0 show">
            <div id="subregion-travel-buttons" class="btn-group mr-2" role="group" style="width: 100%;" data-bind="
                visible: SubRegions.getSubRegions(player.region).filter(sr => sr.unlocked()).length > 1,
                css: { 'slow-flash': player.highestRegion() == player.region && SubRegions.getSubRegions(player.region).filter(sr => sr.unlocked()).length > player.highestSubRegion() + 1 }">
                <button class="btn btn-sm btn-secondary" data-bind="click: () => player.subregion = player.subregion - 1">&lt;</button>
                <button class="btn btn-sm btn-primary" style="width: 70%;" data-bind="
                    click: () => SubRegions.openModal(),
                    text: 'Subregional Travel (' + player.subregionObject()?.name + ')'"
                    >Subregional Travel</button>
                <button class="btn btn-sm btn-secondary" data-bind="click: () => player.subregion = player.subregion + 1">&gt;</button>
            </div>
            <p id="mapTooltip" class="btn btn-secondary" style="visibility: hidden;"></p>
            <svg id="map" viewBox="0 0 1600 960" preserveAspectRatio="xMaxYMax meet">
                <defs>
                    <lineargradient id="mx-gradient-f8cecc-1-ea583b-1-s-0" x1="0%" x2="0%" y1="0%"
                                    y2="100%">
                        <stop offset="0%" style="stop-color:#909090"></stop>
                        <stop offset="100%" style="stop-color:#c1c1c1"></stop>
                    </lineargradient>
                    <lineargradient id="mx-gradient-dae8fc-1-7ea6e0-1-s-0" x1="0%" x2="0%" y1="0%"
                                    y2="100%">
                        <stop offset="0%" style="stop-color:#DAE8FC"></stop>
                        <stop offset="100%" style="stop-color:#7EA6E0"></stop>
                    </lineargradient>
                </defs>

                @import "regionMaps/KantoSVG.html"
                @import "regionMaps/JohtoSVG.html"
                @import "regionMaps/HoennSVG.html"
                @import "regionMaps/SinnohSVG.html"
                @import "regionMaps/UnovaSVG.html"
                @import "regionMaps/KalosSVG.html"
                @import "regionMaps/AlolaSVG.html"
                @import "regionMaps/GalarSVG.html"
                @importif true "regionMaps/HisuiSVG.html"
                @importif true "regionMaps/PaldeaSVG.html"

                <g id="playerSprite">
                    <!-- This group is cleared actively via koExtenders.ts added to fix #3358 -->
                    <!-- TODO: Replace current PlayerSprite rendering logic so a singular SVG is used / updated like so:-->
                </g>
            </svg>
        </div>
    </div>
</div>

        </div>

        <!--Right column-->
        <div class="col-lg-3 col-md-6" data-bind="css: {
            'col-lg-3': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
            'col-lg-4': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
        }">
            <div class="row p-0">
                <div id="right-column" class="col-12" data-bind="css: {
                    'col-lg-12': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
                    'col-lg-6': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                }">

                    <!-- Oak Items -->
                    <div id="oakItemsContainer" class="card sortable border-secondary mb-3" data-bind="visible: App.game.oakItems.canAccess() && !(Settings.getSetting('hideChallengeRelatedModules').observableValue() && App.game.challenges.list.disableOakItems.active())">
    <div class="card-header p-0" data-toggle="collapse" href="#oakItemsBody">
        <span style="text-align:center">Oak Items</span>
    </div>
    <button class='btn btn-sm btn-primary' style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;" href="#oakItemsModal" data-toggle="modal">
        List
    </button>
    <div id="oakItemsBody" class="card-body show p-0">
      <table class="table table-bordered table-striped m-0">
        <!--
        <thead>
          <tr>
            <td class="clickable table-primary p-0" colspan="2" href="#oakItemsModal" data-toggle="modal">
              Open menu
            </td>
          <tr>
        </thead>
        -->
        <tbody data-bind="foreach: App.game.oakItems.itemList">
          <tr data-bind="if: $data.isActive, tooltip: { html: true, title: $data.tooltip, trigger: 'hover', placement:'bottom' }">
            <td class="tight p-1">
              <img class="clickable" href="#oakItemsModal" data-toggle="modal" src="" data-bind="attr:{ src: 'assets/images/oakitems/' + OakItemType[$data.name] + '.png'}" width="32px">
            </td>
            <td class="p-0">
              <div class="progress" style="height: 40px;">
                  <div class="progress-bar bg-primary" role="progressbar"
                      data-bind="attr:{ style: 'width:' + ($data.isMaxLevel() ? 100 : $data.expPercentage) + '%' },
                         css: {
                           'bg-success': $data.hasEnoughExp() && !$data.isMaxLevel(),
                           'bg-primary': !$data.hasEnoughExp() || $data.isMaxLevel(),
                         }"
                      aria-valuemin="0" aria-valuemax="100">
                      <!-- ko if: !$data.hasEnoughExp() && !$data.isMaxLevel() -->
                      <span data-bind="text: $data.progressString" style="font-size: 15px;"></span>
                      <!-- /ko -->
                      <!-- ko if: $data.hasEnoughExp() && !$data.isMaxLevel() -->
                      <span class="clickable" data-bind="html: 'Upgrade (' + $data.calculateCost().amount.toLocaleString('en-US') + ' <img src=assets/images/currency/' + GameConstants.Currency[$data.calculateCost().currency] + '.svg height=18px/>)',
                        click: function(){ $data.buy(); }" style="font-size: 15px;">
                        Upgrade
                      </span>
                      <!-- /ko -->
                      <!-- ko if: $data.isMaxLevel() -->
                      <span style="font-size: 15px;">MAX LEVEL!</span>
                      <!-- /ko -->
                  </div>
              </div>
            </td>
          </tr>
        </tbody>
        <!-- ko if: App.game.oakItems.hasAvailableSlot() && !App.game.challenges.list.disableOakItems.active() -->
        <tfoot>
          <tr>
            <td class="clickable table-warning text-light" colspan="2" href="#oakItemsModal" data-toggle="modal">
              Equip another Oak Item!
            </td>
          </tr>
        </tfoot>
        <!-- /ko -->
        <!-- ko if: App.game.challenges.list.disableOakItems.active() -->
        <tfoot>
          <tr>
            <td class="clickable table-danger text-light" colspan="2" href="#oakItemsModal" data-toggle="modal">
              Oak Items are disabled.
            </td>
          </tr>
        </tfoot>
        <!-- /ko -->
      </table>
    </div>
    <!-- ko if: !App.game.challenges.list.disableOakItems.active() -->
    <div id="oakItemLoadout">
      <table class="table table-bordered table-striped m-0">
        <tr data-bind="foreach: App.game.oakItemLoadouts.loadouts">
          <td class="p-1 tight">
            <button class='btn btn-block btn-primary' style="height: 100%;"
              data-bind='click: function(){ App.game.oakItemLoadouts.activateLoadout($index()) }, text: $index() + 1, tooltip: { title: $data.name(), trigger: "hover", placement: "bottom" }'>
              1
            </button>
          </td>
        </tr>
      </table>
    </div>
    <!-- /ko -->
</div>


                    <!-- Current Quest -->
                    <div id="questDisplayContainer" class="card sortable border-secondary mb-3">
    <!-- ko if: App.game.quests.isDailyQuestsUnlocked() -->
        <div class="card-header p-0" data-toggle="collapse" href="#dailyQuestDisplayBody">
            <span data-bind='text: "Quests (" + App.game.quests.currentQuests().length + "/" + App.game.quests.questSlots() + ")"'></span>
        </div>
        <button class="btn btn-sm btn-primary" style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;"
                data-bind="click: function(){$('#QuestModal').modal('show')}">
            List
        </button>
    <!-- /ko -->

    <div id="dailyQuestDisplayBody" class="card-body p-0 show questDisplayBlock">
        <!-- ko if: App.game.quests.currentQuests().length == 0 && App.game.quests.isDailyQuestsUnlocked() -->
            <span class="pt-2 pb-2">Click "List" to start a new quest.</span>
        <!-- /ko -->
        <table width="100%" class="mb-0">
            <!-- List of player quests -->
            <tbody data-bind="foreach: App.game.quests.currentQuests()">
                <tr class="text-center">
                    <td colspan="2" data-bind="text: $data.description"></td>
                </tr>
                <tr>
                    <td width="70%" class="p-0">
                        <div class="progress p-0">
                            <div class="progress-bar bg-primary" role="progressbar"
                                data-bind="attr:{ style: 'width:' + ($data.progress() * 100) + '%'}"
                                aria-valuemin="0" aria-valuemax="100">
                                <span data-bind="text: $data.progressText">0 / 1000</span>
                            </div>
                        </div>
                    </td>
                    <td width="30%" class="p-0">
                        <!-- ko ifnot: $data.isCompleted() -->
                        <button class="btn btn-danger btn-sm btn-block p-0" data-bind="click: () => { App.game.quests.quitQuest($data.index, $data.progress() > 0) }">
                            Quit
                        </button>
                        <!-- /ko -->
                        <!-- ko if: $data.isCompleted() -->
                        <button class="btn btn-success btn-sm btn-block p-0" data-bind="click: () => { App.game.quests.claimQuest($data.index) }">
                            Claim
                        </button>
                        <!-- /ko -->
                    </td>
                </tr>
            </tbody>
		</table>
	</div>
    <!-- List of quest line quests -->
	<!-- ko let: { activeQuestLines: App.game.quests.questLines().filter((ql) => ql.state() == QuestLineState.started) } -->
        <!-- ko if: activeQuestLines.length -->
        <div class="card-header p-0" data-toggle="collapse" href="#questLineDisplayBody">
            <span>Quest Lines</span>
        </div>
        <!-- /ko -->
        <div id="questLineDisplayBody" class="card-body p-0 show" data-bind="foreach: activeQuestLines">
    		<div class="questDisplayBlock questLine">
    			<div class="card-header"  data-toggle="collapse" data-bind="attr : {href : '#qlcard_' + $index()}">
    				<knockout data-bind="text: $data.name"></knockout>
    				<knockout class="info text-primary" data-bind="tooltip: { title: $data.description, trigger: 'hover', placement:'left' }">ⓘ</knockout>
    			</div>
    			<div class="card-body p-0 show"  data-bind="attr : {id : 'qlcard_' + $index()}">
    				<table width="100%">
    					<tbody>
    						<tr class="text-center">
    							<td colspan="2" data-bind="text: $data.curQuestObject().description"></td>
    						</tr>
    						<!-- ko ifnot: $data.curQuestObject().quests -->
    						<tr>
    							<td colspan="2" class="p-0">
    								<div class="progress p-0">
    									<div class="progress-bar bg-success" role="progressbar"
    										data-bind="attr:{ style: 'width:' + ($data.curQuestObject().progress() * 100) + '%'}"
    										aria-valuemin="0" aria-valuemax="100">
    										<span data-bind="text: ko.pureComputed(function(){return $data.curQuestObject().progressText()})">0/1000</span>
    									</div>
    								</div>
    							</td>
    						</tr>
    						<!-- /ko -->
    						<!-- ko if: $data.curQuestObject().quests -->
    							<!-- ko foreach: $data.curQuestObject().quests -->
    								<!-- ko if: $data.description-->
    									<tr class="text-center font-italic">
    										<td colspan="2" data-bind="text: $data.description"></td>
    									</tr>
    								<!-- /ko -->
    								<tr>
    									<td colspan="2">
    										<div class="progress p-0">
    											<div class="progress-bar bg-success" role="progressbar"
    												data-bind="attr:{ style: 'width:' + ($data.progress() * 100) + '%'}"
    												aria-valuemin="0" aria-valuemax="100">
    												<span data-bind="text: ko.pureComputed(function(){return $data.progressText()})">0/1000</span>
    											</div>
    										</div>
    									</td>
    								</tr>
    							<!-- /ko -->
    						<!-- /ko -->
    					</tbody>
    				</table>
    			</div>
    		</div>
        </div>
	<!-- /ko -->
</div>


                    <!-- Egg Slots/Breeding-->
                    <div id="breedingDisplay" class="card sortable border-secondary mb-3" data-bind="visible: App.game.breeding.canAccess()">
    <div class="card-header p-0" data-toggle="collapse" href="#eggList">
        <span>Hatchery</span>
    </div>
    <button class='btn btn-sm btn-primary' style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;"
            data-bind='click: function(){ BreedingController.openBreedingModal(); }'>
        List
    </button>
    <div id='eggList' class="card-body p-0 show">
      <div class="row m-0" data-bind="foreach: App.game.breeding.eggList">
        <div class="col-3 col-md-6 p-0 eggSlot">
          <div class="content" data-bind="if: DisplayObservables.collapseState.eggList !== 'hidden'">
            <div data-bind="if: $index() === App.game.breeding.eggSlots">
                <p>
                  <br/>
                  <span data-bind="template: { name: 'currencyTemplate', data: {'amount': App.game.breeding.nextEggSlotCost().amount, 'currency': GameConstants.Currency.questPoint}}"></span>
                </p>
                <button class='btn btn-primary' onclick='App.game.breeding.buyEggSlot()'
                        data-bind='css: {disabled: App.game.wallet.currencies[GameConstants.Currency.questPoint]() <= App.game.breeding.nextEggSlotCost().amount}'>Unlock</button>
            </div>
            <div data-bind="visible: $index() > App.game.breeding.eggSlots">
                <img class="lockedSlotImage" src="assets/images/breeding/lock.svg">
            </div>
            <div data-bind="if: App.game.breeding.hatcheryHelpers.hired()[$index()]">
              <div data-bind="with: App.game.breeding.hatcheryHelpers.hired()[$index()]">
                <img class="hatcheryHelperImage" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` },
                  tooltip: {
                    title: $data.tooltip(),
                    trigger: 'hover',
                    placement:'top',
                    html: true,
                  }" />
              </div>
            </div>
            <!-- ko ifnot: $data.isNone() -->
            <div style="margin-top: 20px;" class="clickable" data-bind="
                click: function(){ if (progress() >= 100) App.game.breeding.hatchPokemonEgg($index()) },
                tooltip: {
                    title: BreedingController.getEggPokemonName($data) ? PokemonHelper.displayName(BreedingController.getEggPokemonName($data))() : '???',
                    trigger: 'hover',
                    placement: 'bottom',
                    class: 'no-click',
                }">
                <!-- ko if: $data.type == EggType.Fossil -->
                <img class="egg" data-bind="attr: {src: BreedingController.getEggImage($data)}, class: BreedingController.getEggCssClass($data)"/>
                <!-- /ko -->
                <!-- ko ifnot: $data.type == EggType.Fossil -->
                <div data-bind="template: { name: 'eggSVGTemplate', data: $data}, class: BreedingController.getEggCssClass($data)"></div>
                    <!-- ko if: $data.type == EggType.Pokemon -->
                    <div data-bind="if: $data.partyPokemon()?.pokerus > GameConstants.Pokerus.Uninfected" style="position: absolute;right: 2px;top: -3px;">
                        <img width="40px" src="" data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[$data.partyPokemon()?.pokerus]}.png`}"/>
                    </div>
                    <!-- /ko -->
                <!-- /ko -->
                <div class="progress" data-bind='visible: progress() < 100'>
                    <div class="progress-bar bg-success" role="progressbar"
                         data-bind="attr:{ style: 'width:' + $data.progress() + '%' }"
                         aria-valuemin="0" aria-valuemax="100">
                        <!-- ko if: Settings.getSetting('breedingDisplay').observableValue() == 'stepCount' -->
                        <span data-bind="text: $data.progressText()"></span>
                        <!-- /ko -->
                        <!-- ko if: Settings.getSetting('breedingDisplay').observableValue() == 'percentage' -->
                        <span data-bind="text: Math.floor($data.progress()) + '%'"></span>
                        <!-- /ko -->
                    </div>
                </div>
                <div class="progress" data-bind='visible: progress() >= 100'>
                    <div class="progress-bar bg-success" role="progressbar"
                    data-bind="attr:{ style: 'width: 100%; cursor: pointer;' }, text: 'Hatch!'"
                    aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
            </div>
            <!-- /ko -->
          </div>
        </div>
      </div>
    </div>
    <!-- ko if: App.game.breeding.queueList().length -->
    <div id="hatcheryQueue" class="card-footer p-1" data-bind="foreach: App.game.breeding.queueList()">
      <div class="queuePokemon clickable bg-primary" data-bind="click: function(){ App.game.breeding.removeFromQueue($index()) }">
        <img src="" data-bind="attr: { src: PokemonHelper.getImage(pokemonMap[$data].id) }">
      </div>
    </div>
    <div id="hatcheryQueueInfo" class="card-footer p-0 small">
        <span style="line-height: 30px;"
            data-bind="
                text: App.game.breeding.queueList().length + ' / ' + App.game.breeding.usableQueueSlots(),
                tooltip: { title: Settings.getSetting('breedingQueueSizeSetting').observableValue() > -1 ? 'Queue is currently limited by your Queue Size setting.' : '', trigger: 'hover' }
            "></span>
        <button class="btn btn-sm btn-danger" style="position: absolute; right: 0; width: auto;" data-bind="
            click: () => App.game.breeding.clearQueue(Settings.getSetting('breedingQueueClearConfirmation').observableValue()),
            tooltip: { title: 'Remove all Pokémon from the queue.', trigger: 'hover' }">
            Clear
        </button>
    </div>
    <!-- /ko -->
</div>


                    <!-- Farm -->
                    <div id="farmDisplay" class="card sortable border-secondary mb-3 pokeclicker-optional-module" data-bind="visible: App.game.farming.canAccess() && Settings.getSetting('showFarmModule').observableValue() !== 'never', if: Settings.getSetting('showFarmModule').observableValue() !== 'never'">
    <div class="card-header p-0" data-toggle="collapse" href="#plotListCard">
        <span>Farm</span>
    </div>
    <button class='btn btn-sm btn-primary' style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;" onclick="FarmController.openFarmModal()">
        View
    </button>
    <!-- ko if: Settings.getSetting('showFarmModule').observableValue() === 'limited' -->
    <div class="dropdown" style="position: absolute; left: 0px; top: 0px;">
        <button class='btn btn-sm btn-primary dropdown-toggle dropdown-toggle-no-arrow' style="width: auto; height: 41px;" data-toggle="dropdown"
            data-bind="tooltip: {title: App.game.farming.unlockedBerries[FarmController.selectedBerry()]() ? BerryType[FarmController.selectedBerry()] : '???', trigger: 'hover', placement: 'right'}">
            <img src="" alt="selected berry image" height="28px" data-bind="attr:{ src: FarmController.getBerryImage(FarmController.selectedBerry()) },
                css: {'berryLocked': !App.game.farming.unlockedBerries[FarmController.selectedBerry()]() }">
        </button>
        <div class="dropdown-menu" style="max-height: 275px; overflow-y: auto;"
            data-bind="foreach: GameHelper.enumNumbers(BerryType).filter(b => App.game.farming.unlockedBerries[b]?.())">
            <button class="dropdown-item d-flex small px-3" type="button"
                data-bind="click: () => FarmController.selectedBerry($data), css: { 'active': FarmController.selectedBerry() === $data }">
                <knockout class="flex-grow-1" data-bind="text: BerryType[$data]"></knockout>
                <knockout data-bind="text: App.game.farming.berryList[$data]() >= 1e6
                    ? GameConstants.formatNumber(App.game.farming.berryList[$data]())
                    : App.game.farming.berryList[$data]().toLocaleString('en-US')"></knockout>
            </button>
        </div>
    </div>
    <!-- /ko -->
    <div id="plotListCard" class="card-body p-0 px-2 show" data-bind="css: { ShiftPressed: GameController.keyHeld.Shift() }">
      <!-- ko if: Settings.getSetting('showFarmModule').observableValue() === 'extended' -->
      <div class="row py-0 mt-1">
        <div class="col-3 px-1">
            <div class="btn-group w-100">
                <button type="button" class="btn btn-sm btn-primary px-1 py-0" data-bind="tooltip: {title: App.game.farming.unlockedBerries[FarmController.selectedBerry()]() ? BerryType[FarmController.selectedBerry()] : '???', trigger: 'hover', placement: 'top'},
                    click: () => FarmController.selectedFarmModuleTool(FarmingTool.Berry),
                    css: { active: FarmController.selectedFarmModuleTool() === FarmingTool.Berry }">
                    <img src="" alt="selected berry image" height="28px" data-bind="attr:{ src: FarmController.getBerryImage(FarmController.selectedBerry()) },
                        css: {'berryLocked': !App.game.farming.unlockedBerries[FarmController.selectedBerry()]() }">
                </button>
                <button type="button" class="btn btn-sm btn-primary p-0 dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"></button>
                <div class="dropdown-menu dropdown-menu-right" style="max-height: 275px; overflow-y: auto;"
                    data-bind="foreach: GameHelper.enumNumbers(BerryType).filter(b => App.game.farming.unlockedBerries[b]?.())">
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => { FarmController.selectedBerry($data); FarmController.selectedFarmModuleTool(FarmingTool.Berry) },
                            css: { active: FarmController.selectedBerry() === $data }">
                        <knockout class="flex-grow-1" data-bind="text: BerryType[$data]"></knockout>
                        <knockout data-bind="text: App.game.farming.berryList[$data]() >= 1e6
                            ? GameConstants.formatNumber(App.game.farming.berryList[$data]())
                            : App.game.farming.berryList[$data]().toLocaleString('en-US')"></knockout>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-3 px-1">
            <div class="btn-group w-100">
                <button type="button" class="btn btn-sm btn-primary px-1 py-0" data-bind="tooltip: {title: ItemList[MulchType[FarmController.selectedMulch()]].displayName, trigger: 'hover', placement: 'top'},
                    click: () => FarmController.selectedFarmModuleTool(FarmingTool.Mulch),
                    css: { active: FarmController.selectedFarmModuleTool() === FarmingTool.Mulch }">
                    <img src="" alt="selected mulch image" height="28px" data-bind="attr:{ src: ItemList[MulchType[FarmController.selectedMulch()]].image }">
                </button>
                <button type="button" class="btn btn-sm btn-primary p-0 dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"></button>
                <div class="dropdown-menu dropdown-menu-right" data-bind="foreach: GameHelper.enumNumbers(MulchType).filter(m => m > MulchType.None)">
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => { FarmController.selectedMulch($data); FarmController.selectedFarmModuleTool(FarmingTool.Mulch) },
                            css: { active: FarmController.selectedMulch() === $data }">
                        <knockout class="flex-grow-1" data-bind="text: ItemList[MulchType[$data]].displayName"></knockout>
                        <knockout data-bind="text: App.game.farming.mulchList[$data]() >= 1e6
                            ? GameConstants.formatNumber(App.game.farming.mulchList[$data]())
                            : App.game.farming.mulchList[$data]().toLocaleString('en-US')"></knockout>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-3 px-1">
            <div class="btn-group w-100">
                <button type="button" class="btn btn-sm btn-primary px-1 py-0"
                    data-bind="tooltip: {title: `${ItemList.Berry_Shovel.displayName} (${App.game.farming.shovelAmt().toLocaleString()})`, trigger: 'hover', placement: 'top'},
                        click: () => FarmController.selectedFarmModuleTool(FarmingTool.Shovel),
                        css: { active: FarmController.selectedFarmModuleTool() === FarmingTool.Shovel },
                        visible: FarmController.selectedFarmModuleTool() !== FarmingTool.MulchShovel">
                    <img src="" alt="Berry Shovel" height="28px" data-bind="attr:{ src: ItemList['Berry_Shovel'].image }">
                </button>
                <button type="button" class="btn btn-sm btn-primary px-1 py-0"
                    data-bind="tooltip: {title: `${ItemList.Mulch_Shovel.displayName} (${App.game.farming.mulchShovelAmt().toLocaleString()})`, trigger: 'hover', placement: 'top'},
                        click: () => FarmController.selectedFarmModuleTool(FarmingTool.MulchShovel),
                        css: { active: FarmController.selectedFarmModuleTool() === FarmingTool.MulchShovel },
                        visible: FarmController.selectedFarmModuleTool() === FarmingTool.MulchShovel">
                    <img src="" alt="Mulch Shovel" height="28px" data-bind="attr:{ src: ItemList['Mulch_Shovel'].image }">
                </button>
                <button type="button" class="btn btn-sm btn-primary p-0 dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"></button>
                <div class="dropdown-menu dropdown-menu-right">
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => { FarmController.selectedFarmModuleTool(FarmingTool.Shovel) },
                            css: { active: FarmController.selectedFarmModuleTool() == FarmingTool.Shovel }">
                        <knockout class="flex-grow-1">Shovel</knockout>
                        <knockout data-bind="text: `(${App.game.farming.shovelAmt().toLocaleString()})`"></knockout>
                    </button>
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => { FarmController.selectedFarmModuleTool(FarmingTool.MulchShovel) },
                            css: { active: FarmController.selectedFarmModuleTool() == FarmingTool.MulchShovel }">
                        <knockout class="flex-grow-1">Mulch Shovel</knockout>
                        <knockout data-bind="text: `(${App.game.farming.mulchShovelAmt().toLocaleString()})`"></knockout>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-3 px-1">
            <div class="btn-group w-100">
                <button type="button" class="btn btn-sm btn-primary px-1 py-0" style="height:30px" data-bind="
                    click: () => FarmController.selectedFarmModuleTool(FarmingTool.Lock),
                    tooltip: {title: 'Lock/Unlock a plot from interaction.', trigger: 'hover', placement: 'top'},
                    css: { active: FarmController.selectedFarmModuleTool() == FarmingTool.Lock }">
                    <img alt="Lock" src="assets/images/farm/plotSafeLock.svg" height="22px">
                </button>
                <button type="button" class="btn btn-sm btn-primary p-0 dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"></button>
                <div class="dropdown-menu dropdown-menu-right">
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => FarmController.toggleAllPlotLocksTo(true)">
                        <knockout class="flex-grow-1">Lock All</knockout>
                    </button>
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => FarmController.toggleAllPlotLocksTo(false)">
                        <knockout class="flex-grow-1">Unlock All</knockout>
                    </button>
                    <button class="dropdown-item d-flex small px-3 py-1" type="button"
                        data-bind="click: () => FarmController.toggleAllPlotLocks()">
                        <knockout class="flex-grow-1">Flip All</knockout>
                    </button>
                </div>
            </div>
        </div>
      </div>
      <!-- /ko -->
      
      <div class="row py-1" data-bind="foreach: App.game.farming.plotList">
        <!-- ko if: $index() % GameConstants.FARM_PLOT_WIDTH == 0 -->
        <div class="w-100"></div>
        <!-- /ko -->
        <div class="plot col" data-bind="css: { plotLocked : !$data.isUnlocked }">
            <div class="plot-content" data-bind="class: FarmController.calculateCssClassMini($data)">
                <div class="plotImage"data-bind="if: DisplayObservables.collapseState.plotListCard !== 'hidden'">
                    <img style="width: 100%" src="assets/images/farm/soil.png"
                        data-bind="class: FarmController.calcMulchClass($data)">
                    <!-- ko if: !$data.isUnlocked -->
                    <div class="plotButton plotLockHover" data-bind="tooltip: {
                      title: `Unlock this plot in the Farm`,
                      placement: 'bottom',
                      trigger: 'hover'
                    }" onclick="FarmController.openFarmModal()">
                      <img alt="lock" class="lock" src="assets/images/breeding/lock.svg">
                    </div>
                    <!-- /ko -->
                    <!-- ko if: $data.isUnlocked -->
                        <!-- ko if: $data.wanderer -->
                            <!-- ko ifnot: $data.wanderer.catching -->
                                <div class="pokemonSprite wandererSprite"
                                    data-bind="style: { backgroundImage: FarmController.getWandererStyle($data)},
                                    class: FarmController.getWandererCss($data)">
                                </div>
                            <!-- /ko -->
                            <!-- ko if: $data.wanderer.catching -->
                                <img src="" class="pokeball-animated wandererCapture" style="z-index: 1;"
                                    data-bind="attr: {src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.wanderer.pokeball()] + '.svg'}"/>
                            <!-- /ko -->
                        <!-- /ko -->
                        <div class="plotButton"
                        data-bind="ifnot: $data.isEmpty(),
                        click: function(data, event){FarmController.plotClickMini($index(), event)},
                        tooltip: {title: $data.tooltip(), trigger: 'hover', animation: false, html: true}">
                        <img width="100%" height="100%" src=""
                            style="width: 68.75%; max-height: 100%; image-rendering: pixelated;"
                            data-bind="attr:{ src: FarmController.getImage($index())}">
                        </div>
                    <!-- /ko -->
                    <!-- ko if: $data.isSafeLocked -->
                    <img class ="plotSafeLockIcon" src= "assets/images/farm/plotSafeLock.svg" >
                    <!-- /ko -->
                </div>
            </div>
        </div>
    </div>
    
    </div>
    <div class="card-footer p-0">
      <button type="button" class="btn float-left"
      data-bind="visible: FarmController.additionalInfoTooltip().length !== 0,
      tooltip: {
          title: FarmController.additionalInfoTooltip(),
          trigger: 'hover',
          placement:'top',
          html: true,
      }">ⓘ</button>
    <knockout class="float-right pr-2 pt-1" data-bind="foreach: App.game.farming.farmHands.hired()">
      <img class="pixelated mx-1" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` },
      tooltip: {
          title: $data.tooltip(),
          trigger: 'hover',
          placement:'top',
          html: true,
      }">
    </div>
</div>


                    <!-- Underground -->
                    <div id="undergroundDisplay" class="card sortable border-secondary mb-3 pokeclicker-optional-module" data-bind="visible: App.game.underground.canAccess() && Settings.getSetting('showUndergroundModule').observableValue(), if: Settings.getSetting('showUndergroundModule').observableValue()">
    <div class="card-header p-0" data-toggle="collapse" href="#undergroundCard">
        <span>Underground</span>
    </div>
    <button class="btn btn-sm btn-primary" style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;" onclick="UndergroundController.openUndergroundModal()">
        View
    </button>

    <div id="undergroundCard" class="card-body p-0 show">
        <div class="container">
            <div class="row p-1 d-flex justify-content-center flex-wrap" style="column-gap: 1rem; row-gap: 0.25rem">
                <!-- ko if: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                <div class="flex-grow-1">
                    <div>Searching for mine</div>
                    <div class="progress" style='height: 5px; min-height: 5px'>
                        <div class="progress-bar bg-info" role="progressbar"
                             data-bind="attr:{ style: 'width:' + (1 - App.game.underground.mine.timeUntilDiscovery / App.game.underground.mine.initialTimeToDiscover).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                </div>
                <!-- /ko -->

                <!-- ko ifnot: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                <div class="small" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsFound > 0 && App.game.underground.mine?.itemsFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsFound === App.game.underground.mine?.itemsBuried }">Found • <knockout data-bind="text: App.game.underground.mine?.itemsFound"></knockout></div>
                <div class="small" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsPartiallyFound > 0 && App.game.underground.mine?.itemsPartiallyFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsPartiallyFound === App.game.underground.mine?.itemsBuried }">Seen • <knockout data-bind="text: App.game.underground.mine?.itemsPartiallyFound"></knockout></div>
                <div class="small">Buried • <knockout data-bind="text: App.game.underground.mine?.itemsBuried"></knockout></div>
                <!-- /ko -->
            </div>
        </div>

        <div class="container">
            <div class="row d-flex justify-content-center flex-wrap" style="gap: 2px;">
                <!-- ko foreach: [UndergroundToolType.Chisel, UndergroundToolType.Hammer, UndergroundToolType.Bomb, UndergroundToolType.Survey] -->
                <!-- ko let: { tool: App.game.underground.tools.getTool($data) } -->
                <div class="tool-ui" style="flex: 1; min-width: 50px;" data-bind="class: `${UndergroundToolType[$data]}-tool-ui`">
                    <div class="p-0 mb-1 d-flex justify-content-center" data-bind="css: { 'clickable': [UndergroundToolType.Bomb, UndergroundToolType.Survey].includes($data) && Settings.getSetting('enableUndergroundModuleMineControls').observableValue() }, click: () => {
                        if ([UndergroundToolType.Bomb, UndergroundToolType.Survey].includes($data) && Settings.getSetting('enableUndergroundModuleMineControls').observableValue()) {
                            App.game.underground.tools.useTool($data, 0, 0);
                        }
                    }">
                        <div style="position: relative; width: 100%; max-width: 50px; aspect-ratio: 1; padding: 2px; border-radius: 10px;" data-bind="style: { background: `conic-gradient(var(--tool-color) ${tool.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 })}, transparent 0)`, opacity: tool.durability < tool.durabilityPerUse ? 0.3 : 1 }">
                            <div class="d-flex flex-column align-items-center justify-content-center bg-secondary" style="width: 100%; height: 100%; border-radius: 8px;">
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <img style="width: 20px; height: 20px; object-fit: contain;" alt="" data-bind="attr: { src: `assets/images/underground/${UndergroundToolType[tool.id]}.png` }, style: {  }">
                                </div>
                                <div class="small"><knockout data-bind="text: tool.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                            </div>
                        </div>
                    </div>

                    <!-- ko if: tool.restoreRate > 0 -->
                    <div class="progress" style='height: 5px; min-height: 5px;'>
                        <div class="progress-bar" role="progressbar" style="background: var(--tool-color)"
                             data-bind="style: { 'width': (tool.restoreRateCounter / tool.restoreRate).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <div class="small"><knockout data-bind="text: (tool.restoreRateCounter / tool.restoreRate).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                    <!-- /ko -->
                    <!-- ko ifnot: tool.restoreRate > 0 -->
                    <div class="progress" style='height: 5px; min-height: 5px;'>
                        <div class="progress-bar progress-bar-animated" role="progressbar" style="background: linear-gradient(45deg,var(--tool-color) 25%,transparent 25%,transparent 50%,var(--tool-color) 50%,var(--tool-color) 75%,transparent 75%,transparent); background-size: 0.5rem 0.5rem;"
                             data-bind="style: { 'width': '100%' }"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <div class="small">∞</div>
                    <!-- /ko -->
                </div>
                <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>
    </div>

    <div class="card-header position-relative p-0" data-toggle="collapse" href="#undergroundDisplayHelpers">
        <span>Helper</span>
        <!-- ko if: App.game.underground.helpers.hired().length > 0 -->
        <button class="btn btn-sm btn-danger" style="position: absolute; right: 0px; top: 0px; width: auto; height: 41px;" onclick="App.game.underground.helpers.hired().forEach(helper => helper.fire())">
            Fire
        </button>
        <!-- /ko -->
    </div>

    <div id="undergroundDisplayHelpers" class="table-responsive show">
        <div class="container">
            <!-- ko foreach: App.game.underground.helpers.hired() -->
            <div class="row">
                <div class="col p-2">
                    <div data-bind="text: $data.name"></div>
                    <!-- ko ifnot: $data.selectedEnergyRestore < 0 -->
                    <div data-bind="text: `${GameConstants.camelCaseToString(GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore])} (${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore]]().toLocaleString('en-US')})`"></div>
                    <!-- /ko -->
                    <div class="progress" style='height: 5px'>
                        <div class="progress-bar bg-info" role="progressbar"
                             data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                             aria-valuemin="0" aria-valuemax="100">
                            <span data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} / ${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} s`"></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
            <!-- ko ifnot: App.game.underground.helpers.hired().length > 0 -->
            <div class="">No helpers hired. You're on your own!</div>
            <!-- /ko -->
        </div>
    </div>

    <!-- ko ifnot: App.game.challenges.list.disableOakItems.active() -->
    <!-- ko if: App.game.oakItems.isActive(OakItemType.Cell_Battery) -->
    <div class="card-header position-relative p-0" data-toggle="collapse" href="#undergroundDisplayBattery">
        <span>Battery</span>
    </div>

    <div id="undergroundDisplayBattery" class="table-responsive show">
        <div class="container">
            <div class="row">
                <div class="col p-2">
                    <div class="progress" style='height: 15px; min-height: 15px;'>
                        <div class="progress-bar" role="progressbar"
                             data-bind="style: { 'width': (App.game.underground.battery.charges / App.game.underground.battery.maxCharges).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                             aria-valuemin="0" aria-valuemax="100">
                            <span data-bind="text: `${App.game.underground.battery.charges} / ${App.game.underground.battery.maxCharges}`"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /ko -->
    <!-- /ko -->
</div>


                    <!-- Shortcuts Menu -->
                    <div id="shortcutsContainer" class="card sortable border-secondary mb-3"
    data-bind="visible: UndergroundController.shortcutVisible() || FarmController.shortcutVisible() || ShopHandler.shortcutVisible()">
    <div class="card-header p-0" data-toggle="collapse" href="#shortcutsBody">
        <span style="text-align:center">Shortcuts</span>
    </div>
    <div id="shortcutsBody" class="card-body show p-0">
      <table class="table table-sm m-0">
        <tbody>
          <tr data-bind="visible: UndergroundController.shortcutVisible">
            <td class="p-0">
              <button class="btn btn-block btn-primary m-0" onclick="UndergroundController.openUndergroundModal()">
                  Underground
                  <knockout data-bind="text: `[${Settings.getSetting('hotkey.underground').observableValue()}]`,
                    visible: Settings.getSetting('hotkey.underground').observableValue() != 'None'"></knockout>
              </button>
            </td>
          </tr>
          <tr data-bind="visible: FarmController.shortcutVisible">
            <td class="p-0">
              <button class="btn btn-block btn-primary m-0" onclick="FarmController.openFarmModal()">
                  Farm
                  <knockout data-bind="text: `[${Settings.getSetting('hotkey.farm').observableValue()}]`,
                    visible: Settings.getSetting('hotkey.farm').observableValue() != 'None'"></knockout>
              </button>
            </td>
          </tr>
          <tr data-bind="visible: ShopHandler.shortcutVisible">
            <td class="p-0">
              <button class="btn btn-block btn-primary m-0" onclick="ShopHandler.showShop(pokeMartShop);" href="#shopModal" data-toggle="modal">
                  Poké Mart
                  <knockout data-bind="text: `[${Settings.getSetting('hotkey.shop').observableValue()}]`,
                    visible: Settings.getSetting('hotkey.shop').observableValue() != 'None'"></knockout>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
</div>

                </div>
                <div id="right-column-2" class="col-12" data-bind="css: {
                    'col-lg-12': Settings.getSetting('gameDisplayStyle').observableValue() !== 'fullWidth5',
                    'col-lg-6': Settings.getSetting('gameDisplayStyle').observableValue() === 'fullWidth5',
                }">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Challenge Mode Modal -->
<div class="modal noselect fade" id="challengeModeModal" tabindex="-1" role="dialog" aria-labelledby="challengeModeModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Challenge Modes</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>
                    <strong>Activate in-game challenge modes!</strong><br/>
                    Challenges can be disabled later, but cannot be re-enabled.
                </p>
                <br/>
                <table class="table" width="100%">
                    <tbody data-bind="foreach: Object.values(App.game.challenges.list)">
                        <tr data-bind="tooltip: {
                            title: $data.description,
                            placement: 'bottom',
                            trigger: 'hover'
                        }">
                            <td class="text-left font-weight-bold" data-bind="text: $data.type"></td>
                            <td class="p-1">
                                <!-- ko if: !$data.active() && player.regionStarters[GameConstants.Region.kanto]() == GameConstants.Starter.None --><button class="btn btn-warning btn-block" data-bind="click: ()=>{$data.activate();}">ACTIVATE</button><!-- /ko -->
                                <!-- ko if: !$data.active() && player.regionStarters[GameConstants.Region.kanto]() != GameConstants.Starter.None --><button class="btn btn-secondary btn-block disabled">DISABLED</button><!-- /ko -->
                                <!-- ko if: $data.active() --><button class="btn btn-success btn-block" data-bind="click: ()=>{$data.disable();}">ACTIVE</button><!-- /ko -->
                            </td>
                        </tr>
                    </tbody>
                </table>
                <br/>
               <button class="btn btn-primary btn-block" data-dismiss="modal">Done!</button>
            </div>
       </div>
    </div>
</div>


<!--ShopModal-->
<div class="modal fade noselect" id="shopModal" tabindex="-1" role="dialog"
     aria-labelledby="shopModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 data-bind="text: ShopHandler.shopObservable().displayName">Shop</h4>
                <button type="button" class="btn btn-primary" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div>
                    <span data-bind="template: { name: 'shopBodyTemplate' }"></span>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row justify-content-center">
                    <div class="input-group m-0" style="margin-bottom: 6px; margin-top: 6px">
                        <div class="input-group-prepend">
                            <button class="btn btn-warning btn-outline-dark smallButton smallFont" onclick="ShopHandler.resetAmount()">
                                Reset
                            </button>
                        </div>
                        <input id="amountOfItems" type="number" class="outline-dark form-control form-control-number"
                                value="1" min="1" required name="amountOfItems"
                                oninput="ShopHandler.amount(parseInt($(this).val().toString(), 10) || 0);"
                                onchange="ShopHandler.amount(parseInt($(this).val().toString(), 10) || 0);" title=""/>
                        <div class="input-group-append">
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(10)">
                                    +10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(100)">
                                    +100
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.multiplyAmount(10)">
                                    &times;10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.multiplyAmount(0.1)">
                                    &div;10
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(100)">
                                    +100
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(1000)">
                                    +1,000
                                </button>
                            <!-- /ko -->
                            <button class="btn btn-primary smallButton smallFont" type="button" onclick="ShopHandler.maxAmount()">
                                Max
                            </button>
                            <button class="btn-outline-dark" data-bind="attr: {class: ShopHandler.calculateButtonCss()}" onclick="ShopHandler.buyItem()">
                                Buy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/html" id="shopBodyTemplate">
    <div class="row justify-content-center" data-bind="foreach: [...new Set(ShopHandler.shopObservable().items.map(i => i.currency))]">
        <h4 class="col-6 col-sm-4 col-lg-2">
            <span data-bind="template: { name: 'currencyTemplate', data: { amount: App.game.wallet.currencies[$data](), currency: $data, reduced: true }}"></span>
        </h4>
    </div>
    <div class="row justify-content-center" data-bind="foreach: ShopHandler.shopObservable().items">
        <!-- ko if: $data.isVisible() -->
        <div class="col-6 col-sm-4 col-lg-3">
           <button class="shopItem clickable btn btn-block btn-secondary"
               data-bind="click: function() {ShopHandler.setSelected($index())},
               css: { active: ShopHandler.selected() == $index() },
               attr: { disabled: !$data.isAvailable() || $data.isSoldOut() },
               tooltip: {
                  title: $data.description ? `<u>${$data.displayName}:</u><br/>${$data.description}` : '',
                  trigger: 'hover',
                  placement:'bottom',
                  boundary: 'viewport',
                  html: true
                }">
               <knockout data-bind="if: ($data instanceof PokemonItem)">
                    <span style="position: absolute; top: 12px; left: 20px;"
                        data-bind="template: { name: 'pokerusStatusTemplate', data: {
                            'pokerus': $data.getPokerusStatus(), 'width': '32px',
                            'evs': App.game.party.getPokemonByName($data.type)?.evs() }}">
                    </span>
               </knockout>
               <knockout data-bind="if: ($data instanceof EvolutionStone)">
                    <span style="position: absolute; top: 12px; left: 20px;"
                        data-bind="template: { name: 'pokerusStatusTemplate', data: {
                            'pokerus': ItemList[$data.name].getPokerusStatus(), 'width': '32px',
                            'evsProgress': ItemList[$data.name].getPokerusProgress() }}">
                    </span>
               </knockout>
               <knockout data-bind="if: ($data instanceof CaughtIndicatingItem)">
                   <span style="position: absolute; top: 15px; right: 20px;"
                         data-bind="template: { name: 'caughtStatusTemplate', data: {'status': $data.getCaughtStatus()}}">
                   </span>
               </knockout>
               <img src="" height="36px" data-bind="attr:{ src: $data.image }">
               <p data-bind="text: $data.displayName">Item Name</p>
               <div data-bind="if: $data.isAvailable() && !$data.isSoldOut()">
                    <span data-bind="template: { name: 'currencyTemplate', data: {'amount': totalPrice(ShopHandler.amount()), 'currency': currency, 'reducedThreshold': 1e10}}"></span>
                </div>
                <div data-bind="if: !$data.isAvailable() || $data.isSoldOut()">
                    <span>Sold Out</span>
                </div>
            </button>
        </div>
        <!-- /ko -->
    </div>
</script>


<!-- Receive gym badge Modal -->
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="receiveBadgeModal" tabindex="-1" role="dialog"
aria-labelledby="receiveBadgeModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png'"
                    data-bind="attr:{ src: GymRunner.gymObservable().imagePath }">
               <h5 class="modal-title" id="receiveBadgeModalLabel"
                   data-bind="text: GymRunner.gymObservable().leaderName.replace(/\d/g,'')">Modal title</h5>

           </div>
       </div>
       <div class="modal-body">
           <p data-bind="html: GymRunner.gymObservable().defeatMessage"></p>
           <!-- ko if: !BadgeEnums[GymRunner.gymObservable().badgeReward].startsWith('Elite') -->
           <img src="" width="56px" data-bind="attr:{ src: 'assets/images/badges/' + BadgeEnums[GymRunner.gymObservable().badgeReward] + '.svg'}" onerror="this.src='assets/images/badges/Unknown.png'">
           <!-- /ko -->

       </div>
       <div data-bind="ifnot: GymRunner.gymObservable().flags.champion">
           <div class="modal-footer">
               <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
           </div>
       </div>
       <div data-bind="if: GymRunner.gymObservable().flags.champion">
           <div class="modal-footer">
               <button type="button" class="btn btn-primary" data-dismiss="modal"
                       onclick="$('#hallOfFameModal').modal('show')">
                   Next
               </button>
           </div>
       </div>

   </div>
</div>
</div>


<!-- One time battle won Modal -->
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="temporaryBattleWonModal" tabindex="-1" role="dialog"
aria-labelledby="temporaryBattleWonModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
   <div class="modal-content">
    <!-- ko if: TemporaryBattleRunner.battleObservable()?.defeatMessage -->
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png'"
                    data-bind="attr:{ src: TemporaryBattleRunner.battleObservable().getImage()}">
               <h5 class="modal-title" id="temporaryBattleWonModalLabel"
                   data-bind="text: TemporaryBattleRunner.battleObservable().getDisplayName()">Modal title</h5>

           </div>
        </div>
        <div class="modal-body">
           <p data-bind="html: TextMerger.mergeText(TemporaryBattleRunner.battleObservable().defeatMessage)"></p>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
    <!-- /ko -->
   </div>
</div>
</div>


<!-- Quest Step Cleared -->
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="questStepClearedModal" tabindex="-1" role="dialog"
aria-labelledby="questStepClearedModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
   <div class="modal-content">
    <!-- ko if: Quest.questObservable()?.optionalArgs -->
       <div class="modal-header">
           <div style="width: 100%;">
            <img src="" onerror="this.src='assets/images/npcs/specialNPCs/Mysterious Trainer.png'"
                data-bind="attr:{ src: Quest.questObservable().getNpcImage()}">
            <h5 class="modal-title" id="questStepClearedModalLabel"
                data-bind="text: Quest.questObservable().getNpcDisplayName()">Modal title</h5>

           </div>
        </div>
        <div class="modal-body">
            <p data-bind="html: TextMerger.mergeText(Quest.questObservable()?.getClearedMessage())"></p>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
    <!-- /ko -->
   </div>
</div>
</div>


<!-- Achievements Modal -->
<div class="modal  fade" id="achievementsModal" tabindex="-1" role="dialog"
aria-labelledby="AchievementsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 data-bind="tooltip: { title: 'As you earn achievements, you gain up to: 150% (global), 100% (per region), and from 25% to 75% (per special subregion). Earning bonuses to Click Attack, Flute Effects, Pokédollar / Dungeon Token gains, and Experience earned from all sources.', trigger: 'hover', placement:'right' }">Achievements Bonus: <u class="text-primary" data-bind="text: AchievementHandler.achievementBonusPercent()"></u></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body table-responsive p-0">
                <div class="tab-content p-3">
                    <div class="tab-pane active">
                        <div class="text-left">
                            <div class="form-row">
                                <div class="form-group col-md-3 col-6">
                                    <label>Status</label>
                                    <select name="achievementsStatus" class="custom-select" onchange="AchievementHandler.filter.status(this.value), Settings.setSettingByName(this.name, this.value)">
                                        <!-- ko foreach: Settings.getSetting('achievementsStatus').options -->
                                        <option data-bind="attr: { value: $data.value, selected: Settings.getSetting('achievementsStatus').value === $data.value }, text: $data.text">Status</option>
                                        <!-- /ko -->
                                    </select>
                                </div>
                                <div class="form-group col-md-3 col-6">
                                    <label>Type</label>
                                    <select name="achievementsType" class="custom-select" onchange="AchievementHandler.filter.type(this.value), Settings.setSettingByName(this.name, this.value)">
                                        <!-- ko foreach: Settings.getSetting('achievementsType').options.filter(r => r.value !== -1) -->
                                        <option data-bind="attr: { value: $data.value, selected: Settings.getSetting('achievementsType').value === $data.value }, text: $data.text.replace(/Poke/g, 'Poké')">Type</option>
                                        <!-- /ko -->
                                    </select>
                                </div>
                                <div class="form-group col-md-3 col-6">
                                    <label>Category</label>
                                    <select name="achievementsCategory" class="custom-select" onchange="AchievementHandler.filter.category(this.value), Settings.setSettingByName(this.name, this.value)">
                                        <!-- ko foreach: Settings.getSetting('achievementsCategory').options.filter(r => r.value == 'all' || AchievementHandler.getAchievementCategories().find((c) => c.name == r.value).isUnlocked()) -->
                                        <option data-bind="attr: { value: $data.value, selected: Settings.getSetting('achievementsCategory').value === $data.value }, text: $data.text">Category</option>
                                        <!-- /ko -->
                                    </select>
                                </div>
                                <div class="form-group col-md-3 col-6">
                                    <label>Sort</label>
                                    <div class="input-group" data-bind="with: Settings.getSetting('achievementSort')">
                                        <select autocomplete="off" class="custom-select" onchange="Settings.setSettingByName(this.name, AchievementSortOptions[AchievementSortOptions[this.value]])"
                                                data-bind="foreach: $data.options, attr: {name}, selectedOptions: [$data.observableValue()]">
                                            <option data-bind="text: $data.text, value: $data.value"></option>
                                        </select>
                                        <div class="input-group-append bg-primary text-light">
                                            <label for="achievementSortDirection" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;" data-bind="
                                            text: Settings.getSetting('achievementSortDirection').observableValue() ? '⥄' : '⥂',
                                            tooltip: { title: Settings.getSetting('achievementSortDirection').observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)', trigger: 'hover', placement:'top' }
                                            ">⥂</label>
                                            <input id="achievementSortDirection" style="vertical-align: middle" class="hidden" type='checkbox'
                                                   data-bind="checked: Settings.getSetting('achievementSortDirection').observableValue()"
                                                   onchange="Settings.setSettingByName('achievementSortDirection', this.checked)"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table table-hover table-striped table-sm m-0">
                    <tbody data-bind="template: { name: 'achievementListTemplate', foreach: AchievementHandler.getAchievementListWithIndex()}">
                    </tbody>
                </table>
            </div>

            <div class="modal-footer justify-content-center">
                <button
                  class="btn btn-secondary"
                  onclick="AchievementHandler.navigateIndex(0)"
                  data-bind="
                      disable: AchievementHandler.isNavigateDirectionDisabled(true),
                      css: { disabled: AchievementHandler.isNavigateDirectionDisabled(true) }
                  "
                >
                  <img src="assets/images/arrow-double.svg" style="transform: scaleX(-1);" height="20">
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="AchievementHandler.navigateLeft()"
                  data-bind="
                      disable: AchievementHandler.isNavigateDirectionDisabled(true),
                      css: { disabled: AchievementHandler.isNavigateDirectionDisabled(true) }
                  "
                >
                  <img src="assets/images/arrow.svg" style="transform: scaleX(-1);" height="20">
                </button>
                <div data-bind="text: AchievementHandler.navigateIndex()+1 + '/' + AchievementHandler.numberOfTabs()"></div>
                <button
                  class="btn btn-secondary"
                  onclick="AchievementHandler.navigateRight()"
                  data-bind="
                      disable: AchievementHandler.isNavigateDirectionDisabled(false),
                      css: { disabled: AchievementHandler.isNavigateDirectionDisabled(false) }
                  "
                >
                  <img src="assets/images/arrow.svg" height="20">
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="AchievementHandler.navigateIndex(AchievementHandler.numberOfTabs() - 1)"
                  data-bind="
                      disable: AchievementHandler.isNavigateDirectionDisabled(false),
                      css: { disabled: AchievementHandler.isNavigateDirectionDisabled(false) }
                  "
                >
                  <img src="assets/images/arrow-double.svg" height="20">
                </button>
            </div>
        </div>
    </div>

    <script type="text/html" id="achievementListTemplate">
        <tr
            class="achievement-row"
            data-bind="css: { 'table-success': isCompleted() , 'table-danger': !isCompleted() }, click: () => {App.game.achievementTracker.trackAchievement($data); $('#achievementsModal').modal('hide');}">
            <td style="text-align:left;vertical-align:middle;"><b><span data-bind="text: name">Name</span></b><br>
                <small><span data-bind="text: description">Description</span></small>
            </td>

            <td style="vertical-align:middle;"><span data-bind="text: getProgress().toLocaleString('en-US')">1</span>/<span
                    data-bind="text: property.requiredValue.toLocaleString('en-US')">2</span>
            </td>
            <td style="vertical-align:middle;"><span data-bind="text: getProgressPercentage()"></span>%</td>

            <td style="vertical-align:middle;">+<span data-bind="text: getBonus()"></span>%</td>
        </tr>
    </script>
</div>


<!-- Oak Items Modal-->
<div class="modal fade noselect" id="oakItemsModal" tabindex="-1" role="dialog" aria-badgeledby="oakItemsModal">
  <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header p-0">
        <ul class="nav nav-tabs">
            <li class="nav-item"><a data-toggle='tab' class='p-2 nav-link active' href="#oakItemSelector">Selector</a></li>
            <li class='nav-item'><a data-toggle='tab' class='p-2 nav-link' href="#oakItemLoadouts">Loadouts</a></li>
        </ul>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div data-bind="visible: App.game.challenges.list.disableOakItems.active()" class="modal-body bg-danger my-0 py-0">
        Oak Items are disabled.
      </div>
      <div class="modal-body tab-content">
          <div id="oakItemSelector" class="tab-pane fade in active show">
            <div class="modal-header">
              <h5 style="position: left" data-bind="text: 'Oak Items Equipped: ' + App.game.oakItems.activeCount() + '/' + App.game.oakItems.maxActiveCount()">Oak Items</h5>
            </div>
            <ul class="row justify-content-center p-0 my-0"
              data-bind="foreach: App.game.oakItems.itemList"
              style="list-style-type: none;">
                <!-- ko if: $index() % 4 == 0 -->
                <div class="w-100"></div>
                <!-- /ko -->
                <li class="col p-1">
                    <button class="p-0 btn"
                        data-bind="css: {
                           'btn-primary': $data.isActive,
                           'btn-outline-secondary': !$data.isActive
                         }">
                        <img class="clickable" style="width: 80%;" src=""
                             data-bind="attr:{ src: 'assets/images/oakitems/' + OakItemType[$data.name] + '.png'},
                              css: {
                                'oak-item-locked': !App.game.oakItems.isUnlocked($data.name)
                              },
                              event: {
                                mouseover: function(){OakItemController.hover($data.name)},
                                click: function(){OakItemController.click($data.name);},
                              }">
                    </button>
                </li>
            </ul>
          </div>
          <div id="oakItemLoadouts" class="tab-pane fade">
            <div class="modal-header p-1">
              <select name="loadoutSelector" autocomplete="off" class="custom-select"
                onchange="App.game.oakItemLoadouts.selectedLoadout(this.value)">
                <!-- ko foreach: App.game.oakItemLoadouts.loadouts -->
                <option data-bind="text: $data.name, value: $index(), attr:{ selected: App.game.oakItemLoadouts.selectedLoadout() == $data.value}"></option>
                <!-- /ko -->
              </select>
            </div>
            <div class="form-row p-0" id="loadoutNameEdit">
                <div class="form-group col-12">
                    <label>Name</label>
                    <input autocomplete="off" class="form-control" placeholder="name" data-bind="textInput: App.game.oakItemLoadouts.getSelectedLoadout().name"/>
                </div>
            </div>
            <ul class="row justify-content-center p-0 my-0"
              data-bind="foreach: App.game.oakItems.itemList"
              style="list-style-type: none;">
                  <!-- ko if: $index() % 4 == 0 -->
                  <div class="w-100"></div>
                  <!-- /ko -->
                  <li class="col p-1">
                    <button class="p-0 btn"
                        data-bind="css: {
                          'btn-primary': App.game.oakItemLoadouts.hasItem($index())(),
                          'btn-outline-secondary': !App.game.oakItemLoadouts.hasItem($index())(),
                        }">
                        <img class="clickable" style="width: 80%;" src=""
                            data-bind="attr:{ src: 'assets/images/oakitems/' + OakItemType[$data.name] + '.png'},
                              css: {
                                'oak-item-locked': !App.game.oakItems.isUnlocked($data.name)
                              },
                              event: {
                                mouseover: function(){OakItemController.hover($data.name)},
                                click: function(){App.game.oakItemLoadouts.toggleItem($data.name);},
                              }">
                      </button>
                  </li>
            </ul>
          </div>
      </div>
      <div class="modal-footer p-0">
        <table class="table table-bordered text-center m-0">
          <thead>
            <th colspan="2">
              <strong data-bind="text: GameConstants.humanifyString(OakItemType[OakItemController.inspectedItem])"></strong>
            </th>
          </thead>
          <tbody>
            <!-- ko if: App.game.oakItems.isUnlocked(OakItemController.inspectedItem) -->
            <tr>
              <td colspan="2" data-bind="text: App.game.oakItems.itemList[OakItemController.inspectedItem].description"></td>
            </tr>
            <tr>
              <td colspan="2" class="p-0">
                <div class="progress" style="height: 40px;">
                    <div class="progress-bar bg-primary" role="progressbar"
                        data-bind="attr:{ style: 'width:' + (App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel() ? 100 : App.game.oakItems.itemList[OakItemController.inspectedItem].expPercentage) + '%' },
                            css: {
                              'bg-success': App.game.oakItems.itemList[OakItemController.inspectedItem].hasEnoughExp() && !App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel(),
                              'bg-primary': !App.game.oakItems.itemList[OakItemController.inspectedItem].hasEnoughExp() || App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel(),
                            }"
                        aria-valuemin="0" aria-valuemax="100">
                        <!-- ko if: !App.game.oakItems.itemList[OakItemController.inspectedItem].hasEnoughExp() && !App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel() -->
                        <span data-bind="text: App.game.oakItems.itemList[OakItemController.inspectedItem].progressString" style="font-size: 15px;"></span>
                        <!-- /ko -->
                        <!-- ko if: App.game.oakItems.itemList[OakItemController.inspectedItem].hasEnoughExp() && !App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel() -->
                        <span class="clickable" data-bind="html: 'Upgrade (' + App.game.oakItems.itemList[OakItemController.inspectedItem].calculateCost().amount.toLocaleString('en-US') + ' <img src=assets/images/currency/' + GameConstants.Currency[App.game.oakItems.itemList[OakItemController.inspectedItem].calculateCost().currency] + '.svg height=18px/>)',
                          click: function(){ App.game.oakItems.itemList[OakItemController.inspectedItem].buy(); }" style="font-size: 15px;">
                          Upgrade
                        </span>
                        <!-- /ko -->
                        <!-- ko if: App.game.oakItems.itemList[OakItemController.inspectedItem].isMaxLevel() -->
                        <span style="font-size: 15px;">MAX LEVEL!</span>
                        <!-- /ko -->
                    </div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="table-dark" style="width: 50%">
                Level: <span data-bind="text: App.game.oakItems.itemList[OakItemController.inspectedItem].level"></span>
              </td>
              <td class="table-dark" style="width: 50%">
                Bonus: <span data-bind="text: App.game.oakItems.itemList[OakItemController.inspectedItem].bonusText"></span>
              </td>
            </tr>
            <!-- /ko -->
            <!-- ko ifnot: App.game.oakItems.isUnlocked(OakItemController.inspectedItem) -->
            <tr>
              <td colspan="2">Locked!<br/><span data-bind="text: App.game.oakItems.itemList[OakItemController.inspectedItem].hint()"></span></td>
            </tr>
            <tr>

            </tr>
            <!-- /ko -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Statistics Modal-->
<div class="modal noselect fade" id="statisticsModal" tabindex="-1" role="dialog" aria-labelledby="statisticsModal">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Statistics</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a class="nav-link active" href="#statisticsModalStatsPane" data-toggle="tab">Stats</a></li>
                    <li class="nav-item"><a class="nav-link" href="#statisticsModalMultipliersPane" data-toggle="tab">Multipliers</a></li>
                </ul>
                <div class="tab-content">
                    <!-- Stats Pane -->
                    <div class="tab-pane active" id="statisticsModalStatsPane">
                        <table class="table table-striped table-hover table-bordered table-sm m-0">
                            <thead>
                            <tr>
                                <th>Statistic</th>
                                <th>Amount</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td class="text-left">Time Played</td>
                                <td class="text-left tight text-muted" data-bind="html: GameConstants.formatSecondsToTime(App.game.statistics['secondsPlayed']())">-</td>
                            </tr>
                            <!-- ko foreach: App.game.statistics.observables -->
                            <tr>
                                <td class="text-left" data-bind="text: GameConstants.camelCaseToString($data)">-</td>
                                <td class="text-left tight text-muted" data-bind="text: App.game.statistics[$data]().toLocaleString('en-US')">-</td>
                            </tr>
                            <!-- /ko -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Multipliers Pane -->
                    <div class="tab-pane" id="statisticsModalMultipliersPane">
                        <table class='table table-sm table-hover m-0'>
                            <!-- ko foreach: Object.entries(App.game.multiplier.multipliers) -->
                                <tbody>
                                    <tr>
                                        <td colspan="2" class="clickable text-left h5"
                                            data-toggle="collapse" data-bind="attr: { 'href': '#collapse-multiplier-' + $index() }">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-grow-1" data-bind="text: GameConstants.camelCaseToString($data[0])"></div>
                                                <knockout data-bind="text: `${App.game.multiplier.getBonus($data[0]).toFixed(2)}x`"></knockout>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                                <tbody data-bind="class: 'collapse', attr: { id: 'collapse-multiplier-' + $index()}">
                                    <!-- ko foreach: $data[1] -->
                                        <tr data-bind="if: $data.bonusFunction() !== 1">
                                            <td data-bind="text: $data.source"></td>
                                            <td data-bind="text: `${$data.bonusFunction().toFixed(2)}x`"></td>
                                        </tr>
                                    <!-- /ko -->
                                    <tr data-bind="if: !$data[1].some(({ bonusFunction }) => bonusFunction() !== 1)">
                                        <td colspan="2">You have no active multipliers of this type</td>
                                    </tr>
                                </tbody>
                            <!-- /ko -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Log Book Modal-->
<div class="modal noselect fade" id="logBookModal" tabindex="-1" role="dialog" aria-labelledby="logBookModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Log Book</h5>
                <button class="btn btn-secondary" type="button" data-toggle="collapse" style="margin-left: 25px;"
                        data-target="#log-book-filter" aria-expanded="false" aria-controls="breeding-filter">
                    Filters
                </button>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-0">
                <div class="tab-content">
                    <ul class="nav nav-tabs nav-fill">
                        <li class="nav-item"><a class="nav-link active" href="#log-book" data-toggle="tab">Logs</a></li>
                        <li class="nav-item"><a class="nav-link" href="#log-book-settings" data-toggle="tab">Logs settings</a></li>
                    </ul>
                    <div id="log-book" class="tab-pane active p-3">
                        <div class="form-row collapse" id="log-book-filter" style="width: 100%" data-bind="foreach: Object.keys(App.game.logbook.filters)">
                            <button class="btn col" data-bind="text: App.translation.get(`type.${$data}`, 'logbook')(), css: { [`btn-outline-${LogBookTypes[$data].display}`]: !App.game.logbook.filters[$data](), [`btn-${LogBookTypes[$data].display}`]: App.game.logbook.filters[$data]() }, click: () => App.game.logbook.filters[$data](!App.game.logbook.filters[$data]())" onclick="this.blur()">filter</button>
                        </div>
                        <br>
                        <table class="table table-striped table-hover table-bordered table-sm m-0">
                            <thead>
                              <tr>
                                <th>Type</th>
                                <th style="width:65%">Message</th>
                                <th>Date</th>
                              </tr>
                            </thead>
                            <tbody data-bind="foreach: App.game.logbook.filteredLogs()">
                              <tr>
                                <td class="tight align-middle" data-bind="text: displayLabel, class: 'table-' + type.display"></td>
                                <td class="text-left" data-bind="text: description">-</td>
                                <td class="text-left"><code data-bind="text: new Date(date).toLocaleString()">-</code></td>
                              </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="log-book-settings" class="tab-pane p-3">
                        <h5><b>Disable or enable types of logs</b></h5>
                        <table class="table table-striped table-hover m-0">
                            <tbody>
                            <!-- ko foreach: Object.keys(LogBookTypes) -->
                                <tr data-bind="template: { name: 'BooleanSettingSliderTemplate', data: Settings.getSetting(`logBook.${$data}`)}"></tr>
                            <!-- /ko -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Settings Modal-->
<div class="modal noselect fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a class="nav-link active" href="#settings-display" data-toggle="tab">Display</a></li>
                    <li class="nav-item"><a class="nav-link" href="#settings-game" data-toggle="tab">Gameplay</a></li>
                    <li class="nav-item"><a class="nav-link" href="#settings-sound" data-toggle="tab">Sound</a></li>
                    <li class="nav-item"><a class="nav-link" href="#settings-notifications" data-toggle="tab">Notifications</a></li>
                    <li class="nav-item"><a class="nav-link" href="#settings-hotkeys" data-toggle="tab">Hotkeys</a></li>
                    <li class="nav-item"><a class="nav-link" href="#settings-other" data-toggle="tab">Other</a></li>
                    <!-- ko if: DiscordRichPresence.clientVersion -->
                        <li class="nav-item"><a class="nav-link" href="#settings-discord" data-toggle="tab">Discord</a></li>
                    <!-- /ko -->
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="settings-display">
                        <table class="table table-striped table-hover m-0">
                            <!-- <thead>
                              <tr>
                                <th>Setting</th>
                                <th>Option</th>
                              </tr>
                            </thead> -->
                            <thead>
                                <tr><th colspan="2">General</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('translation.language')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('gameDisplayStyle')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('theme')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('backgroundImage')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Currency</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('showCurrencyGainedAnimation')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('showCurrencyLostAnimation')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('currencyMainDisplayReduced')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('currencyMainDisplayExtended')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Hatchery</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('breedingDisplay')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('eggAnimation')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('hideHatchery')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Farm</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('showFarmModule')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('farmDisplay')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('farmBoostDisplay')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('berryDexMode')}"></tr>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('sizeUnits')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Underground</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('showUndergroundModule')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('enableUndergroundModuleMineControls')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Other</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="visible: Object.values(App.game.challenges.list).filter(c => c.active()).length > 0, template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('hideChallengeRelatedModules')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('showGymGoAnimation')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('showMuteButton')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Map Colors</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--locked')}"></tr>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--incomplete')}"></tr>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--questAtLocation')}"></tr>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--uncaughtPokemon')}"></tr>
                                <!-- ko if: Settings.getSetting('--uncaughtShadowPokemon').isUnlocked() -->
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--uncaughtShadowPokemon')}"></tr>
                                <!-- /ko -->
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--uncaughtShinyPokemonAndMissingAchievement')}"></tr>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--uncaughtShinyPokemon')}"></tr>
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--missingAchievement')}"></tr>
                                <!-- ko if: Settings.getSetting('--missingResistant').isUnlocked() -->
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--missingResistant')}"></tr>
                                <!-- /ko -->
                                <tr data-bind="template: { name: 'ColorChoiceSettingTemplate', data: Settings.getSetting('--completed')}"></tr>
                                <tr>
                                    <td colspan="2">
                                        <button type="button" class="btn btn-primary" data-bind="click: () => {
                                            Settings.list.filter(s => s.name.startsWith('moduleHeight.')).forEach((setting) => {
                                                const resizeId = setting.name.split('.')[1];
                                                document.querySelector(`[data-resize-id='${resizeId}']`).style.height = `${setting.defaultValue}px`;
                                            })
                                        }">Reset Resizable Modules</button>
                                    </td>
                                </tr>
                            </thead>
                        </table>
                    </div>

                    <div class="tab-pane" id="settings-game">
                        <table class="table table-striped table-hover m-0">
                            <tbody>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('shopButtons')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('resetShopAmountOnPurchase')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('hideQuestsOnFull')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('confirmLeaveDungeon')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('confirmBeformeMulchingAllPlots')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('breedingQueueClearConfirmation')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('confirmChangeHeldItem')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('disableRightClickMenu')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('catchFilters.initialEnabled')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('catchFilters.invertPriorityOrder')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('breedingEfficiencyAllModifiers')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('useWebWorkerForGameTicks')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('disableOfflineProgress')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('disableBlinking')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('autoRestartUndergroundMine')}"></tr>
                                <tr data-bind="with: Settings.getSetting('disableAutoSave')">
                                    <td class="p-2">
                                        <label class="m-0" data-bind="attr: { for: 'checkbox-' + $data.name }, text: `${$data.displayName}:`"></label>
                                    </td>
                                    <td class="p-2">
                                        <input class="clickable" type="checkbox"
                                            data-bind="checked: $data.observableValue(), attr: {name, id: 'checkbox-' + $data.name }"
                                            onchange="(() => {
                                                if (!this.checked) {
                                                    Settings.setSettingByName('disableAutoSave', false);
                                                    return;
                                                }

                                                Notifier.confirm({
                                                    title: 'Disable Auto Save?',
                                                    message: 'Disabling auto save will require you to manually save the game before exiting or any progress will be lost!\r\n\r\nProceed at your own risk.',
                                                    type: NotificationConstants.NotificationOption.danger,
                                                    confirm: 'Yes'
                                                }).then(confirmed => {
                                                    if (confirmed) {
                                                        Settings.setSettingByName('disableAutoSave', true);
                                                    } else {
                                                        this.checked = false;
                                                    }
                                                });
                                            })()"/>
                                    </td>
                                </tr>
                                <tr data-bind="visible: player.highestRegion() > 0, with: Settings.getSetting('breedingQueueSizeSetting')">
                                    <td class="p-2" data-bind="text: `${$data.displayName}:`">setting name</td>
                                    <td class="p-0">
                                        <input type="text" class="form-control"
                                            data-bind="attr: { name: $data.name, id: `setting-${$data.name}` }, value: $data.observableValue, tooltip: {
                                                title: `Restrict your hatchery queue to a specific size or disable entirely. Enter a value between 1 and your current max size (${App.game.breeding.queueSlots()}), zero (0) to disable the queue entirely, or -1 for no limit.`,
                                                trigger: 'hover'
                                            }"
                                            onchange="(() => {
                                                const val = Number.isNaN(parseInt(this.value)) ? -1 : +this.value;
                                                this.value = val < -1 ? -1 : Math.min(val, App.game.breeding.queueSlots());
                                            })(), Settings.setSettingByName(this.name, +this.value)
                                        ">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-pane" id="settings-sound">
                        <div data-bind="template: {name: 'RangeSettingTemplate', data: Settings.getSetting('sound.volume')}"></div>
                        <!-- ko foreach: Object.keys(NotificationConstants.NotificationSound) -->
                        <span class="btn btn-block btn-dark clickable mt-1" data-toggle="collapse" data-bind="text: $data, attr: { href: '#settingsSound' + $data }"></span>
                        <div class="collapse show" data-bind="attr: { id: 'settingsSound' + $data }">
                            <table class="table table-striped table-hover m-0">
                                <tbody>
                                <!-- ko foreach: Object.values(NotificationConstants.NotificationSound[$data]) -->
                                    <tr data-bind="template: { name: 'SoundSettingTemplate', data: { sound, setting: Settings.getSetting(`sound.${$data.name}`) } }"></tr>
                                <!-- /ko -->
                                </tbody>
                            </table>
                        </div>
                        <!-- /ko -->
                    </div>

                    <div class="tab-pane" id="settings-notifications">
                        <!-- ko foreach: Object.keys(NotificationConstants.NotificationSetting) -->
                        <span class="btn btn-block btn-dark clickable mt-1" data-toggle="collapse" data-bind="text: $data, attr: { href: '#settingsNotification' + $data }"></span>
                        <div class="collapse show" data-bind="attr: { id: 'settingsNotification' + $data }">
                            <table class="table table-striped table-hover m-0">
                                <tbody>
                                <!-- ko foreach: Object.values(NotificationConstants.NotificationSetting[$data]) -->
                                    <tr data-bind="template: { name: 'NotificationSettingTemplate', data: $data }"></tr>
                                <!-- /ko -->
                                </tbody>
                            </table>
                        </div>
                        <!-- /ko -->
                    </div>

                    <div class="tab-pane" id="settings-hotkeys">
                        <table class="table table-striped table-hover m-0">
                            <thead>
                                <tr><th colspan="2">Modals</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.farm')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.hatchery')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.underground')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.shop')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.oakItems')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.pokeballSelection')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dailyQuests')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Farm</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.farm.toggleShovel')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.farm.togglePlotSafeLock')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Underground</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.underground.chisel')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.underground.hammer')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.underground.bomb')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.underground.survey')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Oak Items</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.oakItems.toggle', 'settings', { defaultValue: 'Toggle Oak Item'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Each number refers to a specific Oak Item',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>Number Keys</code></kbd>
                                    </td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Poké Ball Selector</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.pokeballSelector.select', 'settings', { defaultValue: 'Select Poké Ball Type'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Each number refers to a specific Poké Ball',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>Number Keys</code></kbd>
                                    </td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Dungeon</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dungeon.up')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dungeon.left')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dungeon.down')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dungeon.right')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.dungeon.interact')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Town</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.town.start')}"></tr>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.town.accessContent', 'settings', { defaultValue: 'Access the towns content'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Can access anything from Gyms to NPCs. Each number is a button.',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>Number Keys</code></kbd>
                                    </td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Shop</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.shop.selectItem', 'settings', { defaultValue: 'Select item'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Each number selects an item in the shop.',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>Number Keys</code></kbd>
                                    </td>
                                </tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.shop.buy')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.shop.max')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.shop.reset')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.shop.increase')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Ship</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.ship.selectRegion', 'settings', { defaultValue: 'Select region'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Each number selects a region.',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>Number Keys</code></kbd>
                                    </td>
                                </tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Safari</th></tr>
                            </thead>
                            <tbody>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.safari.ball')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.safari.bait')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.safari.rock')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.safari.run')}"></tr>
                            </tbody>
                            <thead>
                                <tr><th colspan="2">Other</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="p-2">
                                        <knockout data-bind="text: App.translation.get('hotkey.changeRoutes', 'settings', { defaultValue: 'Change Routes'})"></knockout><span>:</span>
                                    </td>
                                    <td class="p-0" data-bind="tooltip: {
                                        title: 'Change routes based on route order',
                                        trigger: 'hover',
                                    }">
                                        <kbd class="btn-block" style="padding: 10px 0;" ><code>- or +</code></kbd>
                                    </td>
                                </tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.forceSave')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.downloadSave')}"></tr>
                                <tr data-bind="template: { name: 'KeyChoiceSettingTemplate', data: Settings.getSetting('hotkey.mute')}"></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-pane" id="settings-other">
                        <table class="table table-striped table-hover m-0">
                            <tbody>
                                <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('saveReminder')}"></tr>
                                <tr data-bind="template: { name: 'BooleanSettingTemplate', data: Settings.getSetting('disableAutoDownloadBackupSaveOnUpdate')}"></tr>
								<tr data-bind="with : Settings.getSetting('saveFilename')">
									<td class="p-2" data-bind="text : `${$data.displayName}:`">setting name</td>
									<td class="p-0">
										<input type="text" class="form-control"
                                            data-bind="attr : {name : $data.name, id : `setting-${$data.name}`, placeholder : $data.defaultValue}, textInput : $data.observableValue, tooltip : {title: 'Special tags {name}, {version} and {date} are automatically filled', trigger: 'hover'}"
                                            onchange="Settings.setSettingByName('saveFilename', this.value)"/>
									</td>
								</tr>
                            </tbody>
                        </table>
                        <div class="btn-group btn-block">
                            <button type="button" class="btn btn-primary" onclick="Settings.saveDefault();">Save As Default Settings</button>
                            <button type="button" class="btn btn-warning" onclick="Settings.loadDefault();">Load From Default Settings</button>
                            <button type="button" class="btn btn-danger" onclick="Settings.resetDefault();">Reset Default Settings</button>
                        </div>
                    </div>

                    <div class="tab-pane" id="settings-discord">
                        <table class="table table-striped table-hover m-0"><tbody>
                            <tr>
                            <td colspan="2">
                                <span>Enable Discord rich presence</span>
                                <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="clickable" type="checkbox" data-bind="checked: Settings.getSetting('discord-rp.enabled').observableValue()" onchange="Settings.setSettingByName(this.name, this.checked)" name="discord-rp.enabled">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                                </label>
                            </td>
                            </tr>
                            <tr>
                            <td colspan="2">
                                <span>Show current session play time (max 24 hours)</span>
                                <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="clickable" type="checkbox" data-bind="checked: Settings.getSetting('discord-rp.timer').observableValue()" onchange="Settings.setSettingByName(this.name, this.checked)" name="discord-rp.timer">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                                </label>
                            </td>
                            </tr>
                            <tr>
                            <td colspan="2">
                                <span>Reset timer on area change</span>
                                <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="clickable" type="checkbox" data-bind="checked: Settings.getSetting('discord-rp.timer-reset').observableValue()" onchange="Settings.setSettingByName(this.name, this.checked)" name="discord-rp.timer-reset">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                                </label>
                            </td>
                            </tr>
                            <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('discord-rp.large-image')}"></tr>
                            <tr data-bind="template: { name: 'MultipleChoiceSettingTemplate', data: Settings.getSetting('discord-rp.small-image')}"></tr>
                            <tr>
                            <td class="p-2">Line 1 text:</td>
                            <td class="p-0">
                                <input class="form-control" onblur="DiscordRichPresence.focusedElement = this" oninput="Settings.setSettingByName(this.name, this.value)" id="discord-rp.line-1" name="discord-rp.line-1" data-bind="value: Settings.getSetting('discord-rp.line-1').observableValue()" placeholder="Shinies: {caught_shiny}/{caught} {sparkle}">
                            </td>
                            </tr>
                            <tr>
                            <td class="p-2">Line 2 text:</td>
                            <td class="p-0">
                                <input class="form-control" onblur="DiscordRichPresence.focusedElement = this" oninput="Settings.setSettingByName(this.name, this.value)" id="discord-rp.line-2" name="discord-rp.line-2" data-bind="value: Settings.getSetting('discord-rp.line-2').observableValue()" placeholder="Total Attack: {attack}">
                            </td>
                            </tr>
                        </tbody></table>
                        <span>Options:<br/>
                            <code data-bind="foreach: DiscordRichPresence.outputOptions">
                                <a href="#" data-bind="click: () => { if (DiscordRichPresence.focusedElement.name) { Settings.setSettingByName(DiscordRichPresence.focusedElement.name, DiscordRichPresence.focusedElement.value += ` {${$data.key}}`) }}, text: `{${$data.key}}`"></a>
                            </code>
                        </span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script type="text/html" id="MultipleChoiceSettingTemplate">
    <td class="p-2" data-bind="text: `${$data.displayName}:`">setting name</td>
    <td class="p-0">
        <select class="form-control" onchange="Settings.setSettingByName(this.name, this.value)" data-bind="foreach: $data.getValidOptions(), attr: {name}">
            <option data-bind="text: $data.text, value: $data.value, attr:{ selected: $parent.observableValue() == $data.value}"></option>
        </select>
    </td>
</script>

<script type="text/html" id="BooleanSettingTemplate">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: 'checkbox-' + $data.name }, text: `${$data.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-2">
        <input class="clickable" type="checkbox"
            data-bind="checked: $data.observableValue(), attr: {name, id: 'checkbox-' + $data.name }"
            onchange="Settings.setSettingByName(this.name, this.checked)"/>
    </td>
</script>

<script type="text/html" id="BooleanSettingSliderTemplate">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: 'checkbox-' + $data.name }, text: `${$data.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-2">
        <label class="form-check-label toggler-wrapper style-1 m-auto">
            <input class="clickable" type="checkbox"
                data-bind="checked: $data.observableValue(), attr: {name, id: 'checkbox-' + $data.name }"
                onchange="Settings.setSettingByName(this.name, this.checked)"/>
            <div class="toggler-slider">
                <div class="toggler-knob"></div>
            </div>
        </label>
    </td>
</script>

<script type="text/html" id="SoundSettingTemplate">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: 'checkbox-' + $data.setting.name }, text: `${$data.setting.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-1 tight">
        <button class="btn btn-info btn-sm" data-bind="click: () => $data.sound.play()"><i class="play-button"></i></button>
    </td>
    <td class="p-2 tight">
        <label class="form-check-label toggler-wrapper style-1 m-auto">
            <input class="clickable" type="checkbox"
                data-bind="checked: $data.setting.observableValue(), attr: {name: $data.setting.name, id: 'checkbox-' + $data.setting.name }"
                onchange="Settings.setSettingByName(this.name, this.checked)"/>
            <div class="toggler-slider">
                <div class="toggler-knob"></div>
            </div>
        </label>
    </td>
</script>

<script type="text/html" id="NotificationSettingTemplate">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: 'checkbox-game-' + $data.name }, text: `${$data.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-2 tight" data-bind="tooltip: {
        title: 'In game notifications',
        trigger: 'hover',
    }">
        <!-- ko if: $data.inGameNotification != undefined -->
        <label data-bind="attr: { for: 'checkbox-game-' + $data.inGameNotification.name }">🎮</label>
        <input class="clickable" type="checkbox"
            data-bind="checked: $data.inGameNotification.observableValue(), attr: { name: $data.inGameNotification.name, id: 'checkbox-game-' + $data.inGameNotification.name }"
            onchange="Settings.setSettingByName(this.name, this.checked)"/>
        <!-- /ko -->
        <!-- ko if: $data.inGameNotification == undefined -->
        <label>🎮</label>
        <input type="checkbox" checked disabled/>
        <!-- /ko -->
    </td>
    <td class="p-2 tight" data-bind="tooltip: {
        title: 'Desktop notifications, these can be seen even if the game is not in focus',
        trigger: 'hover',
    }">
        <label data-bind="attr: { for: 'checkbox-desktop-' + $data.desktopNotification.name }">🖥️</label>
        <input class="clickable" type="checkbox"
            data-bind="checked: $data.desktopNotification.observableValue(), attr: { name: $data.desktopNotification.name, id: 'checkbox-desktop-' + $data.desktopNotification.name }",
            onchange="Settings.setSettingByName(this.name, this.checked)"/>
    </td>
</script>

<script type="text/html" id="RangeSettingTemplate">
    <label data-bind="text: `${$data.displayName}: ${$data.observableValue()}`, attr: { for: `setting-${$data.name}` }">setting name</label>
    <input type="range" class="custom-range pl-3 pr-3"
            data-bind="attr: { name: $data.name, id: `setting-${$data.name}`, min: $data.minValue, max: $data.maxValue, step: $data.step},
                       value: $data.observableValue"
            oninput="Settings.setSettingByName(this.name, this.value)">
</script>

<script type="text/html" id="ColorChoiceSettingTemplate">
    <td class="p-2" data-bind="text: `${$data.displayName}:`">setting name</td>
    <td class="p-0" data-bind="style: { background: $data.observableValue },
    tooltip: {
        title: 'Set to white for transparent',
        trigger: 'hover',
    }">
        <label style="width:100%; min-height: 36px; padding:0px; margin: 0px;"><input style="opacity: 0;" type="color" data-bind="value: $data.observableValue"/></label>
    </td>
</script>

<script type="text/html" id="KeyChoiceSettingTemplate">
    <td class="p-2">
        <knockout data-bind="text: `${$data.displayName}:`">setting name</knockout>
    </td>
    <td class="p-0" data-bind="tooltip: {
        title: 'Click here to set a new key',
        trigger: 'hover',
    }">

        <kbd contenteditable="true" spellcheck="false"
            class="btn-block"
            style="padding: 10px 0;"
            data-bind="event: {
                keydown: (s, e) => {
                    const key = GameController.convertKey(e.key);
                    switch(key) {
                        case 'Backspace':
                        case 'Escape':
                            s.set('None');
                            break;
                        case 'Shift':
                        case 'Ctrl':
                        case 'Alt':
                        case 'Meta':
                            return;
                        default:
                            s.set(key);
                    }
                    e.currentTarget.blur();
                    e.stopPropagation();
                    return false;
                },
                click: (s, e) => {
                    e.currentTarget.innerHTML = `<code>${s.prefix}</code>...<code>${s.suffix}</code>`;
                },
                blur: (s, e) => {
                    e.currentTarget.innerHTML = `<code>${s.prefix}</code>${s.observableValue()}<code>${s.suffix}</code>`;
                }
            }"><code data-bind="text: $data.prefix"></code><ko data-bind="text: $data.observableValue()"></ko><code data-bind="text: $data.suffix"></code></kbd>
    </td>
</script>


<!-- FAQ Modal -->
<div class="modal fade noselect" id="FAQModal" tabindex="-1" role="dialog" aria-badgeledby="FAQModal">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
     <div class="modal-content">
        <div class="modal-header">
             <h5>Frequently Asked Questions</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">&times;</span>
             </button>
        </div>

        <div class="modal-body text-left px-0">
            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">General</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">Where can I play the latest version?</div>
                <p class="small">
                    <a href="https://www.pokeclicker.com/" target="_blank">https://www.pokeclicker.com/</a><br />
                    or download the offline Windows client:<br />
                    <a href="https://github.com/RedSparr0w/Pokeclicker-desktop/releases/latest" target="_blank">https://github.com/RedSparr0w/Pokeclicker-desktop/releases/latest</a>
                </p>

                <div class="border-bottom border-dark font-weight-bold">Where is the wiki?</div>
                <p class="small">
                    <a href="https://wiki.pokeclicker.com/" target="_blank">https://wiki.pokeclicker.com/</a><br/>
                    The Start Menu also has a button to open the Wiki.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Where can I view more information about my save file?</div>
                <p class="small">
                    <a href="https://companion.pokeclicker.com/" target="_blank">https://companion.pokeclicker.com/</a><br/>
                </p>

                <div class="border-bottom border-dark font-weight-bold">My game isn&#39;t running at full speed when the window isn&#39;t active.</div>
                <p class="small">
                    This is a setting on browsers that slows down inactive windows.<br />
                    You can change the browser flags, but this is <strong>not </strong>recommended.<br />
                    Otherwise you can download the Windows client from here:<br />
                    <a href="https://github.com/RedSparr0w/Pokeclicker-desktop/releases/latest" target="_blank">https://github.com/RedSparr0w/Pokeclicker-desktop/releases/latest</a>
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I get Dungeon Tokens?</div>
                <p class="small">
                    Read the in-game Tutorial.<br />
                    Set the &quot;Caught&quot; selector in the top left to Poké Ball to capture Pokémon you have already caught.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How is damage calculated?</div>
                <p class="small">
                    The damage you do against an enemy Pokémon is the sum of the attack of all Pokémon the player has, after type effectiveness, type weakness, and other multipliers are applied.<br />
                    For players' Pokémon with two types, only the most efficient type is applied<br />
                    For enemy Pokémon with two types, effectiveness and weakness is applied once to each type.<br />
                    For enemy Pokémon with one type, effectiveness and weakness is applied twice to that single type.<br />
                    Other factors that will multiply damage value include flutes, battle items, and weather. Gems can be used to change the effectiveness and weakness multipliers as well.<br />
                    Player can check the attack against a specific Pokémon they are fighting by <strong>hovering over Pokémon attack value</strong>.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Save Data</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">Are there cloud saves or accounts?</div>
                <p class="small">
                    No. Your file is saved in your browser data. We recommend making frequent backups of your save data.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Can I transfer my save file between devices?</div>
                <p class="small">
                    Yes! Download a copy of the save file from <strong>Start Menu &rarr; Save</strong>, transfer it to the other device, and import it from the save selector screen.<br />
                    Note that progress does not automatically carry over between devices.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Will my progress be carried over on release?</div>
                <p class="small">
                    Your save file will likely be compatible with the final release.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Rare/Shiny Pokémon</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">What are the odds of finding a roaming Pokémon?</div>
                <p class="small">
                    The chance to encounter a roaming Pokémon is <code>1/8192</code> for the first route of a region, and increases linearly up to <code>1/4096</code> for the last route of a region.<br />
                    (&quot;first&quot; and &quot;last&quot; here just being the route difficulty/HP, not necessarily the order you reach the route)
                </p>

                <div class="border-bottom border-dark font-weight-bold">What are the odds of finding a shiny Pokémon?</div>
                <p class="small">
                    On a Route: <code>1/8192</code><br/>
                    In a Dungeon: <code>1/4096</code><br/>
                    Using an Evolution Item: <code>1/2048</code><br/>
                    In the Safari Zone: <code>1/1024</code><br/>
                    From a Shop: <code>1/1024</code><br/>
                    From Hatching an Egg: <code>1/1024</code><br/>
                    From a Reward: <code>1/1024</code><br/>
                    From a Battle Frontier Milestone: <code>1/1024</code><br/>
                    Wandering on the Farm: <code>1/1024</code>
                </p>

                <div class="border-bottom border-dark font-weight-bold">Do shiny Pokémon give any bonus to gameplay?</div>
                <p class="small">
                    Yes, they give an extra 100% bonus to Click Attack.
                </p>

                <div class="border-bottom border-dark font-weight-bold">If I breed a shiny Pokémon, will it still stay shiny?</div>
                <p class="small">
                    Yes, once a Pokémon is shiny, it will always remain shiny.
                </p>

                <div class="border-bottom border-dark font-weight-bold">If I evolve a shiny Pokémon, will the evolution be shiny?</div>
                <p class="small">
                    No, you will need to obtain the evolution's shiny via a different method.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Items</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">How do I evolve Pokémon that require an item to evolve?</div>
                <p class="small">
                    You can use evolution items by clicking <strong>Items</strong> in the Start Menu.
                </p>

                <div class="border-bottom border-dark font-weight-bold">What is the small/medium/large restore used for?</div>
                <p class="small">
                    They can be used in the underground to restore energy.
                </p>

                <div class="border-bottom border-dark font-weight-bold">What are Berries used for?</div>
                <p class="small">
                    These items can be used in the <strong>Farm</strong> to grow more berries and earn farm points.<br />
                    They can be exchanged for different items or Pokémon in Berry Master Shops.<br />
                    They have special Auras that can provide Gameplay bonuses.<br />
                    They can attract wild Pokémon to the Farm that can be captured, some of which can only be obtained this way.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How can I get more Berries?</div>
                <p class="small">
                    Some berries can be obtained as Pokémon drops or from dungeon chests, but most are obtained through mutation on the Farm.<br />
                    The Kanto Berry Master in Cerulean City will provide daily hints about how to mutate the various berries.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How many Oak Item slots are available?</div>
                <p class="small">
                    There is a maximum of 3 active slots.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Gameplay</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">How many regions are playable?</div>
                <p class="small">
                    Currently Kanto through <span data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[GameConstants.MAX_AVAILABLE_REGION])">...</span> are able to be played.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I get to the next region?</div>
                <p class="small">
                    You must defeat the league champion of the current region. If you have regional Pokedex challenge active you must obtain all Pokémon available in the current region.<br/>
                    <strong>Note:</strong> Once you go to the next region, you will not be able to go back to previous regions until you reach the dock.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I increase my Click Attack?</div>
                <p class="small">
                    New Pokémon you capture, shinies obtained, Pokémon made resistant to Pokérus, and Purified Pokémon all increase your click attack.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I unlock the Auto Battle option for Gyms?</div>
                <p class="small">
                    You must defeat the Gym Leader manually 10 times.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I make the dungeons smaller?</div>
                <p class="small">
                    Dungeons will become smaller at 10, 100, 1,000, etc. clears to a minimum of 5x5 tiles.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I unlock Flash in dungeons?</div>
                <p class="small">
                    <code>Tier 1:</code> 100 clears</span><br/>
                    <code>Tier 2:</code> 250 clears</span><br/>
                    <code>Tier 3:</code> 400 clears
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I unlock Dungeon Guides (BETA) for dungeons?</div>
                <p class="small">
                    You need to have cleared the dungeon at least 10 times in order to make use of Dungeon Guides.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do the floors in dungeons work?</div>
                <p class="small">
                    Dungeons can't get bigger than 10x10, instead they get a second floor of at least 5x5. The boss tile is always in the second floor, the first floor has a stairs tile instead. When you reach the second floor, time stops and you get 10 extra seconds.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Can I progress towards more than 1 quest at a time?</div>
                <p class="small">
                    Yes, you can unlock up to 4 quest slots.<br/>
                    <code>Quest Level 5:</code> 2 slots<br/>
                    <code>Quest Level 10:</code> 3 slots<br/>
                    <code>Quest Level 15:</code> 4 slots
                </p>

                <div class="border-bottom border-dark font-weight-bold">Where do I find..</div>
                <p class="small">
                    <code>Underground:</code> Route 14<br />
                    <code>Daycare:</code> Route 5, or click <strong>List</strong> on the hatchery<br />
                    <code>Farm:</code> Route 11
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I unlock the..</div>
                <p class="small">
                    <code>Underground:</code> Buy the <strong>Explorer Kit</strong> from <strong>Cinnabar Island</strong>.<br/>
                    <code>Daycare:</code> Will be unlocked after reaching <strong>Route 3</strong>.<br/>
                    <code>Farm:</code> Will be unlocked after reaching <strong>route 11</strong> and obtaining <strong>Berries</strong>
                </p>

                <div class="border-bottom border-dark font-weight-bold">Why should I be breeding Pokémon?</div>
                <p class="small">
                    Some Pokémon can only be obtained by breeding.<br/>
                    When a Pokémon is hatched, its attack will increase by 25% of the base amount.<br/>
                    Breeding has higher odds of obtaining a shiny Pokémon <code>(1/1024)</code>.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I obtain certain Pokémon?</div>
                <p class="small">
                    Check that you have completed every <strong>route</strong>.<br/>
                    Check that each <strong>dungeon</strong> has been completed.<br/>
                    Some Pokémon only come from <strong>Eggs</strong>.<br/>
                    Some can only be obtained by using an <strong>Evolution Item</strong>.<br/>
                    Some can only be found in the <strong>Safari Zone</strong>.<br/>
                    <strong>Fossil Pokémon</strong> can only be obtained with the correlating <strong>Fossil</strong> from the <strong>Underground</strong>.<br/>
                    Some can only be purchased from a <strong>Shop</strong>.<br/>
                    <strong>(Roamers)</strong> Some legendaries will <strong>randomly</strong> appear on <strong>routes</strong>.<br/>
                    <strong>(Babies)</strong> Breed their evolution.<br/>
                    Some can only evolve at certain <strong>times of the day</strong>.<br/>
                    Some can only evolve in specific <strong>locations</strong>.<br/>
                    Some can only appear/evolve in specific <strong>weather</strong>.
                </p>

                <div class="border-bottom border-dark font-weight-bold">What is the schedule of the day cycle?</div>
                <table class="table table-bordered table-sm">
                    <thead>
                        <tr>
                            <th class="text-center">Time of Day</th>
                            <th class="text-center">Icon</th>
                            <th class="text-center">Start</th>
                            <th class="text-center">End</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: Object.values(GameConstants.DayCycleStartHours)">
                        <tr>
                            <td class="text-center align-middle" data-bind='text: DayCycle.dayCycleMoments[$index()].description'></td>
                            <td class="text-center align-middle">
                                <img src="" data-bind="attr: {
                                    src: `assets/images/dayCycle/${DayCycle.dayCycleMoments[$index()].description}.png`,
                                    style: `background: ${DayCycle.dayCycleMoments[$index()].color}; width: 30px;`,
                                }"/>
                            </td>
                            <td class="text-center align-middle" data-bind='text: GameHelper.twoDigitNumber($data) + `:00`'></td>
                            <td class="text-center align-middle" data-bind='text: (GameHelper.twoDigitNumber(GameConstants.DayCycleStartHours[$index() + 1] || GameConstants.DayCycleStartHours[0])) + `:00`'></td>
                        </tr>
                    </tbody>
                </table>

                <div class="border-bottom border-dark font-weight-bold">What are the EV damage multipliers?</div>
                <table class="table table-bordered table-sm">
                    <tr>
                        <td class="text-center"><strong>EVs</strong></td>
                        <td class="text-center"><strong>Damage Multiplier</strong></td>
                    </tr>
                    <tr>
                        <td class="text-center">50 EVs</td>
                        <td class="text-center">1.5x Damage</td>
                    </tr>
                    <tr>
                        <td class="text-center">802 EVs</td>
                        <td class="text-center">2x Damage</td>
                    </tr>
                    <tr>
                        <td class="text-center">40,121 EVs</td>
                        <td class="text-center">3x Damage</td>
                    </tr>
                    <tr>
                        <td class="text-center">643,300 EVs</td>
                        <td class="text-center">4x Damage</td>
                    </tr>
                    <tr>
                        <td class="text-center">5,540,000 EVs</td>
                        <td class="text-center">5x Damage</td>
                    </tr>
                    <tr>
                        <td class="text-center" colspan="2">..and so on</td>
                    </tr>
                </table>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Pokérus and EVs</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">What is Pokérus, and what are EVs?</div>
                <p class="small">
                    Pokérus is a beneficial virus your Pokémon can catch. EVs, also called Effort Values, increase the attack of your Pokémon.
                </p>

                <div class="border-bottom border-dark font-weight-bold">When do I unlock EVs?</div>
                <p class="small">
                    EVs are unlocked after defeating the Distortion World dungeon in Sinnoh.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I spread Pokérus?</div>
                <p class="small">
                    Pokérus is spread by Pokémon that are infected, to other Pokémon in the hatchery (not in the queue) that share a type with the infected Pokémon. Neither Pokémon can be ready to hatch, nor can a Hatchery Helper be used on either Pokémon.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How do I gain EVs?</div>
                <p class="small">
                    EVs can be gained in a variety of ways, but are primarily gained by capturing (not breeding) Pokémon.<br />
                    You can use the Contagious Poké Ball selector (unlocked after getting Pokérus) to focus catching Pokémon with less than 50 EVs. Note that setting this selector to "Do not catch" will prevent you from catching any Contagious Pokémon, even if your Caught selector has a Poké Ball set.<br /><br />
                    Base Yield: <code>0.1EV</code><br/>
                    Base Wanderer Yield: <code>0.2EV</code><br/>
                    Wanderer Yield: <code>1EV</code><br/>
                    Evolution Item / Shopmon / Safari Yield: <code>1EV</code><br/>
                    Shadow Modifier: <code>2×</code><br/>
                    Shiny Modifier: <code>5×</code><br/>
                    Dungeon Modifier: <code>3×</code><br/>
                    Dungeon Mimic / Dungeon Boss Modifier: <code>10×</code><br/>
                    Roamer Modifier: <code>50×</code><br/>
                    Repeat Ball Modifier: <code>5×</code><br/>
                    Macho Brace Modifier: <code>1.5×</code><br/>
                    Power Bracer Modifier: <code>2×</code><br/>
                    Rowap Aura Modifier: <code>Multiplier</code> based off Farm Setup<br/>
                    Blue Flute Modifier: <code>%</code> based off Achievement Bonus
                </p>

                <div class="border-bottom border-dark font-weight-bold">What is the EV Attack Bonus?</div>
                <p class="small">
                    The EV damage multiplier is multiplicative, and scales linearly until 1.5x (50 EVs). The bonus thereafter has diminishing returns relative to the number of EVs gained, but has no limit.
                </p>

                <div class="border-bottom border-dark font-weight-bold">What do the Pokérus status filters mean?</div>
                <p class="small">
                    <code>None</code>: Pokémon that have not been infected with Pokérus.<br/>
                    <img src='assets/images/breeding/pokerus/Infected.png'/> <code>Infected</code>: Pokémon has Pokérus, but cannot spread Pokérus or gain EVs until hatching.<br/>
                    <img src='assets/images/breeding/pokerus/Contagious.png'/> <code>Contagious</code>: Pokémon with less than 50 EVs.<br/>
                    <img src='assets/images/breeding/pokerus/Resistant.png'/> <code>Resistant</code>: Pokémon with 50 or more EVs. These Pokémon will still be able to spread Pokérus.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Challenge Modes</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">What are challenge modes?</div>
                <p class="small">
                    They are options you can select <strong>when starting a new save</strong> to make the game harder or more complex by modifying mechanics.<br/>
                    <strong>Note:</strong> You can deactivate the challenges at any point, but they cannot be activated later.
                </p>

                <div class="border-bottom border-dark font-weight-bold">What do I get for activating challenge modes?</div>
                <p class="small">
                    You don't get anything special for having challenges active, but each challenge will give you a ribbon on your trainer profile.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Regional Attack Debuff</div>
                <p class="small">
                    Lowers the attack of Pokémon that aren't native to the current region.<br/>
                    The strength of the debuff is based on your highest region, not the region you are battling in.<br/>
                    Pokémon retain 20% of their attack in Johto and this value raises by 10% each region.<br />
                    <strong>Note:</strong> This challenge is activated by default.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Require Complete Pokédex</div>
                <p class="small">
                    Requires a complete regional Pokédex before moving on to the next region.<br/>
                    You only need <strong>one of each Pokémon</strong> to be able to move to the next region. Any form of the Pokémon is valid even if it isn't the base form.<br/>
                    <strong>Note:</strong> This challenge is activated by default.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Click Attack</div>
                <p class="small">
                    Disables the ability to use click attacks.<br/>
                    You still can click in the very first battle of the game.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Battle Items</div>
                <p class="small">
                    Disables the usage of X Attack, X Click, Lucky Egg, Token Collector, Dowsing Machine, and Lucky Incense.<br/>
                    You can still buy or find these items even if you can't use them.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Master Balls</div>
                <p class="small">
                    Disables the usage of Master Balls.<br/>
                    You still can buy them, so you can complete the related achievements.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Oak Items</div>
                <p class="small">
                    Disables the usage of all Oak items.<br/>
                    The achievements related to leveling up these items will disappear, and the percentages will be distributed among the other general achievements.<br/>
                    In order to get the berries that mutate while using some Oak Items you can buy them in Johto berry master once you have unlocked the berry that evolves to them.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Gem Upgrades</div>
                <p class="small">
                    Disables the usage of Gems to increase damage multipliers.<br/>
                    You can still get gems and use them to buy items such as flutes or Pokémon.
                </p>

                <div class="border-bottom border-dark font-weight-bold">No Vitamins</div>
                <p class="small">
                    Disables the usage of vitamins.<br/>
                    You can still buy and find them, so the related achievements can still be completed. After getting them you can get a money refund by inputting the code: "REFUND-VITAMINS" (one use only).
                </p>

                <div class="border-bottom border-dark font-weight-bold">Slow EVs</div>
                <p class="small">
                    Gain EVs 10x times slower.<br/>
                    If the challenge is deactivated, the EVs will get multiplied back.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Real Evolution</div>
                <p class="small">
                    Your Pokémon go away when they evolve.<br/>
                    When your Pokémon evolve their stats are carried over to the evolution. This includes times hatched, EVs, and shiny status.<br/>
                    If the base Pokémon had a Held Item, it will be carried over to the evolution unless the item is incompatible. For example, Light Ball won't be transferred to a Raichu but a Magnet will.<br/>
                    Baby Pokémon aren't considered evolutions but gifts.
                </p>
            </div>

            <div class="bg-primary rounded-0 px-3 py-2 mb-2">
                <h5 class="m-0 text-light font-weight-bold">Development</h5>
            </div>
            <div class="px-3">
                <div class="border-bottom border-dark font-weight-bold">When will the development version be fully released?</div>
                <p class="small">
                    There are currently no plans for a &quot;final release&quot;.<br/>
                    Maybe once all the regions are added that will be version <code>1.0.0</code>.
                </p>

                <div class="border-bottom border-dark font-weight-bold">When will more regions be added?</div>
                <p class="small">
                    This is a current priority, but there are no set timelines; it will be ready when it is ready.
                </p>

                <div class="border-bottom border-dark font-weight-bold">Who are the awesome people developing this game?</div>
                <p class="small">
                    The original game was developed by @IshaD#1866, who has since decided to stop work on this project.<br/>
                    Since then, lots of people have helped by contributing code via GitHub.
                </p>

                <div class="border-bottom border-dark font-weight-bold">How can I help with development?</div>
                <p class="small">
                    The GitHub repo is located here:<br/>
                    <a href="https://github.com/pokeclicker/pokeclicker" target="_blank">https://github.com/pokeclicker/pokeclicker</a><br/>
                    Any new issues, suggestions or code contributions are always welcomed.<br/>
                    You may even earn the @Poké Crew, @Code Contributor or @Developer roles in Discord.
                </p>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
     </div>
  </div>
</div>


<!-- Changelog Modal -->
<div class="modal fade noselect" id="changelogModal" tabindex="-1" role="dialog" aria-badgeledby="changelogModal">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Changelog</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <table class="table table-striped table-hover table-bordered table-sm m-0">
          <thead>
            <tr>
              <th>Type</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody data-bind="foreach: ChangelogItems">
            <tr data-bind="css: { 'table-dark': type.label == 'UPDATE' }">
              <td class="tight" data-bind="text: type.label, class: 'table-' + type.display"></td>
              <!-- ko if: type.label == 'UPDATE' -->
                <td class="text-left" >
                  <span data-bind="html: description"></span>
                  <a target="_BLANK" class="float-right" data-bind="attr: { href: `https://github.com/pokeclicker/pokeclicker/releases/tag/${$data.version}` }">View full changelog notes</a>
                </td>
              <!-- /ko -->
              <!-- ko ifnot: type.label == 'UPDATE' -->
                <td class="text-left" data-bind="html: description"></td>
              <!-- /ko -->
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- Credits Modal -->
<div class="modal noselect fade" id="creditsModal" tabindex="-1" role="dialog" aria-labelledby="creditsModal">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Credits</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                    <thead>
                      <tr>
                        <th colspan="2">Credited individual</th>
                        <th>Contributed sprites</th>
                      </tr>
                    </thead>
                    <tbody data-bind="foreach: SpriteCredits">
                      <tr>
                        <td class="text-center tight p-0">
                          <img src="" height="28px" data-bind="attr: { src: image }" onerror="this.src='assets/images/profile/trainer-0.png';"/>
                        </td>
                        <td class="text-left">
                          <a href="#" data-bind="text: name, attr: { href: link ? link : '#' }" target="_blank">-</span>
                        </td>
                        <td class="text-left tight text-muted" data-bind="foreach: resources"><span data-bind="text: $data">-</span><br/></td>
                      </tr>
                    </tbody>
                </table>
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                    <thead>
                      <tr>
                        <th colspan="2">Credited individual</th>
                        <th>Code Contributions</th>
                      </tr>
                    </thead>
                    <tbody data-bind="foreach: CodeCredits">
                      <tr>
                        <td class="text-center tight p-0">
                          <img src="" height="28px" data-bind="attr: { src: image }" onerror="this.src='assets/images/profile/trainer-0.png';"/>
                        </td>
                        <td class="text-left">
                          <a href="#" data-bind="text: name, attr: { href: link ? link : '#' }" target="_blank">-</span>
                        </td>
                        <td class="text-left tight text-muted" data-bind="foreach: resources"><span data-bind="text: $data.toLocaleString('en-US')">-</span><br/></td>
                      </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- External Links Modal -->
<div class="modal fade noselect" id="externalLinksModal" tabindex="-1" role="dialog" aria-bageledby="externalLinksModal">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>External Links</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body text-left">
                <p><h5 class="text-primary"><strong>Discord:</strong></h5></p>
                <span class="text-muted">Join the Discord server to join the conversation: <a href="https://discord.gg/a6DFe4p" target="_blank">https://discord.gg/a6DFe4p</a></span>

                <p><h5 class="text-primary"><strong>Github:</strong></h5></p>
                <span class="text-muted">Help make Pokeclicker even better! Contribute to the project by sharing your ideas on our Github: <a href="https://github.com/pokeclicker/pokeclicker" target="_blank">https://github.com/pokeclicker/pokeclicker</a></span>

                <p><h5 class="text-primary"><strong>Subreddit:</strong></h5></p>
                <span class="text-muted">Check out some of the trending posts from the PokéClicker community: <a href="https://pokeclicker.reddit.com" target="_blank">https://pokeclicker.reddit.com</a></span>

                <p><h5 class="text-primary"><strong>Wiki:</strong></h5></p>
                <span class="text-muted">Check out the community wiki to learn more information about PokéClicker: <a href="https://wiki.pokeclicker.com/" target="_blank">https://wiki.pokeclicker.com/</a></span>

                <p><h5 class="text-primary"><strong>Companion Tool:</strong></h5></p>
                <span class="text-muted">Check out the Companion Tool for more information about your save file: <a href="https://companion.pokeclicker.com/" target="_blank">https://companion.pokeclicker.com/</a></span>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Events Modal -->
<div class="modal fade noselect" id="eventsModal" tabindex="-1" role="dialog" aria-badgeledby="eventsModal">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
       <div class="modal-content">
           <div class="modal-header">
               <h5>Events</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true">&times;</span>
               </button>
           </div>

           <div class="modal-body p-0">
               <table class="table table-striped table-hover table-bordered table-sm m-0">
                   <thead>
                     <tr>
                       <th>Event</th>
                       <th>Description</th>
                       <th>Start Time</th>
                       <th>End Time</th>
                       <!-- ko if: App.game.keyItems.hasKeyItem(KeyItemType.Event_calendar) -->
                       <th>Activate</th>
                       <!-- /ko -->
                     </tr>
                   </thead>
                   <tbody data-bind="foreach: Object.values(App.game.specialEvents.events).sort((a, b) => a.startTime - b.startTime)">
                     <tr>
                        <td data-bind="text: title"></td>
                        <td class="text-left" data-bind="html: description"></td>
                        <!-- ko ifnot: isActive()-->
                        <td class="text-left"><code data-bind="text: startTime.toLocaleString()">-</code></td>
                        <td class="text-left"><code data-bind="text: endTime.toLocaleString()">-</code></td>
                        <!-- /ko -->
                        <!-- ko if: isActive()-->
                        <td class="text-left" colspan="2">Time left: <code data-bind="text: timeLeft()">-</code></td>
                        <!-- /ko -->
                        <!-- ko if: App.game.keyItems.hasKeyItem(KeyItemType.Event_calendar) && !hideFromEventCalendar -->
                        <td><button class="btn btn-primary" data-bind="enable: !isActive(), click: eventCalendarActivate">Activate</button></td>
                        <!-- /ko -->
                     </tr>
                   </tbody>
               </table>
           </div>

           <div class="modal-footer">
               <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
           </div>
       </div>
    </div>
</div>


<!-- Start Sequence Modal-->
<div class="modal" id="startSequenceModal" tabindex="-1" role="dialog"
aria-labelledby="startSequenceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div style="width: 100%;">
                    <img src="assets/images/npcs/Professor Oak.png">
                    <h5 class="modal-title" id="startSequenceModalLabel">Professor Oak</h5>
                </div>
            </div>
            <div class="modal-body">
                <p>
                Hello, there! Welcome to the world of Pokémon!<br/>
                My name is Oak. People affectionately refer to me as the Pokémon Professor.<br/>
                This world is inhabited by creatures called Pokémon!<br/>
                For some people, Pokémon are pets. Other use them for battling.<br/>
                As for myself… I study Pokémon as a profession.<br/>
                However, your very own Pokémon legend is about to unfold!<br/>
                A world of dreams and adventures with Pokémon awaits! Let's go!
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning mr-auto" href="#challengeModeModal" data-toggle="modal">Challenge Modes</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Next</button>
            </div>
        </div>
    </div>
</div>


<!-- Pick Starter Tutorial Modal-->
<div class="modal" id="pickStarterTutorialModal" tabindex="-1" role="dialog"
aria-labelledby="pickStarterTutorialModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="assets/images/npcs/Professor Oak.png">
               <h5 class="modal-title" id="pickStarterTutorialModalLabel">Professor Oak</h5>
           </div>
       </div>
       <div class="modal-body">
           <p id="pickStarterTutorialModalText">Oh No! We got ambushed by these Pokémon!<br>
               I can only hold off two! Pick the one you want to fight!</p>
           <div class="row justify-content-center">
               <div class="col-lg-8">
                   <div id="starterSelection" class="row">
                       <div class="col">
                           <input class="image-starter" type="image"
                                  src="assets/images/pokemon/1.png"
                                  onclick="StartSequenceRunner.pickStarter(GameConstants.Starter.Grass);">
                       </div>
                       <div class="col">
                           <input class="image-starter" type="image"
                                  src="assets/images/pokemon/4.png"
                                  onclick="StartSequenceRunner.pickStarter(GameConstants.Starter.Fire);">
                       </div>
                       <div class="col">
                           <input class="image-starter" type="image"
                                  src="assets/images/pokemon/7.png"
                                  onclick="StartSequenceRunner.pickStarter(GameConstants.Starter.Water);">
                       </div>
                   </div>
               </div>
           </div>
           <p>You can click on it to inflict damage</p>
       </div>
   </div>
</div>
</div>


<!-- Pick Starter Modal-->
<div class="modal" id="pickStarterModal" tabindex="-1" role="dialog"
aria-labelledby="pickStarterModalLabel" aria-hidden="true"
data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="assets/images/npcs/Professor Oak.png">
               <h5 class="modal-title" id="pickStarterModalLabel">Professor Oak</h5>
           </div>
       </div>
       <div class="modal-body">
           <p>Pick a starter for your next region</p>
           <div class="row justify-content-center">
               <div class="col-lg-8">
                   <div id="starterSelection" class="row" data-bind="foreach: GameConstants.RegionalStarters[player.region]">
                       <div class="col">
                           <input class="image-starter" type="image"
                                  data-bind="
                                    attr: { src: 'assets/images/pokemon/' + $data + '.png' },
                                    click: () => { player.pickStarter($index()); $('#pickStarterModal').modal('hide'); }
                                    ">
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </div>
</div>
</div>


<!-- Starter Caught Modal-->
<div class="modal" id="starterCaughtModal" tabindex="-1" role="dialog"
aria-labelledby="starterCaughtModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="assets/images/npcs/Professor Oak.png">
               <h5 class="modal-title" id="starterCaughtModalLabel">Professor Oak</h5>
           </div>
       </div>
       <div class="modal-body">
           <p>
               Hm! Excellent! You have caught your first Pokémon!<br>
               This is where your journey begins. <br>
               You can progress to the next route after you have defeated 10 Pokémon.<br>
               To help you on your journey, I will give you these <b>Key Items</b>!<br>
               You can view all your <b>Key Items</b> in the start menu.<br>
           </p>
           <div class="row justify-content-center">
               <div class="col-sm-3">
                   <img
                           title="A television set that is tuned to a program with useful tips for novice TRAINERS."
                           class="key-item"
                           src="assets/images/keyitems/Teachy_tv.png"/>
                   <br>
                   <p>Teachy TV</p>
               </div>
               <div class="col-sm-3">
                   <img
                           title="A case for holding Pokédollars."
                           class="key-item"
                           src="assets/images/keyitems/Coin_case.png"/>
                   <br>
                   <p>Coin Case</p>
               </div>
               <div class="col-sm-3">
                   <img
                           title="A small bag that can hold many different types of Poké Balls."
                           class="key-item"
                           src="assets/images/keyitems/Pokeball_bag.png"/>
                   <br>
                   <p>Poké Ball Bag</p>
               </div>

           </div>

       </div>
       <div class="modal-footer">
           <button type="button" class="btn btn-primary" data-dismiss="modal">Next</button>
       </div>
   </div>
</div>
</div>


<!-- Hall of Fame Modal -->
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="hallOfFameModal" tabindex="-1" role="dialog"
aria-labelledby="hallOfFameModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <div style="width: 100%;">
               <img src="assets/images/npcs/Professor Oak.png">
               <h5 class="modal-title" id="hallOfFameModalLabel">Professor Oak</h5>
           </div>
       </div>
       <div class="modal-body">
           <p>
                <p data-bind="visible: player.region == GameConstants.Region.kanto">
                    So, you won! Congratulations!<br/>
                    You are the new Pokémon League champion!<br/>
                    You have grown up so much since you first left with <span data-bind="text: PokemonHelper.getPokemonById(GameConstants.RegionalStarters[GameConstants.Region.kanto][player.regionStarters[GameConstants.Region.kanto]()]).name">starter</span>!<br/>
                    <br/>
                    There are many more regions to explore!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.johto">
                    I heard from Professor Elm that you had just conquered the Johto Pokémon League! Congratulations!<br/>
                    You are the new Johto League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.hoenn">
                    Professor Birch told me that you just beat the Hoenn Pokémon League! Congratulations!<br/>
                    You are the new Hoenn League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.sinnoh">
                    I heard from Professor Rowan that you had just conquered the Sinnoh Pokémon League! Congratulations!<br/>
                    You are the new Sinnoh League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.unova">
                    Professor Juniper told me that you also beat the Unova Pokémon League! Congratulations!<br/>
                    You are the new Unova League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.kalos">
                    Professor Sycamore just told me. You are unstoppable! Congratulations!<br/>
                    You are the new Kalos League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.alola">
                    Professor Kukui told me that you just beat the Alola Pokémon League! Congratulations!<br/>
                    You are the new Alola League champion!
                </p>
                <p data-bind="visible: player.region == GameConstants.Region.galar">
                    Professor Magnolia told me that you just beat the Galar Pokémon League! Congratulations!<br/>
                    You are the new Galar League champion!
                </p>

                <p data-bind="visible: App.game.challenges.list.requireCompletePokedex.active()">
                    In order to move on you will need to capture all available Pokémon from the current region!
                </p>
           </p>
       </div>
       <div class="modal-footer">
           <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
       </div>
   </div>
</div>
</div>


<!-- Log Book Modal-->
<div class="modal noselect fade" id="nextRegionModal" tabindex="-1" role="dialog" aria-labelledby="nextRegionModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
           <div class="modal-header">
               <h5 class="modal-title" data-bind="text: `Travel to ${GameConstants.camelCaseToString(GameConstants.Region[player.highestRegion() + 1])}`">Travel to next region</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true">&times;</span>
               </button>
           </div>
           <div class="modal-body">
               <p>
                   <!-- ko if: App.game.challenges.list.requireCompletePokedex.active() -->
                   <strong>Congratulations on completing the <span data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[player.highestRegion()])"></span> Pokédex!</strong><br/>
                   <!-- /ko -->
                   You can now travel on to <span data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[player.highestRegion() + 1])"></span>!<br/>
                   <br/>
                   <strong>There are a few things you should know before you depart:</strong><br/>
                   You will gain <strong data-bind="text: App.game.breeding.queueSlotsGainedFromRegion(player.highestRegion())"></strong> queue slots in the Hatchery.<br/><br/>
                   <!-- ko if: App.game.challenges.list.regionalAttackDebuff.active() -->
                   When Pokémon are in a Region they're not native to, they will only retain <strong data-bind="text: App.game.party.getRegionAttackMultiplier(player.highestRegion() + 1).toLocaleString('en-US',{style: 'percent'})"></strong> of their total attack.<br/><br/>
                   <!-- /ko -->
                   <!-- ko if: player.highestRegion() - 2 >= GameConstants.Region.kanto -->
                   Dungeons in the <strong data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[player.highestRegion() - 2])"></strong> Region will be significantly less likely to drop Epic, Legendary, and Mythic loot.<br/><br/>
                   <!-- /ko -->
                   You will also have to progress to the Dock in <span data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[player.highestRegion() + 1])"></span> before you are able to travel between regions again.
               </p>
               <button class="btn btn-success btn-block" onclick="MapHelper.travelToNextRegion()" data-dismiss="modal">Let's Go!</button>
           </div>
       </div>
    </div>
</div>


<!-- Gems Modal -->
<div class="modal fade noselect" id="gemModal" tabindex="-1" role="dialog" aria-badgeledby="gemModal">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
       <div class="modal-content">
            <div class="modal-header">
                <h5 class="mb-0">Gems</h5>

                <!-- ko if: App.game.challenges.list.disableGems.active() -->
                <h5 class="mb-0 px-2 rounded bg-danger">
                    Gem Bonuses are disabled.
                </h5>
                <!-- /ko -->
            </div>

            <div class="modal-body">
                <p>
                    Use gems to upgrade the type effectiveness of your Pokémon.
                    When you defeat a Pokémon, you get gems based on its type.
                    Each upgrade increases your effectiveness by <knockout data-bind="text: GameConstants.GEM_UPGRADE_STEP.toLocaleString('en-US', { style: 'percent', signDisplay: 'exceptZero' })"></knockout>.
                </p>

                <h4>Select a Gem</h4>

                <!-- ko let: { gemIndex: ko.observable(-1) } -->
                <div class="container my-3">
                    <div class="row">
                        <!-- ko foreach: Array(Gems.nTypes) -->
                        <div class="col-6 col-lg-3 p-0 card clickable" data-bind="
                            click: () => { gemIndex($index()); }
                        ">
                            <div class="card-body bg-secondary rounded p-1" data-bind="tooltip: {
                                title: App.game.gems.gemWallet[$index()]().toLocaleString('en-US'),
                                trigger: 'hover',
                                placement: 'bottom'
                            },
                            css: { 'bg-info': gemIndex() === $index() }">
                                <div class="d-flex align-items-center">
                                    <img width="32px" data-bind='attr: { src: Gems.image($index()) }'/>
                                    <div class="flex-grow-1 text-left" data-bind="text: PokemonType[$index()]"></div>
                                    <knockout data-bind="text: App.game.gems.gemWallet[$index()]() > 1e6 ? GameHelper.formatAmount(App.game.gems.gemWallet[$index()]()) : App.game.gems.gemWallet[$index()]().toLocaleString('en-US')"></knockout>
                                </div>

                                <div class="d-flex" style="gap: 0.25rem">
                                    <!-- ko foreach: Array(Gems.nEffects) -->
                                    <div class="flex-grow-1" style="height: 2px;" data-bind="
                                        class: App.game.gems.isValidUpgrade($parentContext.$index(), $index()) ? (App.game.gems.hasMaxUpgrade($parentContext.$index(), $index()) ? 'bg-success' : 'bg-warning') : 'bg-success',
                                        style: { opacity: App.game.gems.isValidUpgrade($parentContext.$index(), $index()) ? 1 : 0.25 }
                                    "></div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>

                <!-- ko if: gemIndex() >= 0 -->
                <div class="card my-3">
                    <div class="card-header p-1">
                        <div class="d-flex align-items-center">
                            <img width="32px" height="32px" data-bind='attr: { src: Gems.image(gemIndex()) }'/>
                            <div class="flex-grow-1 text-center">
                                <div class="badge text-light px-1" style="line-height: normal; text-shadow: 0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black;" data-bind="style: { 'background-color': GameConstants.TypeColor[gemIndex()] }">
                                  <strong data-bind="text: PokemonType[gemIndex()]"></strong>
                                </div>
                                <div data-bind="text: App.game.gems.gemWallet[gemIndex()]()?.toLocaleString('en-US')"></div>
                            </div>
                            <img width="32px" height="32px" data-bind='attr: { src: Gems.image(gemIndex()) }'/>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="card-deck">
                            <!-- ko foreach: Array(Gems.nEffects) -->
                                <div class="card" data-bind="style: { opacity: App.game.gems.isValidUpgrade(gemIndex(), $index()) ? 1 : 0.25 }">
                                    <div class="card-header" data-bind="text: GameConstants.camelCaseToString(GameConstants.TypeEffectiveness[$index()])"></div>

                                    <div class="card-body p-2">
                                        <!-- ko if: App.game.gems.isValidUpgrade(gemIndex(), $index()) -->
                                        <div class="font-weight-bold" data-bind="text: (GameConstants.TypeEffectivenessValue[GameConstants.TypeEffectiveness[$index()]]
                                            + (App.game.gems.getGemUpgrade(gemIndex(), $index()) * GameConstants.GEM_UPGRADE_STEP)).toLocaleString('en-US', { style: 'percent' })"></div>

                                        <div class="text-center m-0 p-1 small">Versus</div>

                                        <div>
                                            <!-- ko foreach: TypeHelper.typeMatrix[gemIndex()].map((value, index) => value === TypeHelper.typeToValue($index()) ? index : -1).filter(value => value >= 0) -->
                                            <span class="badge text-light text-uppercase px-1" style="line-height: normal; text-shadow: 0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black;" data-bind="style: { 'background-color': GameConstants.TypeColor[$data] }">
                                              <small><strong data-bind="text: PokemonType[$data]"></strong></small>
                                            </span>
                                            <!-- /ko -->
                                        </div>
                                        <!-- /ko -->

                                        <!-- ko ifnot: App.game.gems.isValidUpgrade(gemIndex(), $index()) -->
                                        <div>N / A</div>
                                        <!-- /ko -->
                                    </div>

                                    <!-- ko if: App.game.gems.isValidUpgrade(gemIndex(), $index()) -->
                                    <div class="p-0">
                                        <div class="d-flex" style="gap: 1px">
                                            <!-- ko foreach: [...Array(10).keys()] -->
                                            <div class="flex-grow-1" style="height: 5px" data-bind="style: { 'background-color': GameConstants.TypeColor[gemIndex()], filter: `brightness(${App.game.gems.getGemUpgrade(gemIndex(), $parentContext.$index()) > $index() ? 1 : 0.5})` }"></div>
                                            <!-- /ko -->
                                        </div>
                                    </div>
                                    <!-- /ko -->

                                    <!-- ko ifnot: App.game.challenges.list.disableGems.active() -->
                                    <div class="card-footer p-0">
                                        <!-- ko if: App.game.gems.isValidUpgrade(gemIndex(), $index()) -->
                                            <!-- ko if: App.game.gems.hasMaxUpgrade(gemIndex(), $index()) -->
                                            <div class="btn btn-block no-click">MAXED</div>
                                            <!-- /ko -->

                                            <!-- ko ifnot: App.game.gems.hasMaxUpgrade(gemIndex(), $index()) -->
                                            <button class="btn btn-block btn-primary" data-bind="
                                                enable: App.game.gems.canBuyGemUpgrade(gemIndex(), $index()),
                                                click: () => { App.game.gems.buyGemUpgrade(gemIndex(), $index()); }">
                                                Buy (<knockout data-bind="text: App.game.gems.getGemUpgradeCost(gemIndex(), $index()).toLocaleString('en-US')"></knockout><img width="18px" height="18px" data-bind='attr: { src: Gems.image(gemIndex()) }'/>)
                                                <!-- text: `Buy ()` -->
                                            </button>
                                            <!-- /ko -->
                                        <!-- /ko -->

                                        <!-- ko ifnot: App.game.gems.isValidUpgrade(gemIndex(), $index()) -->
                                            <div class="btn btn-block no-click">N / A</div>
                                        <!-- /ko -->
                                    </div>
                                    <!-- /ko -->
                                </div>
                            <!-- /ko -->
                        </div>
                    </div>
                </div>
                <!-- /ko -->
                <!-- /ko -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Breeding Modal-->
<div class="modal fade" id="breedingModal" tabindex="-1" role="dialog"
aria-labelledby="breedingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl breeding-modal" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <div class="row w-100 m-0">
                    <div class="col-12 p-0">
                        <ul class="nav nav-tabs nav-fill w-100">
                            <li class="nav-item"><a class="nav-link active" href="#breeding-pokemon" data-toggle="tab" onclick="$('#breeding-fireall').show()">Pokémon</a></li>
                            <li class="nav-item"><a class="nav-link" href="#breeding-eggs" data-toggle="tab" onclick="$('#breeding-fireall').show()">Eggs</a></li>
                            <li class="nav-item"><a class="nav-link" href="#breeding-fossils" data-toggle="tab" onclick="$('#breeding-fireall').show()">Fossils</a></li>
                            <li class="nav-item" data-bind="visible: App.game.breeding.hatcheryHelpers.isUnlocked()" onclick="$('#breeding-fireall').show()"><a class="nav-link" href="#breeding-helpers" data-toggle="tab">Helpers</a></li>
                            <li class="nav-item"><a class="nav-link" href="#breeding-help" data-toggle="tab" onclick="$('#breeding-fireall').show()">Help</a></li>
                            <li class="d-lg-block d-none"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                        </ul>
                    </div>
                    <div class="col-12 d-lg-block d-none py-2 px-3" style="min-height: 55px;">
                        <div class="float-left">
                            <button type="button" class="btn btn-warning hatchery-warnings" style="pointer-events: none;" data-bind="visible: !App.game.breeding.hasFreeEggSlot()">
                                You don't have any free egg slots.
                            </button>
                            <button type="button" class="btn btn-danger hatchery-warnings" style="pointer-events: none;" data-bind="visible: !App.game.breeding.hasFreeQueueSlot() && App.game.breeding.queueSlots()">
                                Your breeding queue is full or disabled.
                            </button>
                        </div>
                        <div class="float-right d-lg-block d-none">
                            <knockout class="mx-2" data-bind="foreach: App.game.breeding.hatcheryHelpers.hired()">
                                <img class="pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` },
                                tooltip: {
                                    title: $data.tooltip(),
                                    trigger: 'hover',
                                    placement:'top',
                                    html: true,
                                }">
                            </knockout>
                            <button id="breeding-fireall" type="button" class="btn btn-danger" data-bind="attr : {
                                disabled : !App.game.breeding.hatcheryHelpers.hired().length},
                                click: function(){App.game.breeding.hatcheryHelpers.hired().forEach(function(h){h.fire();})},
                                tooltip: {
                                    title: App.game.breeding.fireAllButtonTooltip(),
                                    trigger: 'hover',
                                    placement:'top',
                                    html: true,
                                }">Fire All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-body p-0">
                <div class="tab-content p-3 h-100">
                    <!-- ko let: { categoryModeEnabled: PokemonCategories.categoryAssignEnabled, categoryModeSelected: PokemonCategories.categoryAssignSelected } -->
                    <div class="tab-pane fade in active show" id="breeding-pokemon">
                        <div class="row">
                            <div class="col-12 d-lg-none d-block">
                                <button class="w-100 my-1 btn btn-secondary" type="button" data-toggle="collapse"
                                        data-target="#breeding-filter-container" aria-expanded="false" aria-controls="pokedex-filter-container">
                                    Filters and Settings
                                </button>
                            </div>
                            <!-- Filters and Settings -->
                            <div class="col-lg-3 col-12 collapse dont-collapse-lg" id="breeding-filter-container">
                                <div class="pokedex-border-bottom pt-2">
                                    <h4>Filters and Settings</h4>
                                </div>
                                <div class="scrolling-div-breeding-filters">
                                    <div class="container-fluid py-3">
                                        <div class="form-row text-left">
                                            <div class="form-group col-lg-12 col-12">
                                                <label for="breeding-filter-nameID">Name or ID</label>
                                                <input id="breeding-filter-nameID" autocomplete="off" class="form-control" placeholder="Search here"
                                                    oninput="BreedingController.formatSearch(this.value)" data-bind="value: BreedingController.getSearchString()" />
                                            </div>

                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingType1Filter: Settings.getSetting('breedingType1Filter') } -->
                                                <label>Types</label>
                                                <select id="breeding-filter-type1" class="custom-select"
                                                        data-bind="options: breedingType1Filter.options,
                                                                optionsValue: 'value',
                                                                optionsText: 'text',
                                                                value: breedingType1Filter.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingType2Filter: Settings.getSetting('breedingType2Filter') } -->
                                                <label> </label>
                                                <select id="breeding-filter-type2" class="custom-select"
                                                        data-bind="options: breedingType2Filter.options,
                                                                optionsValue: 'value',
                                                                optionsText: 'text',
                                                                value: breedingType2Filter.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>

                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingRegionFilter: Settings.getSetting('breedingRegionFilter') } -->
                                                <label for="breeding-filter-region" data-bind="text: breedingRegionFilter.displayName">Region(s)</label><br/>
                                                <div class="dropdown show">
                                                    <button id="breeding-filter-region" type="button" class="text-left custom-select col-12 btn btn-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-bind="text: BreedingController.getRegionFilterString()">
                                                        Regions
                                                    </button>
                                                    <div class="border-secondary dropdown-menu col-12">
                                                        <div class="dropdown-item" data-bind="click: function() { breedingRegionFilter.set((2 << player.highestRegion()) - 1) }">
                                                            All
                                                        </div>
                                                        <div class="dropdown-divider"></div>
                                                        <!-- ko foreach : GameHelper.enumNumbers(GameConstants.Region).filter((r) => (r <= player.highestRegion() && r > GameConstants.Region.none)) -->
                                                        <div class="dropdown-item" data-bind="class: breedingRegionFilter.observableValue() & (1 << $data) ? 'bg-success' : '',
                                                            text: GameConstants.camelCaseToString(GameConstants.Region[$data]),
                                                            click: function(){ breedingRegionFilter.set(1 << $data) },
                                                            attr: { 'oncontextmenu' : `Settings.setSettingByName('breedingRegionFilter', Settings.getSetting('breedingRegionFilter').value ^ (1 << ${$data})); return false;` }">
                                                        </div>
                                                        <!-- /ko-->
                                                    </div>
                                                </div>
                                                <!-- /ko -->
                                            </div>

                                            <!-- Category -->
                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingCategoryFilter: Settings.getSetting('breedingCategoryFilter') } -->
                                                <label for="breeding-filter-category" data-bind="text: breedingCategoryFilter.displayName">Category</label>
                                                <div class="dropdown show">
                                                    <button id="breeding-filter-category" type="button" class="text-left custom-select col-12 btn btn-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                        data-bind="text: breedingCategoryFilter.observableValue() == -1 ? 'All'
                                                            : breedingCategoryFilter.observableValue() == -2 ? 'Categorized'
                                                            : PokemonCategories.categories().find(c => c.id == breedingCategoryFilter.observableValue()).name()">
                                                        Categories
                                                    </button>
                                                    <div class="border-secondary dropdown-menu col-12 category-dropdown">
                                                        <div class="dropdown-item dropdown-text" data-bind="click: function() { breedingCategoryFilter.set(-1) }">
                                                            All
                                                        </div>
                                                        <div class="dropdown-item dropdown-text" data-bind="click : function(){ breedingCategoryFilter.set(-2) }">
                                                            Categorized
                                                        </div>
                                                        <div class="dropdown-divider"></div>
                                                        <!-- ko foreach : PokemonCategories.categories -->
                                                        <div class="dropdown-item" data-bind="text : $data.name(), style: { background: $data.color(), color: GameHelper.isColorLight($data.color()) ? 'black' : 'white' },
                                                            click : function() { breedingCategoryFilter.set($data.id) }">
                                                        </div>
                                                        <!-- /ko-->
                                                        <div class="dropdown-divider"></div>
                                                        <a class="dropdown-item dropdown-text" href="#categoryModal" data-toggle="modal">
                                                            <i>Edit categories</i>
                                                        </a>
                                                    </div>
                                                </div>
                                                <!-- /ko -->
                                            </div>

                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingShinyFilter: Settings.getSetting('breedingShinyFilter') } -->
                                                <label for="breeding-filter-shiny-status" data-bind="text: breedingShinyFilter.displayName">Shiny Status</label>
                                                <select id="breeding-filter-shiny-status" autocomplete="off" class="custom-select"
                                                    data-bind="options: breedingShinyFilter.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: breedingShinyFilter.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingPokerusFilter: Settings.getSetting('breedingPokerusFilter') } -->
                                                <label for="breeding-filter-pokerus-status" data-bind="text: breedingPokerusFilter.displayName">Pokérus Status</label>
                                                <select id="breeding-filter-pokerus-status" autocomplete="off" class="custom-select"
                                                    data-bind="options: breedingPokerusFilter.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: breedingPokerusFilter.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <!-- Mega Evolution -->
                                            <!-- ko if: Settings.getSetting('breedingUniqueTransformationFilter').isUnlocked() -->
                                            <div class="form-group col-lg-12 col-12">
                                                <!-- ko let: { breedingUniqueTransformationFilter: Settings.getSetting('breedingUniqueTransformationFilter') } -->
                                                <label for="breeding-filter-unique-transformation" data-bind="text: breedingUniqueTransformationFilter.displayName">Unique Transformations</label>
                                                <select id="breeding-filter-unique-transformation" autocomplete="off" class="custom-select"
                                                    data-bind="options: breedingUniqueTransformationFilter.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: breedingUniqueTransformationFilter.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <!-- /ko -->
                                            <!--Hide alternate forms-->
                                            <div class="form-group col-lg-12 col-12 mb-0">
                                                <!-- ko let: { breedingHideAltFilter: Settings.getSetting('breedingHideAltFilter') } -->
                                                <label for="breeding-filter-hide-alternate" data-bind="text: breedingHideAltFilter.displayName">Hide alternate forms</label>
                                                <label class="form-check-label toggler-wrapper style-1 float-right">
                                                    <input class="form-check-input" type="checkbox" id="breedingHideAlternateFilter"
                                                        data-bind="checked: breedingHideAltFilter.observableValue">
                                                    <div class="toggler-slider">
                                                        <div class="toggler-knob"></div>
                                                    </div>
                                                </label>
                                                <!-- /ko -->
                                            </div>

                                            <div class="col-12">
                                                <hr style="border-color:grey;">
                                            </div>

                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingDisplayTextSetting: Settings.getSetting('breedingDisplayTextSetting') } -->
                                                <label for="breeding-setting-display-text" data-bind="text: breedingDisplayTextSetting.displayName">Display Value</label>
                                                <select id="breeding-setting-display-text" autocomplete="off" class="custom-select"
                                                    data-bind="options: breedingDisplayTextSetting.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: breedingDisplayTextSetting.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <!-- ko if: App.game.challenges.list.regionalAttackDebuff.active() -->
                                            <div class="form-group col-lg-6 col-6">
                                                <!-- ko let: { breedingRegionalAttackDebuffSetting: Settings.getSetting('breedingRegionalAttackDebuffSetting') } -->
                                                <label for="breeding-setting-regional-attack-debuff" data-bind="text: breedingRegionalAttackDebuffSetting.displayName">Regional Debuff</label>
                                                <select id="breeding-setting-regional-attack-debuff" autocomplete="off" class="custom-select"
                                                    data-bind="options: breedingRegionalAttackDebuffSetting.getValidOptions(),
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: breedingRegionalAttackDebuffSetting.observableValue">
                                                </select>
                                                <!-- /ko -->
                                            </div>
                                            <!-- /ko -->
                                            <div class="form-group col-lg-12 col-12" style="max-width: 100%; flex-grow: 1">
                                                <!-- ko let: { hatcherySort: Settings.getSetting('hatcherySort') } -->
                                                <label for="hatchery-setting-sort" data-bind="text: hatcherySort.displayName">Sort</label>
                                                <div class="input-group">
                                                    <select id="hatchery-setting-sort" autocomplete="off" class="custom-select"
                                                        data-bind="options: hatcherySort.options,
                                                            optionsValue: 'value',
                                                            optionsText: 'text',
                                                            value: hatcherySort.observableValue">
                                                    </select>
                                                    <div class="input-group-append bg-primary text-light">
                                                        <!-- ko let: { hatcherySortDirection: Settings.getSetting('hatcherySortDirection') } -->
                                                        <label for="hatchery-setting-sort-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;"
                                                            data-bind="text: hatcherySortDirection.observableValue() ? '⥄' : '⥂',
                                                                tooltip: {
                                                                    title: hatcherySortDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                                                    trigger: 'hover',
                                                                    placement:'top'
                                                                }">
                                                            ⥂
                                                        </label>
                                                        <input id="hatchery-setting-sort-direction" style="vertical-align: middle" class="hidden" type='checkbox'
                                                            data-bind="checked: hatcherySortDirection.observableValue"/>
                                                        <!-- /ko -->
                                                    </div>
                                                </div>
                                                <!-- /ko -->
                                            </div>

                                            <div class="col-12">
                                                <hr style="border-color:grey;">
                                            </div>

                                            <!-- Category Mode-->
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <button type="button" class="btn btn-primary btn-block" data-bind="
                                                        click: () => categoryModeEnabled(!categoryModeEnabled()),
                                                        text: categoryModeEnabled() ? 'Disable Category Mode' : 'Enable Category Mode',
                                                        tooltip: {
                                                            title: 'Use Category Mode to quickly assign and remove Pokémon from categories. Select a category then click the desired Pokémon to add or remove.',
                                                            placement: 'top',
                                                            trigger: 'hover'
                                                        }">
                                                        Enable Category Mode
                                                    </button>
                                                </div>
                                            </div>
                                            <!-- ko if: categoryModeEnabled() -->
                                            <div class="col-12">
                                                <div class="form-group mb-1">
                                                    <label>Selected Category</label>
                                                    <div class="dropdown show">
                                                        <button type="button" class="text-left custom-select col-12 btn btn-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                            data-bind="text: PokemonCategories.categories().find(c => c.id == categoryModeSelected()).name()">
                                                            Select A Category
                                                        </button>
                                                        <div class="border-secondary dropdown-menu col-12 category-dropdown" data-bind="foreach: PokemonCategories.categories">
                                                            <div class="dropdown-item" data-bind="text : $data.name(),
                                                                style: { color: GameHelper.isColorLight($data.color()) ? 'black' : 'white', background: $data.color() },
                                                                click: () => categoryModeSelected($data.id)">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group col-6">
                                                <button type="button" class="btn btn-success btn-block" data-bind="tooltip: {
                                                    title: 'Add all Pokémon matching the current filters to this category.',
                                                    placement: 'bottom',
                                                    trigger: 'hover'
                                                },
                                                click: () => PartyController.addCategory(BreedingController.hatcheryFilteredList().filter(p => p.isHatchable()), categoryModeSelected())">Add All</button>
                                            </div>
                                            <div class="form-group col-6">
                                                <button type="button" class="btn btn-danger btn-block" data-bind="tooltip: {
                                                    title: 'Remove all Pokémon matching the current filters from this category.',
                                                    placement: 'bottom',
                                                    trigger: 'hover'
                                                },
                                                disable: categoryModeSelected() === 0,
                                                click: () => PartyController.removeCategory(BreedingController.hatcheryFilteredList().filter(p => p.isHatchable()), categoryModeSelected())">Remove All</button>
                                            </div>
                                            <!-- /ko -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pokemon List -->
                            <div class="col-lg-9 col-12 pokemon-list" id="breeding-pokemon-list-container">
                                <div class="scrolling-div-breeding-list">
                                    <!-- Check if the player has any level 100 Pokémon or if they have any eggs -->
                                    <button type="button" class="btn btn-danger hatchery-warnings w-100" style="pointer-events: none;" data-bind="visible: DisplayObservables.modalState.breedingModal !== 'hidden' && !App.game.party.hasMaxLevelPokemon()">
                                        Unfortunately, you don't have any Pokémon of level 100 to breed.
                                    </button>
                                    <knockout data-bind="using: lazyLoad('lazyHatcheryList', $element, BreedingController.viewSortedFilteredList, { pageSize: 60, reset: BreedingController.resetHatcheryFlag }), as: 'lazyHatcheryList'">
                                        <!-- ko if: DisplayObservables.modalState.breedingModal !== 'hidden' && App.game.party.hasMaxLevelPokemon() -->
                                        <ul class="row justify-content-center w-100 p-0 m-0" data-bind="foreach: lazyHatcheryList, childrenComplete: () => { lazyLoadCallback('lazyHatcheryList'); }">
                                            <!-- ko if: $data.isHatchable() && ($data.matchesHatcheryFilters() || BreedingController.viewResetWaiting()) -->
                                            <li class="col-sm-4 col-md-3 col-lg-2 pokedexEntry" data-bind="
                                                style:{background: PokedexHelper.getBackgroundColors($data.name)},
                                                class: App.game.breeding.hasFreeEggSlot() || App.game.breeding.hasFreeQueueSlot() ? '' : 'disabled',
                                                css: { 'category-highlight': categoryModeEnabled() && $data.category.includes(categoryModeSelected()) }">
                                                <div class="breedingListShiny" data-bind="visible: App.game.party.alreadyCaughtPokemon($data.id, true)">✨</div>
                                                <img class="breeding-shadow-icon shadow-icon" src="assets/images/status/shadow.svg" data-bind="visible: $data.shadow == GameConstants.ShadowStatus.Shadow"/>
                                                <img class="breeding-shadow-icon shadow-icon" src="assets/images/status/purified.svg" data-bind="visible: $data.shadow == GameConstants.ShadowStatus.Purified"/>
                                                <div class="breedingListPokerus" data-bind="if: App.game.party.getPokemon($data.id)?.pokerus">
                                                    <img width="32px" src="" data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[App.game.party.getPokemon($data.id).pokerus]}.png`}"/>
                                                </div>
                                                <img src="" class="pokedex-pokemon-sprite" data-bind="attr:{ src: PokemonHelper.getImage($data.id) }">
                                                <span class="pokedex-bottom-text" data-bind="text: BreedingController.getDisplayValue($data)">value</span>
                                                <a class="overlay" href="#breed" data-bind="click: function() {
                                                    if (categoryModeEnabled()) {
                                                        $data.toggleCategory(categoryModeSelected());
                                                    } else {
                                                        App.game.breeding.addPokemonToHatchery($data);
                                                        App.game.breeding.checkCloseModal();
                                                    }
                                                }"></a>
                                                <span class="pokedex-top-text text-truncate px-1" data-bind="text: $data.displayName,
                                                    tooltip: {
                                                        title: categoryModeEnabled() ? '' : PokemonHelper.displayName($data.name),
                                                        trigger: 'hover',
                                                        placement: 'top',
                                                        boundary: 'viewport'
                                                    }">name</span>

                                                <!-- Category Button -->
                                                <div class="pokemonCategory dropdown" data-bind="let: { pokemon: App.game.party.getPokemon($data.id) }">
                                                    <div data-toggle="dropdown" style="height: 15px;">
                                                        <!-- Limit category display to 12 for UI purposes -->
                                                        <div class="d-flex position-relative category-display" data-bind="foreach: pokemon.category.slice(0, 12)">
                                                            <button data-bind="class: `category-${$data + 1}`"></button>
                                                        </div>
                                                    </div>
                                                    <div class="border-secondary dropdown-menu multiselect-dropdown category-dropdown px-1">
                                                        <div class="form-check d-flex align-items-center", data-bind="with: PokemonCategories.categories().find(c => c.id === 0), as: 'pokemonCategory'">
                                                            <input type="checkbox" class="form-check-input mt-0" style="cursor: pointer;"
                                                                data-bind="attr: { id: `${$parent.id}-category0` },
                                                                    checked: pokemon.isUncategorized,
                                                                    disable: pokemon.isUncategorized,
                                                                    click: () => { pokemon.resetCategory(); return true; }">
                                                            <label class="form-check-label text-truncate w-100 p-1" style="max-width: 200px; cursor: pointer;"
                                                                data-bind="
                                                                    text: pokemonCategory.name,
                                                                    attr: { for: `${$parent.id}-category0` },
                                                                    style: { color: GameHelper.isColorLight(pokemonCategory.color()) ? 'black' : 'white', background: pokemonCategory.color, 'text-shadow': `0 0 6px ${GameHelper.isColorLight(pokemonCategory.color()) ? 'white' : 'black'}` }"
                                                                onclick="event.stopPropagation();"></label>
                                                        </div>
                                                        <div class="dropdown-divider"></div>
                                                        <!-- ko foreach: { data: PokemonCategories.playerCategories, as: 'pokemonCategory' } -->
                                                        <div class="form-check d-flex align-items-center">
                                                            <input type="checkbox" class="form-check-input mt-0" style="cursor: pointer;"
                                                                data-bind="
                                                                    attr: { id: `${$parent.id}-category${pokemonCategory.id}` },
                                                                    checked: pokemon._category,
                                                                    checkedValue: pokemonCategory.id">
                                                            <label class="form-check-label text-truncate w-100 p-1" style="max-width: 200px; cursor: pointer;"
                                                                data-bind="
                                                                    text: pokemonCategory.name,
                                                                    attr: { for: `${$parent.id}-category${pokemonCategory.id}` },
                                                                    style: { color: GameHelper.isColorLight(pokemonCategory.color()) ? 'black' : 'white', background: pokemonCategory.color, 'text-shadow': `0 0 6px ${GameHelper.isColorLight(pokemonCategory.color()) ? 'white' : 'black'}` }"
                                                                onclick="event.stopPropagation();"></label>
                                                        </div>
                                                        <!-- /ko -->
                                                        <div class="dropdown-divider"></div>
                                                        <a class="dropdown-item dropdown-text" href="#categoryModal" data-toggle="modal">
                                                            <i>Edit categories</i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </li>
                                            <!-- /ko -->
                                        </ul>
                                        <!-- /ko -->
                                    </knockout>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->

                    <div class="tab-pane fade" id="breeding-eggs">
                        <div class="scrolling-div-breeding-list">
                            <button type="button" class="btn btn-warning hatchery-warnings w-100" style="pointer-events: none;" data-bind="visible: !Object.keys(GameConstants.EggItemType).filter(e=>isNaN(e)).filter(x=>player.itemList[x]()).length">
                                You don't have any eggs to breed.
                            </button>
                            <!-- ko if: Object.keys(GameConstants.EggItemType).filter(e=>isNaN(e)).filter(x=>player.itemList[x]()).length -->
                            <ul class="row justify-content-center w-100 p-0 m-0" data-bind="foreach: Object.keys(GameConstants.EggItemType).filter(e=>isNaN(e)).filter(x=>player.itemList[x]())">
                                <li class="eggSlotModal col-sm-4 col-md-3 col-lg-2 pokedexEntry text-nowrap" data-bind="class: App.game.breeding.hasFreeEggSlot() ? '' : 'disabled'">
                                    <span style="top: 0; border-top-left-radius: 6px; border-top-right-radius: 6px;" data-bind="text: GameConstants.camelCaseToString(GameConstants.humanifyString($data))">egg</span>
                                    <img src="" width="80px" data-bind="attr:{ src: `assets/images/breeding/${$data}.png` }">
                                    <span style="bottom: 0; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px" data-bind="text: 'Amount: ' + player.itemList[$data]().toLocaleString('en-US')">amount</span>
                                    <a class="overlay" href="#breed" data-bind="click: function() { ItemList[$data].use(); App.game.breeding.checkCloseModal(); }"></a>
                                    <knockout style="position: absolute; right: 2px; top: -14px;"
                                        data-bind="template: { name: 'caughtStatusTemplate', data: { status: ItemList[$data].getCaughtStatus() }, if: (ItemList[$data] instanceof CaughtIndicatingItem) }"/>
                                </li>
                            </ul>
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="tab-pane fade" id="breeding-fossils">
                        <div class="scrolling-div-breeding-list">
                            <button type="button" class="btn btn-warning hatchery-warnings w-100" style="pointer-events: none;" data-bind="visible: !UndergroundItems.list.filter(it => it.valueType === UndergroundItemValueType.Fossil && player.itemList[it.itemName]() > 0).length">
                                You don't have any fossils to breed.
                            </button>
                            <!-- ko if: UndergroundItems.list.filter(it => it.valueType === UndergroundItemValueType.Fossil && player.itemList[it.itemName]() > 0).length -->
                            <ul class="row justify-content-center w-100 p-0 m-0" data-bind="foreach: UndergroundItems.list.filter(it => it.valueType === UndergroundItemValueType.Fossil && player.itemList[it.itemName]() > 0)">
                                <li class="eggSlotModal col-sm-4 col-md-3 col-lg-2 pokedexEntry text-nowrap" data-bind="class: App.game.breeding.hasFreeEggSlot() ? '' : 'disabled'">
                                    <span style="top: 0; border-top-left-radius: 6px; border-top-right-radius: 6px;" data-bind="text: GameConstants.humanifyString($data.name)">fossil</span>
                                    <img src="" width="80px" data-bind="attr:{ src: `assets/images/breeding/${$data.name}.png` }">
                                    <span style="bottom: 0; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px" data-bind="text: 'Amount: ' + player.itemList[$data.itemName]().toLocaleString('en-US')">amount</span>
                                    <a class="overlay" href="#breed" data-bind="click: function() { UndergroundController.sellMineItem($data); App.game.breeding.checkCloseModal(); }"></a>
                                    <knockout style="position: absolute; right: 2px; top: -14px;"
                                        data-bind="template: { name: 'caughtStatusTemplate', data: { status: PartyController.getCaughtStatusByName(GameConstants.FossilToPokemon[$data.name]) } }"/>
                                </li>
                            </ul>
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="tab-pane fade" id="breeding-helpers">
                        <div class="row m-0 justify-content-center" data-bind="foreach: App.game.breeding.hatcheryHelpers.available()" style="max-width: 100%;">
                            <div class="card text-left col-md-3 col-sm-6 col-xs-12 p-0">
                                <h5 class="card-header">
                                    <knockout data-bind="text: $data.name">Name</knockout>
                                    <img class="float-right pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` }">
                                </h5>
                                <div class="card-body p-0">
                                    <table class="table table-striped table-hover table-bordered table-sm m-0" style="overflow: visible;">
                                        <tbody>
                                            <tr>
                                                <td class="text-left align-middle">Cost / Hatch:</td>
                                                <td class="text-right" data-bind="template: { name: 'currencyTemplate', data: {'amount': $data.cost.amount, 'currency': $data.cost.currency, 'reducedThreshold': 1e10}}"></td>
                                            </tr>
                                            <tr>
                                                <td class="text-left">Step Efficiency:</td>
                                                <td class="text-right">
                                                    <knockout data-bind="text: `${$data.stepEfficiencyBase.toLocaleString('en-US')}%`">100%</knockout>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left text-nowrap">Attack Efficiency:</td>
                                                <td class="text-right">
                                                    <knockout data-bind="text: `${$data.attackEfficiencyBase.toLocaleString('en-US')}%`">100%</knockout>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left text-nowrap">Hatched:</td>
                                                <td class="text-right">
                                                    <knockout data-bind="text: $data.hatched().toLocaleString('en-US')">0</knockout>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left text-nowrap">Bonus to Efficiency:</td>
                                                <td class="text-right">
                                                    <knockout data-bind="text: `+ ${$data.hatchBonus().toLocaleString('en-US')}%`">0%</knockout>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2" class="p-0">
                                                    <div class="progress">
                                                        <!-- ko if: $data.hatchBonus() < 50 -->
                                                        <div class="progress-bar bg-primary" role="progressbar"
                                                            data-bind="attr:{ style: 'width:' + (($data.hatched() - $data.prevBonus()) / ($data.nextBonus() - $data.prevBonus())) * 100 + '%' }"
                                                            aria-valuemin="0" aria-valuemax="100">
                                                            <span data-bind="text: `${$data.hatchBonus()}%`" class="text-left pl-1">0%</span>
                                                            <span data-bind="text: ($data.hatched() - $data.prevBonus()) + ' / ' + ($data.nextBonus() - $data.prevBonus()) + ' hatches'"></span>
                                                            <span data-bind="text: `${($data.hatchBonus() + 0.1).toFixed(1)}%`" class="text-right pr-1">0.1%</span>
                                                        </div>
                                                        <!-- /ko -->
                                                        <!-- ko if: $data.hatchBonus() >= 50 -->
                                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%">
                                                            <span>MAX BONUS!</span>
                                                        </div>
                                                        <!-- /ko -->
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left align-middle">Sort:</td>
                                                <td class="text-center align-middle">
                                                    <div class="input-group input-group-sm">
                                                        <select autocomplete="off" class="custom-select" data-bind="options: GameHelper.enumSelectOption(SortOptions).filter(o => ![SortOptions.level, SortOptions.attack].includes(o.value)), optionsValue: 'value', optionsText: i => SortOptionConfigs[i.value].text, value: $data.sortOption"></select>
                                                        <div class="input-group-append bg-primary text-light">
                                                            <label class="clickable m-0 px-2" style="font-size: 20px;" data-bind="
                                                                attr: {for: 'hatcheryHelperSortDirection' + $index() },
                                                                text: $data.sortDirection() ? '⥄' : '⥂',
                                                                tooltip: { title: $data.sortDirection() ? 'Descending (highest value first)' : 'Ascending (lowest value first)', trigger: 'hover', placement:'top' }
                                                                ">⥂</label>
                                                            <input class="hidden" type="checkbox"
                                                                data-bind="attr: { id: 'hatcheryHelperSortDirection' + $index() }, checked:  $data.sortDirection" />
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left align-middle">Category:</td>
                                                <td class="text-center align-middle" style="max-width: 1px;">
                                                    <knockout data-bind="template: { name: 'multiSelectDropdownTemplate',
                                                        data: {
                                                            id: `helper-category${$index()}`,
                                                            options: PokemonCategories.categories(),
                                                            optionsText: 'name',
                                                            optionsValue: 'id',
                                                            bindingField: $data.categories,
                                                            buttonText: () => {
                                                                return $data.categories().map(id => PokemonCategories.categories().find(c => c.id === id)?.name()).join('; ') || 'All Categories';
                                                            },
                                                            buttonClass: 'custom-select-sm',
                                                            itemLabel: {
                                                                class: 'small',
                                                                style: (item) => ({ 'background-color': item.color(), color: GameHelper.isColorLight(item.color()) ? 'black' : 'white' })
                                                            },
                                                            showSelectAll: true,
                                                            selectAllText: 'All Categories',
                                                            selectAllClick: () => $data.categories([]),
                                                        }}">
                                                    </knockout>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2" class="text-center">
                                                    <div class="position-relative">
                                                        <div class="form-check">
                                                            <input type="checkbox" class="form-check-input mt-1" data-bind="checked: $data.useHatcheryFilters,
                                                                attr: { id: `hatcheryHelperUseFilters${$index()}` }">
                                                            <label class="form-check-label" data-bind="attr: { for: `hatcheryHelperUseFilters${$index()}` }">Use Hatchery Filters</label>
                                                        </div>
                                                        <div class="position-absolute" style="top:0; right: 0;" data-bind="tooltip: {
                                                            html: true,
                                                            title: 'When this option is enabled Hatchery Helpers will use the filters and settings selected in the Hatchery in addition to their own settings. Disabling this option will allow them to work independently and ignore the Hatchery filters.',
                                                            placement: 'top',
                                                            trigger: 'hover'
                                                        }">ⓘ</div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="2">
                                                    <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired() && !App.game.breeding.hatcheryHelpers.canHire() }, css: { 'btn-success': !$data.hired(), 'btn-danger': $data.hired() }, click: () => !$data.hired() ? $data.hire() : $data.fire(), text: !$data.hired() ? 'Hire!' : 'Fire!'">Hire!</button>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div id="breeding-help" class="tab-pane fade col-10 offset-1">
                        <h4><u>Hatchery</u></h4>
                        <p>You can leave your level 100 Pokémon here in the hatchery to gain an egg of the same Pokémon.</p>

                        <p data-bind="text: `Once an egg hatches, your Pokémon will gain a bonus of ${GameConstants.BREEDING_ATTACK_BONUS}% of their base attack and have a higher chance of becoming shiny!` "></p>

                        <p class="text-warning"><i>NOTE: Base attack is the value your Pokémon originally has at level 100, before any breeding buffs.</i></p>

                        <p>Any Proteins applied to Pokémon will give them an additional 1 attack per hatch, but require 20 more steps.</p>
                        <p>Any Calciums applied to Pokémon will give them an additional 1% of their base attack per hatch, but require 20 more steps.</p>
                        <p>Any Carbos applied to Pokémon will reduce the steps required per hatch.</p>

                        <p>Hatching a shiny Pokémon will grant it 5 times the usual attack gain. Note that this bonus does not apply to every hatch of existing shiny pokemon. In other words, if you breed a shiny Pokémon, it will only receive the bonus if it hatches shiny again.</p>

                        <p>There is no limit to breeding, so this will be your main source of attack gain.</p>

                        <h4><u>Queue</u></h4>
                        <p>You will gain access to a queue in the hatchery once you reach the Johto region, and more queue slots for each new region reached after that.</p>

                        <h4><u>Hatchery Helpers</u></h4>
                        <p><i>(unlocked after hatching 100 total Pokémon)</i></p>
                        <p>Hatchery Helpers will help out by automatically breeding your Pokémon for you.</p>
                        <p>The cost displayed is how much you will be charged per hatch.</p>
                        <p>They will only breed Pokémon based on your current Hatchery filters.</p>
                        <p>All of the Helpers have different step efficiencies and will hatch eggs faster or slower depending on their value.</p>
                        <p>They each also have different attack efficiencies, which will determine how much attack you gain compared to manually hatching the Pokémon yourself.</p>
                        <p>These efficiencies will gain a bonus based on how many times you've used the helper to hatch eggs.</p>
                        <p><i>More Hatchery Helpers can be unlocked through shops and hatching more Pokémon</i></p>
                    </div>

                </div>
            </div>
            <div class="modal-footer d-lg-none d-flex">
                <div class="mr-auto">
                    <button type="button" class="btn btn-warning hatchery-warnings"
                        data-bind="visible: !App.game.breeding.hasFreeEggSlot(),
                        tooltip: {
                            title: 'You don\'t have any free egg slots.',
                            trigger: 'hover',
                            placement: 'top',
                            boundary: 'window'
                        }">
                        ⓘ
                    </button>
                    <button type="button" class="btn btn-danger hatchery-warnings"
                        data-bind="visible: !App.game.breeding.hasFreeQueueSlot() && App.game.breeding.queueSlots(),
                        tooltip: {
                            title: 'Your breeding queue is full or disabled.',
                            trigger: 'hover',
                            placement: 'top',
                            boundary: 'window'
                        }">
                        ⓘ
                    </button>
                </div>
                <knockout class="" data-bind="foreach: App.game.breeding.hatcheryHelpers.hired()">
                    <img class="pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` },
                    tooltip: {
                        title: $data.tooltip(),
                        trigger: 'hover',
                        placement:'top',
                        html: true,
                    }">
                </knockout>
                <button id="breeding-fireall-footer" type="button" class="btn btn-danger" data-bind="attr : {disabled : !App.game.breeding.hatcheryHelpers.hired().length}, click: function(){App.game.breeding.hatcheryHelpers.hired().forEach(function(h){h.fire();})}" >Fire All</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Underground Modal -->
<div aria-labelledby="myModalLabel" class="modal fade noselect" id="mineModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a></li>
                    <li class="nav-item"><a data-toggle='tab' class='nav-link' href="#undergroundHelpers">Helpers</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <li class="d-block"><button type="button" class="btn btn-danger" data-dismiss="modal" style="font-size: 18px; font-weight: 700;">×</button></li>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="dig" class="tab-pane fade in active show" data-bind="">
                    <div class="container">
                        <div class="row p-2">
                            <div class="col-6 p-0 d-flex">
                                <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>

                                <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                                <button class="btn btn-danger p-2" style="min-width: 36px;" data-bind="
                                    text: `↻ ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                    css: {
                                        'btn-danger': !autoRestartUndergroundMine.observableValue(),
                                        'btn-success': autoRestartUndergroundMine.observableValue()
                                    },
                                    tooltip: {
                                        title: `${autoRestartUndergroundMine.displayName}: ${autoRestartUndergroundMine.observableValue() ? 'On' : 'Off'}`,
                                        trigger: 'hover',
                                        placement:'right'
                                    },
                                    click: () => autoRestartUndergroundMine.observableValue(!autoRestartUndergroundMine.observableValue())"></button>
                                <!-- /ko -->
                            </div>

                            <div class="col-6 p-0" data-bind="tooltip: {
                                    title: `${(App.game.underground.undergroundExp - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')} / ${(Underground.convertLevelToExperience(App.game.underground.undergroundLevel + 1) - Underground.convertLevelToExperience(App.game.underground.undergroundLevel)).toLocaleString('en-US')}`,
                                    trigger: 'hover'
                                }">
                                <div>Lvl. <knockout data-bind="text: App.game.underground.undergroundLevel"></knockout></div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + App.game.underground.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card">
                            <div class="card-header p-2 font-weight-bold">Treasures</div>
                            <div class="card-body p-2 d-flex justify-content-center" style="gap: 1.5rem">
                                <!-- ko if: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div>Found • ??</div>
                                <div>Seen • ??</div>
                                <div>Buried • ??</div>
                                <!-- /ko -->

                                <!-- ko ifnot: !App.game.underground.mine || App.game.underground.mine.timeUntilDiscovery > 0 -->
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsFound > 0 && App.game.underground.mine?.itemsFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsFound === App.game.underground.mine?.itemsBuried }">
                                    Found • <knockout data-bind="text: App.game.underground.mine?.itemsFound"></knockout>
                                </div>
                                <div class="" data-bind="css: { 'text-warning': App.game.underground.mine?.itemsPartiallyFound > 0 && App.game.underground.mine?.itemsPartiallyFound < App.game.underground.mine?.itemsBuried, 'text-success': App.game.underground.mine?.itemsPartiallyFound === App.game.underground.mine?.itemsBuried }">
                                    Seen • <knockout data-bind="text: App.game.underground.mine?.itemsPartiallyFound"></knockout>
                                </div>
                                <div class="">
                                    Buried • <knockout data-bind="text: App.game.underground.mine?.itemsBuried"></knockout>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- ko if: App.game.underground.mine -->
                        <div style="position: relative;">
                            <div id="mineBody" style="margin:auto; background-image: url('assets/images/underground/rock0.png');"
                                 data-bind="css: {
                                    'disabled': App.game.underground.mine.timeUntilDiscovery > 0 || App.game.underground.mine.completed,
                                    'tool-cooldown': App.game.underground.tools.getTool(App.game.underground.tools.selectedToolType).durability < App.game.underground.tools.getTool(App.game.underground.tools.selectedToolType).durabilityPerUse
                                 },
                                 class: `${UndergroundToolType[App.game.underground.tools.selectedToolType]}Selected`,
                                 style: {
                                    backgroundSize: `calc(100% / ${App.game.underground.mine?.columnCount})`,
                                 }">
                                <!-- ko foreach: App.game.underground.mine.grid -->
                                <div class="mineSquare" data-bind="event: { mousedown: () => UndergroundController.clickModalMineSquare($index()) }">
                                    <div class="rock" data-bind="class: `rock${$data.layerDepth}`, style: UndergroundController.calculateMineTileStyle($index())"></div>

                                    <!-- ko if: $data.survey > 0 -->
                                    <div class="survey" data-bind="class: `survey-${$data.survey}`"></div>
                                    <!-- /ko -->
                                </div>
                                <!-- /ko -->
                            </div>

                            <!-- ko if: App.game.underground.mine && App.game.underground.mine.timeUntilDiscovery > 0 -->
                            <div style="position: absolute; inset: 20%; display: grid; align-content: center;">
                                <div>Searching for mine</div>
                                <div class="progress" style='height: 5px'>
                                    <div class="progress-bar bg-info" role="progressbar"
                                         data-bind="attr:{ style: 'width:' + (1 - App.game.underground.mine.timeUntilDiscovery / App.game.underground.mine.initialTimeToDiscover).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <div data-bind="text: GameConstants.formatTime(App.game.underground.mine.timeUntilDiscovery)"></div>
                            </div>
                            <!-- /ko -->

                            <!-- ko if: App.game.underground.mine && App.game.underground.mine.completed -->
                            <div style="position: absolute; inset: 20%; display: grid; gap: 1rem; align-content: center;">
                                <div>Found all items</div>
                                <button class="btn btn-primary" data-bind="click: () => $('#findNewMineModal').modal('show');">Find mine</button>
                            </div>
                            <!-- /ko -->
                        </div>

                        <div class='row no-gutters'>
                            <div class="col-12 row no-gutters">
                                <!-- ko foreach: [UndergroundToolType.Chisel, UndergroundToolType.Hammer, UndergroundToolType.Bomb, UndergroundToolType.Survey] -->
                                <!-- ko let: { tool: App.game.underground.tools.getTool($data) } -->
                                <div class="tool-ui col card clickable" data-bind="class: `${UndergroundToolType[$data]}-tool-ui`, css: { 'border-info': App.game.underground.tools.selectedToolType === $data }, click: () => App.game.underground.tools.selectedToolType = $data">
                                    <div class="card-header p-1" data-bind="css: { 'bg-info': App.game.underground.tools.selectedToolType === $data }">
                                        <div data-bind="text: tool.displayName"></div>
                                    </div>

                                    <div class="card-body d-flex flex-column p-0 rounded text-center">
                                        <div class="p-1 d-flex justify-content-center">
                                            <div style="position: relative; width: 100%; max-width: 75px; aspect-ratio: 1; padding: 5px; border-radius: 10px;" data-bind="style: { background: `conic-gradient(var(--tool-color) ${tool.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 })}, transparent 0)`, opacity: !tool.canUseTool() ? 0.3 : 1 }">
                                                <div class="d-flex flex-column align-items-center justify-content-center bg-secondary" style="width: 100%; height: 100%; border-radius: 5px;">
                                                    <div class="d-flex align-items-center justify-content-center" style="width: 27px; height: 27px;">
                                                        <img alt="" data-bind="attr: { src: `assets/images/underground/${UndergroundToolType[tool.id]}.png` }">
                                                    </div>
                                                    <div class="small"><knockout data-bind="text: tool.durability.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-center text-light bg-dark p-1"><h6 class="m-0 small">Repair</h6></div>
                                        <!-- ko if: tool.restoreRate > 0 -->
                                        <div class="progress" style='height: 10px; min-height: 10px;'>
                                            <div class="progress-bar" role="progressbar" style="background: var(--tool-color)"
                                                 data-bind="style: { 'width': (tool.restoreRateCounter / tool.restoreRate).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                                 aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="small"><knockout data-bind="text: (tool.restoreRateCounter / tool.restoreRate).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></div>
                                        <!-- /ko -->
                                        <!-- ko ifnot: tool.restoreRate > 0 -->
                                        <div class="progress" style='height: 10px; min-height: 10px;'>
                                            <div class="progress-bar progress-bar-animated" role="progressbar" style="background: linear-gradient(45deg,var(--tool-color) 25%,transparent 25%,transparent 50%,var(--tool-color) 50%,var(--tool-color) 75%,transparent 75%,transparent); background-size: 1rem 1rem;"
                                                 data-bind="style: { 'width': '100%' }"
                                                 aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="small">∞</div>
                                        <!-- /ko -->
                                    </div>

                                    <div class="card-footer p-0">
                                    </div>
                                </div>
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                        </div>

                        <!-- ko ifnot: App.game.challenges.list.disableOakItems.active() -->
                        <div class="card">
                            <div class="card-header p-2 font-weight-bold position-relative">
                                Battery
                                <button class="btn btn-primary" style="position: absolute; right: 0px; top: 0px; width: auto; height: 100%;" data-bind="click: () => $('#undergroundBatteryModal').modal('show');">?</button>
                            </div>

                            <!-- ko if: App.game.oakItems.isActive(OakItemType.Cell_Battery) -->
                            <div class="card-body p-2">
                                <div class="progress mb-2" style='height: 15px; min-height: 15px;'>
                                    <div class="progress-bar" role="progressbar"
                                         data-bind="style: { 'width': (App.game.underground.battery.charges / App.game.underground.battery.maxCharges).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                         aria-valuemin="0" aria-valuemax="100">
                                        <span data-bind="text: `${App.game.underground.battery.charges} / ${App.game.underground.battery.maxCharges}`"></span>
                                    </div>
                                </div>

                                <button class="btn btn-primary" data-bind="click: () => App.game.underground.battery.discharge(), attr: { disabled: App.game.underground.battery.charges < App.game.underground.battery.maxCharges }">Discharge</button>
                            </div>
                            <!-- /ko -->
                            <!-- ko ifnot: App.game.oakItems.isActive(OakItemType.Cell_Battery) -->
                            <div class="card-body p-2">
                                <p>Equip your Cell Battery Oak Item to use the Battery.</p>
                            </div>
                            <!-- /ko -->
                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                </div>

                <div id="treasures" class="tab-pane fade p-2">
                    <!-- ko foreach: [UndergroundItemValueType.Diamond, UndergroundItemValueType.Gem, UndergroundItemValueType.Shard, UndergroundItemValueType.Fossil, UndergroundItemValueType.FossilPiece, UndergroundItemValueType.EvolutionItem, UndergroundItemValueType.Special] -->
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: GameConstants.camelCaseToString(GameHelper.enumStrings(UndergroundItemValueType)[$data])"></span>
                        </div>

                        <div class="card-body">
                            <div class="row justify-content-center">
                                <!-- ko foreach: UndergroundItems.list.filter(item => item.valueType === $data) -->
                                <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                    <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                            data-bind="
                                            css: { 'bg-info': UndergroundTrading.selectedTradeFromItem === $data },
                                            style: { cursor: $data.valueType === UndergroundItemValueType.Special ? 'default' : 'pointer' },
                                            template: { name: 'otherItemTemplate', data: $data.itemName },
                                            click: () => {
                                                if ($data.valueType !== UndergroundItemValueType.Special) {
                                                    UndergroundTrading.selectedTradeFromItem = $data;
                                                    UndergroundTrading.selectedTradeToItem = UndergroundTrading.tradeToItemList[0];
                                                    $('#treasureDetailModal').modal('show');
                                                }
                                            }
                                            ">
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div id="undergroundHelpers" class="tab-pane fade">
                    <div class="row m-0 justify-content-start" data-bind="foreach: App.game.underground.helpers.available()" style="max-width: 100%;">
                        <div class="card text-left col-md-4 col-sm-6 col-xs-12 p-0">
                            <h5 class="card-header">
                                <knockout data-bind="text: $data.name">Name</knockout>
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Information</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-left">Level</td>
                                        <td class="text-right tight" data-bind="text: $data.level.toLocaleString('en-US')"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <div class="progress" style='height: 5px'>
                                                <div class="progress-bar bg-info" role="progressbar"
                                                     data-bind="style: { 'width': $data.progressToNextLevel.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }) }"
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <span data-bind="text: `${($data.experience - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')} / ${(UndergroundHelper.convertLevelToExperience($data.level + 1) - UndergroundHelper.convertLevelToExperience($data.level)).toLocaleString('en-US')}`"></span>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Favorite mine</td>
                                        <td class="text-right tight" data-bind="text: UndergroundController.getMineConfig($data.favoriteMine).displayName"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Discover chance</td>
                                        <td class="text-right tight" data-bind="text: $data.favoriteMineChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Look for favorite</td>
                                        <td class="text-center tight align-middle">
                                            <input class="clickable" type="checkbox" data-bind="checked: $data.shouldDiscoverFavorite"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Smart tool use</td>
                                        <td class="text-right tight" data-bind="text: $data.smartToolUsageChance.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Reward retention</td>
                                        <td class="text-right tight" data-bind="text: $data.rewardRetention.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Auto-sell</td>
                                        <td class="text-center tight align-middle">
                                            <!-- ko if: $data.level >= GameConstants.HELPER_AUTO_SELL_LEVEL_REQUIREMENT -->
                                            <input class="clickable" type="checkbox" data-bind="checked: $data.autoSellToggle">
                                            <!-- /ko -->
                                            <!-- ko ifnot: $data.level >= GameConstants.HELPER_AUTO_SELL_LEVEL_REQUIREMENT -->
                                            <img width="24px" class="lock" src="assets/images/breeding/lock.svg" data-bind="
                                            tooltip: {
                                                title: `Unlocked when ${$data.name} reaches level ${GameConstants.HELPER_AUTO_SELL_LEVEL_REQUIREMENT}`,
                                                placement: 'bottom',
                                                trigger: 'hover'
                                            }" />
                                            <!-- /ko -->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-left">Work cycle</td>
                                        <td class="text-right tight" data-bind="text: `${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })}s`"></td>
                                    </tr>
                                    </tbody>

                                    <thead>
                                    <tr>
                                        <th colspan="2" class="text-center text-light bg-dark"><h5 class="m-0">Energy Restore</h5></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td colspan="2">
                                            <div class="input-group input-group-sm">
                                                <select autocomplete="off" class="custom-select" data-bind="options: [
                                                    { name: 'None', value: -1 },
                                                    ...GameHelper.enumSelectOption(GameConstants.EnergyRestoreSize),
                                                ], optionsValue: 'value', optionsText: (item) => item.value < 0 ? `${GameConstants.camelCaseToString(item.name)}` : `${GameConstants.camelCaseToString(item.name)} (${player.itemList[item.name]().toLocaleString('en-US')})`, value: $data.selectedEnergyRestore"></select>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer p-0">
                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired && !App.game.underground.helpers.canHire() }, css: { 'btn-success': !$data.hired, 'btn-danger': $data.hired }, click: () => !$data.hired ? $data.hire() : $data.fire(), text: !$data.hired ? 'Hire!' : 'Fire!'">Hire!</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-pane fade p-2 text-left">
                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Mines</span>
                        </div>

                        <div class="card-body">
                            <p>
                                There are six different types of mines you can search for in the Underground.
                                Understanding their unique properties and the discovery times involved is crucial for efficient mining.
                                The Underground lexicon can be found at the bottom of this page.
                            </p>

                            <h4>Finding a new mine</h4>
                            <p>
                                A new mine can be manually found by clicking the Find mine button in the Dig tab.<br/>
                                Automatically starting a new mine happens in the following cases:
                            </p>
                            <ul>
                                <li>A <strong>player</strong> digs up the last item: When the 'Auto restart selected mine' toggle is enabled, the game will automatically try to find a new mine of your selected type.</li>
                                <li>A <strong>helper</strong> digs up the last item: If your helper has the 'Look for favorite' setting enabled, it will try and start it's favorite mine. If this setting is disabled it will start a Random mine.</li>
                            </ul>
                            <p>
                                <u>Note that this does NOT ignore the discovery time needed.</u>
                            </p>

                            <h4>Mine Types</h4>
                            <ul>
                                <li>
                                    <strong>Random Mine:</strong> Contains all possible items (except the items from a Special mine)
                                </li>
                                <li>
                                    <strong>Diamond Mine:</strong> Contains only treasures sellable for diamonds.
                                </li>
                                <li>
                                    <strong>Gem Plate Mine:</strong> Contains only gem plate treasures sellable for gems.
                                </li>
                                <li>
                                    <strong>Shard Mine:</strong> Contains only shard treasures.
                                </li>
                                <li>
                                    <strong>Fossil Mine:</strong> Contains only fossils and fossil pieces.
                                </li>
                                <li>
                                    <strong>Evolution Item Mine:</strong> Contains only evolution items.
                                </li>
                            </ul>

                            <h4>Special Mine</h4>
                            <p>
                                When you (not your helper) are searching for a mine, there is a 4% chance for the mine to be a Special mine.
                                This mine only contains 1 item, which can be any of the mega stones (if eligible) or other special items.
                            </p>

                            <h4>Discovery Time Calculation</h4>
                            <p>The discovery time is calculated as follows:</p>
                            <ul>
                                <li>
                                    <strong>Random Mine Type</strong>
                                    <ul>
                                        <li>
                                            Current mine is a Random mine:<br/>
                                            The discovery time starts at <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_BASE)"></knockout> and is reduced by <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_REDUCTION_PER_LEVEL)"></knockout> for every level past level <knockout data-bind="text: GameConstants.DISCOVER_MINE_TIMEOUT_LEVEL_START"></knockout>. This is then further reduced by the percentage of the amount of unmined tiles divided by all tiles only taking into account tiles that do contain a reward.
                                        </li>
                                        <li>Current mine is not a random mine: No discovery time</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Other Mine Type</strong>
                                    <p>The discovery time starts at <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_BASE)"></knockout> and is reduced by <knockout data-bind="text: GameConstants.formatTimeFullLetters(GameConstants.DISCOVER_MINE_TIMEOUT_REDUCTION_PER_LEVEL)"></knockout> for every level past level <knockout data-bind="text: GameConstants.DISCOVER_MINE_TIMEOUT_LEVEL_START"></knockout>.</p>
                                </li>
                            </ul>

                            <h4>Amount of Treasure</h4>
                            <p>The amount of treasure a player can find is random, between the minimum (inclusive) and maximum (inclusive), and increases as their Underground Level increases:</p>
                            <ul>
                                <li><strong>Minimum:</strong> Starts at 1, increases by 1 at levels: 3, 9, 15, 21 and 27, up to a maximum of 6.</li>
                                <li><strong>Maximum:</strong> Starts at 3, increases by 1 at levels: 6, 12, 18, 24 and 30, up to a maximum of 8.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Tools</span>
                        </div>

                        <div class="card-body">
                            <p>The Underground offers <knockout data-bind="text: App.game.underground.tools.tools.length"></knockout> powerful tools to aid in your mining and exploration. Each tool has a unique function, and understanding how to use them effectively is crucial for maximizing your mining efficiency.</p>

                            <h4>Durability</h4>
                            <p>
                                Using a tool is only possible when your tool is durable enough. When you use your tool successfully it will take some damage, which will be repaired over time.
                                The tool will repair X% over Y seconds. Each tool has its own repair rate and repairs a certain percentage of the tool's durability.
                                The repair rate is reduced by Z seconds based on your Underground Level.
                                When a tool reaches a repair rate of 0 seconds, it's durability will stay at 100%.
                            </p>

                            <h4>Successful Use</h4>
                            <p>A tool only counts as used if its action is successful, meaning it accomplishes its intended task (e.g., mining layers or indicating tiles).</p>

                            <h4>Tools Overview</h4>
                            <p>There are <knockout data-bind="text: App.game.underground.tools.tools.length"></knockout> different tools available, each with unique functions and properties:</p>
                            <!-- ko let: { tool: App.game.underground.tools.getTool(UndergroundToolType.Chisel) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines 2 layers on the selected spot.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.underground.tools.getTool(UndergroundToolType.Hammer) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines 1 layer on all 9 tiles in a 3x3 grid.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.underground.tools.getTool(UndergroundToolType.Bomb) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: 'Mines a maximum of 2 layers on each of 10 random tiles (both mined and cleared). The number of tiles increases when equipped with the Explosive Charge Oak Item.' } }"></div>
                            <!-- /ko -->
                            <!-- ko let: { tool: App.game.underground.tools.getTool(UndergroundToolType.Survey) } -->
                            <div data-bind="template: { name: 'helpToolTemplate', data: { tool, action: `Indicates a ${GameConstants.SURVEY_RANGE_BASE}x${GameConstants.SURVEY_RANGE_BASE} grid where at least one tile contains an item. The grid shrinks by two tiles in each direction every ${GameConstants.SURVEY_RANGE_REDUCTION_LEVELS} levels.` } }"></div>
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Battery</span>
                        </div>

                        <div class="card-body">
                            <p>
                                The Battery is a system that charges up as you or your helper mines tiles. In order to charge up you need to have your Cell Battery Oak Item equipped.
                            </p>
                            <p>
                                Each successful mining attempt will add 1 charge, up to a maximum of <knockout data-bind="text: GameConstants.UNDERGROUND_BATTERY_MAX_CHARGES"></knockout> charges.
                                You can only gain 1 charge per <knockout data-bind="text: GameConstants.UNDERGROUND_BATTERY_COOLDOWN_SECONDS"></knockout> second.
                            </p>
                            <p>
                                When your battery is fully charged up, you can discharge it. This discharge will leave a pattern of cleared tiles behind.
                                With higher level patterns, which damage more tiles, becoming available as you level up your Cell Battery.
                            </p>
                            <p>
                                All patterns and their requirements are available in the help section of the Battery on the Dig tab.
                            </p>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Helpers</span>
                        </div>

                        <div class="card-body">
                            <p>Helpers are characters you can hire to assist with mining tasks. They perform actions at certain timing intervals and become more efficient as they level up. Each of them bring their own powerful tools, so their actions will not affect the durability of your tools.</p>

                            <h4>Helper Mechanics</h4>
                            <ul>
                                <li><strong>Favorite Mine:</strong> Each helper has a favorite mine they are more likely to find.
                                    <ul>
                                        <li>Starts at <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> chance to find their favorite mine when searching.</li>
                                        <li>Increases by <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to a maximum of <knockout data-bind="text: GameConstants.FAVORITE_MINE_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>If they don’t find their favorite mine, they will randomly find one of the 6 types of mines.</li>
                                    </ul>
                                </li>
                                <li><strong>Smart tool use:</strong> Helpers start out inexperienced and will pick the most efficient tool <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of the time.
                                    <ul>
                                        <li>Increases by <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_INCREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, up to <knockout data-bind="text: GameConstants.SMART_TOOL_CHANCE_MAXIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.</li>
                                        <li>
                                            <strong>Actions</strong>
                                            <ul>
                                                <li><strong>Bomb:</strong> When not all items have been seen.</li>
                                                <li><strong>Hammer:</strong> When all items have been seen, and the spot that is being mined has at least 1 adjacent tile with a reward</li>
                                                <li><strong>Chisel:</strong> When all items have been seen, and the spot that is being mined has no adjacent tiles with a reward</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li><strong>Reward retention:</strong> When a helper digs up an item, there is a chance that they will keep the item for themselves.
                                    <ul>
                                        <li>
                                            The chance starts at <knockout data-bind="text: GameConstants.REWARD_RETENTION_BASE.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> and decreases by <knockout data-bind="text: GameConstants.REWARD_RETENTION_DECREASE_PER_LEVEL.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> per level, down to <knockout data-bind="text: GameConstants.REWARD_RETENTION_MINIMUM.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout>.
                                        </li>
                                        <li>
                                            From helper level <knockout data-bind="text: GameConstants.HELPER_AUTO_SELL_LEVEL_REQUIREMENT"></knockout>, the player can ask to auto-sell diamond and plate items for their respective value.
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Work cycle:</strong> Starts at <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_BASE"></knockout> seconds and decreases by <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_DECREASE_PER_LEVEL"></knockout> second for every level, up to a minimum of <knockout data-bind="text: GameConstants.WORKCYCLE_TIMEOUT_MINIMUM"></knockout> seconds per action.
                                </li>
                                <li>
                                    <strong>Energy restore:</strong> A helper can use an energy potion to restore a portion of the time until they can perform their next action.
                                    <ul>
                                        <li><strong>Small restore:</strong> Restores 25% of the time until the next action can be performed</li>
                                        <li><strong>Medium restore:</strong> Restores 50% of the time until the next action can be performed</li>
                                        <li><strong>Large restore:</strong> Restores 75% of the time until the next action can be performed</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Experience and Leveling</span>
                        </div>

                        <div class="card-body">
                            <p>Using tools and helpers not only helps you gather treasures but also grants experience that helps in leveling up.</p>

                            <h4>Experience</h4>
                            <ul>
                                <li>
                                    <strong>Items:</strong>
                                    <ul>
                                        <li>Digging up any item: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_DIG_UP_ITEM"></knockout> experience</li>
                                        <li>Digging up all items: <knockout data-bind="text: GameConstants.UNDERGROUND_EXPERIENCE_CLEAR_LAYER"></knockout> experience</li>
                                    </ul>
                                </li>
                            </ul>

                            <h4>Shared Experience</h4>
                            <ul>
                                <li><strong>Player Actions:</strong> When the player performs an action that gains experience, the active helper will also gain <knockout data-bind="text: GameConstants.PLAYER_EXPERIENCE_HELPER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                                <li><strong>Helper Actions:</strong> When the helper performs an action that gains them experience, the player will also gain <knockout data-bind="text: GameConstants.HELPER_EXPERIENCE_PLAYER_FRACTION.toLocaleString('en-US', { style: 'percent', maximumFractionDigits: 2 })"></knockout> of that experience, rounded to the nearest tenth.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Trading</span>
                        </div>

                        <div class="card-body">
                            <p>Trading allows you to exchange items within the same category. Here’s how it works:</p>
                            <ul>
                                <li><strong>Same Category Trading:</strong> Trades can only be made within the same category of items.</li>
                                <li><strong>3 to 1 Trade:</strong> Trading always follows a 3 to 1 ratio (e.g., trade 3 items to receive 1 new item).</li>
                                <li><strong>Exception:</strong> Diamond items cannot be traded.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-2">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Oak Items</span>
                        </div>

                        <div class="card-body">
                            <h4>Explosive Charge</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when finding all items in a mine</li>
                                <li><strong>Effect:</strong> Increases the number of tiles the Bomb tool will mine</li>
                            </ul>

                            <h4>Cell Battery</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when the player uses discharge</li>
                                <li><strong>Effect:</strong> Triggers a discharge which will clear tiles in a certain pattern, new patterns become available by levelling up Cell Battery</li>
                            </ul>

                            <h4>Treasure Scanner</h4>
                            <ul>
                                <li><strong>Progress:</strong> Gains progress to level up when finding an item in a mine</li>
                                <li><strong>Effect:</strong> Has a chance to duplicate a found item. Keeps attempting to duplicate until it fails a chance</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex align-items-center p-0">
                            <span class="flex-grow-1 text-center font-weight-bold">Lexicon</span>
                        </div>

                        <div class="card-body">
                            <ul>
                                <li><strong>Seen Item:</strong> At least 1 part of the item is visible to the player</li>
                                <li><strong>Found Item:</strong> All parts of the item are visible to the player, the item has been claimed</li>
                                <li><strong>Completed Mine:</strong> All buried items have been found</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer p-0">
                <div class="container">
                    <div class="row p-0">
                        <!-- ko foreach: App.game.underground.helpers.hired() -->
                        <div class="col p-0">
                            <div>
                                <span data-bind="text: $data.name"></span>
                                <!-- ko ifnot: $data.selectedEnergyRestore < 0 -->
                                <span data-bind="text: ` using ${GameConstants.camelCaseToString(GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore])} (${player.itemList[GameConstants.EnergyRestoreSize[$data.selectedEnergyRestore]]().toLocaleString('en-US')})`"></span>
                                <!-- /ko -->
                            </div>
                            <div class="progress" style='height: 5px'>
                                <div class="progress-bar bg-info" role="progressbar"
                                     data-bind="attr:{ style: 'width:' + ($data.timeSinceWork / $data.workCycleTime).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) }"
                                     aria-valuemin="0" aria-valuemax="100">
                                    <span data-bind="text: `${$data.timeSinceWork.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} / ${$data.workCycleTime.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 })} s`"></span>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div aria-labelledby="findNewMineModalLabel" class="modal fade no-select" id="findNewMineModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <h4>Select a mine</h4>
                <div class="search-mine-display mb-2">
                    <!-- ko foreach: [MineType.Random, MineType.Diamond, MineType.GemPlate, MineType.Shard, MineType.Fossil, MineType.EvolutionItem] -->
                    <div class="mx-1 mb-1">
                        <div class="card clickable" data-bind="click: () => { App.game.underground.autoSearchMineType = $data; }">
                            <div class="card-body bg-secondary rounded text-center p-1" data-bind="css: { 'bg-info': App.game.underground.autoSearchMineType === $data }">
                                <div class="d-flex flex-column align-items-center">
                                    <h6 class="card-title m-0" data-bind="text: UndergroundController.getMineConfig($data).displayName"></h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>

                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).displayName"></span>
                    </div>

                    <div class="card-body">
                        <h6>Potential treasures</h6>
                        <div>
                            <!-- ko foreach: UndergroundController.getMineConfig(App.game.underground.autoSearchMineType).getAvailableItems() -->
                            <img width="24px" height="24px" data-bind="tooltip: { title: $data.displayName, trigger: 'hover' }, attr: { src: $data.image }" />
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="small">
                            Discovery time: <label data-bind="text: GameConstants.formatTime(UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType)), css: { 'text-warning': UndergroundController.calculateDiscoverMineTimeout(App.game.underground.autoSearchMineType) > 0 }"></label>
                        </div>

                        <button class="btn btn-primary" data-bind="click: () => App.game.underground.generateMine(App.game.underground.autoSearchMineType);" data-dismiss="modal">Search for mine</button>
                    </div>
                </div>

                <div>
                    <!-- ko let: { autoRestartUndergroundMine: Settings.getSetting('autoRestartUndergroundMine') } -->
                    <label for="auto-restart-underground-mine" data-bind="text: autoRestartUndergroundMine.displayName"></label>
                    <label class="form-check-label toggler-wrapper style-1 float-right">
                        <input class="form-check-input" type="checkbox" id="auto-restart-underground-mine"
                               data-bind="checked: autoRestartUndergroundMine.observableValue">
                        <div class="toggler-slider">
                            <div class="toggler-knob"></div>
                        </div>
                    </label>
                    <!-- /ko -->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div aria-labelledby="treasureDetailModalLabel" class="modal fade no-select" id="treasureDetailModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header align-items-center">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem -->
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <div>
                    <h4 class="m-0" data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></h4>
                    <small class="m-0" data-bind="text: player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]().toLocaleString('en-US')"></small>
                </div>
                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                <!-- /ko -->
            </div>

            <div class="modal-body" style="min-height: 300px;">
                <!-- ko if: UndergroundTrading.selectedTradeFromItem?.hasSellValue() -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Sell</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.sellAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.sellAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Gem -->
                                <img class='mineInventoryItem' data-bind='attr: { src: Gems.image(UndergroundTrading.selectedTradeFromItem.type) }'/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × ${PokemonType[UndergroundTrading.selectedTradeFromItem.type]} Gems`"></label>
                                <!-- /ko -->
                                <!-- ko if: UndergroundTrading.selectedTradeFromItem.valueType === UndergroundItemValueType.Diamond -->
                                <img class='mineInventoryItem' src="assets/images/currency/diamond.svg"/>
                                <label data-bind="text: `${UndergroundTrading.selectedTradeFromItem.value.toLocaleString('en-US')} × Diamonds`"></label>
                                <!-- /ko -->
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: (UndergroundTrading.sellAmount * UndergroundTrading.selectedTradeFromItem.value).toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.sellAmount = 1">Reset</button>

                                    <input type="number" min="0" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.sellAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.sellAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.sellAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.sellAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canSell,
                                    click: () => UndergroundTrading.sell()
                                ">Sell</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->

                <!-- ko if: UndergroundTrading.tradeToItemList?.length > 0 -->
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Trade</span>
                    </div>

                    <div class="card-body">
                        <div class="row">
                            <!-- ko foreach: UndergroundTrading.tradeToItemList -->
                            <div class="col-6 col-lg-3 mb-2" data-bind="visible: $data.isUnlocked()">
                                <div class="btn btn-secondary text-left w-100 px-1" style="padding-top: 1px; padding-bottom: 2px;"
                                     data-bind="
                                        css: { 'bg-info': UndergroundTrading.selectedTradeToItem === $data },
                                        template: { name: 'otherItemTemplate', data: $data.itemName },
                                        click: () => { UndergroundTrading.selectedTradeToItem = $data; }
                                     ">
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>

                        <hr>

                        <div class="row">
                            <div class="col-12 col-lg-3 font-weight-bold" data-bind="css: { 'text-danger': UndergroundTrading.tradeFromAmount > player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() }">
                                <label data-bind="text: UndergroundTrading.tradeFromAmount.toLocaleString('en-US')"></label>
                            </div>
                            <div class="col-12 col-lg-6">
                                <label data-bind="text: UndergroundTrading.selectedTradeFromItem.name"></label>
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeFromItem.image }'>
                                →
                                <img class='mineInventoryItem' data-bind='attr: {src: UndergroundTrading.selectedTradeToItem?.image || null }'>
                                <label data-bind="text: UndergroundTrading.selectedTradeToItem?.name || '???'"></label>
                            </div>
                            <div class="col-12 col-lg-3 font-weight-bold">
                                <label data-bind="text: UndergroundTrading.tradeAmount.toLocaleString('en-US')"></label>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="row">
                            <div class="col-12 col-lg-9 mb-2 mb-lg-0">
                                <div class="input-group">
                                    <button class="btn btn-warning btn-outline-dark smallButton smallFont" data-bind="click: () => UndergroundTrading.tradeAmount = 1">Reset</button>

                                    <input type="number" min="0" class="outline-dark form-control form-control-number" data-bind="textInput: UndergroundTrading.tradeAmount">

                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 10">
                                        +10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount *= 10">
                                        &times;10
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount /= 10">
                                        &div;10
                                    </button>
                                    <!-- /ko -->
                                    <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 100">
                                        +100
                                    </button>
                                    <button class="btn btn-secondary smallButton smallFont" type="button" onclick="UndergroundTrading.tradeAmount += 1000">
                                        +1,000
                                    </button>
                                    <!-- /ko -->

                                    <button class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                    <div class="dropdown-menu text-center p-0">
                                        <p class="small py-2 m-0">Set Trade Amount</p>
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [10, 100, 1000] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US')}`,
                                            click: () => { UndergroundTrading.tradeAmount = $data }
                                        "></button>
                                        <!-- /ko -->
                                        <div class="dropdown-divider m-0"></div>
                                        <!-- ko foreach: [0.1, 0.25, 0.5, 0.75, 1] -->
                                        <button class="dropdown-item small py-1" type="button" data-bind="
                                            text: `${$data.toLocaleString('en-US', { style: 'percent' })}`,
                                            click: () => { UndergroundTrading.tradeFromAmount = player.itemList[UndergroundTrading.selectedTradeFromItem.itemName]() * $data }
                                        "></button>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3">
                                <button class="btn btn-block btn-primary" data-bind="
                                    enable: UndergroundTrading.canTrade,
                                    click: () => UndergroundTrading.trade()
                                ">Trade</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div aria-labelledby="undergroundBatteryModalLabel" class="modal fade no-select" id="undergroundBatteryModal" role="dialog" style="cursor: default;" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="card mb-2">
                    <div class="card-header d-flex align-items-center p-0">
                        <span class="flex-grow-1 text-center font-weight-bold">Underground Battery Patterns</span>
                    </div>

                    <div class="card-body">
                        <table class="table table-hover table-striped table-sm m-0">
                            <thead>
                            <tr>
                                <th>Tier</th>
                                <th></th>
                                <th class="text-left">Name</th>
                                <th class="text-left">Requirements</th>
                                <th>Chance</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- ko foreach: App.game.underground.battery.patterns -->
                            <tr>
                                <td class="vertical-middle" data-bind="text: $data.tier"></td>
                                <td class="vertical-middle">
                                    <img width="24px" class="lock" src="assets/images/breeding/lock.svg" data-bind="
                                            tooltip: {
                                                title: $data.hint || '',
                                                placement: 'bottom',
                                                trigger: 'hover'
                                            }, visible: !$data.canAccess()" />
                                </td>
                                <td class="vertical-middle text-left" data-bind="text: $data.name"></td>
                                <td class="vertical-middle text-left" data-bind="text: !$data.canAccess() ? $data.hint : ''"></td>
                                <td class="vertical-middle" data-bind="text: $data.canAccess() ? ($data.weight / App.game.underground.battery.patterns.filter(p => p.canAccess()).reduce((prev, cur) => prev + cur.weight, 0)).toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '-'"></td>
                            </tr>
                            <!-- /ko -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="helpToolTemplate">
    <h6 class="d-flex align-items-center" style="gap: 0.5rem;">
        <img alt="" data-bind="attr: { src: `assets/images/underground/${UndergroundToolType[$data.tool.id]}.png` }">
        <knockout data-bind="text: $data.tool.displayName"></knockout>
    </h6>
    <ul>
        <li><strong>Action:</strong> <knockout data-bind="text: $data.action"></knockout></li>
        <li>
            <strong>Properties:</strong>
            <ul>
                <li><strong>Base Repair Rate:</strong> <knockout data-bind="text: $data.tool.restoreRateInSeconds"></knockout> seconds</li>
                <li><strong>Repair Rate Reduction per Level:</strong> <knockout data-bind="text: $data.tool.restoreRateReductionPerLevel"></knockout> seconds</li>
                <li><strong>Repair per Tick:</strong> <knockout data-bind="text: $data.tool.durabilityRestoreRate.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></li>
                <li><strong>Damage per Use:</strong> <knockout data-bind="text: $data.tool.durabilityPerUse.toLocaleString('en-US', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 })"></knockout></li>
            </ul>
        </li>
    </ul>
</script>


<!-- Pokedex Modal-->
<div class="modal fade noselect" id="pokedexModal" tabindex="-1" role="dialog"
aria-labelledby="pokedexModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-xl pokedex-modal" role="document">
        <div class="modal-content">

            <div class="modal-header p-lg-0 border-lg-0 position-relative">
                <h4 class="d-lg-none d-block" style="margin-bottom: 0">Pokédex</h4>
                <div class="row w-100 m-0 py-1 d-lg-flex d-none">
                    <div class="col-3">
                        <div class="pokedex-border-bottom pt-2">
                            <h4>Filters and Settings</h4>
                        </div>
                    </div>
                    <div class="col-9">
                        <!-- ko if: PokedexHelper.filteredList().length == 0 -->
                        <div class="pokedex-border-bottom pt-2">
                            <h4>No Pokémon found</h4>
                        </div>
                        <!-- /ko -->

                        <!-- ko if: PokedexHelper.filteredList().length != 0 -->
                        <div class="pokedex-border-bottom pt-2">
                            <h4 data-bind="text: `Showing ${PokedexHelper.filteredList().length.toLocaleString('en-US')} Pokémon`"></h4>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
                <button type="button" class="btn btn-danger position-absolute" data-dismiss="modal" style="right:0; top:0; font-size: 18px; font-weight: 700;">×</button>
            </div>

            <!-- ko let: { categoryModeEnabled: PokemonCategories.categoryAssignEnabled, categoryModeSelected: PokemonCategories.categoryAssignSelected } -->
            <div class="modal-body pt-0 overflow-hidden" style="background-color: inherit;">
                <div class="row">
                    <div class="col-12 d-lg-none d-block">
                        <button class="w-100 my-1 btn btn-secondary" type="button" data-toggle="collapse"
                                data-target="#pokedex-filter-container" aria-expanded="false" aria-controls="pokedex-filter-container">
                            Filters and Settings
                        </button>
                    </div>
                    <!-- Filters and Settings -->
                    <div class="col-lg-3 col-12 collapse dont-collapse-lg" id="pokedex-filter-container" style="background-color: inherit; top: 0; z-index: 100;">
                        <div class="pokedex-border-bottom pt-2 d-lg-none d-block">
                            <h4>Filters and Settings</h4>
                        </div>
                        <div class="scrolling-div-pokedex" style="margin-bottom: 0.5rem;">
                            <div class="container-fluid py-3">
                                <div class="form-row text-left">
                                    <!--Name or ID-->
                                    <div class="form-group col-lg-12 col-12">
                                        <label for="pokedex-filter-nameID">Name or ID</label>
                                        <input id="pokedex-filter-nameID" class="form-control" placeholder="Bulbasaur or 1"
                                            oninput="PokedexHelper.formatSearch(this.value)" data-bind="value: PokedexHelper.getSearchString()">
                                    </div>

                                    <!--Types-->
                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexType1Filter: Settings.getSetting('pokedexType1Filter') } -->
                                        <label>Types</label>
                                        <select id="pokedex-filter-type1" class="custom-select" style="margin-right: 8px"
                                                data-bind="options: pokedexType1Filter.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: pokedexType1Filter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>
                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexType2Filter: Settings.getSetting('pokedexType2Filter') } -->
                                        <label> </label>
                                        <select id="pokedex-filter-type2" class="custom-select"
                                                data-bind="options: pokedexType2Filter.options,
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: pokedexType2Filter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>

                                    <!--Region-->
                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexRegionFilter: Settings.getSetting('pokedexRegionFilter') } -->
                                        <label for="pokedex-filter-region" data-bind="text: pokedexRegionFilter.displayName">Region</label>
                                        <select id="pokedex-filter-region" class="custom-select" style="margin-right: 8px"
                                                data-bind="options: pokedexRegionFilter.getValidOptions(),
                                                        optionsValue: 'value',
                                                        optionsText: 'text',
                                                        value: pokedexRegionFilter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>

                                    <!-- Category -->
                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexCategoryFilter: Settings.getSetting('pokedexCategoryFilter') } -->
                                        <label for="pokedex-filter-category" data-bind="text: pokedexCategoryFilter.displayName">Category</label>
                                        <div class="dropdown show">
                                            <button id="pokedex-filter-category" type="button" class="text-left custom-select col-12 btn btn-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                data-bind="text: pokedexCategoryFilter.observableValue() == -1 ? 'All'
                                                    : pokedexCategoryFilter.observableValue() == -2 ? 'Categorized'
                                                    : PokemonCategories.categories().find(c => c.id == pokedexCategoryFilter.observableValue()).name()">
                                                Categories
                                            </button>
                                            <div class="border-secondary dropdown-menu col-12 category-dropdown">
                                                <div class="dropdown-item dropdown-text" data-bind="click : function() { pokedexCategoryFilter.set(-1) }">
                                                    All
                                                </div>
                                                <div class="dropdown-item dropdown-text" data-bind="click : function(){ Settings.setSettingByName('pokedexCategoryFilter', -2) }">
                                                    Categorized
                                                </div>
                                                <div class="dropdown-divider"></div>
                                                <!-- ko foreach : PokemonCategories.categories -->
                                                <div class="dropdown-item" data-bind="text : $data.name(), style: { color: GameHelper.isColorLight($data.color()) ? 'black' : 'white', background: $data.color() },
                                                    click : function() { pokedexCategoryFilter.set($data.id) }">
                                                </div>
                                                <!-- /ko-->
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item dropdown-text" href="#categoryModal" data-toggle="modal">
                                                    <i>Edit categories</i>
                                                </a>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </div>

                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexCaughtFilter: Settings.getSetting('pokedexCaughtFilter') } -->
                                        <label for="pokedex-filter-caught-status" data-bind="text: pokedexCaughtFilter.displayName">Caught Status</label>
                                        <select id="pokedex-filter-caught-status" autocomplete="off" class="custom-select"
                                            data-bind="options: pokedexCaughtFilter.getValidOptions(),
                                                    optionsValue: 'value',
                                                    optionsText: 'text',
                                                    value: pokedexCaughtFilter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>

                                    <div class="form-group col-lg-6 col-6">
                                        <!-- ko let: { pokedexPokerusFilter: Settings.getSetting('pokedexPokerusFilter') } -->
                                        <label for="pokedex-filter-pokerus-status" data-bind="text: pokedexPokerusFilter.displayName">Pokérus Status</label>
                                        <select id="pokedex-filter-pokerus-status" autocomplete="off" class="custom-select"
                                            data-bind="options: pokedexPokerusFilter.options,
                                                    optionsValue: 'value',
                                                    optionsText: 'text',
                                                    value: pokedexPokerusFilter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>

                                    <!-- Mega Evolution -->
                                    <!-- ko if: Settings.getSetting('pokedexUniqueTransformationFilter').isUnlocked() -->
                                    <div class="form-group col-lg-12 col-12">
                                        <!-- ko let: { pokedexUniqueTransformationFilter: Settings.getSetting('pokedexUniqueTransformationFilter') } -->
                                        <label for="pokedex-filter-unique-transformation" data-bind="text: pokedexUniqueTransformationFilter.displayName">Unique Transformations</label>
                                        <select id="pokedex-filter-unique-transformation" autocomplete="off" class="custom-select"
                                            data-bind="options: pokedexUniqueTransformationFilter.options,
                                                optionsValue: 'value',
                                                optionsText: 'text',
                                                value: pokedexUniqueTransformationFilter.observableValue">
                                        </select>
                                        <!-- /ko -->
                                    </div>
                                    <!-- /ko -->

                                    <!--Rare Hold Item-->
                                    <div class="col-12">
                                        <div class="form-group my-2">
                                            <!-- ko let: { pokedexHeldItemFilter: Settings.getSetting('pokedexHeldItemFilter') } -->
                                            <label for="pokedex-filter-held-item" data-bind="text: pokedexHeldItemFilter.displayName">Rare Held Item</label>
                                            <span class="mx-1"
                                                data-bind="tooltip: {
                                                    title: 'Shows Pokémon with a chance to drop an item',
                                                    trigger: 'hover',
                                                    boundary: 'window'
                                                }" data-original-title="" title="">ⓘ</span>
                                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                                <input class="form-check-input" type="checkbox" id="pokedex-filter-held-item"
                                                    data-bind="checked: pokedexHeldItemFilter.observableValue">
                                                <div class="toggler-slider">
                                                    <div class="toggler-knob"></div>
                                                </div>
                                            </label>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                    <!--Hide alternate forms-->
                                    <div class="col-12">
                                        <div class="form-group my-2">
                                            <!-- ko let: { pokedexHideAltFilter: Settings.getSetting('pokedexHideAltFilter') } -->
                                            <label for="pokedex-filter-hide-alternate" data-bind="text: pokedexHideAltFilter.displayName">Hide alternate forms</label>
                                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                                <input class="form-check-input" type="checkbox" id="pokedex-filter-hide-alternate"
                                                    data-bind="checked: pokedexHideAltFilter.observableValue">
                                                <div class="toggler-slider">
                                                    <div class="toggler-knob"></div>
                                                </div>
                                            </label>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <hr style="border-color:grey;">
                                    </div>

                                    <!--Hide shiny images-->
                                    <div class="col-12">
                                        <div class="form-group my-2">
                                            <!-- ko let: { partyHideShinySprites: Settings.getSetting('partyHideShinySprites') } -->
                                            <span data-bind="text: partyHideShinySprites.displayName">Hide party shiny sprites</span>
                                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                                <input class="form-check-input" type="checkbox" id="pokedex-hide-shiny-sprites-checkbox"
                                                    value="false" data-bind="checked: partyHideShinySprites.observableValue"
                                                    onchange="Settings.setSettingByName('partyHideShinySprites', this.checked)">
                                                <div class="toggler-slider">
                                                    <div class="toggler-knob"></div>
                                                </div>
                                            </label>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                    <!--Show shadow images-->
                                    <div class="col-12">
                                        <div class="form-group my-2">
                                            <!-- ko let: { partyShowShadowSprites: Settings.getSetting('partyShowPurifiedShadowSprites') } -->
                                            <span data-bind="text: partyShowShadowSprites.displayName">Show party shadow sprites</span>
                                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                                <input class="form-check-input" type="checkbox" id="pokedex-show-shadow-sprites-checkbox"
                                                    value="false" data-bind="checked: partyShowShadowSprites.observableValue"
                                                    onchange="Settings.setSettingByName('partyShowPurifiedShadowSprites', this.checked)">
                                                <div class="toggler-slider" data-bind="tooltip: {
                                                    html: true,
                                                    title: `Display all purified Pokémon with their shadow sprites.`,
                                                    trigger: 'hover',
                                                }">
                                                    <div class="toggler-knob"></div>
                                                </div>
                                            </label>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <hr style="border-color:grey;">
                                    </div>

                                    <!-- Category Mode -->
                                    <div class="col-12">
                                        <div class="form-group">
                                            <button type="button" class="btn btn-primary btn-block" data-bind="
                                                click: () => categoryModeEnabled(!categoryModeEnabled()),
                                                text: categoryModeEnabled() ? 'Disable Category Mode' : 'Enable Category Mode',
                                                tooltip: {
                                                    title: 'Use Category Mode to quickly assign and remove Pokémon from categories. Select a category then click the desired Pokémon to add or remove.',
                                                    placement: 'top',
                                                    trigger: 'hover'
                                                }">
                                                Enable Category Mode
                                            </button>
                                        </div>
                                    </div>
                                    <!-- ko if: categoryModeEnabled() -->
                                    <div class="col-12">
                                        <div class="form-group mb-1">
                                            <label>Selected Category</label>
                                            <div class="dropdown show">
                                                <button type="button" class="text-left custom-select col-12 btn btn-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                    data-bind="text: PokemonCategories.categories().find(c => c.id == categoryModeSelected()).name()">
                                                    Select A Category
                                                </button>
                                                <div class="border-secondary dropdown-menu col-12 category-dropdown" data-bind="foreach: PokemonCategories.categories">
                                                    <div class="dropdown-item" data-bind="text : $data.name(),
                                                        style: { color: GameHelper.isColorLight($data.color()) ? 'black' : 'white', background: $data.color() },
                                                        click: () => categoryModeSelected($data.id)">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group col-6">
                                        <button type="button" class="btn btn-success btn-block" data-bind="tooltip: {
                                            title: 'Add all Pokémon matching the current filters to this category.',
                                            placement: 'bottom',
                                            trigger: 'hover'
                                        },
                                        click: () => PartyController.addCategory(PokedexHelper.filteredListPartyPokemon(), categoryModeSelected())">Add All</button>
                                    </div>
                                    <div class="form-group col-6">
                                        <button type="button" class="btn btn-danger btn-block" data-bind="tooltip: {
                                            title: 'Remove all Pokémon matching the current filters from this category.',
                                            placement: 'bottom',
                                            trigger: 'hover'
                                        },
                                        disable: categoryModeSelected() === 0,
                                        click: () => PartyController.removeCategory(PokedexHelper.filteredListPartyPokemon(), categoryModeSelected())">Remove All</button>
                                    </div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pokemon List -->
                    <div class="col-lg-9 col-12 pokemon-list" id="pokedex-pokemon-list-container">
                        <!-- ko if: PokedexHelper.filteredList().length == 0 -->
                        <div class="pokedex-border-bottom pt-2 d-lg-none d-block">
                            <h4>No Pokémon found</h4>
                        </div>
                        <!-- /ko -->

                        <!-- ko if: PokedexHelper.filteredList().length != 0 -->
                        <div class="pokedex-border-bottom pt-2 d-lg-none d-block">
                            <h4 data-bind="text: `Showing ${PokedexHelper.filteredList().length.toLocaleString('en-US')} Pokémon`"></h4>
                        </div>
                        <!-- /ko -->
                        <div class="scrolling-div-pokedex">
                            <!-- ko if: PokedexHelper.filteredList().length == 0 -->
                            <div class="mt-1">
                                <span>Missing a Pokémon but don't see it here? Be sure to completely explore the region!</span>
                            </div>
                            <!-- /ko -->
                            <knockout data-bind="let: { lazyPokedexList: lazyLoad('lazyPokedexList', $element, PokedexHelper.filteredList, { pageSize: 60, reset: PokedexHelper.resetPokedexFlag }) }">
                                <!-- ko if: DisplayObservables.modalState.pokedexModal !== 'hidden' -->
                                <ul class="row justify-content-center w-100 p-0 m-0" data-bind="foreach: lazyPokedexList, childrenComplete: () => { lazyLoadCallback('lazyPokedexList'); }">
                                    <li class="col-sm-4 col-md-3 col-lg-2 pokedexEntry" data-bind="style:{background: PokedexHelper.getBackgroundColors($data.name)},
                                        css: { 'category-highlight': categoryModeEnabled() && App.game.party.getPokemon($data.id)?.category.includes(categoryModeSelected()) }">
                                        <span class="id pokedex-top-text" data-bind="text: ($data.id > 0 ? Math.floor($data.id) + '' : '???').padStart(3, 0)">number</span>
                                        <div data-bind="visible: App.game.party.alreadyCaughtPokemonByName(name)" style="position: absolute;right: 2px;top: -15px;">
                                            <img width="18px" src="" data-bind="attr: { src: `assets/images/pokeball/Pokeball${App.game.party.alreadyCaughtPokemon($data.id, true) ? '-shiny' : ''}.svg`}"/>
                                        </div>
                                        <!-- ko if: App.game.party.alreadyCaughtPokemonByName(name) -->
                                            <div data-bind="if: App.game.party.getPokemon($data.id)?.pokerus" style="position: absolute;left: 2px;top: -11px;">
                                                <img width="32px" src="" data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[App.game.party.getPokemon($data.id)?.pokerus]}.png`}"/>
                                            </div>
                                            <!-- ko if: PokemonHelper.hasMegaEvolution($data.name) -->
                                            <knockout data-bind="foreach: PokemonHelper.getMegaStones($data.name).filter(s => player.hasMegaStone(s.megaStone))">
                                                <img width="20px" style="position: absolute; top: 4px;"
                                                    data-bind="attr: { src: $data.image }, style: { right: `${1 + 17 * $index()}px` }"/>
                                            </knockout>
                                            <!-- /ko -->
                                            <img style="position: absolute; top: 24px; right: 0px;" class="shadow-icon" src="assets/images/status/shadow.svg" data-bind="visible: App.game.party.getPokemon($data.id).shadow == GameConstants.ShadowStatus.Shadow"/>
                                            <img style="position: absolute; top: 24px; right: 0px;" class="shadow-icon" src="assets/images/status/purified.svg" data-bind="visible: App.game.party.getPokemon($data.id).shadow == GameConstants.ShadowStatus.Purified"/>
                                        <!-- /ko -->
                                        <img src="" class="pokedex-pokemon-sprite" data-bind="css: { 'pokemon-not-seen': !PokedexHelper.pokemonSeen($data.id)(), 'pokemon-seen-but-not-caught': !App.game.party.alreadyCaughtPokemonByName(name) && PokedexHelper.pokemonSeen($data.id)() }, attr:{ src: PokemonHelper.getImage($data.id)}">
                                        <!-- ko if: PokedexHelper.pokemonSeen($data.id) -->
                                            <a class="overlay" href="#pokemonStatisticsModal" data-toggle="modal" data-bind="
                                                click: (_, event) => {
                                                    if (categoryModeEnabled()) {
                                                        App.game.party.getPokemon($data.id)?.toggleCategory(categoryModeSelected());
                                                        event.stopPropagation(); // prevent statistics modal from opening
                                                    } else {
                                                        App.game.statistics.selectedPokemonID($data.id);
                                                    }
                                                },
                                                tooltip: {
                                                    html: true,
                                                    title: categoryModeEnabled() ? '' : `<u>Information:</u>
                                                        <br/>Base Attack: <strong>${$data.attack}</strong>
                                                        <br/>Catch Rate: <strong>${PokemonFactory.catchRateHelper($data.catchRate, true)}%</strong>
                                                        <br/>Hatch Steps: <strong>${App.game.party.getPokemon($data.id)?.getEggSteps().toLocaleString('en-US') || 'Unknown'}</strong>` +
                                                        (App.game.party.getPokemon($data.id)?.pokerus >= GameConstants.Pokerus.Contagious ?
                                                            `<br/>EVs: <strong>${App.game.party.getPokemon($data.id).evs().toLocaleString('en-US')}</strong>
                                                            <br/>EV bonus: <strong>×${App.game.party.getPokemon($data.id).calculateEVAttackBonus().toLocaleString('en-US')}</strong>`
                                                            : '') +
                                                        (PokemonHelper.hasMegaEvolution($data.name) ?
                                                            pokemonMap[$data.name].evolutions.flatMap(e => e.restrictions).filter(r => r instanceof MegaEvolveRequirement && player.hasMegaStone(r.megaStone))
                                                                .map(r => `<br/><u>${GameConstants.humanifyString(GameConstants.MegaStoneType[r.megaStone])}</u><br/>${r.hint()}`).join('')
                                                            : ''),
                                                    trigger: 'hover',
                                                    placement:'bottom'
                                                }"></a>

                                            <span class="pokedex-bottom-text text-truncate px-1" data-bind="text: PokemonHelper.displayName($data.name),
                                                tooltip: {
                                                    title: categoryModeEnabled() ? '' : PokemonHelper.displayName($data.name),
                                                    trigger: 'hover',
                                                    placement: 'bottom'
                                                }">name</span>

                                            <!-- Category Button -->
                                            <!-- ko if: App.game.party.alreadyCaughtPokemonByName($data.name) -->
                                            <div class="pokemonCategory dropdown" data-bind="let: { pokemon: App.game.party.getPokemon($data.id) }">
                                                <div data-toggle="dropdown" style="height: 15px;">
                                                    <!-- Limit category display to 12 for UI purposes -->
                                                    <div class="d-flex position-relative category-display" data-bind="foreach: pokemon.category.slice(0, 12)">
                                                        <button data-bind="class: `category-${$data + 1}`"></button>
                                                    </div>
                                                </div>
                                                <div class="border-secondary dropdown-menu multiselect-dropdown category-dropdown px-1">
                                                    <div class="form-check d-flex align-items-center", data-bind="with: PokemonCategories.categories().find(c => c.id === 0), as: 'pokemonCategory'">
                                                        <input type="checkbox" class="form-check-input mt-0" style="cursor: pointer;"
                                                            data-bind="attr: { id: `${$parent.id}-category0` },
                                                                checked: pokemon.isUncategorized,
                                                                disable: pokemon.isUncategorized,
                                                                click: () => { pokemon.resetCategory(); return true; }">
                                                        <label class="form-check-label text-truncate w-100 p-1" style="max-width: 200px; cursor: pointer;"
                                                            data-bind="
                                                                text: pokemonCategory.name,
                                                                attr: { for: `${$parent.id}-category0` },
                                                                style: { color: GameHelper.isColorLight(pokemonCategory.color()) ? 'black' : 'white', background: pokemonCategory.color, 'text-shadow': `0 0 6px ${GameHelper.isColorLight(pokemonCategory.color()) ? 'white' : 'black'}` }"
                                                            onclick="event.stopPropagation();"></label>
                                                    </div>
                                                    <div class="dropdown-divider"></div>
                                                    <!-- ko foreach: { data: PokemonCategories.playerCategories, as: 'pokemonCategory' } -->
                                                    <div class="form-check d-flex align-items-center">
                                                        <input type="checkbox" class="form-check-input mt-0" style="cursor: pointer;"
                                                            data-bind="
                                                                attr: { id: `${$parent.id}-category${pokemonCategory.id}` },
                                                                checked: pokemon._category,
                                                                checkedValue: pokemonCategory.id">
                                                        <label class="form-check-label text-truncate w-100 p-1" style="max-width: 200px; cursor: pointer;"
                                                            data-bind="
                                                                text: pokemonCategory.name,
                                                                attr: { for: `${$parent.id}-category${pokemonCategory.id}` },
                                                                style: { color: GameHelper.isColorLight(pokemonCategory.color()) ? 'black' : 'white', background: pokemonCategory.color, 'text-shadow': `0 0 6px ${GameHelper.isColorLight(pokemonCategory.color()) ? 'white' : 'black'}` }"
                                                            onclick="event.stopPropagation();"></label>
                                                    </div>
                                                    <!-- /ko -->
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item dropdown-text" href="#categoryModal" data-toggle="modal">
                                                        <i>Edit categories</i>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- /ko -->
                                        <!-- /ko -->
                                    </li>
                                </ul>
                                <!-- /ko -->
                            </knockout>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
            <!--
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
            -->
        </div>
    </div>
</div>


<!-- Statistics Modal-->
<div class="modal noselect fade" id="pokemonStatisticsModal" tabindex="-1" role="dialog" aria-labelledby="pokemonStatisticsModal">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal modal-sm" role="document">
    <div class="modal-content" data-bind="with: App.game.statistics.selectedPokemonID()">
      <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
        <h5 class="modal-title text-muted"
          data-bind="text: `#${pokemonMap[$data].id <= 0 ? '???' : Math.floor(pokemonMap[$data].id).toString().padStart(3,0)}&nbsp;&nbsp;`">
        </h5>
        <h5 class="modal-title text-light" data-bind="text: PokemonHelper.displayName(pokemonMap[$data].name)">Pokémon Statistics</h5>&nbsp;
        <h5 class="modal-title text-light ml-1" data-bind="if: App.game.party.getPokemon(pokemonMap[$data].id)">
          <img width="18px" src=""
            data-bind="attr: { src: `assets/images/pokeball/Pokeball${App.game.party.alreadyCaughtPokemon(pokemonMap[$data].id, true) ? '-shiny' : ''}.svg` }" />
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0 pb-1">
        <div class="row m-0 mt-1">
          <div class="col">
            <img data-bind="attr:{ src: PokemonHelper.getImage(pokemonMap[$data].id) }" src=""/>
            <div class="position-absolute" style="top: 0px; right: 15px;"
              data-bind="if: App.game.party.getPokemon(pokemonMap[$data].id)?.pokerus">
              <img width="40px" src=""
                data-bind="attr: { src: `assets/images/breeding/pokerus/${GameConstants.Pokerus[App.game.party.getPokemon(pokemonMap[$data].id)?.pokerus]}.png`}" />
            </div>
          </div>
        </div>
        <div class="row m-0 mt-2">
          <div class="col-12 col-lg-6">
            <table class="table table-striped table-hover table-bordered table-sm m-0 mb-2">
              <thead>
                <tr class="bg-secondary">
                  <th colspan="2">Pokémon Stats</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left">Type</td>
                  <td class="text-left tight">
                      <span class="badge text-light text-uppercase px-1" style="line-height: normal; text-shadow: 0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black;" data-bind="visible: pokemonMap[$data].type[0] >= 0, style: { 'background-color': GameConstants.TypeColor[pokemonMap[$data].type[0]] }">
                          <small><strong data-bind="text: PokemonType[pokemonMap[$data].type[0]]"></strong></small>
                      </span>
                      <span class="badge text-light text-uppercase px-1" style="line-height: normal; text-shadow: 0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black;" data-bind="visible: pokemonMap[$data].type[1] >= 0, style: { 'background-color': GameConstants.TypeColor[pokemonMap[$data].type[1]] }">
                          <small><strong data-bind="text: PokemonType[pokemonMap[$data].type[1]]"></strong></small>
                      </span>
                  </td>
                </tr>
                <tr>
                  <td class="text-left">Base Attack</td>
                  <td class="text-left tight"><code
                      data-bind="text: pokemonMap[$data].attack.toLocaleString('en-US')">-</code></td>
                </tr>
                <tr>
                  <td class="text-left">Current Attack</td>
                  <td class="text-left tight"><code
                      data-bind="text: (App.game.party.getPokemon($data) ? App.game.party.getPokemon($data).attack : 0).toLocaleString('en-US')">-</code>
                  </td>
                </tr>
                <!-- ko if : App.game.party.getPokemon($data) && App.game.party.getPokemon($data).level != 100 -->
                <tr>
                  <td class="text-left">Attack at level 100</td>
                  <td class="text-left tight"><code
                      data-bind="text: App.game.party.getPokemon($data).calculateAttack(true).toLocaleString('en-US')">-</code>
                  </td>
                </tr>
                <!-- /ko -->
                <!-- ko if: App.game.party.getPokemon($data)?.pokerus -->
                <tr>
                  <td class="text-left">EVs</td>
                  <td class="text-left tight">
                    <code>
                      <span data-bind="text: App.game.party.getPokemon($data).calculateEVs().toLocaleString('en-US')">-</span>
                    </code>
                  </td>
                </tr>
                <tr>
                  <td class="text-left">EV bonus</td>
                  <td class="text-left tight"><code
                      data-bind="text: '×' + App.game.party.getPokemon($data).calculateEVAttackBonus().toLocaleString('en-US')">-</code>
                  </td>
                </tr>
                <!-- /ko -->
                <tr>
                  <td class="text-left">Catch Rate</td>
                  <td class="text-left tight"><code
                      data-bind="text: PokemonFactory.catchRateHelper(pokemonMap[$data].catchRate, true) + '%'">-</code>
                  </td>
                </tr>
                <tr>
                  <td class="text-left">Hatch Steps</td>
                  <td class="text-left tight"><code
                      data-bind="text: App.game.party.getPokemon($data)?.getEggSteps().toLocaleString('en-US') || 'Unknown'">-</code>
                  </td>
                </tr>
                <!-- ko if: App.game.party.alreadyCaughtPokemon($data) -->
                <tr>
                  <td class="text-left">Breeding Efficiency</td>
                  <td class="text-left tight"><code
                      data-bind="text: SortOptionConfigs[SortOptions.breedingEfficiency].getValue(App.game.party.getPokemon(pokemonMap[$data].id)).toLocaleString('en-US', { maximumFractionDigits: 3 })"></code>
                  </td>
                </tr>
                <!-- /ko -->
                <!-- ko if: BagHandler.displayName(pokemonMap[$data].heldItem) -->
                <tr>
                  <td class="text-left align-middle" data-bind="tooltip: {
                    title: 'Item this Pokémon has a chance to drop upon being defeated.',
                    placement: 'bottom',
                    trigger: 'hover'
                  }">Rare Hold Item</td>
                  <td class="text-left tight text-wrap">
                    <code data-bind="text: BagHandler.displayName(pokemonMap[$data].heldItem)"></code>
                    <!-- ko ifnot: pokemonMap[$data].heldItem.requirement?.isCompleted() ?? true -->
                    <span class="small" data-bind="tooltip: {
                        title: pokemonMap[$data].heldItem.requirement.hint(),
                        placement: 'bottom',
                        trigger: 'hover'
                    }">🔒</span>
                    <!-- /ko -->
                  </td>
                </tr>
                <!-- /ko -->
                <tr>
                  <td class="text-left align-middle">Gender Ratio</td>
                  <td class="text-justify tight">
                    <!-- ko if: pokemonMap[$data].gender.type === GameConstants.Genders.Genderless -->
                    <code>Genderless</code>
                    <!-- /ko -->
                    <!-- ko if: pokemonMap[$data].gender.type != GameConstants.Genders.Genderless -->
                    <code
                      data-bind="text: '♂: ' + PokedexHelper.getGenderRatioData(pokemonMap[$data]).male + '%'"></code>
                    <br />
                    <code
                      data-bind="text: '♀: ' + PokedexHelper.getGenderRatioData(pokemonMap[$data]).female + '%'"></code>
                    <!-- /ko -->
                  </td>
                </tr>
                <!-- ko if: App.game.party.alreadyCaughtPokemon($data) -->
                <tr>
                  <td class="text-left align-middle">Held Item</td>
                  <td class="text-left tight text-wrap"><code
                      data-bind="text: App.game.party.getPokemon($data).heldItem()?.displayName || '-'"></code></td>
                </tr>
                <!-- ko if: !App.game.challenges.list.disableVitamins.active() -->
                <tr data-bind="tooltip: {
                  html: true,
                  title: Object.entries(App.game.party.getPokemon($data).vitaminsUsed)
                      .map(([v, amt]) => `<u>${GameConstants.VitaminType[v]}</u>: ${amt()}`).join('<br/>'),
                  placement: 'top',
                  trigger: 'hover',
                }">
                <td class="text-left">Vitamins Applied</td>
                <td class="text-left tight">
                  <code data-bind="text: `${App.game.party.getPokemon($data).totalVitaminsUsed().toLocaleString('en-US')}/${((player.highestRegion() + 1) * 5).toLocaleString('en-US')}`">-</code>
                </td>
              </tr>
              <!-- /ko -->
                <tr>
                  <td colspan="2" class="text-left tight">
                    <input type="text" class="form-control" placeholder="Nickname"
                      data-bind="value: App.game.party.getPokemon($data).nickname" />
                  </td>
                </tr>
                <!-- ko if: pokemonMap[$data].gender.visualDifference -->
                <tr>
                  <td class="text-left align-middle">Display Gender</td>
                  <td class="text-left tight">
                    <label class="form-check-label toggler-wrapper style-1 gender-toggle float-left">
                      <input class="form-check-input" type="checkbox" id="" value="false"
                        data-bind="checked: App.game.party.getPokemon($data).defaultFemaleSprite">
                      <div class="toggler-slider">
                        <div class="toggler-knob"></div>
                      </div>
                    </label>
                  </td>
                </tr>
                <!-- /ko -->
                <!-- ko if: App.game.party.getPokemon($data)?.shiny -->
                <tr>
                  <td class="text-left align-middle text-nowrap">Hide Shiny Sprite</td>
                  <td class="text-left tight">
                    <label class="form-check-label toggler-wrapper style-1 float-left">
                      <input class="form-check-input" type="checkbox" id="" value="false"
                        data-bind="checked: App.game.party.getPokemon($data).hideShinyImage">
                      <div class="toggler-slider" data-bind="tooltip: {
                        html: true,
                        title: Settings.getSetting('partyHideShinySprites').observableValue() ?
                            `<strong><u>${Settings.getSetting('partyHideShinySprites').displayName}</u></strong> is currently overriding this setting.` : '',
                        trigger: 'hover',
                      }">
                        <div class="toggler-knob"></div>
                      </div>
                    </label>
                  </td>
                </tr>
                <!-- /ko -->
                <!-- ko if: App.game.party.getPokemon($data)?.shadow == GameConstants.ShadowStatus.Purified -->
                <tr>
                  <td class="text-left align-middle text-nowrap">Show Shadow</td>
                  <td class="text-left tight">
                    <label class="form-check-label toggler-wrapper style-1 float-left">
                      <input class="form-check-input" type="checkbox" id="" value="false"
                        data-bind="checked: App.game.party.getPokemon($data).showShadowImage">
                      <div class="toggler-slider" data-bind="tooltip: {
                        html: true,
                        title: Settings.getSetting('partyShowPurifiedShadowSprites').observableValue() ?
                            `<strong><u>${Settings.getSetting('partyShowPurifiedShadowSprites').displayName}</u></strong> is currently overriding this setting.` : '',
                        trigger: 'hover',
                      }">
                        <div class="toggler-knob"></div>
                      </div>
                    </label>
                  </td>
                </tr>
                <!-- /ko -->
                <!-- /ko -->
              </tbody>
            </table>
          </div>
          <div class="col col-lg-6">
            <table class="table table-striped table-hover table-bordered table-sm m-0 mb-2">
              <thead>
                <tr class="bg-secondary">
                  <th colspan="2">Statistics</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left align-middle">Encountered</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.pokemonEncountered[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.malePokemonEncountered[$data](),
                                      'femaleStat': App.game.statistics.femalePokemonEncountered[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Defeated</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.pokemonDefeated[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.malePokemonDefeated[$data](),
                                      'femaleStat': App.game.statistics.femalePokemonDefeated[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Captured</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.pokemonCaptured[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.malePokemonCaptured[$data](),
                                      'femaleStat': App.game.statistics.femalePokemonCaptured[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Hatched</td>
                  <td class="text-left align-middle tight position-relative">
                    <code data-bind="text: App.game.statistics.pokemonHatched[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.malePokemonHatched[$data](),
                                      'femaleStat': App.game.statistics.femalePokemonHatched[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Shinies Encountered</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.shinyPokemonEncountered[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.shinyMalePokemonEncountered[$data](),
                                      'femaleStat': App.game.statistics.shinyFemalePokemonEncountered[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Shinies Defeated</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.shinyPokemonDefeated[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.shinyMalePokemonDefeated[$data](),
                                      'femaleStat': App.game.statistics.shinyFemalePokemonDefeated[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Shinies Captured</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.shinyPokemonCaptured[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.shinyMalePokemonCaptured[$data](),
                                      'femaleStat': App.game.statistics.shinyFemalePokemonCaptured[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left align-middle">Shinies Hatched</td>
                  <td class="text-left align-middle tight position-relative">
                    <code
                      data-bind="text: App.game.statistics.shinyPokemonHatched[$data]().toLocaleString('en-US')">-</code>
                    <!-- Gender Statistics -->
                    <!-- ko if: pokemonMap[$data].gender.type == GameConstants.Genders.MaleFemale && pokemonMap[$data].gender.femaleRatio != 0 && pokemonMap[$data].gender.femaleRatio != 1 -->
                    <knockout data-bind="template: {
                                  name: 'pokemonGenderStatisticTemplate',
                                  data: {
                                      'maleStat': App.game.statistics.shinyMalePokemonHatched[$data](),
                                      'femaleStat': App.game.statistics.shinyFemalePokemonHatched[$data](),
                                  }
                              }">Pokémon gender statistic</knockout>
                    <!-- /ko -->
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- ko if : App.game.party.getPokemon($data) -->
            <table class="table table-striped table-hover table-bordered table-sm m-0 mb-2" data-bind="visible: false">
              <thead>
                <tr class="bg-secondary">
                  <th colspan="2">Contest Stats</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="2" class="text-center">
                    <span>Contest Condition</span>
                    <span data-bind="visible: pokemonMap[$data].contestTypes.length != App.game.party.getPokemon($data).currentContestTypes.length || !App.game.party.getPokemon($data).currentContestTypes.every(ct => pokemonMap[$data].contestTypes.includes(ct)),
                    tooltip: {
                      title: `<u>Default Contest Types:</u><br/>${Object.values(pokemonMap[$data].contestTypes)
                          .map((v) => `${ContestType[v]}`).join('<br/>')}`,
                      trigger: 'hover',
                      placement:'top',
                      html: true,
                    }">ⓘ</span>
                  </td>
                </tr>
                <tr>
                  <td colspan="2" class="text-center tight" style="line-height: normal;">
                    <!-- ko foreach: GameHelper.enumNumbers(ContestType) -->
                    <!-- ko if: $data == ContestType.Balanced -->
                      <br />
                    <!-- /ko -->
                    <span class="badge text-light px-1" data-bind="
                                style: {
                                  'background-color': GameConstants.ContestColor[$data],
                                  'text-shadow': ContestHelper.getPokemonContestTypes($parent).includes($data) ? '0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black' : '',
                                  'opacity': ContestHelper.getPokemonContestTypes($parent).includes($data) ? '1' : '0.2',
                                }">
                      <small><strong
                        data-bind="text: ContestType[$data].toUpperCase()" style="color: white"></strong></small>
                    </span>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td class="text-left">Contest Appeal</td>
                  <td class="text-left tight"><code
                    data-bind="text: (App.game.party.getPokemon($data) ? App.game.party.getPokemon($data).contestAppeal : 0).toLocaleString('en-US')">-</code>
                  </td>
                </tr>
                <tr data-bind="
                  tooltip: {
                    title: App.game.party.getPokemon($data).maxSheenTooltip,
                    trigger: 'hover',
                  }">
                  <td class="text-left">Contest Sheen</td>
                  <td class="text-left tight" data-bind="if: App.game.party.getPokemon(pokemonMap[$data].id)"><code
                    data-bind="text: (App.game.party.getPokemon($data) ? App.game.party.getPokemon($data).contestSheen() : 0) + '%'">-</code>
                  </td>
                </tr>
              </tbody>
            </table>
            <!-- /ko -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Expanded Vitamin Modal -->
<div class="modal noselect fade" id="pokemonVitaminExpandedModal" tabindex="-1" role="dialog" aria-labelledby="pokemonVitaminExpandedModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
                <h5 class="modal-title text-light">Vitamins</h5>&nbsp; <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <div class="sticky-top bg-dark text-light pt-2">
                    <!-- ko if: App.game.challenges.list.disableVitamins.active() -->
                    <span class="btn btn-block btn-danger btn-static m-0">Vitamins are disabled.</span>
                    <!-- /ko -->
                    <div class="form-row m-0" id="multivitamin-filters">
                        <div class="form-group col-6 col-lg-4 m-0 p-0">
                            <label for="multivitamin-search">Search</label>
                            <input id="multivitamin-search" autocomplete="off" class="form-control" placeholder="Search here" data-bind="textInput: Settings.getSetting('vitaminSearchFilter').observableValue" />
                        </div>
                        <div class="form-group col-6 col-lg-2 m-0 p-0">
                            <!-- ko let: { vitaminRegionFilter: Settings.getSetting('vitaminRegionFilter') } -->
                            <label for="multivitamin-region-filter">Region</label>
                            <select id="multivitamin-region-filter" autocomplete="off" class="custom-select"
                                data-bind="options: vitaminRegionFilter.getValidOptions(),
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: vitaminRegionFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                        <div class="form-group col-6 col-lg-2 m-0 p-0">
                            <!-- ko let: { vitaminTypeFilter: Settings.getSetting('vitaminTypeFilter') } -->
                            <label for="multivitamin-type-filter">Type</label>
                            <select id="multivitamin-type-filter" autocomplete="off" class="custom-select"
                                data-bind="options: vitaminTypeFilter.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: vitaminTypeFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                        <div class="form-group col-6 col-lg-4 m-0 p-0">
                            <label>Order</label>
                            <div class="input-group">
                                <!-- ko let: { vitaminSort: Settings.getSetting('vitaminSort') } -->
                                <select id="multivitamin-sort" autocomplete="off" class="custom-select"
                                    data-bind="options: vitaminSort.options,
                                        optionsValue: 'value',
                                        optionsText: 'text',
                                        value: vitaminSort.observableValue">
                                </select>
                                <!-- /ko -->
                                <!-- ko let: { vitaminSortDirection: Settings.getSetting('vitaminSortDirection') } -->
                                <div class="input-group-append bg-primary text-light">
                                    <label for="multivitamin-sort-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;" data-bind="
                                    text: vitaminSortDirection.observableValue() ? '⥄' : '⥂',
                                    tooltip: {
                                        title: vitaminSortDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                        trigger: 'hover',
                                        placement:'top',
                                    }">⥂</label>
                                    <input id="multivitamin-sort-direction" style="vertical-align: middle" class="hidden" type="checkbox" data-bind="checked: vitaminSortDirection.observableValue" />
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>

                    <div class="form-row m-0 mt-1 align-items-center">
                        <div class="col-12 col-lg-8 text-center text-lg-left">
                            <div class="form-check form-check-inline align-middle">
                                <input type="checkbox" id="multivitamin-hide-maxed-pokemon" class="form-check-input" data-bind="checked: Settings.getSetting('vitaminHideMaxedPokemon').observableValue" />
                                <label for="multivitamin-hide-maxed-pokemon" class="form-check-label">Hide Pokémon with max vitamins</label>
                            </div>
                            <div class="form-check form-check-inline align-middle">
                                <input type="checkbox" id="multivitamin-hide-shiny-pokemon" class="form-check-input" data-bind="checked: Settings.getSetting('vitaminHideShinyPokemon').observableValue" />
                                <label for="multivitamin-hide-shiny-pokemon" class="form-check-label">Hide shiny Pokémon</label>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 text-center text-lg-right p-0">
                            <div class="btn-group btn-group-toggle">
                                <!-- ko foreach: VitaminController.multiplier -->
                                <label class="btn btn-secondary" data-bind="css: { active: VitaminController.multiplierIndex() == $index() }">
                                    <input type="radio" name="vitaminAmount"
                                        data-bind="value: $index(), checked: VitaminController.multiplierIndex()"
                                        onchange="VitaminController.multiplierIndex(+this.value)">
                                    <knockout data-bind="text: $data"></knockout>
                                </label>
                                <!-- /ko -->
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown"></button>
                                    <div class="dropdown-menu">
                                        <!-- ko foreach: GameHelper.enumNumbers(GameConstants.VitaminType) -->
                                        <a class="dropdown-item" href="#" data-bind="text: `Remove All ${GameConstants.VitaminType[$data]}`, click: () => { PartyController.removeVitaminFromParty($data) }"></a>
                                        <!-- /ko -->
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#" data-bind="click: () => { PartyController.removeAllVitaminsFromParty() }">Remove ALL Vitamins</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-responsive" style="overflow-y: hidden;">
                    <table class="table table-striped table-hover table-bordered table-sm m-0 mt-1">
                        <thead>
                            <tr>
                                <th class="align-middle">Pokémon</th>
                                <th class="text-center align-middle">Vitamins Used</th>
                                <!-- ko foreach: GameHelper.enumStrings(GameConstants.VitaminType) -->
                                <th class="text-center align-middle">
                                    <span data-bind="text: $data"></span><br />
                                    <span class="font-weight-normal small" data-bind="text: `[ ${player.itemList[$data]().toLocaleString('en-US')} ]`"></span>
                                </th>
                                <!-- /ko -->
                                <th class="text-center align-middle">Breeding Efficiency</th>
                                <th class="text-center align-middle">Attack Bonus</th>
                                <th class="text-center align-middle">Egg Steps</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: lazyLoad('lazyVitaminExpandedList', $element, PartyController.getVitaminSortedList, { reset: () => (DisplayObservables.modalState.pokemonVitaminExpandedModal === 'hidden') }), childrenComplete: () => { lazyLoadCallback('lazyVitaminExpandedList'); }">
                            <tr data-bind="css: { 'text-muted': $data.breeding }">
                                <td class="text-left align-middle">
                                    <knockout data-bind="text: $data.displayName"></knockout>
                                    <sup data-bind="visible: $data.shiny">✨</sup>
                                </td>
                                <td class="text-center align-middle tight" data-bind="text: $data.totalVitaminsUsed().toLocaleString('en-US')"></td>
                                <!-- ko foreach: GameHelper.enumNumbers(GameConstants.VitaminType) -->
                                <td class="text-center align-middle tight">
                                    <button type="button" class="btn btn-link btn-sm text-decoration-none align-text-top" style="line-height: 0.6; font-size: 1rem;"
                                        data-bind="
                                            click: () => { $parent.removeVitamin($data, VitaminController.getMultiplier()) },
                                            class: ($parent.vitaminsUsed[$data]() > 0 && !$parent.breeding ? 'text-success' : 'text-muted')">-</button>
                                    <knockout class="align-middle d-inline-block" style="width: .875rem;" data-bind="text: $parent.vitaminsUsed[$data]().toLocaleString('en-US')">0</knockout>
                                    <button type="button" class="btn btn-link btn-sm text-decoration-none align-text-top" style="line-height: 0.6; font-size: 1rem;"
                                        data-bind="
                                            click: () => { $parent.useVitamin($data, VitaminController.getMultiplier()) },
                                            class: ($parent.vitaminUsesRemaining() && player.itemList[GameConstants.VitaminType[$data]]() && !$parent.breeding ? 'text-success' : 'text-muted')">+</button>
                                </td>
                                <!-- /ko -->
                                <td class="text-center align-middle tight" data-bind="text: SortOptionConfigs[SortOptions.breedingEfficiency].getValue($data).toLocaleString('en-US', { maximumFractionDigits: 3 })">-</td>
                                <td class="text-center align-middle tight" data-bind="text: $data.getBreedingAttackBonus().toLocaleString('en-US')">-</td>
                                <td class="text-center align-middle tight" data-bind="text: $data.getEggSteps().toLocaleString('en-US')">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Badge Case Modal-->
<div class="modal fade noselect" id="badgeCaseModal" tabindex="-1" role="dialog"
aria-labelledby="badgeCaseModalLabel">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
   <div class="modal-content tab-content">
        <div class="modal-header p-0" style='justify-content: space-around;'>
            <ul class="nav nav-tabs nav-fill w-100">
                <li class="nav-item">
                    <a data-toggle='tab' class='nav-link active' href="#badgeCase">
                        <div class="row" style="justify-content: center;">
                            <h5 class="modal-title">Badge Case</h5>
                            <button type="button" class="btn py-0"
                                data-bind="tooltip: {
                                    title: App.game.badgeCase.badgeCaseTooltip(),
                                    trigger: 'hover',
                                    placement:'top',
                                    html: true,
                                }">ⓘ</button>
                        </div>
                    </a>
                </li>
                <!-- ko if: GameHelper.enumNumbers(ContestRank).some(r => ContestHelper.getContestHallRequirements(r).some(req => req.isCompleted())) -->
                <li class="nav-item">
                    <a data-toggle='tab' class="nav-link" href="#ribbonCase">
                        <div class="row" style="justify-content: center;">
                            <h5 class="modal-title">Ribbon Case</h5>
                            <button type="button" class="btn py-0"
                                data-bind="tooltip: {
                                    title: `Contest Ribbons increase your Appeal during frenzy. Your current ribbon bonus is ${'+' + ContestBattle.contestClearedMultiplier()}%`,
                                    trigger: 'hover',
                                    placement:'top',
                                    html: true,
                                }">ⓘ</button>
                        </div>
                    </a>
                </li>
                <!-- /ko -->
                <button type="button" class="close mr-auto" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </ul>
        </div>

        <div id="badgeCase" class="modal-body tab-pane fade in active show">
            <div data-bind="foreach: Object.entries(BadgeCaseController.getDisplayableBadges())">
                <div>
                    <h4 data-bind="text: $data[0]"></h4>
                    <div class="row no-gutters justify-content-center"
                        data-bind="foreach: $data[1]">
                        <div class="col-3 badgeEntry">
                            <img src="" width="60px"
                                data-bind="attr:{ src: 'assets/images/badges/'+ $data +'.svg'},
                                css: { 'badge-not-acquired': !App.game.badgeCase.hasBadge(BadgeEnums[$data])}">

                            <p style="bottom: 0;"
                                data-bind="text: $data.replace(/_/g, ' ')">name</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="ribbonCase" class="modal-body tab-pane fade">
            <div data-bind="foreach: { data: GameHelper.enumNumbers(ContestRank).filter(r => r > ContestRank.Practice && r < ContestRank['Brilliant Shining'] && ContestHelper.getContestHallRequirements(r).every(req => req.isCompleted())), as: 'rank'}">
                <h4 data-bind="text: `${ContestRank[rank]} Rank`"></h4>
                <div class="row no-gutters justify-content-center">
                    <div class="row w-100 justify-content-center">
                        <!-- ko foreach: ContestHelper.getAvailableRibbons()[ContestRank[rank]].filter(r => r < ContestType.Balanced) -->
                        <div class="col-2 p-0" style="align-content:center">
                            <p class="m-0" data-bind="text: ContestHelper.getRibbonImageDescription(rank, $data)"></p>
                        </div>
                        <!-- /ko -->
                    </div>
                    <div class="row w-100 justify-content-center">
                        <!-- ko foreach: ContestHelper.getAvailableRibbons()[ContestRank[rank]].filter(r => r < ContestType.Balanced) -->
                        <div class="col-2 p-0" style="align-content:center">
                            <svg class="ribbon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 1280" xmlns:v="https://vecta.io/nano"
                                data-bind="
                                    style: {
                                        width: rank < ContestRank.Spectacular ? '80px' : '',
                                    },
                                    css: {
                                        'badge-not-acquired': App.game.statistics.contestHighestRound[rank][$data]() == 0,
                                        'pokemon-not-seen': !ContestHelper.contestIsUnlocked(rank, $data),
                                    },
                                    attr: {'contest-type': ContestType[$data]},
                                    ">
                                <g data-bind="html: ContestHelper.getRibbonImage(rank, $data)"></g>
                            </svg>
                        </div>
                        <!-- /ko -->
                    </div>
                    <div class="row w-100 justify-content-center">
                        <!-- ko foreach: ContestHelper.getAvailableRibbons()[ContestRank[rank]].filter(r => r >= ContestType.Balanced) -->
                        <div class="" style="align-content:center">
                            <p class="m-0" data-bind="text: ContestHelper.getRibbonImageDescription(rank, $data)"></p>
                            <svg class="ribbon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 1280" xmlns:v="https://vecta.io/nano"
                                data-bind="
                                    css: {
                                        'badge-not-acquired': App.game.statistics.contestHighestRound[rank][$data]() == 0,
                                        'pokemon-not-seen': !ContestHelper.contestIsUnlocked(rank, $data),
                                    },
                                    attr: {'contest-type': ContestType[$data]},
                                    ">
                                <g data-bind="html: ContestHelper.getRibbonImage(rank, $data)"></g>
                            </svg>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>

       <div class="modal-footer">
           <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
       </div>
   </div>
</div>
</div>


<!-- Save Modal-->
<div class="modal fade noselect" id="saveModal" tabindex="-1" role="dialog"
     aria-labelledby="saveModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Save Data</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a class="nav-link active" href="#saveTab" data-toggle="tab">Save</a></li>
                    <li class="nav-item"><a class="nav-link" href="#saveConvert" data-toggle="tab">Convert Original Save</a></li>
                </ul>
                <div class="tab-content p-3">
                    <div id="saveTab" class="tab-pane fade in active show">
                        <div>
                            <form class="form-inline input-group">
                                <input class="outline-dark form-control" placeholder="Enter code..." id="redeemable-code-input" type="text" />
                                <div class="input-group-append">
                                    <button class="btn btn-info" name="name" value="value" type="submit" onclick="RedeemableCodeController.enterCode(); return false;">Claim!</button>
                                </div>
                            </form>
                            <hr>
                            <!-- ko if: App.game.discord.enabled -->
                            <button class="btn btn-primary btn-block" onClick="App.game.discord.login()" data-bind="visible: !App.game.discord.ID()">Link Discord</button>
                            <button class="btn btn-warning btn-block" onClick="App.game.discord.logout()" data-bind="visible: App.game.discord.ID()">Unlink Discord</button>
                            <i class="text-warning"><strong>Note:</strong> This is <strong>not</strong> used for cloud saves;<br/>it just allows you to enter codes received from the Discord bot.</i>
                            <hr>
                            <!-- /ko -->

                            <button class="btn btn-primary btn-block" onClick="Save.download()">Download Save</button>
                            <i>If this does not work, you can copy the contents of the save and paste it into a '.txt' file</i>
                            <button class="btn btn-primary btn-block" onclick="Save.copySaveToClipboard()">Copy to Clipboard</button>
                            <hr>

                            <input type="file" id="import-save" accept=".txt" style="display:none;"
                                    onchange=Save.loadFromFile(this.files[0])>
                            <label for="import-save" class="btn btn-primary btn-block">Import Save</label>
                            <hr>
                            <h5 class="text-danger">You will not be able to recover your savefile!</h5>
                            <button class="btn btn-danger btn-block" onClick="Save.delete()">DELETE SAVE</button>
                        </div>
                    </div>

                    <div id="saveConvert" class="tab-pane fade">
                        <p>You can paste your old PokéClicker save file here, to keep shinies:</p>
                        <textarea id="convertTextArea" class="saveTextArea"></textarea>
                        <button class="btn btn-success btn-block" onclick="Save.convert()">
                            Convert
                        </button>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Quests Modal-->
<div class="modal noselect fade" id="QuestModal" tabindex="-1" role="dialog" aria-labelledby="QuestModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill w-100">
                    <li class="nav-item" onclick="$('#refreshQuests').show()"><a class="nav-link active" href="#questsModalQuestsPane" data-toggle="tab">Quests</a></li>
                    <li class="nav-item" onclick="$('#refreshQuests').hide()">
                        <a class="nav-link position-relative" href="#questsModalQuestLinesPane" data-toggle="tab">
                            Quest Lines
                            <span class="position-absolute rounded-circle bg-danger p-1"
                                data-bind="visible: App.game.quests.questLines().some(q => q.state() === QuestLineState.inactive && q.bulletinBoard !== GameConstants.BulletinBoards.None && q.requirement?.isCompleted())"></span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="modal-body p-0">
                <div class="tab-content">

                    <!-- Quests -->
                    <div class="tab-pane active" id="questsModalQuestsPane">
                        <div class="container">
                            <div class="form-row my-3">
                                <div class="col-3 align-self-center">
                                    <h5>
                                        <span class='' data-bind='text: "Quests (" + App.game.quests.currentQuests().length + "/" + App.game.quests.questSlots() + ")"'></span>
                                    </h5>
                                </div>
                                <div class='col-6' data-bind="tooltip : App.game.quests.questProgressTooltip()">
                                    <div>Lvl. <knockout data-bind='text: App.game.quests.level'></knockout></div>
                                    <div class="progress" style='height: 5px'>
                                        <div class="progress-bar bg-info" role="progressbar"
                                                data-bind="attr:{ style: 'width:' + App.game.quests.percentToNextQuestLevel() + '%' }"
                                                aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3 align-self-center">
                                    <span data-bind="template: { name: 'currencyTemplate', data: {'amount': App.game.wallet.currencies[GameConstants.Currency.questPoint](), 'currency': GameConstants.Currency.questPoint}}"></span>
                                </div>
                            </div>
                        </div>

                        <table class='table table-hover m-0'>
                            <thead>
                            <tr>
                                <td class="align-middle"><h5 class="mb-0">Description</h5></td>
                                <td class="align-middle"><h5 class="mb-0">Reward</h5></td>
                                <td class="align-middle"><h5 class="mb-0">Status</h5></td>
                            </tr>
                            </thead>
                            <tbody data-bind="foreach: App.game.quests.sortedQuestList" >
                            <tr>
                                <td class="align-middle" style="text-align:left" data-bind='text: description'></td>
                                <td class="align-middle text-center py-0" style="text-align:left">
                                    <span data-bind="template: { name: 'currencyTemplate', data: {'amount':  pointsReward, 'currency': GameConstants.Currency.questPoint}}"></span>
                                </td>
                                <td class="align-middle text-center py-0">
                                    <button class='btn btn-primary btn-sm btn-block'
                                        data-bind='visible: App.game.quests.canStartNewQuest() && !$data.inProgress() && !$data.isCompleted() && !$data.claimed(),
                                        click: function(){
                                            App.game.quests.beginQuest($data.index);
                                        }'>
                                        Start
                                    </button>
                                    <button class='btn btn-success btn-sm btn-block' data-bind='visible: !$data.claimed() && $data.isCompleted(),
                                                                        click: () => { App.game.quests.claimQuest($data.index) }'>
                                        Claim
                                    </button>
                                    <span data-bind='visible: $data.inProgress() && !$data.isCompleted(), text: Math.floor(progress()*100) + "%"'></span>
                                    <button class='btn btn-success btn-sm btn-block' disabled data-bind='visible: $data.claimed()'>Completed</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Quest Lines -->
                    <div class="tab-pane" id="questsModalQuestLinesPane">
                        <div class="px-2 pt-3 text-left" data-bind="with: {
                            active: App.game.quests.questLines().filter(q => q.state() === QuestLineState.started),
                            available: App.game.quests.questLines().filter(q => (q.state() === QuestLineState.inactive || q.state() === QuestLineState.suspended) && q.bulletinBoard !== GameConstants.BulletinBoards.None && q.requirement?.isCompleted()),
                            complete: App.game.quests.questLines().filter(q => q.state() === QuestLineState.ended)
                        }">
                            <!-- ko if: $data.active.length -->
                            <div class="bg-primary p-2">
                                <h6 class="m-0 text-light font-weight-bold">Active Quest Lines</h6>
                            </div>
                            <table class="table table-striped table-bordered table-hover table-sm">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th class="text-center">Step</th>
                                        <th style="width: 1px;"></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: $data.active">
                                    <tr>
                                        <td>
                                            <knockout class="font-weight-bold d-block" data-bind="text: $data.name"></knockout>
                                            <knockout class="small" data-bind="text: $data.description"></knockout>
                                        </td>
                                        <td class="text-nowrap align-middle text-center" data-bind="text: `${$data.curQuest() + 1} / ${$data.totalQuests}`"></td>
                                        <td class="align-middle text-center">
                                            <button type="button" class="btn btn-danger btn-sm" data-bind="click: () => { $data.suspendQuest() }, tooltip: {
                                                title: $data.pauseTooltip,
                                                trigger: 'hover',
                                                placement: 'top',
                                                html: true,
                                                boundary: 'window'
                                            }, css: { disabled: !$data.isPausable() }">Pause</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- /ko -->

                            <!-- ko if: $data.available.length -->
                            <div class="bg-primary p-2">
                                <h6 class="m-0 text-light font-weight-bold">Available Quest Lines</h6>
                            </div>
                            <table class="table table-striped table-bordered table-hover table-sm">
                                <thead>
                                    <tr>
                                        <th class="align-middle">Name</th>
                                        <th class="text-nowrap text-center">Bulletin Board</th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: $data.available">
                                    <tr>
                                        <td>
                                            <knockout class="font-weight-bold d-block" data-bind="text: $data.name"></knockout>
                                            <knockout class="small" data-bind="text: $data.description"></knockout>
                                        </td>
                                        <td class="text-nowrap text-center align-middle" data-bind="text: BulletinBoard.getLocation($data.bulletinBoard)"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- /ko -->

                            <!-- ko if: $data.complete.length -->
                            <div class="bg-primary p-2">
                                <h6 class="m-0 text-light font-weight-bold">Complete Quest Lines</h6>
                            </div>
                            <table class="table table-striped table-bordered table-hover table-sm">
                                <tbody data-bind="foreach: $data.complete">
                                    <tr>
                                        <td>
                                            <knockout class="font-weight-bold d-block" data-bind="text: $data.name"></knockout>
                                            <knockout class="small" data-bind="text: $data.description"></knockout>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- /ko -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div id='refreshQuests'>
                    <!-- ko if: App.game.quests.freeRefresh() -->
                    <button class="btn btn-primary" onclick="App.game.quests.refreshQuests(false, true)">Free Refresh</button>
                    <!-- /ko -->
                    <!-- ko if: !App.game.quests.freeRefresh() -->
                    <button class="btn btn-primary" onclick="App.game.quests.refreshQuests(false, true)"
                        data-bind="enable: App.game.quests.canAffordRefresh(),
                            tooltip: {
                                title: App.game.quests.freeRefresh() ? '' : `Daily free refresh in: ${GameHelper.formattedLetterTimeUntilTomorrow()}`,
                                trigger: 'hover', placement:'top'
                            }">
                        <span data-bind="template: { name: 'amountTemplate', data: App.game.quests.getRefreshCost() }"></span> - Refresh
                    </button>
                    <!-- /ko -->

                </div>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Farm Modal-->
<div class="modal fade noselect" id="farmModal" tabindex="-1" role="dialog"
     aria-labelledby="farmModalLabel"
     style="cursor:default">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item" onclick="FarmController.farmingModalTabSelected('berryFarmView')"><a data-toggle='tab' class='nav-link active' href="#berryFarmView">Farm</a></li>
                    <li class='nav-item' onclick="FarmController.farmingModalTabSelected('farmHandsView')" data-bind="visible: App.game.farming.farmHands.isUnlocked()"><a data-toggle='tab' class='nav-link' href="#farmHandsView">Farm Hands</a></li>
                    <li class='nav-item' onclick="FarmController.farmingModalTabSelected('berryDexView')"><a data-toggle='tab' class='nav-link' href="#berryDexView">Berrydex</a></li>
                    <li class='nav-item' onclick="FarmController.farmingModalTabSelected('helpView')"><a data-toggle='tab' class='nav-link' href="#helpView">Help</a></li>
                    <btn class="btn btn-primary">
                        <span data-bind="template: { name: 'currencyTemplate', data: {'amount': App.game.wallet.currencies[GameConstants.Currency.farmPoint](), 'currency': GameConstants.Currency.farmPoint}}"></span>
                    </btn>
                </ul>
            </div>

            <div class="modal-body tab-content p-0" style="overflow-x: hidden;">

                <div id="berryFarmView" class="tab-pane fade in active show">
                    <div id="farmView" class="justify-content-center no-select row">
                        <div class="col-12 col-lg-4">


                            <ul class="nav nav-tabs nav-fill">
                                <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#seeds" data-bind="click: () => FarmController.selectedFarmTool(FarmingTool.Berry) && FarmController.berryListVisible(true);">Berries</a></li>
                                <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#mulches" data-bind="click: () => FarmController.selectedFarmTool(FarmingTool.Mulch) && FarmController.berryListVisible(false);">Mulch</a></li>
                            </ul>

                            <div class="tab-content">
                                <div id="seeds" class="tab-pane active">
                                    <ul id="seedList" class="list-group p-0">
                                        <!-- ko foreach: FarmController.getUnlockedBerryListWithIndex() -->
                                        <li class="list-group-item list-group-item-action seed-list-item p-2"
                                            data-bind="click: function() {
                                                FarmController.selectedBerry($data);
                                                FarmController.selectedFarmTool(FarmingTool.Berry);
                                            }, css: { 'active': FarmController.selectedBerry() === $data && FarmController.selectedFarmTool() == FarmingTool.Berry }">
                                            <img src="" height="28px"
                                                data-bind="attr:{ src: FarmController.getBerryImage($data) },
                                                css: {'berryLocked': !App.game.farming.unlockedBerries[$data]() }">
                                            <span data-bind="text: App.game.farming.unlockedBerries[$data]() ? BerryType[$data] : '???'"></span>
                                            <span class="float-right" data-bind="text: App.game.farming.berryList[$data]().toLocaleString('en-US')"></span>
                                        </li>
                                        <!-- /ko -->
                                    </ul>

                                    <div class="row justify-content-center align-items-center py-1">
                                        <div class="col-4 pr-0">
                                            <button class="btn btn-block btn-secondary"
                                                onclick="FarmController.navigateLeft()"
                                                data-bind="disable: FarmController.navigateIndex() === 0,
                                                    css: { disabled: FarmController.navigateIndex() === 0 }">
                                                <img src="assets/images/arrow.svg" style="transform: scaleX(-1);" height="20">
                                            </button>
                                        </div>
                                        <div class="col-4" data-bind="text: FarmController.navigateIndex()+1 + '/' + (FarmController.numberOfTabs()+1)"></div>
                                        <div class="col-4 pl-0">
                                            <button class="btn btn-block btn-secondary"
                                                onclick="FarmController.navigateRight()"
                                                data-bind="disable: FarmController.navigateIndex() ===  FarmController.numberOfTabs(),
                                                    css: { disabled: FarmController.navigateIndex() ===  FarmController.numberOfTabs() }">
                                                <img src="assets/images/arrow.svg" height="20">
                                            </button>
                                        </div>
                                    </div>

                                    <div class="row justify-content-center py-1">
                                        <div class="col-6 pr-0">
                                            <button class="btn btn-primary btn-block" data-bind="click: function(){App.game.farming.plantAll(FarmController.selectedBerry())}">
                                                Plant All
                                            </button>
                                        </div>
                                        <div class="col-6 pl-0">
                                            <button class="btn btn-success btn-block" data-bind="click: function(){App.game.farming.harvestAll()}">
                                                Harvest All
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div id="mulches" class="tab-pane">
                                    <ul id="mulchList" class="list-group p-0">
                                        <!-- ko foreach: Object.keys(MulchType).filter(value => !isNaN(value) && value != -1) -->
                                        <li class="list-group-item list-group-item-action seed-list-item p-2"
                                            data-bind="click: function() {
                                                    FarmController.selectedMulch($data);
                                                    FarmController.selectedFarmTool(FarmingTool.Mulch)
                                                },
                                                css: { 'active': FarmController.selectedMulch() == $data && FarmController.selectedFarmTool() == FarmingTool.Mulch },
                                                tooltip: {title: ItemList[MulchType[$data]].description, trigger: 'hover', animation: false}">
                                            <img src="" width="24px"
                                                 data-bind="attr:{ src: ItemList[MulchType[$data]].image }">
                                            <span data-bind="text: MulchType[$data].replace('_', ' ')"></span>
                                            <span class="float-right" data-bind="text: App.game.farming.mulchList[$data]().toLocaleString('en-US')"></span>
                                        </li>
                                        <!-- /ko -->
                                    </ul>
                                    <div class="justify-content-center py-1">
                                        <div class="btn-group btn-block">
                                            <button type="button" class="btn btn-sm btn-secondary col-3"
                                            data-bind="text: FarmController.multipliers[FarmController.multIndex()]"
                                            onclick="FarmController.incrementMultiplier()"
                                            oncontextmenu="FarmController.decrementMultiplier(); return false"
                                            title="Multiplier"
                                            data-toggle="popover"
                                            data-html="true"
                                            data-content="Left/right click to cycle amount<br/>Applies to single and Mulch All"
                                            data-placement="right"
                                            data-trigger="hover">
                                            </button>
                                            <button class="btn btn-primary btn-block" data-bind="click: function(){ FarmController.mulchAll(); }">
                                                Mulch All
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <ul id="shovelList" class="list-group">
                                <!-- ko if: FarmController.berryListVisible() -->
                                <li class="list-group-item list-group-item-action seed-list-item p-2"
                                    data-bind="click: function() {
                                        FarmController.selectedFarmTool(FarmingTool.Shovel);
                                    },
                                    css: { 'active': FarmController.selectedFarmTool() == FarmingTool.Shovel },
                                    tooltip: {title: 'Clear a Plant from a plot.', trigger: 'hover', animation: false}">
                                    <img src="" height="24px"
                                        data-bind="attr:{ src: ItemList['Berry_Shovel'].image }">
                                    <span>Shovel</span>
                                    <span class="float-right" data-bind="text: App.game.farming.shovelAmt().toLocaleString('en-US')"></span>
                                </li>
                                <!-- /ko -->
                            </ul>
                            <ul id="shovelMulch" class="list-group p-0">
                                <!-- ko ifnot: FarmController.berryListVisible() -->
                                <li class="list-group-item list-group-item-action seed-list-item p-3"
                                    data-bind="click: function() {
                                        FarmController.selectedFarmTool(FarmingTool.MulchShovel);
                                    },
                            css: { 'active': FarmController.selectedFarmTool() == FarmingTool.MulchShovel },
                            tooltip: {title: 'Clear a Mulch from a plot.', trigger: 'hover', animation: false}">
                                    <img src="" height="21px"
                                         data-bind="attr:{ src: ItemList['Mulch_Shovel'].image }">
                                    <span>MulchShovel</span>
                                    <span class="float-right" data-bind="text: App.game.farming.mulchShovelAmt().toLocaleString('en-US')"></span>
                                </li>
                                <!-- /ko -->
                            </ul>
                        </div>

                        <div class="col-12 col-lg-8">
                            <div id="plotList" class="row" data-bind="foreach: App.game.farming.plotList, css: { ShiftPressed: GameController.keyHeld.Shift() }">
                                <!-- ko if: $index() % GameConstants.FARM_PLOT_WIDTH == 0 -->
                                <div class="w-100"></div>
                                <!-- /ko -->
                                <div class="plot col" data-bind="css: { plotLocked : !$data.isUnlocked }">
                                    <div class="plot-content" data-bind="class: FarmController.calculateCssClass($data)">
                                        <div class="plotImage">
                                            <img style="width: 100%;" src="assets/images/farm/soil.png"
                                                data-bind="class: FarmController.calcMulchClass($data)">
                                            <!-- ko if: !$data.isUnlocked -->
                                            <div class="plotButton plotLockHover">
                                                <div>
                                                    <span style="display: inline;">
                                                        <img alt="Berry" style="height: 28px;"
                                                            data-bind="attr:{ src: FarmController.getBerryImage(App.game.farming.plotBerryCost($index()).type) },
                                                            css: {'berryLocked': !App.game.farming.unlockedBerries[App.game.farming.plotBerryCost($index()).type]() }"/>
                                                        <span data-bind="text: GameConstants.formatNumber(App.game.farming.plotBerryCost($index()).amount)">0</span>
                                                    </span>
                                                </div>
                                                <div>
                                                    <span data-bind="template: { name: 'currencyTemplate', data: {'amount': App.game.farming.plotFPCost($index()), 'currency': GameConstants.Currency.farmPoint}}"></span>
                                                </div>
                                            </div>
                                            <!-- /ko -->
                                            <!-- ko if: $data.wanderer -->
                                                <!-- ko ifnot: $data.wanderer.catching -->
                                                    <div class="pokemonSprite wandererSprite"
                                                        data-bind="style: { backgroundImage: FarmController.getWandererStyle($data)},
                                                        class: FarmController.getWandererCss($data)">
                                                    </div>
                                                <!-- /ko -->
                                                <!-- ko if: $data.wanderer.catching -->
                                                    <img src="" class="pokeball-animated wandererCapture" style="z-index: 1;"
                                                        data-bind="attr: {src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.wanderer.pokeball()] + '.svg'}"/>
                                                <!-- /ko -->
                                            <!-- /ko -->
                                            <div class="plotButton"
                                                data-bind="ifnot: $data.isEmpty(),
                                                click: function(data, event){FarmController.plotClick($index(), event)},
                                                tooltip: {title: $data.tooltip(), trigger: 'hover', animation: false, html: true}">
                                                <img width="100%" height="100%" src=""
                                                    style="width: 68.75%; max-height: 100%; image-rendering: pixelated;"
                                                    data-bind="attr:{ src: FarmController.getImage($index())}">
                                            </div>
                                            <!-- ko if: $data.isSafeLocked -->
                                            <img class ="plotSafeLockIcon" src= "assets/images/farm/plotSafeLock.svg" >
                                            <!-- /ko -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="berryDexView" class="tab-pane fade">
                    <div data-bind="if: Settings.getSetting('berryDexMode').observableValue() === 'classic'">
                        <ul class="row justify-content-center p-0 m-0" data-bind="foreach: FarmController.getUnlockedBerryList()">
                            <li class="col-sm-4 col-md-3 col-lg-2 pokedexEntry"
                            data-bind="style:{background: FarmController.getBackgroundColor($data)},
                                    tooltip: { title: FarmController.getHint($data,true,true),
                                    trigger: 'hover',
                                    placement:'top' }">
                                 <span class="id" style="top: 0; border-top-left-radius: 6px; border-top-right-radius: 6px;" data-bind="text: ($data + 1 + '').padStart(2, 0)">number</span>
                                     <img src="" width=80px style="padding: 20px 0px;" data-bind="css: { 'pokemon-not-seen': !App.game.farming.unlockedBerries[$data]() }, attr:{ src: FarmController.getBerryImage($data)}">
                                     <!-- ko if: App.game.farming.unlockedBerries[$data]() -->
                                     <span style="bottom: 0; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px" data-bind="text: BerryType[$data]">name</span>
                                     <a class="overlay" href="#berryDexModal" data-toggle="modal"
                                        data-bind="click: ()=>{App.game.statistics.selectedBerryID($data)},
                                            attr:{'aria-label': BerryType[$data]}"></a>
                                     <!-- /ko -->
                            </li>
                        </ul>
                    </div>
                    <div data-bind="if: Settings.getSetting('berryDexMode').observableValue() === 'preview'">
                        <div id="berryDexPreviewContainer" class="d-flex flex-wrap">
                            <div id="berryDexPreviewList" class="berryDexPreviewColumn col-12 col-lg-8 col-md-6 mt-1 mb-1" style="overflow-y: auto;">
                                <ul class="d-flex flex-wrap justify-content-center p-0 m-0" data-bind="foreach: FarmController.getUnlockedBerryList()">
                                    <li class="col-5 col-lg-2 col-md-10 d-flex flex-column align-items-center mx-2 my-1 p-0 berryDexButtons btn" data-bind="css: {
                                        'btn-primary': App.game.statistics.selectedBerryID() === $data,
                                        'btn-secondary': App.game.statistics.selectedBerryID() != $data,
                                        'disabled': !App.game.farming.unlockedBerries[$data]() && !FarmController.getHint($data,true)
                                    }">
                                        <span data-bind="text: `#${($data + 1).toString().padStart(2, 0)}`"></span>
                                        <img width="48" height="48" data-bind="css: { 'pokemon-not-seen': !App.game.farming.unlockedBerries[$data]() },
                                            attr:{ src: FarmController.getBerryImage($data)}" style="margin: -6px 0;">
                                        <!-- ko if: !App.game.farming.unlockedBerries[$data]() && !FarmController.getHint($data,true) -->
                                        <span data-bind="text: '???'">name</span>
                                        <!-- /ko -->
                                        <!-- ko if: App.game.farming.unlockedBerries[$data]() || FarmController.getHint($data,true) -->
                                        <span data-bind="text: BerryType[$data]">name</span>
                                        <a class="overlay" href='#' data-bind="click: () => {FarmController.handleBerryDexClick($data)}, attr:{'aria-label': BerryType[$data]}"></a>
                                        <!-- /ko -->

                                    </li>
                                </ul>
                            </div>
                            <div id="berryDexPreviewTable" class="berryDexPreviewColumn col-12 col-lg-4 col-md-6 mt-1 mb-1" style="overflow-y: auto; overflow-x: hidden; scrollbar-gutter: stable;">
                                <!-- ko using: App.game.statistics.selectedBerryID() -->
                                <div class="sticky-top">
                                    <div class="modal-header bg-dark text-light">
                                        <h5 class="p-0 modal-title text-light" data-bind="text: BerryType[$data]">Berry Statistics</h5>
                                        <h5 class="p-0 modal-title text-muted" data-bind="text: `#${(Number($data) + 1).toString().padStart(2,0)}`"></h5>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <img data-bind="attr:{ src: FarmController.getBerryImage($data) }" src=""/>
                                    <!-- ko if: App.game.farming.unlockedBerries[$data]() -->
                                    <table class="table table-striped table-hover table-bordered table-sm m-0">
                                        <thead>
                                            <tr class="text-light">
                                                <th class="bg-dark" colspan="2">Overview</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-left">Berry Color</td>
                                                <td class="text-left tight">
                                                    <code data-bind="text: BerryColor[App.game.farming.berryData[$data].color]">-</code>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left">Growth Duration</td>
                                                <td class="text-left tight">
                                                    <code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[3])">-</code>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left">Farm Points per Harvest</td>
                                                <td class="text-left tight">
                                                    <code data-bind="text: App.game.farming.berryData[$data].farmValue.toLocaleString('en-US')">-</code>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left">Harvest Amount</td>
                                                <td class="text-left tight">
                                                    <code data-bind="text: App.game.farming.berryData[$data].harvestAmount.toLocaleString('en-US')">-</code>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="text-left">Current Amount</td>
                                                <td class="text-left tight">
                                                    <code data-bind="text: App.game.farming.berryList[$data]().toLocaleString('en-US')">-</code>
                                                </td>
                                            </tr>
                                            <!-- ko if: App.game.farming.berryData[$data].aura -->
                                            <tr>
                                                <td class="text-left">Aura</td>
                                                <td class="text-left tight">
                                                    <code data-bind="text: AuraType[App.game.farming.berryData[$data].aura.auraType]"></code>
                                                </td>
                                            </tr>
                                            <!-- /ko -->
                                        </tbody>
                                    </table>
                                    <table class="table table-striped table-hover table-bordered table-sm m-0">
                                        <thead>
                                            <tr class="text-light">
                                                <th class="bg-dark" colspan="5">Flavor</th>
                                            </tr>
                                        </thead>
                                        <tbody id="berryDexPreviewFlavors">
                                            <tr>
                                                <td class="px-0 align-middle">Spicy</td>
                                                <td class="px-0 align-middle">Dry</td>
                                                <td class="px-0 align-middle">Sweet</td>
                                                <td class="px-0 align-middle">Bitter</td>
                                                <td class="px-0 align-middle">Sour</td>
                                            </tr>
                                            <tr data-bind="foreach: App.game.farming.berryData[$data].flavors">
                                                <td class="px-0 align-middle" data-bind="text: $data.value"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <!-- ko let: {
                                        berrySpecificWanderers: App.game.farming.berryData[$data].wander.filter((w) => ![...Berry.baseWander, ...Berry.colorWander[App.game.farming.berryData[$data].color]].includes(w) && pokemonMap[w].nativeRegion <= GameConstants.MAX_AVAILABLE_REGION)
                                    } -->
                                        <!-- ko if: berrySpecificWanderers.length -->
                                        <table class="table table-striped table-hover table-bordered table-sm m-0">
                                            <thead>
                                                <tr class="text-light">
                                                    <th class="bg-dark">Wandering Pokémon</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="p-0">
                                                        <ul class="list-inline wanderPokemonList" data-bind="foreach: berrySpecificWanderers">
                                                            <li class="list-inline-item" data-bind="template: { name: 'wanderingPokémonDisplay', data: $data}"></li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <!-- /ko -->
                                    <!-- /ko -->
                                    <!-- /ko -->

                                    <!-- ko ifnot: App.game.farming.unlockedBerries[$data]() -->
                                    <table class="table table-striped table-hover table-bordered table-sm m-0">
                                        <thead>
                                            <tr class="text-light">
                                                <th class="bg-dark" colspan="2">Hint</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="2" data-bind="text: FarmController.getHint($data)"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <!-- /ko -->

                                    <button type="button" class="btn btn-info btn-block" href="#berryDexModal" data-toggle="modal" data-bind="visible: App.game.farming.unlockedBerries[$data]()">
                                        More Info
                                    </button>
                                </div>
                                <!-- /ko -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="helpView" class="tab-pane fade col-10 offset-1">
                    <h4><u>Farm</u></h4>
                    <p>In the farm you can plant and harvest Berries.</p>

                    <p>Each Berry type takes a different amount of time to grow.
                    <br/>Once fully grown, the Berry plant can be manually harvested with a click or by a hired Farm Hand. Both methods will yield Farm Points.</p>

                    <p>Otherwise, after some time being fully grown, the Berry plant will wither away,
                    dropping half of the expected Berries, though it may also be re-planted automatically.
                    <br/><i>(Farm Points are not gained when Berries wither or get replanted!)</i><p>

                    <p>Additional plots can be unlocked by spending Berries.</p>

                    <h4><u>Mutations</u></h4>
                    <p>Berries have the chance to cause mutations and create new Berry species in empty plots based on certain conditions.
                    <br/><i>(The Berry Master in Kanto will give you daily hints to what these conditions may be.)</i></p>

                    <p>There are two types of mutations:</p>

                    <p><b>Common mutations:</b> They require specific Berries to happen. <i>These mutations only happen at Ripe stage.</i>
                    <br/><b>Evolution mutations:</b> They usually require a Berry changing into other and are related with flavour profiles or use of objects. <i>These mutations can start to happen at Taller stage.</i></p>

                    <h4><u>Mulches</u></h4>
                    <p>Mulches can be bought in later regions from Berry Masters. They last 5 minutes each and can be stacked. However, you cannot combine multiple types of mulch on the same plot!</p>
                    <p>They can be used on plots for different effects:</p>
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>Boost Mulch</td>
                            <td>Increases the growth rate of Berry plants.</td>
                        </tr>
                        <tr>
                            <td>Rich Mulch</td>
                            <td>Increases the number of Berries harvested.</td>
                        </tr>
                        <tr>
                            <td>Surprise Mulch</td>
                            <td>Increases the chances of mutations.</td>
                        </tr>
                        <tr>
                            <td>Amaze Mulch</td>
                            <td>A weaker combination of Boost, Rich and Surprise mulch.</td>
                        </tr>
                        <tr>
                            <td>Freeze Mulch</td>
                            <td>Stops Berry growth and auras. Mutations will still occur while Berries are frozen.</td>
                        </tr>
                        <tr>
                            <td>Gooey Mulch</td>
                            <td>Boosts Wanderer catch rate by 10% and increases the chance of non-base Wanderers appearing. Available from Unova.</td>
                        </tr>
                    </table>

                    <h4><u>Shovels</u></h4>
                    <p>If you want to remove a Berry plant before it is fully grown, you can use a Shovel to uproot it. This will consume the Shovel. Using it on a ripe Berry, however, will function the same as a normal harvest, and the Shovel will not be consumed!</p>
                    <p>If you want to remove a mulch, you can use Mulch Shovels. Using one will remove the full mulch effect, regardless of the time remaining.</p>
                    <p><i>(Both types of shovels can be purchased in later regions from Berry Masters.)</i></p>

                    <h4><u>Locking Plots</u></h4>
                    <p>You can lock specific plots by toggling on the lock with the lock button
                    <br/>or using the hotkey <kbd data-bind="text: Settings.getSetting('hotkey.farm.togglePlotSafeLock').observableValue()"></kbd>.
                    <br/>You can also press <kbd>Shift + Click</kbd> while having any tool/Berry selected to safely lock a plot.</p>

                    <p>Locking a plot prevents you from planting, harvesting,<br/>or interacting with the plot in any way.</p>

                    <p><i>Locked plots ignore Harvest All, Plant All, or Mulch All buttons as well as Farm Hand activity.</i></p>

                    <p>You can unlock a plot by using the toggle or pressing <kbd>Shift + Click</kbd> on the plot again.</p>

                    <h4><u>Trades</u></h4>
                    <p>Berries can be traded with Berry Masters in later regions for other useful items.</p>

                    <h4><u>Wandering Pokémon</u></h4>
                    <p>Ripe Berry plants may attract wild Pokémon that you can then capture. Some Pokémon can only be found using certain Berry species.</p>
                    <p>Some Berry Auras will increase or decrease the chance of encountering Wandering Pokémon.</p>
                    <p>When a Pokémon wanders onto your farm they will appear on a plot next to the Berry and will remain there until interacted with or will flee a couple minutes after the Berry is harvested or withers.</p>
                    <p>Your Poké Ball Filters will be used when attempting to capture a Wanderer. Farm Hands can also be used for this by enabling their Manage Wanderers setting.</p>
                    <p>Interacting with a Wanderer will earn you Farm Points whether you catch it or not. Successfully capturing one will net you Dungeon Tokens.</p>

                    <h4><u>Farm Hands</u></h4>
                    <p><i>(Unlocked after obtaining 8 unique Berries.)</i></p>
                    <p>Farm Hands can help around the Farm; they will harvest and plant Berries as needed or catch wild wanderers, and accrue Farm Points while doing so.</p>
                    <p>Up to 3 Farm Hands can be hired at a time.</p>
                    <p>If they run out of energy, they won't do any work for that cycle, but will regenerate some energy instead. If there's no work to do currently, they will also regenerate some energy. Firing them will allow them to recover energy at the same rate as if they were still hired.</p>
                    <p>Efficiency refers to how many actions they can do per work cycle.</p>
                    <p><i>More Farm Hands can be unlocked through shops and unlocking unique Berries.</i></p>

                    <h4><u>Farm Module</u></h4>
                    <p>
                        Monitor and interact with the farm in a limited capacity without opening the full modal. Harvest or plant Berries, apply mulch, use shovels, and lock/unlock plots with the extended controls.<br />
                        Hide the extended controls for less clutter while still being able to plant and harvest Berries or disable the module completely in the settings.<br />
                        You can also use <kbd>Shift + Click</kbd> to safely lock/unlock a plot.<br />
                        The Farm shortcut will be hidden when the Farm module is enabled.
                    </p>
                </div>

                <div id="farmHandsView" class="tab-pane fade">
                    <div class="row m-0 justify-content-center" data-bind="foreach: App.game.farming.farmHands.available()" style="max-width: 100%;">
                        <div class="card text-left col-md-4 col-sm-6 col-xs-12 p-0">
                            <h5 class="card-header">
                                <knockout data-bind="text: $data.name">Name</knockout>
                                <img class="float-right pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` }">
                            </h5>
                            <div class="card-body p-0">
                                <table class="table table-striped table-hover table-bordered table-sm m-0">
                                    <thead>
                                        <tr>
                                            <th colspan="2" class="text-center text-light bg-dark">
                                                <h5 class="m-0">Information</h5>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-left">Cost:</td>
                                            <td class="text-right tight"><img alt="Farm Points" src="assets/images/currency/farmPoint.svg" style="height: 24px; width: 24px;">&nbsp;<knockout data-bind="text: `${$data.cost.amount.toLocaleString('en-US')}/hour`">0/hour</knockout></td>
                                        </tr>
                                        <tr>
                                            <td class="text-left">Work Speed:</td>
                                            <td class="text-right tight" data-bind="text: GameConstants.formatTimeFullLetters($data.workTick / 1000)">01m 00s</td>
                                        </tr>
                                        <tr>
                                            <td class="text-left">Efficiency:</td>
                                            <td class="text-right tight">
                                                <div class="progress">
                                                    <div class="progress-bar bg-primary" role="progressbar" data-bind="attr:{ style: 'width:' + Math.floor(($data.efficiency / $data.maxEfficiency) * 100) + '%' }" aria-valuemin="0" aria-valuemax="50" style="width:0%">
                                                        <span data-bind="text: $data.efficiency.toLocaleString('en-US')">0</span>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-left">Max Energy:</td>
                                            <td class="text-right tight">
                                                <div class="progress">
                                                    <div class="progress-bar bg-primary" role="progressbar" data-bind="attr:{ style: 'width:' + $data.maxEnergy + '%' }" aria-valuemin="0" aria-valuemax="100" style="width:0%">
                                                        <span data-bind="text: $data.maxEnergy.toLocaleString('en-US')">0</span>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <thead>
                                        <tr>
                                            <th colspan="2" class="text-center text-light bg-dark">
                                                <h5 class="m-0">Settings</h5>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-left">Should Harvest:</td>
                                            <td class="text-center tight align-middle">
                                                <input class="clickable" type="checkbox" data-bind="checked: $data.shouldHarvest"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-left">Manage Wanderers: <span class="ml-1" style="position: absolute; float: right; line-height: 100%;" data-bind="tooltip: {
                                                title: 'They will use your Poké Balls Filters and consume your Poké Balls !',
                                                trigger: 'hover',
                                                placement: 'left',
                                            }">ⓘ</span></td>
                                            <td class="text-center tight align-middle">
                                                <input class="clickable" type="checkbox" data-bind="checked: $data.shouldCatch"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-left align-middle">Berry Planting:</td>
                                            <td class="text-right tight">
                                                <select autocomplete="off" class="custom-select custom-select-sm" data-bind="options: App.game.farming.farmHands.availableBerries, optionsText: i => FarmHandBerryTypes[i], value: $data.focus"></select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="clickable" data-toggle="collapse" data-bind="attr: { href: `#allowedPlots${$data.name}`}" >Allowed Plots:</td>
                                        </tr>
                                        <tr>
                                            <td class="p-0" colspan="2">
                                                <div class="row m-0 collapse" data-bind="attr: { id: `allowedPlots${$data.name}`}, foreach: App.game.farming.plotList">
                                                    <!-- ko if: $index() % GameConstants.FARM_PLOT_WIDTH == 0 -->
                                                    <div class="w-100"></div>
                                                    <!-- /ko -->
                                                    <div class="plot col p-1">
                                                        <div class="plot-content clickable" data-bind="click: () => { $parent.togglePlot($index()) }">
                                                            <div class="plotImage">
                                                                <img style="width: 100%" src="assets/images/farm/soil.png" data-bind="css: { plotEnabled : $parent.plots().includes($index()), plotDisabled : !$parent.plots().includes($index()) }">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="2">
                                                <button class="btn btn-block" data-bind="attr: { disabled: !$data.hired() && !App.game.farming.farmHands.canHire() }, css: { 'btn-success': !$data.hired(), 'btn-danger': $data.hired() }, click: () => !$data.hired() ? $data.hire() : $data.fire(), text: !$data.hired() ? 'Hire!' : 'Fire!'">Hire!</button>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                                <p class="card-text">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn mr-auto"
                    data-bind="visible: FarmController.additionalInfoTooltip().length !== 0,
                    tooltip: {
                        title: FarmController.additionalInfoTooltip(),
                        trigger: 'hover',
                        placement:'top',
                        html: true,
                    }">ⓘ</button>
                <knockout class="mr-auto" data-bind="foreach: App.game.farming.farmHands.hired()">
                    <img class="pixelated" src="" height="24px" data-bind="attr:{ src: `assets/images/profile/trainer-${$data.trainerSprite}.png` },
                    tooltip: {
                        title: $data.tooltip(),
                        trigger: 'hover',
                        placement:'top',
                        html: true,
                    }">
                </knockout>
        				<button id="farm-fireall" type="button" class="btn btn-danger" data-bind="
                            attr : { disabled : !App.game.farming.farmHands.hired().length },
                            click: () => App.game.farming.farmHands.hired().forEach((f) => f.fire()),
                            visible: FarmController.farmingModalTabSelected() == 'farmHandsView'
                        ">Fire All</button>
                <div class="safeLockButton" data-bind="visible: FarmController.farmingModalTabSelected() == 'berryFarmView'">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-primary" onclick="this.blur();" data-bind="
                            click: () => {
                                FarmController.selectedFarmTool() == FarmingTool.Lock ? FarmController.selectedFarmTool(FarmController.berryListVisible() ? FarmingTool.Berry : FarmingTool.Mulch) : FarmController.selectedFarmTool(FarmingTool.Lock);
                            },
                            css: { 'active': FarmController.selectedFarmTool() == FarmingTool.Lock },
                            tooltip: {title: 'Toggle locking a plot from interaction.',  trigger: 'hover', animation: false}
                        ">
                            <img src="assets/images/farm/plotSafeLock.svg" height="22">
                        </button>

                        <button type="button" class="btn btn-primary" data-bind="
                            click: () => FarmController.toggleAllPlotLocksTo(true),
                            tooltip: { title: 'Lock all plots.', trigger: 'hover', animation: false }
                        ">All</button>
                        <button type="button" class="btn btn-primary" data-bind="
                            click: () => FarmController.toggleAllPlotLocksTo(false),
                            tooltip: { title: 'Unlock all plots.', trigger: 'hover', animation: false }
                        ">None</button>
                        <button type="button" class="btn btn-primary" data-bind="
                            click: () => FarmController.toggleAllPlotLocks(),
                            tooltip: { title: 'Flips which plots are locked.', trigger: 'hover', animation: false }
                        ">Flip</button>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Berrydex Modal-->
<div class="modal noselect fade" id="berryDexModal" tabindex="-1" role="dialog" aria-labelledby="berryDexModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content" data-bind="with: App.game.statistics.selectedBerryID()+''">
            <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
                <h5 class="modal-title text-muted" data-bind="text: `#${(Number($data) + 1).toString().padStart(2,0)}&nbsp;&nbsp;`"></h5>
                <h5 class="modal-title text-light" data-bind="text: BerryType[$data]">Berry Statistics</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <img data-bind="attr:{ src: FarmController.getBerryImage($data) }" src=""/>
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                  <thead>
                    <tr class="text-light">
                      <th class="bg-dark" colspan="2">Description</th>
                    </tr>
                  </thead>
                  <tbody>
                      <td colspan="2"><span data-bind="html: App.game.farming.berryData[$data].descriptionHTML"></span></td>
                  </tbody>
                  <thead>
                    <tr class="text-light">
                      <th class="bg-dark" colspan="2">Form</th>
                    </tr>
                  </thead>
                    <tbody>
                    <tr>
                      <td class="text-left">Berry Color</td>
                      <td class="text-left tight"><code data-bind="text: BerryColor[App.game.farming.berryData[$data].color]">-</code></td>
                    </tr>
                    <tr>
                      <td class="text-left">Size</td>
                      <td class="text-left tight"><code data-bind="text: Farming.sizeUnitConverter[SizeUnits[Settings.getSetting('sizeUnits').observableValue()]](App.game.farming.berryData[$data].size)">-</code></td>
                    </tr>
                    <tr>
                      <td class="text-left">Firmness</td>
                      <td class="text-left tight"><code data-bind="html: GameConstants.humanifyString(BerryFirmness[App.game.farming.berryData[$data].firmness])">-</code></td>
                    </tr>
                    <!-- ko if: App.game.farming.berryData[$data].aura -->
                    <tr>
                      <td class="text-left">Aura</td>
                      <td class="text-left tight"><code data-bind="text: AuraType[App.game.farming.berryData[$data].aura.auraType]"></code></td>
                    </tr>
                    <!-- /ko -->
                    </tbody>
                  <thead>
                    <tr class="text-light">
                      <th class="text-left bg-dark">Time</th>
                      <th class="text-left bg-dark">Length</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-left">Growth Duration</td>
                      <td class="text-left tight"><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[3])">-</code></td>
                    </tr>
                    <tr>
                      <td class="text-left">Berry Stage Duration</td>
                      <td class="text-left tight"><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[4]-App.game.farming.berryData[$data].growthTime[3])">-</code></td>
                    </tr>
                    <tr>
                      <td class="text-left">Total Life Span</td>
                      <td class="text-left tight"><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[4])">-</code></td>
                    </tr>
                    </tbody>
                    <thead>
                      <tr class="text-light">
                        <th class="text-left bg-dark">Farming Info</th>
                        <th class="text-left bg-dark">Data</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="text-left">Harvest Amount</td>
                        <td class="text-left tight"><code data-bind="text: App.game.farming.berryData[$data].harvestAmount.toLocaleString('en-US')">-</code></td>
                      </tr>
                      <tr>
                        <td class="text-left">Replant Rate</td>
                        <td class="text-left tight"><code data-bind="text: App.game.farming.berryData[$data].replantRate.toLocaleString('en-US', { style: 'percent' })">-</code></td>
                      </tr>
                      <tr>
                        <td class="text-left">Farm Points per Harvest</td>
                        <td class="text-left tight"><code data-bind="text: App.game.farming.berryData[$data].farmValue.toLocaleString('en-US')">-</code></td>
                      </tr>
                    </tbody>
                    <thead>
                      <tr class="text-light">
                        <th class="text-left bg-dark">Statistic</th>
                        <th class="text-left bg-dark">Amount</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="text-left">Current Amount</td>
                        <td class="text-left tight"><code data-bind="text: App.game.farming.berryList[$data]().toLocaleString('en-US')"></span></td></code></td>
                      </tr>
                      <tr>
                        <td class="text-left">Total Harvested</td>
                        <td class="text-left tight"><code data-bind="text: App.game.statistics.berriesHarvested[$data]().toLocaleString('en-US')">-</code></td>
                      </tr><tr>
                        <td class="text-left">Total Obtained</td>
                        <td class="text-left tight"><code data-bind="text: App.game.statistics.berriesObtained[$data]().toLocaleString('en-US')">-</code></td>
                      </tr>
                    </tbody>
                    <tr>
                      <td class="p-0" colspan="2">
                          <table style="width: 100%;">
                              <tr class="text-light">
                                <th class="bg-dark" colspan="5">Flavor</th>
                              </tr>
                              <tr>
                                  <td>Spicy</td>
                                  <td>Dry</td>
                                  <td>Sweet</td>
                                  <td>Bitter</td>
                                  <td>Sour</td>
                              </tr>
                              <tr>
                                <td data-bind="text: App.game.farming.berryData[$data].flavors[0].value">Spicy</td>
                                <td data-bind="text: App.game.farming.berryData[$data].flavors[1].value">Dry</td>
                                <td data-bind="text: App.game.farming.berryData[$data].flavors[2].value">Sweet</td>
                                <td data-bind="text: App.game.farming.berryData[$data].flavors[3].value">Bitter</td>
                                <td data-bind="text: App.game.farming.berryData[$data].flavors[4].value">Sour</td>
                            </tr>
                          </table>
                      </td>
                      </tr>
                    <tr>
                      <td class="p-0" colspan="2">
                        <table class="table table-striped table-hover table-bordered table-sm m-0">
                          <tr class="text-light">
                            <th class="bg-dark" colspan="4">Growth Stages</th>
                          </tr>
                          <tr>
                            <td>Sprout</td>
                            <td>Taller</td>
                            <td>Bloom</td>
                            <td>Berry</td>
                          </tr>
                          <tr>
                            <td><img src="assets/images/farm/AllTreeSprout.png"/></td>
                            <td><img src="" data-bind="attr: { src: `assets/images/farm/${BerryType[$data]}Tree${PlotStage[PlotStage.Taller]}.png` }"/></td>
                            <td><img src="" data-bind="attr: { src: `assets/images/farm/${BerryType[$data]}Tree${PlotStage[PlotStage.Bloom]}.png` }"/></td>
                            <td><img src="" data-bind="attr: { src: `assets/images/farm/${BerryType[$data]}Tree${PlotStage[PlotStage.Berry]}.png` }"/></td>
                          </tr>
                          <tr>
                            <th colspan="4">Total Time until Stage</th>
                          </tr>
                          <tr>
                            <td><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[0])">-</code></td>
                            <td><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[1])">-</code></td>
                            <td><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[2])">-</code></td>
                            <td><code data-bind="html: GameConstants.formatSecondsToTime(App.game.farming.berryData[$data].growthTime[3])">-</code></td>
                          </tr>
                          <!-- ko if: App.game.farming.berryData[$data].aura -->
                          <tr>
                            <th colspan="4">Aura Effect at Stage</th>
                          </tr>
                          <tr>
                            <td><code data-bind="html: GameConstants.formatSecondsToTime(1 - 1)">-</code></td>
                            <td><code data-bind="html: App.game.farming.auraDisplay($data, 0)">-</code></td>
                            <td><code data-bind="html: App.game.farming.auraDisplay($data, 1)">-</code></td>
                            <td><code data-bind="html: App.game.farming.auraDisplay($data, 2)">-</code></td>
                          </tr>
                          <!-- /ko -->
                        </table>
                      </td>
                    </tr>  
                    <tr>
                      <td class="p-0" colspan="2">
                        <table class="table table-striped table-hover table-bordered table-sm m-0">
                          <thead>
                            <tr class="text-light">
                              <th class="bg-dark">Wandering Pokémon</th>
                            </tr>
                            <tr>
                              <th colspan="2" data-bind="text: 'Attracted by all Berries'">Base Wanderers</th>
                            </tr>
                          </thead>
                          <tbody class="wanderPokemonList">
                            <tr>
                              <td>
                                <ul class="list-inline">
                                <!-- ko foreach: Berry.baseWander.filter(w => pokemonMap[w].nativeRegion <= GameConstants.MAX_AVAILABLE_REGION) -->
                                  <li class="list-inline-item" data-bind="template: { name: 'wanderingPokémonDisplay', data: $data}"></li>
                                <!-- /ko -->
                                </ul>
                              </td>
                            </tr>
                            <tr>
                              <th colspan="2" data-bind="text: `Attracted to ${BerryColor[App.game.farming.berryData[$data].color]}-Colored Berries`">Color Wanderers</th>
                            </tr>
                            <tr>
                              <td>
                                <ul class="list-inline">
                                <!-- ko foreach: Berry.colorWander[App.game.farming.berryData[$data].color].filter(w => pokemonMap[w].nativeRegion <= GameConstants.MAX_AVAILABLE_REGION) -->
                                <li class="list-inline-item" data-bind="template: { name: 'wanderingPokémonDisplay', data: $data}"></li>
                                <!-- /ko -->
                                </ul>
                              </td>
                            </tr>
                            <!-- ko if: App.game.farming.berryData[$data].wander.some((w) => ![...Berry.baseWander, ...Berry.colorWander[App.game.farming.berryData[$data].color]].includes(w) && pokemonMap[w].nativeRegion <= GameConstants.MAX_AVAILABLE_REGION) -->
                            <tr>
                              <th colspan="2" data-bind="text: `Attracted to ${BerryType[$data]} Berry`">Specific Wanderers</th>
                            </tr>
                            <tr>
                              <td>
                                <ul class="list-inline">
                                <!-- ko foreach: App.game.farming.berryData[$data].wander.filter((w) => ![...Berry.baseWander, ...Berry.colorWander[App.game.farming.berryData[$data].color]].includes(w) && pokemonMap[w].nativeRegion <= GameConstants.MAX_AVAILABLE_REGION) -->
                                  <li class="list-inline-item" data-bind="template: { name: 'wanderingPokémonDisplay', data: $data}"></li>
                                <!-- /ko -->
                                </ul>
                              </td>
                            </tr>
                            <!-- /ko -->
                          </tbody>
                        </table>
                      </td>
                    </tr>              
                  </tbody>
                  <!-- ko if: FarmController.getHint(+$data) !== ""-->
                  <thead>
                    <tr class="text-light">
                      <th class="bg-dark" colspan="2">Hint</th>
                    </tr>
                  </thead>
                  <tbody>
                    <td colspan="2"><span data-bind="text: FarmController.getHint(+$data)"></span></td>
                  </tbody>
                  <!-- /ko -->
                </table>
            </div>
        </div>
    </div>
</div>


<!-- Berry Master Modal-->
<div class="modal fade noselect" id="berryMasterModal" tabindex="-1" role="dialog"
     aria-labelledby="berryMasterModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content" data-bind="let: { shopVisible: ko.observable(true) }">
            <div class="modal-header text-center">
                <h4 data-bind="text: ShopHandler.shopObservable().displayName">Berry Master</h4>
                <button type="button" class="btn btn-primary" data-dismiss="modal">&times;</button>
            </div>
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#berryMasterShop" data-bind="click: function(){shopVisible(true);}">Shop</a></li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#berryMasterTrade" data-bind="click: function(){shopVisible(false);}">Trades</a></li>
                </ul>
            </div>
            <div class="modal-body tab-content">
                <div id="berryMasterShop" class="tab-pane fade in active show">
                    <span data-bind="template: { name: 'shopBodyTemplate' }"></span>
                </div>
                <div id="berryMasterTrade" class="tab-pane fade">
                    <div class="table-responsive" id="dailyDealsBody" style="min-height: 250px;">
                        <table class="table table-sm table-striped m-0 text-left">
                            <thead>
                                <tr>
                                    <th class="text-center">Inv</th>
                                    <th></th>
                                    <th>Berries</th>
                                    <th></th>
                                    <th></th>
                                    <th>Item</th>
                                    <th></th>
                                </tr>
                            </thead>

                            <!-- ko foreach: BerryDeal.getDeals(ShopHandler.shopObservable().location) -->
                            <tbody data-bind="let: { tradeAmount: ko.observable(1) }">
                                <!-- ko foreach: berries -->
                                <tr>
                                    <td class="align-middle" data-bind="text: App.game.farming.berryList[$data.berryType]().toLocaleString('en-US')"></td>
                                    <td class="align-middle"><img height="28px" data-bind="attr: {src: FarmController.getBerryImage($data.berryType) }, css: {'berryLocked': !App.game.farming.unlockedBerries[$data.berryType]() }"></img></td>
                                    <td class="align-middle">
                                        <span data-bind="text: amount.toLocaleString('en-US') + ' '"></span>
                                        <span data-bind="text: '(' + (amount * tradeAmount()).toLocaleString('en-US') + ')', css: { 'text-danger': amount * tradeAmount() > App.game.farming.berryList[$data.berryType]() }"></span>
                                        <span data-bind="text: ' x ' + (App.game.farming.unlockedBerries[$data.berryType]() ? BerryType[$data.berryType] : '???')"></span>
                                    </td>
                                    <!-- ko if: $index() === 0 -->
                                    <td class="align-middle" data-bind="attr: { rowspan: $parent.berries.length }">→</td>
                                    <td class="align-middle" data-bind="attr: { rowspan: $parent.berries.length }">
                                        <img class='mineInventoryItem' data-bind="
                                            attr: {src: $parent.item.itemType.image},
                                            tooltip: {
                                                title: $parent.item.itemType.description ? $parent.item.itemType.description : '',
                                                trigger: 'hover',
                                                placement:'bottom',
                                                html: true
                                              }">
                                    </td>
                                    <td class="align-middle" data-bind='attr: { rowspan: $parent.berries.length }'>
                                        <span data-bind='text: ($parent.item.amount).toLocaleString("en-US") + " (" + ($parent.item.amount * tradeAmount()).toLocaleString("en-US") + ") × " + $parent.item.itemType.displayName'></span>
                                        <span style="float: right; margin-right: 5px">
                                            <knockout data-bind="if: ($parent.item.itemType instanceof CaughtIndicatingItem)">
                                                <span data-bind="template: { name: 'caughtStatusTemplate', data: {'status': $parent.item.itemType.getCaughtStatus()}}"></span>
                                            </knockout>
                                            <knockout data-bind="if: ($parent.item.itemType instanceof PokemonItem)">
                                                <span style="position: relative; top: -1px;"
                                                    data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                                        'pokerus': $parent.item.itemType.getPokerusStatus(), 'width': '32px',
                                                        'evs': App.game.party.getPokemonByName($parent.item.itemType.type)?.evs() }}">
                                                </span>
                                            </knockout>
                                        </span>
                                    </td>
                                    <td class="align-middle" data-bind="attr: { rowspan: $parent.berries.length }">
                                        <div class="btn-group btn-block">
                                            <button class='btn btn-success btn-block' data-bind='attr:{ disabled: (tradeAmount() > $parent.calculateMaxTrades() || !BerryDeal.canUse(ShopHandler.shopObservable()?.location, $parentContext.$index())) }, click: function(){BerryDeal.use(ShopHandler.shopObservable()?.location, $parentContext.$index(), tradeAmount())}, css: { disabled: (tradeAmount() > $parent.calculateMaxTrades() || !BerryDeal.canUse(ShopHandler.shopObservable()?.location, $parentContext.$index())) }'>
                                                Trade
                                            </button>
                                            <button type="button" data-bind="text: tradeAmount().toLocaleString('en-US') + '&nbsp;'" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            </button>
                                            <div class="dropdown-menu" data-bind="foreach: [1, 10, 100, 1000, $parent.calculateMaxTrades()]">
                                                <button class="dropdown-item" type="button" data-bind="click: function(){tradeAmount($data)}, text: $data.toLocaleString('en-US')"></button>
                                            </div>
                                        </div>
                                    </td>
                                    <!-- /ko -->
                                </tr>
                                <!-- /ko -->
                            </tbody>
                            <!-- /ko -->
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <!-- ko if: shopVisible() -->
                <div class="row justify-content-center">
                    <div class="input-group m-0" style="margin-bottom: 6px; margin-top: 6px">
                        <div class="input-group-prepend">
                            <button class="btn btn-warning btn-outline-dark smallButton smallFont" onclick="ShopHandler.resetAmount()">
                                Reset
                            </button>
                        </div>
                        <input id="amountOfItems" type="number" class="outline-dark form-control form-control-number"
                                value="1" min="1" required name="amountOfItems"
                                oninput="ShopHandler.amount(parseInt($(this).val().toString(), 10) || 0);"
                                onchange="ShopHandler.amount(parseInt($(this).val().toString(), 10) || 0);" title=""/>
                        <div class="input-group-append">
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(10)">
                                    +10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(100)">
                                    +100
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.multiplyAmount(10)">
                                    &times;10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.multiplyAmount(0.1)">
                                    &div;10
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(100)">
                                    +100
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="ShopHandler.increaseAmount(1000)">
                                    +1,000
                                </button>
                            <!-- /ko -->
                            <button class="btn btn-primary smallButton smallFont" type="button" onclick="ShopHandler.maxAmount()">
                                Max
                            </button>
                            <button class="btn-outline-dark" data-bind="attr: {class: ShopHandler.calculateButtonCss()}" onclick="ShopHandler.buyItem()">
                                Buy
                            </button>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
                <!-- ko if: !shopVisible() -->
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>


<!-- Gem Master Modal-->
<div class="modal fade noselect" id="gemMasterModal" tabindex="-1" role="dialog"
     aria-labelledby="gemMasterModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4>Gem Master</h4>
                <button type="button" class="btn btn-primary" data-dismiss="modal">&times;</button>
            </div>
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#gemMasterTrade">Trades</a></li>
                </ul>
            </div>
            <div class="modal-body tab-content">
                <div id="gemMasterTrade" class="tab-pane fade in active show">
                    <div class="table-responsive" id="gemDealsBody">
                        <table class="table table-sm table-hover table-striped m-0 text-left">
                            <thead>
                                <tr>
                                    <th class="text-center">Inv</th>
                                    <th></th>
                                    <th>Gems</th>
                                    <th></th>
                                    <th></th>
                                    <th>Item</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody data-bind='foreach: GemDeals.getDeals(ShopHandler.shopObservable().shop)'>
                                <!-- ko if: $data.isVisible() -->
                                    <!-- ko foreach: gems -->
                                    <tr>
                                        <td class="vertical-middle" data-bind="text: App.game.gems.gemWallet[$data.gemType]().toLocaleString('en-US')"></td>
                                        <td class="vertical-middle"><img height="24px" data-bind="attr: {src: Gems.image($data.gemType) }"/></td>
                                        <td class="vertical-middle" data-bind="text: amount.toLocaleString('en-US') + ' x ' + PokemonType[$data.gemType]"></td>
                                        <!-- ko if: $index() === 0 -->
                                        <td class='vertical-middle' data-bind="attr: { rowspan: $parent.gems.length }">→</td>
                                        <td class='vertical-middle' data-bind="attr: { rowspan: $parent.gems.length }">
                                              <img class='mineInventoryItem' data-bind="attr: {
                                                src: $parent.item.itemType.image
                                              },
                                              tooltip: {
                                                title: ItemList[$parent.item.itemType.name].getDescription(),
                                                trigger: 'hover',
                                                placement:'bottom',
                                                html: true
                                              }"/>
                                        </td>
                                        <td class='vertical-middle' data-bind='attr: { rowspan: $parent.gems.length }'>
                                            <span data-bind='text: $parent.item.amount + " × " + $parent.item.itemType.displayName'></span>
                                            <span style="float: right; margin-right: 5px">
                                                <knockout data-bind="if: ($parent.item.itemType instanceof CaughtIndicatingItem)">
                                                    <span data-bind="template: { name: 'caughtStatusTemplate', data: {'status': $parent.item.itemType.getCaughtStatus()}}"></span>
                                                </knockout>
                                                <knockout data-bind="if: ($parent.item.itemType instanceof PokemonItem)">
                                                    <span style="position: relative; top: -1px;"
                                                        data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                                            'pokerus': $parent.item.itemType.getPokerusStatus(), 'width': '32px',
                                                            'evs': App.game.party.getPokemonByName($parent.item.itemType.type)?.evs() }}">
                                                    </span>
                                                </knockout>
                                            </span>
                                        </td>
                                        <td class='vertical-middle' data-bind="attr: { rowspan: $parent.gems.length }">
                                            <div class="btn-group btn-block" data-bind="let: { tradeAmount: ko.observable(1) }">
                                                <button class='btn btn-success btn-block' data-bind='click: function(){GemDeals.use(ShopHandler.shopObservable().shop, $parentContext.$index(), tradeAmount())}, css: { disabled: !GemDeals.canUse(ShopHandler.shopObservable().shop, $parentContext.$index()) }'>
                                                    <knockout data-bind="text: !ItemList[$parent.item.itemType.name].isSoldOut() ? 'Trade' : 'Sold out'"></knockout>
                                                </button>
                                                <button type="button" data-bind="visible: ItemList[$parent.item.itemType.name].maxAmount > 1, text: tradeAmount() + '&nbsp;'" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"'>
                                                </button>
                                                <div class="dropdown-menu" data-bind="foreach: [1, 10, 100, 1000, Infinity]">
                                                    <button class="dropdown-item" type="button" data-bind="visible: ItemList[$parents[1].item.itemType.name].maxAmount > 1, click: function(){tradeAmount($data)}, text: $data"></button>
                                                </div>
                                            </div>
                                        </td>
                                        <!-- /ko -->
                                    </tr>
                                    <!-- /ko -->
                                <!-- /ko -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Shard Master Modal-->
<div class="modal fade noselect" id="shardTraderModal" tabindex="-1" role="dialog"
     aria-labelledby="shardTraderModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 data-bind='text: ShopHandler.shopObservable?.().name'></h4>
                <button type="button" class="btn btn-primary" data-dismiss="modal">&times;</button>
            </div>
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#shardTraderTrade">Trades</a></li>
                </ul>
            </div>
            <div class="modal-body tab-content">
                <div id="shardTraderTrade" class="tab-pane fade in active show">
                    <div class="table-responsive" id="shardDealsBody">
                        <table class="table table-sm m-0 text-left">
                            <thead>
                                <tr class="text-center">
                                    <th class="text-center">Inv</th>
                                    <th colspan="2" data-bind="text: ShopHandler.shopObservable().currencyName"></th>
                                    <th colspan="2">Currency</th>
                                    <th></th>
                                    <th colspan="2">Item</th>
                                    <th data-bind="attr: { hidden: ShopHandler.shopObservable().hidePlayerInventory }">Inv</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody data-bind='foreach: ShardDeal.getDeals(ShopHandler.shopObservable().location)'>
                                <!-- ko if: $data.isVisible() -->
                                    <!-- ko foreach: shards -->
                                    <tr class="text-center">
                                        <td class="align-middle" data-bind="text: player.itemList[$data.shardType.itemName]().toLocaleString('en-US')"></td>
                                        <td class="align-middle">
                                            <img class='mineInventoryItem' data-bind='attr: {src: $data.shardType.image }'>
                                        </td>
                                        <td class="align-middle" data-bind="text: amount.toLocaleString('en-US') + ' x ' + $data.shardType.name"></td>
                                        <!-- ko if: $index() === 0 -->
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length }, text: $parent.questPointCost.toLocaleString('en-US')"></td>
                                        <!-- TODO: Make the QP symbol appear in the same TD as the QP Cost -->
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length }">
                                            <img src='assets/images/currency/questPoint.svg' width="20px" data-bind="attr: { src: `assets/images/currency/${GameConstants.Currency[$parent.currencyType]}.svg`}">
                                        </td>
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length }">→</td>
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length }">
                                            <img class='mineInventoryItem' data-bind="attr: {
                                                src: $parent.item.itemType.image
                                            }">
                                        </td>
                                        <td class="align-middle" data-bind='attr: { rowspan: $parent.shards.length }, text: $parent.item.amount + " × " + $parent.item.itemType.displayName'></td>
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length, hidden: ShopHandler.shopObservable().hidePlayerInventory }, text: player.itemList[$parent.item.itemType.name]().toLocaleString('en-US')"></td>
                                        <td class="align-middle" data-bind="attr: { rowspan: $parent.shards.length }">
                                            <div class="btn-group btn-block" data-bind="let: { tradeAmount: ko.observable(1) }">
                                                <button class='btn btn-success btn-block' data-bind='click: function(){ShardDeal.use(ShopHandler.shopObservable()?.location, $parentContext.$index(), tradeAmount())}, css: { disabled: !ShardDeal.canUse(ShopHandler.shopObservable()?.location, $parentContext.$index()) }'>
                                                    <knockout data-bind="text: !ItemList[$parent.item.itemType.name].isSoldOut() ? 'Trade' : 'Sold out'"></knockout>
                                                </button>
                                                <button type="button" data-bind="visible: ItemList[$parent.item.itemType.name].maxAmount > 1, text: tradeAmount() + '&nbsp;'" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                </button>
                                                <div class="dropdown-menu" data-bind="foreach: [1, 10, 100]">
                                                    <button class="dropdown-item" type="button" data-bind="visible: ItemList[$parents[1].item.itemType.name].maxAmount > 1, click: function(){tradeAmount($data)}, text: $data"></button>
                                                </div>
                                            </div>
                                        </td>
                                        <!-- /ko -->
                                    </tr>
                                    <!-- /ko -->
                                <!-- /ko -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span>Total Quest Points: <span data-bind="text: App.game.wallet.currencies[GameConstants.Currency.questPoint]().toLocaleString('en-US')">-</span></span>
                   <img src='assets/images/currency/questPoint.svg' width="20px">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Generic Trader Modal-->
<div class="modal fade noselect" id="genericTraderModal" tabindex="-1" role="dialog"
     aria-labelledby="genericTraderModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 data-bind='text: ShopHandler.shopObservable?.().name'></h4>
                <button type="button" class="btn btn-primary" data-dismiss="modal">&times;</button>
            </div>
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#genericTraderTrade">Trades</a></li>
                </ul>
            </div>
            <div class="modal-body tab-content">
                <div id="genericTraderTrade" class="tab-pane fade in active show" style="min-height: 250px;">
                    <div style="display: grid; column-gap: 0.5rem; grid-template-columns: auto auto 1fr auto auto auto 1fr auto;">
                        <div class="font-weight-bold" style="grid-column: 1 / 3">Cost</div>
                        <div class="font-weight-bold">Inventory</div>
                        <div class="font-weight-bold"></div>
                        <div class="font-weight-bold" style="grid-column: 5 / 7">Profit</div>
                        <div class="font-weight-bold">Inventory</div>
                        <div class="font-weight-bold"></div>

                        <!-- ko foreach: { data: GenericDeal.getDeals(ShopHandler.shopObservable().traderID), as: 'deal' } -->
                        <div class="align-items-center mt-1" style="display: grid; grid-column: 1 / 9; grid-template-columns: subgrid" data-bind="let: { tradeAmount: ko.observable(1) }">
                            <div class="align-items-center" style="display: grid; grid-column: 1 / 4; grid-template-columns: subgrid">
                                <!-- ko foreach: deal.costs -->
                                <!-- ko template: { name: 'traderCostProfitItemTemplate', data: { model: $data, tradeAmount: tradeAmount(), type: 'cost' } } -->
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                            <div class="mx-4">→</div>
                            <div class="align-items-center" style="display: grid; grid-column: 5 / 8; grid-template-columns: subgrid">
                                <!-- ko foreach: deal.profits -->
                                <!-- ko template: { name: 'traderCostProfitItemTemplate', data: { model: $data, tradeAmount: tradeAmount(), type: 'profit' } } -->
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                            <div>
                                <div class="btn-group btn-block">
                                    <button class='btn btn-success btn-block' data-bind='click: function(){GenericDeal.use(ShopHandler.shopObservable()?.traderID, $index(), tradeAmount())}, attr: { disabled: tradeAmount() > GenericDeal.maxTrades(deal) || !GenericDeal.canUse(ShopHandler.shopObservable()?.traderID, $index()) }'>
                                        <knockout data-bind="text: !GenericDeal.anySoldOut(deal) ? 'Trade' : 'Sold out'"></knockout>
                                    </button>
                                    <button type="button" data-bind="visible: GenericDeal.maxTrades(deal) > 1, text: tradeAmount() + '&nbsp;'" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    </button>
                                    <div class="dropdown-menu" data-bind="foreach: [1, 10, 100]">
                                        <button class="dropdown-item" type="button" data-bind="visible: GenericDeal.maxTrades(deal) > 1, click: function(){tradeAmount($data)}, text: $data"></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="grid-column: 1 / 9;">
                            <hr class="my-2">
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="traderCostProfitItemTemplate">
    <!-- ko if: model.type === 'Gem' -->
    <div><img height="24px" data-bind="attr: {src: Gems.image(model.gemType) }"/></div>
    <div class="text-left" data-bind="text: `${(tradeAmount * model.amount).toLocaleString('en-US')} × ${PokemonType[model.gemType]}`, css: { 'text-danger': type === 'cost' && tradeAmount * model.amount > App.game.gems.gemWallet[model.gemType]() }"></div>
    <div class="text-center" data-bind="text: model.hidePlayerInventory ? '' : App.game.gems.gemWallet[model.gemType]().toLocaleString('en-US')"></div>
    <!-- /ko -->

    <!-- ko if: model.type === 'Shard' -->
    <div><img height="24px" data-bind="attr: {src: model.shardItem.image }"/></div>
    <div class="text-left" data-bind="text: `${(tradeAmount * model.amount).toLocaleString('en-US')} × ${model.shardItem.displayName}`, css: { 'text-danger': type === 'cost' && tradeAmount * model.amount > player.itemList[model.shardItem.name]() }"></div>
    <div class="text-center" data-bind="text: model.hidePlayerInventory ? '' : player.itemList[model.shardItem.name]().toLocaleString('en-US')"></div>
    <!-- /ko -->

    <!-- ko if: model.type === 'Berry' -->
    <div><img height="24px" data-bind="attr: {src: FarmController.getBerryImage(model.berryType) }, css: {'berryLocked': !App.game.farming.unlockedBerries[model.berryType]() }"/></div>
    <div class="text-left" data-bind="text: `${(tradeAmount * model.amount).toLocaleString('en-US')} × ${App.game.farming.unlockedBerries[model.berryType]() ? BerryType[model.berryType] : '???'}`, css: { 'text-danger': type === 'cost' && tradeAmount * model.amount > App.game.farming.berryList[model.berryType]() }"></div>
    <div class="text-center" data-bind="text: model.hidePlayerInventory ? '' : App.game.farming.berryList[model.berryType]().toLocaleString('en-US')"></div>
    <!-- /ko -->

    <!-- ko if: model.type === 'Item' -->
    <div><img height="24px" data-bind="attr: {src: model.item.image }"/></div>
    <div class="text-left" data-bind="text: `${(tradeAmount * model.amount).toLocaleString('en-US')} × ${model.item.displayName}`, css: { 'text-danger': type === 'cost' && tradeAmount * model.amount > player.itemList[model.item.name]() }"></div>
    <div class="text-center" data-bind="text: model.hidePlayerInventory ? '' : player.itemList[model.item.name]().toLocaleString('en-US')"></div>
    <!-- /ko -->

    <!-- ko if: model.type === 'Amount' -->
    <div><img height="24px" data-bind="attr: {src: `assets/images/currency/${GameConstants.Currency[model.currency.currency]}.svg` }"/></div>
    <div class="text-left" data-bind="text: `${(tradeAmount * model.currency.amount * model.amount).toLocaleString('en-US')} × ${GameConstants.camelCaseToString(GameConstants.Currency[model.currency.currency])}`, css: { 'text-danger': type === 'cost' && tradeAmount * model.currency.amount * model.amount > App.game.wallet.currencies[model.currency.currency]() }"></div>
    <div class="text-center" data-bind="text: model.hidePlayerInventory ? '' : App.game.wallet.currencies[model.currency.currency]().toLocaleString('en-US')"></div>
    <!-- /ko -->
</script>


<!-- Subregion Modal-->
<div class="modal noselect fade" id="SubregionModal" tabindex="-1" role="dialog" aria-labelledby="SubregionModal">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Subregional Travel</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <h5 data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[player.region])">Region</h5>
            <div class="modal-body bg-ocean">
                <img class="my-5" src='assets/images/boat.png' style='width: 40%;'>
                <div style='margin-top:20px' data-bind="foreach: SubRegions.getSubRegions(player.region)">
                    <!-- ko if: $data !== 'none' -->
                    <button style="position: relative;" class='btn btn-block btn-success'
                        data-dismiss='modal'
                        data-bind='visible: $data.unlocked(),
                        click: () => { player.subregion = $data.id; $("#SubregionModal").modal("hide"); },
                        attr: { disabled: player.subregion == $data.id }'>
                        <img style="position:absolute; left: 10px;" data-bind="visible: player.subregion == $data.id, attr: { src: `assets/images/profile/trainer-${App.game.profile.trainer() || 0}.png` }"/> <knockout data-bind="text: $data.name">Region</knockout>
                    </button>
                    <!-- /ko -->
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Ship Modal-->
<div class="modal noselect fade" id="ShipModal" tabindex="-1" role="dialog" aria-labelledby="ShipModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header" style='justify-content: space-around;'>
                <h5 class="modal-title">Regional Travel</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body bg-ocean">
                <img class="my-5" src='assets/images/ship.png' style='width: 100%;'>
                <div style='margin-top:20px'>
                    <!-- ko foreach: GameHelper.enumStrings(GameConstants.Region) -->
                        <!-- ko if: $data !== 'none' && GameConstants.Region[$data] <= GameConstants.MAX_AVAILABLE_REGION -->
                            <!-- ko if: GameConstants.Region[$data] <= player.highestRegion() -->
                            <div class="btn-group w-100 my-1">
                                <button style="position: relative;" class='btn btn-block btn-success ship-modal-region-button'
                                    data-dismiss='modal'
                                    data-bind='click: () => { player.region = GameConstants.Region[$data]; player.subregion = 0; MapHelper.moveToTown(GameConstants.DockTowns[GameConstants.Region[$data]]); $("#ShipModal").modal("hide"); },
                                    attr: { disabled: player.region == GameConstants.Region[$data] }'>
                                    <img style="position:absolute; left: 10px;" data-bind="visible: player.region == GameConstants.Region[$data], attr: { src: `assets/images/profile/trainer-${App.game.profile.trainer() || 0}.png` }"/> <knockout data-bind="text: GameConstants.camelCaseToString($data)">Region</knockout>
                                </button>
                                <!-- ko using: Weather.regionalWeather[GameConstants.Region[$data]], as: 'weatherType' -->
                                <button class="btn btn-weather-dock" style="right: 0px; top: 0px; width: auto; padding: 0 4px;"
                                    data-bind='style: { background: Weather.weatherConditions[weatherType].color },
                                        tooltip: {
                                            title: GameConstants.humanifyString(WeatherType[weatherType]),
                                            placement: "bottom",
                                            trigger: "hover",
                                            boundary: "window",
                                        }'>
                                    <img width=30px src="" data-bind="attr: { src: `assets/images/weather/${WeatherType[weatherType]}.png` }"/>
                                </button>
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                            <!-- ko if: GameConstants.Region[$data] > player.highestRegion() -->
                            <div class="btn-group w-100 my-1">
                                <button style="position: relative;" class='btn btn-block btn-success ship-modal-region-button'
                                        data-bind='attr: { disabled: true }'>
                                    <knockout>Unexplored region</knockout>
                                </button>
                            </div>
                            <!-- /ko -->
                        <!-- /ko -->
                    <!-- /ko -->
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Safari Modal -->
<div aria-labelledby="safariModal" class="modal fade noselect" id="safariModal" role="dialog" style="cursor:default" tabindex="-1" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="controls" data-bind="visible: Safari.inProgress() && !Safari.inBattle()">
                <div style="width:120px">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 411 411">
                        <g>
                          <path fill="whitesmoke" d="M382 137h-89c-11 0-19-8-19-19V29c0-16-13-29-29-29h-79c-16 0-29 13-29 29v89c0 11-8 19-19 19H29c-16 0-29 13-29 29v79c0 16 13 29 29 29h89c11 0 19 8 19 19v89c0 16 13 29 29 29h79c16 0 29-13 29-29v-89c0-11 8-19 19-19h89c16 0 29-13 29-29v-79c0-16-13-29-29-29zM93 244c0 2-2 3-4 2l-52-38c-2-1-2-4 0-5l52-38c2-1 4 0 4 3v76zm72-155l38-52c1-2 4-2 5 0l38 52c1 2 0 4-2 4h-76c-3 0-4-2-3-4zm81 233l-38 52c-1 2-4 2-5 0l-38-52c-1-2 0-4 3-4h76c2 0 3 2 2 4zm-40-69a47 47 0 110-94 47 47 0 010 94zm168-45l-52 38c-2 1-4 0-4-2v-76c0-3 2-4 4-3l52 38c2 1 2 4 0 5z"/>
                          <path id="safari-dpad-up" fill="transparent" d="M135 1h142v137H135z" /><!-- up -->
                          <path id="safari-dpad-left" fill="transparent" d="M1 137h142v137H1z" /><!-- left -->
                          <path id="safari-dpad-down" fill="transparent" d="M135 273h142v137H135z" /><!-- down -->
                          <path id="safari-dpad-right" fill="transparent" d="M268 137h142v137H268z" /><!-- right -->
                        </g>
                    </svg>
                </div>
            </div>
            <div class="modal-header">
                <h4 style='text-align:center' class="modal-title">
                    Safari Zone
                    <span data-bind="if: Safari.completed(false, player.region)">
                        <img class="pokeball-smallest"
                            data-bind='attr:{
                                title:"You have captured all of the Safari Pokémon" + (Safari.completed(true, player.region) ? " shiny" : "") + "!",
                                src:"assets/images/pokeball/Pokeball" + (Safari.completed(true, player.region) ? "-shiny" : "") + ".svg"
                            }'
                        />
                    </span>
                </h4>
                <div class='col-6' data-bind="tooltip : Safari.safariProgressTooltip()">
                    <div>Lvl. <knockout data-bind='text: Safari.safariLevel()'></knockout></div>
                    <div class="progress" style='height: 5px'>
                        <div class="progress-bar bg-info" role="progressbar"
                             data-bind="attr:{ style: 'width:' + Safari.percentToNextSafariLevel() + '%' }"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                </div>
                <button class='btn btn-danger modalClose' onclick='Safari.closeModal()'>Leave</button>
            </div>

            <div class="modal-body p-0">
                <!-- Tab Titles -->
                <ul style="width:100%" class="nav nav-tabs nav-fill">
                    <li class="nav-item">
                        <a data-toggle='tab' class='nav-link active' href="#safariExplore">Explore</a>
                    </li>
                    <li class='nav-item'>
                        <a class='nav-link' href="#safariHelp" data-bind="attr: {'data-toggle': Safari.inBattle() ? '' : 'tab'}">Help</a>
                    </li>
                </ul>

                <!-- Tab Contents -->
                <div class=tab-content>

                    <!-- Main tab -->
                    <div  id="safariExplore" class="tab-pane fade in active show">
                        <div class="modal-body p-0">

                            <div id="safariEntrance" data-bind="if: !Safari.inProgress()">
                                <button id="paySafariButton" class="btn btn-block" onclick="Safari.payEntranceFee()"
                                    data-bind="class: Safari.canPay() ? 'btn-primary' : 'disabled btn-danger'">
                                    Pay Entrance Fee <knockout id='safariEntranceCost' data-bind="template: { name: 'currencyTemplate', data: {'amount': Safari.cost().amount, 'currency': Safari.cost().currency}}"></knockout>
                                </button>
                                <img class='fit-width' src="assets/images/safari/area1.png" />
                            </div>

                            <div class='container-fluid' data-bind="if: Safari.inProgress()" style="overflow-x: auto; padding: 0px;">
                                <div id="safariBody" style="position: relative; width: max-content; overflow-x: hidden;">
                                    <div data-bind="foreach: Safari.grid, childrenComplete: () => Safari.addPlayer()">
                                        <div class="row flex-nowrap" data-bind="foreach: $data" style="margin: 0 -1px !important;">
                                            <div class="safariSquare" data-bind="attr: { id: `safari-${$parentContext.$index()}-${$context.$index()}` }, style: { 'background-image': `url('assets/images/safari/tiles/${GameConstants.SafariTile[$data]}.png')`, 'z-index': ([GameConstants.SafariTile.treeTopL, GameConstants.SafariTile.treeTopC, GameConstants.SafariTile.treeTopR].includes($data) ? '3' : 'auto') } ">
                                            </div>
                                        </div>
                                    </div>
                                    <div id="sprite" style="position: absolute;"></div>
                                    <!-- ko foreach: Safari.pokemonGrid -->
                                        <div class="pokemonSprite walkDown" data-bind="css: { shiny: $data.shiny },
                                        style: {
                                            backgroundImage: `${$data.shiny ? 'url(\'assets/images/dynamic-background/pokemon/sparkle.png\'), ' : ''}url('assets/images/dynamic-background/pokemon/${$data.spriteID.toString()}${$data.shiny ? 's' : ''}.png')`,
                                            top: `${32 * $data.y - 8}px`,
                                            left: `${32 * $data.x - 4}px`,
                                        }"></div>
                                    <!-- /ko -->
                                    <!-- ko foreach: Safari.itemGrid -->
                                        <div class="safari-item" data-bind="
                                        style: {
                                            top: `${32 * $data.y}px`,
                                            left: `${32 * $data.x}px`,
                                        }"></div>
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Help tab -->
                    <div  id="safariHelp" class="tab-pane fade">
                        <div class="modal-body" style="width: 80%;margin: auto;">
                            <div id="safariHelpText">
                                <p>The Safari Zone uses a different method of encountering and capturing Pokémon, and it contains several unique Pokémon.</p>
                                <p>After paying the entrance fee, you will be able to walk around in the Safari Zone. To encounter Pokémon, you must either walk in the tall grass or walk into Pokémon that randomly appear on the map.</p>
                                <p>As you perform actions, you will gain Safari XP and increase your Safari Level. If you catch a Pokémon, there is a chance an item will appear on the map.</p>
                                <p>
                                    When you have encountered a Pokémon, you will be given 4 options:
                                    <table class="table table-bordered table-sm" style="color: inherit;">
                                        <tr>
                                            <td class="align-middle"><b>Ball</b></td>
                                            <td>This will throw a Poké Ball and give you a chance of capturing the Pokémon. Provides 10 Safari XP.</td>
                                        </tr>
                                        <tr>
                                            <td class="align-middle"><b>Rock</b></td>
                                            <td>Throwing a Rock will make the Pokémon angry, and more likely to flee, but easier to catch. Provides 10 Safari XP.</td>
                                        </tr>
                                        <tr>
                                            <td class="align-middle"><b>Bait</b></td>
                                            <td>Throwing any kind of Bait will make the Pokémon eat, and less likely to flee, but harder to catch. Berry Baits change the base rates of the Pokémon, with Razz lowering flee rate, and Nanab increasing catch rate. Only one Berry effect can be present at a time. Provides 5 Safari XP.</td>
                                        </tr>
                                        <tr>
                                            <td class="align-middle"><b>Run</b></td>
                                            <td>This will end the encounter.</td>
                                        </tr>
                                    </table>
                                </p>
                                <p>Catching a Pokémon will provide 50 Safari XP. Shiny is 5×</p>
                                <p>Picking up an item will provide 10 Safari XP.</p>
                                <p>After your turn of the encounter, if it did not result in the encounter ending, the wild Pokémon will have a chance of running away.</p>
                                <p>Your safari exploration will end when you have run out of Poké Balls. You can freely leave and re-enter without having to pay the fee again as long as you still have Poké Balls remaining.</p>
                                <p>Safari Level will increase the effectiveness of Rocks and Bait, the catch chance, the Egg Steps gained from walking, and the odds that an item will spawn when a Pokémon is caught.</p>
                                <p>Some items are not available until a certain Safari Level is reached.</p>
                                <p>
                                    Every 10 Safari Levels, the animation will speed up by the following values:
                                    <ul style="list-style-type: none;">
                                        <li><b>Level 10:</b> 11% faster.</li>
                                        <li><b>Level 20:</b> 33% faster.</li>
                                        <li><b>Level 30:</b> 75% faster.</li>
                                        <li><b>Level 40:</b> 122% faster.</li>
                                    </ul>
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<!-- Safari Modal -->
<div class="modal fade noselect" id="safariBattleModal" tabindex="-1" role="dialog" aria-badgeledby="safariBattleModal" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md" role="document">
       <div class="modal-content">
           <div class="modal-body p-0">
              <div class="battle-view" data-bind="class: Safari.environmentCssClass()">
                <div class="row justify-content-center no-gutters" data-bind="if: Safari.inBattle">
                  <div class="col no-gutters clickable" data-bind="click: function() {BattleFrontierBattle.clickAttack()}" style="height: 280px; display: block;">
                      <h2 class="pageItemTitle" style="display: block;">

                          <knockout class="left">
                          </knockout>

                          <knockout>
                                <knockout data-bind="template: { name: 'pokemonNameTemplate', data: { 'pokemon': SafariBattle.enemy } }">Pokémon name</knockout>
                                <knockout data-bind="template: { name: 'caughtStatusTemplate', data: {'status': PartyController.getCaughtStatus(SafariBattle.enemy.id)}}"></knockout>
                                <knockout style="position: relative; top: -1px;"
                                    data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                        'pokerus': PartyController.getPokerusStatus(SafariBattle.enemy.id),
                                        'evs': App.game.party.getPokemon(SafariBattle.enemy.id)?.evs() }}">
                                </knockout>
                          </knockout>

                          <knockout class="right">
                          </knockout>
                      </h2>

                      <div>
                          <knockout data-bind="template: { name: 'pokemonSpriteTemplate', data: { 'pokemon': SafariBattle.enemy } }">Pokémon sprite</knockout>
                      </div>

                      <h2 class="pageItemFooter" style="display: block;">

                          <knockout class="left" data-bind="text: `Catch chance: ${SafariBattle.enemy.catchFactor.toFixed(2)} %`">
                          </knockout>
                            &nbsp;
                          <knockout class="right" data-bind="text: `Escape chance: ${SafariBattle.enemy.escapeFactor.toFixed(2)} %`">
                          </knockout>
                      </h2>
                  </div>
                </div>
              </div>
           </div>

           <div class="modal-footer p-0 bg-dark text-light">
                <div class="message" data-bind='html: SafariBattle.text'></div>
                <div class="row" style="width: 100%;">
                    <button type="button" class="btn btn-primary btn-block col-6 m-0" onclick="this.blur();SafariBattle.throwBall()" data-bind="disable: SafariBattle.busy()">
                        <span class="position-absolute small" style="left: 5px;" data-bind="text: `[${Settings.getSetting('hotkey.safari.ball').observableValue()}]`"></span>
                        <knockout data-bind="text: `Ball (${Safari.balls()})`">Ball (30)</knockout>
                    </button>
                    <div class="btn-group btn-block col-6 m-0 dropup" style="padding:0px;">
                        <button type="button" class='btn btn-primary btn-block' onclick="this.blur();"
                            data-bind='{ click: function(){SafariBattle.throwBait();}, disable: SafariBattle.selectedBait().amount() <= 0 || SafariBattle.busy() }'>
                            <span class="position-absolute small" style="left: 5px;" data-bind="text: `[${Settings.getSetting('hotkey.safari.bait').observableValue()}]`"></span>
                            <div style="display:inline"><img width=16px data-bind="attr: { src: SafariBattle.selectedBait().image }"></div>
                            <span data-bind="text: SafariBattle.selectedBait().btnName">Bait (∞)</span>
                        </button>
                        <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split active" data-bind="text: '&nbsp;'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" data-bind="foreach: GameHelper.enumStrings(BaitType)">
                            <button class="dropdown-item" type="button" data-bind="click: function(){SafariBattle.selectedBait(BaitList[$data])}, text: BaitList[$data].btnName"></button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary btn-block col-6 m-0" onclick="this.blur();SafariBattle.throwRock()" data-bind="disable: SafariBattle.busy()">
                        <span class="position-absolute small" style="left: 5px;" data-bind="text: `[${Settings.getSetting('hotkey.safari.rock').observableValue()}]`"></span>
                        Rock (∞)
                    </button>
                    <button type="button" class="btn btn-primary btn-block col-6 m-0" onclick="this.blur();SafariBattle.run()" data-bind="disable: SafariBattle.busy()">
                        <span class="position-absolute small" style="left: 5px;" data-bind="text: `[${Settings.getSetting('hotkey.safari.run').observableValue()}]`"></span>
                        Run
                    </button>
                </div>
           </div>
       </div>
    </div>
</div>


<!-- NPC Modal-->
<div class="modal fade noselect" id="npc-modal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body text-center" data-bind="with: NPCController.selectedNPC">
        <u><h5 class="npc-name" data-bind="text: $data.name"></h5></u>
        <img class="npc-image" data-bind="visible: $data.options.image, attr: { src: $data.options.image }" />
        <div class="npc-dialog" data-bind="html: $data.dialogHTML"></div>
        <!-- ko ifnot: $data.type == NPCType.Gift -->
        <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">Close</button>
        <!-- /ko -->
        <!-- ko if: $data.type == NPCType.Gift -->
        <img class="npc-gift-image mb-4" data-bind="visible: $data.giftImage, attr: { src: $data.giftImage }" />
        <div class="d-flex">
          <button type="button" class="btn btn-success col mr-1" data-dismiss="modal"
            data-bind="click: () => $data.acceptGift()">Accept</button>
          <button type="button" class="btn btn-primary col ml-1" data-dismiss="modal">Close</button>
        </div>
        <!-- /ko -->
      </div>
    </div>
  </div>
</div>


<!-- Pokeball Selector Modal -->
<div class="modal fade" id="pokeballSelectorModal" tabindex="-1" role="dialog"
  aria-labelledby="PokeballSelectorModal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pokeballSelectorModalLabel">Poké Ball Selection</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div class="table-warning p-1 text-left" data-bind="text: App.game.pokeballs.selectedTitle"></div>
        <div class="card-body p-0 show table-responsive text-left">
          <table class="table table-sm m-0">
            <thead>
              <tr>
                <th class="text-center" width="20%">Ball</th>
                <th>Description</th>
                <th class="text-center">Qty</th>
              </tr>
            </thead>
            <tbody>
              <tr class="clickable"
                data-bind="template: { name: 'pokeballSelectionTemplate', data: { 'image': 'None', 'type': -1, 'description': 'Do not catch' }},
                    click: function(){App.game.pokeballs.selectedSelection()?.(GameConstants.Pokeball.None)}"></tr>
              <!-- ko foreach: App.game.pokeballs.pokeballs -->
              <tr class="clickable"
                data-bind="template: { name: 'pokeballSelectionTemplate', data: $data},
                  click: function(){App.game.pokeballs.selectedSelection()?.($data.type)},
                  visible: $data.unlocked() || $data.quantity(),
                  css: {
                    'clickable': !($data.type === GameConstants.Pokeball.Masterball && App.game.challenges.list.disableMasterballs.active()),
                    'disabled no-click text-muted': ($data.type === GameConstants.Pokeball.Masterball && App.game.challenges.list.disableMasterballs.active()),
                  }"></tr>
              <!-- /ko -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/html" id="pokeballSelectionTemplate">
  <td class="text-center">
    <img class="pokeball-small"
      data-bind="attr: {src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.type] + '.svg'}, css: {'pokeball-selected': App.game.pokeballs.selectedSelection()?.() === $data.type}, tooltip: {title: $data.type === -1 ? 'None' : ItemList[GameConstants.Pokeball[$data.type]].displayName, trigger: 'hover', animation: false, placement: 'bottom'}"/>
  </td>
  <td class="align-middle">
    <span data-bind="text: $data.description"></span>
  </td>
  <td class="text-center align-middle">
    <span data-bind="text: $data.quantity && $data.quantity() ? GameConstants.formatNumber($data.quantity()) : '-', tooltip: $data.quantity && {title: $data.quantity().toLocaleString('en-US'), trigger: 'hover', animation: false, placement: 'left'}"></span>
  </td>
</script>


<!-- Pokeball Selector Config Modal -->
<div class="modal fade" id="pokeballSelectorAdvModal" tabindex="-1" role="dialog"
    aria-labelledby="PokeballSelectorAdvModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header p-0" style='justify-content: space-around;'>
                <ul class="nav nav-tabs nav-fill w-100">
                    <li class="nav-item">
                        <a data-toggle='tab' class='nav-link active' href="#pokeballFilterConfigTab">
                            Configure Filters
                        </a>
                    </li>
                    <li class="nav-item">
                        <a data-toggle='tab' class='nav-link' href="#pokeballFilterTestTab">
                            Test Filters
                        </a>
                    </li>
                    <li class="nav-item">
                        <a data-toggle="tab" class="nav-link" href="#pokeballFilterHelpTab">
                            Help
                        </a>
                    </li>
                </ul>
            </div>
            <div class="modal-body p-0">
                <div class="tab-content">
                    <div id="pokeballFilterConfigTab" class="tab-pane active p-3">
                        <div>
                            <button class="btn btn-primary my-2 mr-2" onclick="App.game.pokeballFilters.createFilter()">
                                Create New Filter
                            </button>
                            <button class="btn btn-primary my-2" onclick="App.game.pokeballFilters.reset()">
                                Reset Filters
                            </button>
                        </div>
                        <p class="mb-1 small">
                            ** Filters closer to the
                            <strong class="text-warning" data-bind="text: Settings.getSetting('catchFilters.invertPriorityOrder').observableValue() ? 'bottom' : 'top'">top</strong>
                            have a higher priority! **
                        </p>
                        <div id="pokeballFilterConfigs"
                            data-bind="sortable: {
                                foreach: App.game.pokeballFilters.list,
                                options: {
                                    group: 'pokeballFilters',
                                    draggable: '.pokeballFilterWrapper',
                                    handle: '.pokeballFilterDragHandle',
                                    dataIdAttr: 'data-key',
                                    getId: (filter) => filter.uuid,
                                }
                            }">
                            <div class="pokeballFilterWrapper" data-bind="
                                visible: !PokeballFilters.hideFilter($data)
                            ">
                                <div class="pokeballFilterDragHandle bg-dark text-white"></div>
                                <div class="pokeballFilter">
                                    <div class="pokeballFilterHeader">
                                        <div class="pokeballFilterEnableToggle" data-bind="
                                            tooltip: {
                                                title: $data.enabled() ? 'Enabled' : 'Disabled',
                                                trigger: 'hover',
                                                animation: false,
                                                placement: 'bottom',
                                            },
                                            template: {
                                                name: 'toggleSliderTemplate',
                                                data: {
                                                    value: $data.enabled,
                                                    key: `checkbox-enabled-${$index()}`
                                                },
                                            }
                                        "></div>
                                        <button class="btn-circle btn-info"
                                                data-bind="tooltip: {
                                                    title: $data.description,
                                                    trigger: 'hover',
                                                    animation: false,
                                                    placement: 'right',
                                                    html: true,
                                                }"
                                        >?</button>
                                        <div class="pokeballFilterName">
                                            <input class="form-control" data-bind="textInput: $data._name"></span>
                                        </div>
                                        <img class="clickable pokeball-selected pokeball-small" data-bind="
                                        attr: {
                                            src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.ball()] + '.svg'},
                                            tooltip: {
                                                title: $data.ball() === -1 ? 'None' : ItemList[GameConstants.Pokeball[$data.ball()]].displayName,
                                                trigger: 'hover',
                                                animation: false,
                                                placement: 'bottom'
                                            },
                                            click: function() {
                                                App.game.pokeballs.selectedSelection($data.ball);
                                                App.game.pokeballs.selectedTitle($data.name);
                                                $('#pokeballSelectorModal').modal('show')
                                            },
                                        }" />
                                    </div>
                                    <button class="pokeballFilterExpandBtn btn btn-secondary btn-block"
                                            data-toggle="collapse"
                                            data-bind="attr: { href: `#pokeball-filter-options-${$index()}` }"
                                    >Toggle Settings</button>
                                    <div class="collapse pokeballFilterBody"
                                        data-bind="attr: { id: `pokeball-filter-options-${$index()}`}">
                                        <table class="pokeballFilterOptions">
                                            <tbody>
                                                <!-- ko foreach: Object.entries($data.options).map(([k, v]) => ({ optionName: k, setting: v })) -->
                                                <tr>
                                                    <td>
                                                        <button class="btn-circle btn-danger"
                                                            data-bind="click: () => App.game.pokeballFilters.removeFilterOption($parent, optionName)">
                                                            <span>&minus;</span>
                                                        </button>
                                                    </td>
                                                    <!-- ko template: {
                                                    name: setting instanceof BooleanSetting ? 'pokeballFilterSlider' : 'pokeballFilterMultipleChoice',
                                                    data: { setting, key: $index() },
                                                } --><!-- /ko -->
                                                </tr>
                                                <!-- /ko -->
                                                <!-- ko foreach: Object.keys(pokeballFilterOptions).filter(k => !(k in $data.options) && pokeballFilterOptions[k].canUse()) -->
                                                <tr class="bg-faded text-white">
                                                    <td>
                                                        <button class="btn-circle btn-success"
                                                            data-bind="click: () => App.game.pokeballFilters.addFilterOption($parent, $data)">
                                                            <span>&plus;</span>
                                                        </button>
                                                    </td>
                                                    <td class="p-2"
                                                        data-bind="text: pokeballFilterOptions[$data].defaultSetting.displayName">
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                <!-- /ko -->
                                                <!-- Commenting out the invert filter because it is confusing and possibly not even wanted
                                                     Can be re-enabled in a future release if we find it is wanted
                                                    tr>
                                                    <td></td>
                                                    <td class="p-2"><label class="m-0" data-bind="attr: { 'for': `checkbox-inverted-${$index()}` }">Invert Filter:</label></td>
                                                    <td class="p-2" data-bind="template: {
                                                        name: 'toggleSliderTemplate',
                                                        data: {
                                                            value: $data.inverted,
                                                            key: `checkbox-inverted-${$index()}`,
                                                        }
                                                    }"></td>
                                                </tr -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="pokeballFilterDelete">
                                    <button class="btn bg-danger text-white deleteButton"
                                        data-bind="click: () => App.game.pokeballFilters.deleteFilter($data)">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="pokeballFilterTestTab" class="tab-pane p-3">
                        <div>
                            <p>This tab is useful for making sure what your filters match, and which ones take precedence. See the Help tab for more details.</p>
                        </div>
                        <div id="pokeballFilterTestInput">
                            <p>Configure these options to describe a Pokémon you want to test:</p>
                            <table>
                                <tbody data-bind="foreach: Object.entries(App.game.pokeballFilters.testSettings)
                                                                .filter(([k]) => pokeballFilterOptions[k]?.canUse() ?? true)
                                                                .map(([k, s]) => s)">
                                    <tr data-bind="template: {
                                                            name: $data instanceof BooleanSetting ? 'pokeballFilterSlider' : 'pokeballFilterMultipleChoice',
                                                            data: { setting: $data, key: `test-${$index()}` },
                                                        }"></tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="pokeballFilterTestResults" data-bind="using: App.game.pokeballFilters.findMatch(
                                                                    App.game.pokeballFilters.testSettingsData()
                                                                )">
                            <p id="pokeballFilterTestMatch">
                                <span data-bind='visible: $data, text: `This will use your "${$data?.name}" filter`'></span>
                                <span data-bind='visible: !$data'>None of your enabled filters match this scenario</span>
                                <!-- ko if: $data -->
                                <img class="pokeball-selected pokeball-small" data-bind="
                                    attr: {
                                        src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data?.ball()] + '.svg'},
                                        tooltip: {
                                            title: $data?.ball() === -1 ? 'None' : ItemList[GameConstants.Pokeball[$data?.ball()]].displayName,
                                            trigger: 'hover',
                                            animation: false,
                                            placement: 'bottom'
                                        },
                                }" />
                                <!-- /ko -->
                            </p>
                            <div data-bind="foreach: App.game.pokeballFilters.displayList()">
                                <p data-bind="
                                    class: $data.test(App.game.pokeballFilters.testSettingsData()) ? 'bg-success text-white' : '',
                                    css: {
                                        'pokeballFilterDisabled': !$data.enabled(),
                                        'font-weight-bold': $parent === $data,
                                        'darker-25': $parent !== $data,
                                    }
                                ">
                                    <span data-bind="if: $parent === $data">*** </span>
                                    <span data-bind="text: $data.name"></span>
                                    <span data-bind="if: $parent === $data"> ***</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="pokeballFilterHelpTab" class="tab-pane p-3">
                        <h2>Configure Filters</h2>
                        <p>
                            Use this tab to add, edit, re-order, and remove Pokéball filters.
                        </p>
                        <p>
                            Click the "Toggle Settings" button for a filter to configure how it works.
                            Options listed first are all the values that are checked when catching - you can click their <button class="btn-circle btn-danger float-none">&minus;</button> to remove these.
                            The darker options below that are not checked.
                            You can click their <button class="btn-circle btn-success float-none">&plus;</button> button to include it in the filter, and choose a value it must match.
                        </p>
                        <p>
                            Filters can be re-ordered by dragging them from the bar on the left side of each filter.
                            You can click the x on the right of each filter to remove them - this will open a confirmation box to prevent accidentally deleting one.
                        </p>
                        <p>
                            Some filter options and default filters are hidden at the start of the game, and will unlock as they become relevant.
                        </p>
                        <p>
                            The "Enabled" toggle allows you to turn a filter off.
                            Disabled filters will be grayed out in the filter list on the main game screen, and also in the Test Filters tab.
                            The "Inverted" toggle, when turned on, will make that filter <i>ignore</i> any Pokémon that match its conditions, and catch all the rest.
                        </p>
                        <p>
                            You can hover (or tap) the <button class="btn-circle btn-info float-none">&#8505;</button> icon for a description of what the filter will catch.
                        </p>
                        <p>
                            Right click (or long press on mobile) can be used to enable/disable filters from the main screen without opening this menu.
                        </p>

                        <h2>Test Filters</h2>
                        <p>
                            In some scenario, multiple of your filters may meet all of their conditions,
                            but only one can be used to choose a ball for catching.
                        </p>
                        <p>
                            This tab will allow you to see exactly which will be chosen,
                            for some scenario you configure with the settings in the tab.
                        </p>
                        <p>
                            For instance, if you wanted to know what is used for a shiny Rattata,
                            when you already have a normal Rattata,
                            you would turn on the "Shiny" and "Caught" toggles,
                            but leave the others off.
                        </p>
                        <p>
                            With the default catch filters,
                            you will see that both "Caught" and "New Shiny" meet their conditions,
                            but the "New Shiny" filter is the one used for catching.
                            The filter furthest down in your list that matches all conditions is the one used.
                            The highlighted filters are ones that matched the scenario.
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="toggleSliderTemplate">
    <!-- ko if: $data.text -->
    <label data-bind="attr: { for: $data.key }, text: $data.text"></label>
    <!-- /ko -->
    <label class="form-check-label toggler-wrapper style-1 m-auto">
        <input class="clickable" type="checkbox"
            data-bind="checked: $data.value, attr: { id: $data.key }">
        <div class="toggler-slider">
            <div class="toggler-knob"></div>
        </div>
    </label>
</script>
<script type="text/html" id="pokeballFilterSlider">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: `checkbox-${setting.name}-${key}` }, text: `${setting.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-2">
        <label class="form-check-label toggler-wrapper style-1 m-auto">
            <input class="clickable" type="checkbox"
                data-bind="checked: setting.observableValue, attr: { id: `checkbox-${setting.name}-${key}` }">
            <div class="toggler-slider">
                <div class="toggler-knob"></div>
            </div>
        </label>
    </td>
</script>

<script type="text/html" id="pokeballFilterMultipleChoice">
    <td class="p-2" data-bind="text: `${setting.displayName}:`">setting name</td>
    <td class="p-0">
        <select class="form-control" data-bind="
            options: setting.getValidOptions(),
            optionsValue: 'value',
            optionsText: 'text',
            value: setting.observableValue
        "></select>
    </td>
</script>


<!-- Damage Calculator Modal -->
<script type="text/html" id="damageDetailTemplate">
  <tr data-toggle="modal" href="#pokemonStatisticsModal" data-bind="click: () => { App.game.statistics.selectedPokemonID($data.id) }" >
      <td>
          <img class="smallImage" data-bind="attr:{ src: PokemonHelper.getImage($data.id) }" src=""/>
      <td class="text-nowrap">
          <span data-bind="text: $data.displayName">Name</span><sup data-bind="visible: App.game.party.alreadyCaughtPokemon($data.id, true)">✨</sup>
      </td>
      <td data-bind="text: Math.round(damage).toLocaleString('en-US')">Damage</td>
      <td data-bind="text: PokemonType[type1]">Type 1</td>
      <td data-bind="text: PokemonType[type2]">Type 2</td>
  </tr>
</script>

<div class="modal fade" id="damageCalculatorModal" tabindex="-1" role="dialog"
aria-labelledby="damageCalculatorModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
        <!-- ko if: DisplayObservables.modalState.damageCalculatorModal === 'show' -->
        <div class="modal-header">
            <h5 class="modal-title" id="damageCalculatorModalLabel">Damage Calculator</h5>
            <button type="button" class="btn btn-info"
            style="position: absolute; right: 0px; top: 0px; width: auto; height: 61px; padding: 10px;"
            data-bind="tooltip: { title: `Check how much damage you are doing against a particular Pokémon type, and see a breakdown of where that damage is coming from by your Pokémon types.`, trigger: 'hover', placement:'left' }">
            ?
            </button>
        </div>
        <div class="modal-body p-2">
            <div class="form-row m-0">
                <div class="form-group col-4 col-lg">
                    <label>Region</label>
                    <select autocomplete="off" class="custom-select" data-bind="value: DamageCalculator.region">
                        <!-- ko foreach: GameHelper.enumStrings(GameConstants.Region).filter(r => GameConstants.Region[r] <= player.highestRegion()) -->
                        <option data-bind="value: GameConstants.Region[$data], text: GameConstants.camelCaseToString($data)">Region</option>
                        <!-- /ko -->
                    </select>
                </div>
                <div class="form-group col-4 col-lg">
                    <label>Subregion</label>
                    <!-- ko if: DamageCalculator.region() != GameConstants.Region.none -->
                    <select autocomplete="off" class="custom-select" data-bind="
                        options: SubRegions.getSubRegions(DamageCalculator.region()),
                        optionsText: 'name',
                        optionsValue: 'id',
                        value: DamageCalculator.subregion"></select>
                    <!-- /ko -->
                    <!-- ko if: DamageCalculator.region() == GameConstants.Region.none -->
                    <select autocomplete="off" class="custom-select">
                        <option value="-1">None</option>
                    </select>
                    <!-- /ko -->
                </div>
                <div class="form-group col-4 col-lg">
                    <label>Weather</label>
                    <select autocomplete="off" class="custom-select" data-bind="value: DamageCalculator.weather">
                        <!-- ko foreach: GameHelper.enumStrings(WeatherType) -->
                        <option data-bind="attr: { value: WeatherType[$data] }, text: GameConstants.camelCaseToString($data)">Weather</option>
                        <!-- /ko -->
                    </select>
                </div>
                <div class="form-group col-4 col-lg">
                    <label>Type 1</label>
                    <select autocomplete="off" class="custom-select" data-bind="value: DamageCalculator.type1">
                        <!-- ko foreach: GameHelper.enumStrings(PokemonType) -->
                        <option data-bind="attr: { value: PokemonType[$data] }, text: $data">Type</option>
                        <!-- /ko -->
                    </select>
                </div>
                <div class="form-group col-4 col-lg">
                    <label>Type 2</label>
                    <select autocomplete="off" class="custom-select" data-bind="value: DamageCalculator.type2">
                        <!-- ko foreach: GameHelper.enumStrings(PokemonType) -->
                        <option data-bind="attr: { value: PokemonType[$data] }, text: $data">Type</option>
                        <!-- /ko -->
                    </select>
                </div>
            </div>
            <div class="form-row justify-content-center m-0 mb-2">
                <div class="form-check form-check-inline">
                    <input id="damage-calc-include-breeding" class="form-check-input" type="checkbox" autocomplete="off" data-bind="checked: DamageCalculator.includeBreeding"></input>
                    <label for="damage-calc-include-breeding" class="form-check-label">Include Breeding</label>
                </div>
                <div class="form-check form-check-inline">
                    <input id="damage-calc-ignore-level" class="form-check-input" type="checkbox" autocomplete="off" data-bind="checked: DamageCalculator.ignoreLevel"></input>
                    <label for="damage-calc-ignore-level" class="form-check-label">Ignore Level</label>
                </div>
                <div class="form-check form-check-inline">
                    <input id="damage-calc-use-base" class="form-check-input" type="checkbox" autocomplete="off" data-bind="checked: DamageCalculator.baseAttackOnly"></input>
                    <label for="damage-calc-use-base" class="form-check-label">Base Attack Only</label>
                </div>
            </div>
            <hr />
            <div data-bind="text: `Total Damage: ${Math.round(DamageCalculator.observableTotalDamage()).toLocaleString('en-US')}`"> </div>
            <div class="d-flex">
                <!-- ko foreach: DamageCalculator.observableTypeDamageArray -->
                <div class="type-damage-bar"
                    data-bind="style: {'flex-grow': $data,
                                        'background-color': '#' + TypeHelper.typeColorsLocked[$index()]
                                      },
                                visible: $data > 0,
                                tooltip: {title: `${PokemonType[$index()]}: ${Math.round($data).toLocaleString('en-US')}`,
                                          trigger: 'hover',
                                          placement:'bottom'
                                        },
                                click: () => {DamageCalculator.detailType($index())}"
                ></div>
                <!-- /ko -->
            </div>
            <div class="form-group text-left mt-3">
                <label>Type Detail</label>
                <select autocomplete="off" data-bind="value: DamageCalculator.detailType">
                    <!-- ko foreach: GameHelper.enumStrings(PokemonType) -->
                    <option data-bind="attr: { value: PokemonType[$data] }, text: $data">Type</option>
                    <!-- /ko -->
                </select>
                <!-- ko if: DamageCalculator.detailType() != PokemonType.None -->
                <span class="float-right" data-bind="text: `${PokemonType[DamageCalculator.detailType()]} Damage: ${Math.round(DamageCalculator.observableTypeDamageArray()[DamageCalculator.detailType()]).toLocaleString('en-US')}`"></span>
                <!-- /ko -->
            </div>
            <div data-bind="if: DamageCalculator.detailType() != PokemonType.None">
                <table id="damageCalcTypeDetailTable" class="table table-striped table-hover table-sm m-0">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Name</th>
                            <th>Damage</th>
                            <th>Type 1</th>
                            <th>Type 2</th>
                        </tr>
                    </thead>
                    <tbody data-bind="template: { name: 'damageDetailTemplate', foreach: DamageCalculator.observableTypeDetails }">
                    </tbody>
                </table>
            </div>
       </div>
       <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
       </div>
       <!-- /ko -->
   </div>
</div>
</div>


<!-- Category Modal -->
<div class="modal fade noselect" id="categoryModal" tabindex="-1" role="dialog" aria-badgeledby="categoryModal">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Categories</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <table class="table table-sm m-0 text-left">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="text-center" width="20%">Color</th>
                            <th width="80%">Name</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody data-bind="sortable: {
                        foreach: PokemonCategories.categories,
                        options: {
                            group: 'pokemonCategories',
                            draggable: '.category-row',
                            handle: '.category-drag-handle',
                            getId: (cat) => cat.id,
                        }}">
                        <tr class="category-row">
                            <td class="category-drag-handle align-middle text-center px-2" style="cursor: grab;">⠿</td>
                            <td class="p-0" data-bind="style: { background: $data.color }">
                                <label style="width:100%; min-height: 28px; padding:0px; margin: 0px;">
                                    <input style="opacity: 0;" type="color" data-bind="value: $data.color" />
                                </label>
                            </td>
                            <td data-bind="contentEditable: $data.name"></td>
                            <td>
                                <div class="btn-group" data-bind="visible: PokemonCategories.categories().length > 1">
                                    <button type="button" class="btn btn-sm py-0 dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false" title="Move Pokémon from this category to another category."></button>
                                    <div class="dropdown-menu pt-0">
                                        <p class="small text-center p-2 mb-0">Move Pokémon To:</p>
                                        <div data-bind="foreach: PokemonCategories.categories">
                                            <!-- ko if: $data.id !== $parent.id -->
                                            <button class="dropdown-item small" type="button"
                                                data-bind="text: $data.name,
                                                    style: { 'background-color': $data.color(), color: GameHelper.isColorLight($data.color()) ? 'black' : 'white' },
                                                    click: () => PartyController.moveCategoryPokemon($parent.id, $data.id)"></button>
                                            <!-- /ko -->
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <button type="button" class="close text-danger" title="Remove Category" style="opacity: 1;"
                                    data-bind="visible: $data.id > 0, click: () => { PokemonCategories.removeCategory($data.id) }">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody>
                        <tr>
                            <td class="bg-primary clickable text-center" colspan="5"
                                onclick="PokemonCategories.addCategory('New', '#333333')">+ New</td>
                        </tr>
                    </tbody>
                </table>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger mr-auto"
                        data-bind="click: async () => { if (await Notifier.confirm({ title: 'Reset Categories', message: 'Are you sure you want to reset all of your categories to defaults?', confirm: 'Reset' })) PokemonCategories.reset(); }">Reset</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Bulletin board Modal -->
<div class="modal fade" id="bulletinBoardModal" tabindex="-1" role="dialog"
aria-labelledby="bulletinBoardModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document" data-bind="if: BulletinBoard.selectedBulletinBoard()">
    <div class="modal-content">
       <div class="modal-header justify-content-start align-items-center">
            <h5 class="modal-title" id="bulletinBoardModalLabel">Bulletin Board</h5>
        </div>
        <div class="modal-body p-0">
            <table class="table m-0">
                <tbody>
                    <!-- ko foreach: GameHelper.chunk(3, BulletinBoard.selectedBulletinBoard().getQuests()) -->
                    <tr>
                        <!-- ko foreach: $data -->
                        <td class="col-md-3">
                            <div class="text-left bulletin-paper card">
                                <div class="card-footer">
                                    <h5 class="card-title m-0" data-bind="text: $data.name">Card title</h5>
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <p class="card-text flex-grow-1" data-bind="text: $data.description">Description</p>
                                    <!-- ko if: $data.state() == QuestLineState.suspended -->
                                    <div class="text-center text-muted small">
                                        <p class="m-0">Previously Started</p>
                                        <p class="m-0" data-bind="text: `Step: ${$data.curQuest() + 1} / ${$data.totalQuests}`"></p>
                                    </div>
                                    <!-- /ko -->
                                </div>
                                <div class="card-footer p-0">
                                    <button class="btn btn-primary btn-block" data-bind="visible: !$data.state(), click: () => { $data.beginQuest(); }">Accept</button>
                                    <button class="btn btn-primary btn-block" data-bind="visible: $data.state() == QuestLineState.started" disabled>Started</button>
                                    <button class="btn btn-primary btn-block" data-bind="visible: $data.state() == QuestLineState.suspended, click: () => { $data.resumeSuspendedQuest() }">Resume</button>
                                </div>
                            </div>
                        </td>
                        <!-- /ko -->
                        <!-- ko if: $data.length < 2 -->
                        <td class="col-md-3"></td>
                        <!-- /ko -->
                        <!-- ko if: $data.length < 3 -->
                        <td class="col-md-3"></td>
                        <!-- /ko -->
                    </tr >
                    <!-- /ko -->
                    <!-- ko if: BulletinBoard.selectedBulletinBoard().getQuests().length == 0 -->
                    <tr>
                        <td>No new quests available.</td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
    </div>
</div>
</div>


<div class="modal noselect fade" id="heldItemModal" tabindex="-1" role="dialog" aria-labelledby="heldItemModal">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
                <h5 class="modal-title text-light">Select a Pokémon</h5>&nbsp;
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0" style="background-color: inherit; overflow-x: hidden;">
                <!-- ko if: HeldItem.heldItemSelected() -->
                <img data-bind="attr: { src: HeldItem.heldItemSelected().image }, style: { 'image-rendering': HeldItem.heldItemSelected().pixelated ? 'pixelated' : '' }" width="25%"/>
                <br/>
                <div class="sticky-top" style="background-color: inherit;">
                  <div class="btn-group btn-block m-0" role="group" aria-label="Basic example">
                    <button class="btn btn-block btn-secondary btn-static" data-bind="text: HeldItem.heldItemSelected().displayName + ': ' + player.amountOfItem(HeldItem.heldItemSelected().name)"></button>
                  </div>
                  <!-- Sort field -->
                  <div class="input-group px-1 mt-1">
                      <!-- ko let: { heldItemSort: Settings.getSetting('heldItemSort') } -->
                      <select id="held-item-sort" autocomplete="off" class="custom-select"
                          data-bind="options: heldItemSort.options,
                              optionsValue: 'value',
                              optionsText: 'text',
                              value: heldItemSort.observableValue">
                      </select>
                      <!-- /ko -->
                      <!-- ko let: { heldItemSortDirection: Settings.getSetting('heldItemSortDirection') } -->
                      <div class="input-group-append bg-primary text-light">
                          <label for="held-item-sort-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;" data-bind="
                              text: heldItemSortDirection.observableValue() ? '⥄' : '⥂',
                              tooltip: {
                                  title: heldItemSortDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                  trigger: 'hover',
                                  placement: 'bottom',
                              }">⥂</label>
                          <input id="held-item-sort-direction" style="vertical-align: middle" class="hidden" type='checkbox'
                              data-bind="checked: heldItemSortDirection.observableValue" />
                      </div>
                      <!-- /ko -->
                  </div>
                  <!-- Search field -->
                  <div class="input-group px-1 mt-1 mb-0">
                    <div class="input-group-prepend">
                        <!-- ko let: { heldItemDropdownPokemonOrItem: Settings.getSetting('heldItemDropdownPokemonOrItem') } -->
                        <select id="held-item-sort" autocomplete="off" class="custom-select"
                            data-bind="options: heldItemDropdownPokemonOrItem.options,
                                optionsValue: 'value',
                                optionsText: 'text',
                                value: heldItemDropdownPokemonOrItem.observableValue">
                        </select>
                        <!-- /ko -->
                    </div>
                    <input id="held-item-search" autocomplete="off" class="form-control" placeholder="Search"
                        data-bind="textInput: Settings.getSetting('heldItemSearchFilter').observableValue" />
                  </div>
                  <div class="small px-1 pb-2 my-1" style="overflow-x: hidden;">
                    <!-- Region and Type selects -->
                    <div class="form-row px-1">
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { heldItemRegionFilter: Settings.getSetting('heldItemRegionFilter') } -->
                            <label class="mb-1" for="held-item-region-filter">Region</label>
                            <select id="held-item-region-filter" autocomplete="off" class="custom-select custom-select-sm"
                                data-bind="options: heldItemRegionFilter.getValidOptions(),
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: heldItemRegionFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { heldItemTypeFilter: Settings.getSetting('heldItemTypeFilter') } -->
                            <label class="mb-1" for="held-item-type-filter">Type</label>
                            <select id="held-item-type-filter" name="heldItemTypeFilter" autocomplete="off" class="custom-select custom-select-sm"
                                data-bind="options: heldItemTypeFilter.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: heldItemTypeFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                    </div>
                    <!-- Hide/Show checkboxes -->
                    <div class="form-check align-middle mt-1">
                        <input type="checkbox" id="hide-holding-item-pokemon" class="form-check-input"
                            data-bind="checked: Settings.getSetting('heldItemHideHoldingPokemon').observableValue" />
                        <label for="hide-holding-item-pokemon" class="form-check-label">Hide Pokémon holding an item</label>
                    </div>
                    <div class="form-check align-middle mt-1">
                        <input type="checkbox" id="show-this-item-pokemon" class="form-check-input"
                            data-bind="checked: Settings.getSetting('heldItemHideHoldingThisItem').observableValue" />
                        <label for="show-this-item-pokemon" class="form-check-label">Hide Pokémon holding <u>this</u> item</label>
                    </div>
                  </div>
                </div>
                <!-- /ko -->
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                  <thead>
                      <tr class="text-light">
                          <th class="text-left bg-dark align-middle">Pokémon:</th>
                          <th class="text-left bg-dark align-middle">Held item:</th>
                      </tr>
                  </thead>
                  <tbody data-bind="foreach: lazyLoad('lazyHeldItemList', $element, PartyController.getHeldItemSortedList, { reset: () => (DisplayObservables.modalState.heldItemModal === 'hidden') }), childrenComplete: () => { lazyLoadCallback('lazyHeldItemList'); }">
                    <tr class="clickable" data-bind="click: () => $data.giveHeldItem(HeldItem.heldItemSelected())">
                      <td class="text-left align-middle"><knockout data-bind="text: $data.displayName"></knockout><sup data-bind="visible: $data.shiny">✨</sup></td>
                      <td class="text-left tight align-middle" data-bind="if: $data.heldItem(),
                        tooltip: { title: $data.heldItem()?.description ?? '', trigger: 'hover', placement: 'bottom' }">
                            <img width="20" data-bind="attr: { src: $data.heldItem().image }" />
                            <knockout data-bind="text: $data.heldItem().displayName"></knockout>
                        </td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- Battle Cafe Modal -->
<div class="modal fade noselect" id="battleCafeModal" tabindex="-1" role="dialog" aria-labelledby="battleCafeModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Battle Café</h5>
        </div>
        <div class="modal-body">
                <h4>Select a Sweet</h4>
                <div class="sweet-display my-3" data-bind="foreach: GameHelper.enumStrings(GameConstants.AlcremieSweet)">
                    <div class="mx-1 mb-1">
                        <div class="card clickable" data-bind="click: () => BattleCafeController.selectedSweet(GameConstants.AlcremieSweet[$data])">
                            <div class="card-body bg-secondary rounded text-center p-1"
                                data-bind="css: { 'bg-info': BattleCafeController.selectedSweet() == GameConstants.AlcremieSweet[$data] }">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="d-flex align-items-center justify-content-between w-100">
                                        <knockout class="pokeball-image" data-bind="template: { name: 'caughtStatusTemplate', data: {
                                            'status': BattleCafeController.getCaughtStatus(GameConstants.AlcremieSweet[$data])()
                                        }}"></knockout>
                                        <knockout class="pokerus-image" data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                            'pokerus': BattleCafeController.getPokerusStatus(GameConstants.AlcremieSweet[$data])(),
                                        }}"></knockout>
                                    </div>
                                    <img style="width: 40px; margin-top: -3px;" data-bind="attr: { src: 'assets/images/sweets/' + $data + '.png' }"/>
                                    <h6 class="card-title mb-1" data-bind="text: $data.replace(' Sweet', '')"></h6>
                                    <div class="d-flex" data-bind="foreach: BattleCafeController.getPrice(GameConstants.AlcremieSweet[$data])">
                                        <img style="width: 24px;" data-bind="attr: { src: FarmController.getBerryImage($data.berry) },
                                            tooltip: { title: `${BerryType[$data.berry]} × ${$data.amount.toLocaleString('en-US')}`, trigger: 'hover', placement: 'bottom' }">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ko with: GameConstants.AlcremieSweet[BattleCafeController.selectedSweet()] -->
                <div class="card mb-3">
                    <div class="card-header d-flex align-items-center p-0">
                        <img height="36" data-bind="attr: { src: 'assets/images/sweets/' + $data + '.png' }"/>
                        <span class="flex-grow-1 text-center font-weight-bold" data-bind="text: $data"></span>
                        <img height="36" data-bind="attr: { src: 'assets/images/sweets/' + $data + '.png' }"/>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-6 pb-3">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr>
                                            <th class="border-top-0 w-50">Cost Per Spin</th>
                                            <th class="border-top-0 w-50">Owned</th>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: BattleCafeController.getPrice(GameConstants.AlcremieSweet[$data])">
                                        <tr>
                                            <td class="border-top-0 p-0">
                                                <img style="width: 30px;" data-bind="attr: { src: FarmController.getBerryImage($data.berry) }">
                                                <span data-bind="text: `${BerryType[$data.berry]} × ${$data.amount.toLocaleString('en-US')}`"></span>
                                            </td>
                                            <td class="align-middle border-top-0 p-0" data-bind="text: App.game.farming.berryList[$data.berry]().toLocaleString('en-US'),
                                                css: { 'text-danger': $data.amount > App.game.farming.berryList[$data.berry]() }"></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td>Maximum Spins</td>
                                            <td data-bind="text: BattleCafeController.calcMaxSpins(BattleCafeController.selectedSweet()).toLocaleString('en-US')"></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="alcremie-display" data-bind="foreach: Object.values(BattleCafeController.evolutions[GameConstants.AlcremieSweet[$data]]).sort((a, b) => pokemonMap[a.name].id - pokemonMap[b.name].id)">
                                    <div class="card">
                                        <div class="card-body bg-secondary rounded text-center p-1">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="d-flex align-items-center justify-content-between w-100">
                                                    <knockout class="pokeball-image" data-bind="template: { name: 'caughtStatusTemplate', data: {
                                                        'status': PartyController.getCaughtStatusByName($data.name)
                                                    }}"></knockout>
                                                    <knockout class="pokerus-image" data-bind="template: { name: 'pokerusStatusTemplate', data: {
                                                        'pokerus': PartyController.getPokerusStatusByName($data.name),
                                                        'evs': App.game.party.getPokemonByName($data.name)?.evs()
                                                    }}"></knockout>
                                                </div>
                                                <img src="" style="width: 64px; margin-top: -8px;" data-bind="attr: { src: PokemonHelper.getImage(pokemonMap[$data.name].id) },
                                                    css: { 'dungeon-pokemon-locked': !App.game.party.alreadyCaughtPokemonByName($data.name) }">
                                                <h6 class="card-title small mb-0" style="margin-top: -8px;"
                                                    data-bind="text: App.game.party.alreadyCaughtPokemonByName($data.name) ? $data.name.match(/.+\(\w+\s(.+)\)/)[1] : '???'"></h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header py-2 font-weight-bold">Spin!</div>
                    <div class="card-body col-lg-6 align-self-center p-2">
                        <div>Remaining Spin Attempts: <span data-bind="text: BattleCafeController.spinsLeft()"></span></div>
                        <img style="width: 60px;" src="assets/images/profile/trainer-1.png" data-bind="
                            attr: { src: `assets/images/profile/trainer-${App.game.profile.trainer() || 0}.png` },
                            class: BattleCafeController.isSpinning() ? 'player-animated' + (BattleCafeController.clockwise() ? '' : '-counter') : ''" />
                        <div class="input-group justify-content-center align-items-center mt-3">
                            <label class="m-0 pr-1" for="battleCafeDuration">Spin Duration (seconds):</label>
                            <input style="max-width: 100px;" class="form-control col-4" id="battleCafeDuration" type="number" min="1" max="20" value="3"/>
                        </div>
                        <div class="d-flex mt-3">
                            <div class="col-6 px-1">
                                <button class="btn btn-primary btn-block" onclick="BattleCafeController.spin(true);">Clockwise</button>
                            </div>
                            <div class="col-6 px-1">
                                <button class="btn btn-primary btn-block" onclick="BattleCafeController.spin(false);">Counter-Clockwise</button>
                            </div>
                        </div>
                        <div class="text-muted small mt-2">Spin Attempts Reset At Midnight</div>
                    </div>
                </div>
                <!-- /ko -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Dream Orbs Modal -->
<div class="modal fade noselect" id="dreamOrbsModal" tabindex="-1" role="dialog"
aria-labelledby="dreamOrbsModalLabel">
<div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Open Dream Orbs</h5>
        </div>
        <div class="modal-body">
            <select id="dream-orbs-selector" class="custom-select" onchange="App.game.dreamOrbController.item(undefined)" style="margin-right: 8px"
                    data-bind="options: App.game.dreamOrbController.orbs.filter((o) => !o.requirement ||o.requirement.isCompleted()),
                               optionsText: 'color',
                               value: App.game.dreamOrbController.selectedOrb"
            >
            </select>
            <img data-bind="attr: { src: App.game.dreamOrbController.item() ? BagHandler.image(App.game.dreamOrbController.item().item) :
                ('assets/images/dreamOrbs/dream_orb_' +
                App.game.dreamOrbController.selectedOrb().color.toLowerCase() +
                (App.game.dreamOrbController.opening() ? '_animated' : '') +
                '.png')
            }" height = "120px'"/>
            <div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="App.game.dreamOrbController.open()">Open</button>
                    <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split active" data-bind="text: App.game.dreamOrbController.amountSelected().toLocaleString('en-US') + '&nbsp;'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    </button>
                    <div class="dropdown-menu" data-bind="foreach: [1, 10, 100, 1000, Infinity]">
                        <button class="dropdown-item" type="button" data-bind="click: function(){App.game.dreamOrbController.amountSelected($data)}, text: $data.toLocaleString('en-US')"></button>
                    </div>
                </div>
            </div>
            <div>Orbs left: <span data-bind="text: App.game.dreamOrbController.selectedOrb().amount().toLocaleString('en-US')"></span></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
    </div>
</div>
</div>


<!-- Dream Orbs Opened Modal -->
<div class="modal fade noselect" id="dreamOrbsOpenedModal" tabindex="-1" role="dialog" aria-labelledby="dreamOrbsOpenedModalLabel">
<div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Dream Orbs Opened</h5>
        </div>
        <div class="modal-body">
            <p data-bind="text: `You opened ${App.game.dreamOrbController.amountOpened().toLocaleString('en-US')} ${App.game.dreamOrbController.selectedOrb().color} Dream Orbs and received:`"></p>
            <div data-bind="foreach: App.game.dreamOrbController.itemsReceived">
                <div>
                    <span data-bind="text: $data.amount.toLocaleString('en-US')"></span>
                    <img data-bind="attr: { src: BagHandler.image($data.item) }" height="32px" />
                    <span data-bind="text: $data.name"></span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
        </div>
    </div>
</div>
</div>


<!-- Purify Chamber Modal -->
<div class="modal fade noselect" id="purifyChamberModal" tabindex="-1" role="dialog"
aria-labelledby="purifyChamberModalLabel">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Purify Chamber</h5>
            </div>
            <div class="modal-body">
                <!-- ko if: App.game.party.caughtPokemon.some((p) => p.shadow == GameConstants.ShadowStatus.Shadow) -->
                <select id="purify-chamber-selector" class="custom-select" style="margin-right: 8px"
                        data-bind="options: App.game.party.caughtPokemon.filter((p) => p.shadow == GameConstants.ShadowStatus.Shadow),
                               optionsText: (p) => PokemonHelper.displayName(p.name),
                               value: App.game.purifyChamber.selectedPokemon"
                >
                </select>
                <div>
                    <img data-bind="visible: App.game.purifyChamber.selectedPokemon(), attr: { src: App.game.purifyChamber.selectedPokemon() ? PokemonHelper.getImage(App.game.purifyChamber.selectedPokemon().id) : '' }"/>
                </div>
                <div>
                    <h4>Flow needed for next purification:</h4>
                    <span data-bind="text: App.game.purifyChamber.currentFlow().toLocaleString('en-US')"></span>
                    <span> / </span>
                    <span data-bind="text: App.game.purifyChamber.flowNeeded().toLocaleString('en-US')"></span>
                </div>
                <div>
                    <button data-bind="visible: App.game.purifyChamber.canPurify()" class="btn btn-primary" onclick="App.game.purifyChamber.purify()">Purify</button>
                </div>
                <!-- /ko -->

                <!-- ko ifnot: App.game.party.caughtPokemon.some((p) => p.shadow == GameConstants.ShadowStatus.Shadow) -->
                <div>No Shadow Pokémon in the Party</div>
                <!-- /ko -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Weather App Modal -->
<div class="modal fade" id="weatherAppModal" tabindex="-1" role="dialog" aria-labelledby="weatherAppModal">
    <div class="modal-dialog modal-dialog-scrollable modal-lg h-100" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Castform App</h4>
                <div style="width: 100px;">
                    <!-- ko using: GameHelper.enumNumbers(GameConstants.Region).filter((r) => r >= 0 && r <= player.highestRegion()), as: 'regions' -->
                    <select class="custom-select" onchange="WeatherApp.selectedRegion(+this.value);">
                        <!-- ko foreach: regions -->
                        <option data-bind="attr: { value: $data, selected: WeatherApp.selectedRegion() === $data }, text: GameConstants.camelCaseToString(GameConstants.Region[$data])"></option>
                        <!-- /ko -->
                    </select>
                    <!-- /ko -->
                </div>
            </div>
            <div class="modal-body">
                <div class="row m-0 w-100 h-100">
                    <div class="col-2 w-100 px-0" id="timeTable">
                        <table class="w-100 h-100" border="1">
                            <thead>
                                <tr>
                                    <th style="height: 26px;">Time</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: WeatherApp.generateHourList()">
                                <tr>
                                    <td style="height: 60px;" data-bind="text: `${GameHelper.twoDigitNumber(+$data)}:00 - ${GameHelper.twoDigitNumber(+$data + (Weather.period - 1))}:59`"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-10 w-100 px-0 overflow-auto" id="forecastTable">
                        <table class="w-100 h-100" border="1">
                            <thead>
                                <tr>
                                    <!-- ko foreach: WeatherApp.dateList() -->
                                    <th style="height: 26px;" data-bind="text: GameConstants.DayOfWeek[$data.getDay()].slice(0, 3),
                                        tooltip: {
                                            title: $data.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }),
                                            placement: 'bottom',
                                            trigger: 'hover',
                                            boundary: 'window',
                                        }">
                                    </th>
                                    <!-- /ko -->
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: { data: WeatherApp.fullForecast().find((rf) => rf.region == WeatherApp.selectedRegion()).weatherForecastList(), as: 'hourForecast' }">
                                <tr class="py-2" data-bind="template: { name: 'weatherAppTemplate', data: {'hourForecast': hourForecast, 'region': WeatherApp.selectedRegion()} }"></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="weatherAppTemplate">
    <!-- ko foreach: { data: $data.hourForecast, as: 'weatherForecast' } -->
    <td class="px-3 clickable" style="height: 60px; position: relative;"
        data-bind="css: { 'weatherForecastPassed': weatherForecast.status() === WeatherForecastStatus.hasPassed }">
        <button class='btn btn-sm' style="right: 0px; top: 0px; width: auto; height: 41px;"
        data-bind='style: { background: Weather.weatherConditions[weatherForecast.weatherType].color },
            tooltip: {
                title: GameConstants.humanifyString(WeatherType[weatherForecast.weatherType]),
                placement: "bottom",
                trigger: "hover",
                boundary: "window",
            }'>
            <img width=30px src="" data-bind="attr: { src: `assets/images/weather/${WeatherType[weatherForecast.weatherType]}.png` }"/>
        </button>
    </td>
    <!-- /ko -->
</script>


<!-- Consumable Modal -->
<div class="modal noselect fade" id="consumableModal" tabindex="-1" role="dialog" aria-labelledby="consumableModal">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
                <h5 class="modal-title text-light">Select a Pokémon</h5>&nbsp;
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0" style="background-color: inherit;">
                <img data-bind="attr: { src: ItemList[ConsumableController.currentlySelectedName()].image }" width="40%"/>
                <br/>
                <div class="sticky-top" style="background-color: inherit;">
                  <div class="btn-group btn-block m-0" role="group" aria-label="Basic example">
                    <button class="btn btn-block btn-secondary btn-static" data-bind="text: ItemList[ConsumableController.currentlySelectedName()].displayName + ': ' + player.amountOfItem(ConsumableController.currentlySelectedName())"></button>
                    <button class="btn btn-primary btn-sm" data-bind="text : ConsumableController.multiplier[ConsumableController.multiplierIndex()], click : () => ConsumableController.incrementMultiplier(), attr : { oncontextmenu : 'ConsumableController.decrementMultiplier(); return false;' }"></button>
                  </div>
                  <div class="input-group px-1 mt-1">
                      <!-- ko let: { consumableSort: Settings.getSetting('consumableSort') } -->
                      <select id="consumable-sort" autocomplete="off" class="custom-select"
                          data-bind="options: consumableSort.options,
                              optionsValue: 'value',
                              optionsText: 'text',
                              value: consumableSort.observableValue">
                      </select>
                      <!-- /ko -->
                      <!-- ko let: { consumableSortDirection: Settings.getSetting('consumableSortDirection') } -->
                      <div class="input-group-append bg-primary text-light">
                          <label for="consumable-sort-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;" data-bind="
                              text: consumableSortDirection.observableValue() ? '⥄' : '⥂',
                              tooltip: {
                                  title: consumableSortDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                  trigger: 'hover',
                                  placement: 'bottom',
                              }">⥂</label>
                          <input id="consumable-sort-direction" style="vertical-align: middle" class="hidden" type='checkbox'
                              data-bind="checked: consumableSortDirection.observableValue" />
                      </div>
                      <!-- /ko -->
                  </div>
                  <div class="form-group px-1 mt-1 mb-0">
                    <input id="consumable-search" autocomplete="off" class="form-control" placeholder="Search"
                        data-bind="textInput: Settings.getSetting('consumableSearchFilter').observableValue" />
                  </div>
                  <div class="small px-1 pb-2 my-1" style="overflow-x: hidden;">
                    <div class="form-row px-1">
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { consumableRegionFilter: Settings.getSetting('consumableRegionFilter') } -->
                            <label class="mb-1" for="consumable-region-filter">Region</label>
                            <select id="consumable-region-filter" autocomplete="off" class="custom-select custom-select-sm" 
                                data-bind="options: consumableRegionFilter.getValidOptions(),
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: consumableRegionFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { consumableTypeFilter: Settings.getSetting('consumableTypeFilter') } -->
                            <label class="mb-1" for="held-item-type-filter">Type</label>
                            <select id="held-item-type-filter" name="consumableTypeFilter" autocomplete="off" class="custom-select custom-select-sm" 
                                data-bind="options: consumableTypeFilter.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: consumableTypeFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                    </div>
                    <div class="form-check align-middle mt-1">
                        <input type="checkbox" id="consumable-shiny-filter" class="form-check-input"
                            data-bind="checked: Settings.getSetting('consumableHideShinyPokemon').observableValue" />
                        <label for="consumable-shiny-filter" class="form-check-label" 
                            data-bind="text: Settings.getSetting('consumableHideShinyPokemon').displayName"></label>
                    </div>
                  </div>
                </div>
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                  <thead>
                      <tr class="text-light">
                          <th class="text-left bg-dark align-middle">Pokémon</th>
                          <th class="text-left bg-dark align-middle">Attack</th>
                      </tr>
                  </thead>
                  <tbody data-bind="foreach: lazyLoad('lazyConsumableList', $element, PartyController.getConsumableSortedList, { reset: () => (DisplayObservables.modalState.consumableModal === 'hidden') }), childrenComplete: () => { lazyLoadCallback('lazyConsumableList'); }">
                    <tr class="clickable" data-bind="click: () => { $data.useConsumable(ConsumableController.currentlySelected(), ConsumableController.getMultiplier()); }">
                      <td class="text-left"><knockout data-bind="text: $data.displayName"></knockout><sup data-bind="visible: $data.shiny">✨</sup></td>
                      <td class="text-center tight" data-bind="text: $data.calculateAttack(true).toLocaleString('en-US')">Attack</td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- PokeBlock Modal-->
<div class="modal noselect fade" id="pokeblockModal" tabindex="-1" role="dialog" aria-labelledby="pokeblockModal">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" style="min-width: fit-content;" role="document">
        <div class="modal-content">
            <div class="modal-header bg-dark text-light" style='justify-content: space-around;'>
                <h5 class="modal-title text-light">Select a Pokémon</h5>&nbsp;
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body p-0" style="background-color: inherit;">
                <img style="image-rendering: pixelated;" data-bind="attr: { src: PokeBlockController.getImage() }" width="20%" />
                <br/>
                <div class="sticky-top" style="background-color: inherit;">
                  <div class="btn-group btn-block m-0" role="group" aria-label="Basic example">
                    <button class="btn btn-block btn-secondary btn-static" data-bind="text: ItemList[PokeBlockController.currentlySelectedName()].displayName + 's: ' + player.amountOfItem(PokeBlockController.currentlySelectedName())"></button>
                    <button class="btn btn-primary btn-sm" data-bind="text : PokeBlockController.multiplier[PokeBlockController.multiplierIndex()], click : () => PokeBlockController.incrementMultiplier(), attr : { oncontextmenu : 'PokeBlockController.decrementMultiplier(); return false;' }"></button>
                  </div>
                  <div class="input-group px-1 mt-1">
                      <!-- ko let: { pokeblockSort: Settings.getSetting('pokeblockSort') } -->
                      <select id="pokeblock-sort" autocomplete="off" class="custom-select"
                          data-bind="options: pokeblockSort.options,
                              optionsValue: 'value',
                              optionsText: 'text',
                              value: pokeblockSort.observableValue">
                      </select>
                      <!-- /ko -->
                      <!-- ko let: { pokeblockSortDirection: Settings.getSetting('pokeblockSortDirection') } -->
                      <div class="input-group-append bg-primary text-light">
                          <label for="pokeblock-sort-direction" class="clickable m-0 pl-2 pr-2" style="font-size: 22px;" data-bind="
                              text: pokeblockSortDirection.observableValue() ? '⥄' : '⥂',
                              tooltip: {
                                  title: pokeblockSortDirection.observableValue() ? 'Descending (highest value first)' : 'Ascending (lowest value first)',
                                  trigger: 'hover',
                                  placement: 'bottom',
                              }">⥂</label>
                          <input id="pokeblock-sort-direction" style="vertical-align: middle" class="hidden" type='checkbox'
                              data-bind="checked: pokeblockSortDirection.observableValue" />
                      </div>
                      <!-- /ko -->
                  </div>
                  <div class="form-group px-1 mt-1 mb-0">
                    <input id="pokeblock-search" autocomplete="off" class="form-control" placeholder="Search"
                        data-bind="textInput: Settings.getSetting('pokeblockSearchFilter').observableValue" />
                  </div>
                  <div class="small px-1 pb-2 my-1" style="overflow-x: hidden;">
                    <div class="form-row px-1">
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { pokeblockRegionFilter: Settings.getSetting('pokeblockRegionFilter') } -->
                            <label class="mb-1" for="pokeblock-region-filter">Region</label>
                            <select id="pokeblock-region-filter" autocomplete="off" class="custom-select custom-select-sm" 
                                data-bind="options: pokeblockRegionFilter.getValidOptions(),
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: pokeblockRegionFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                        <div class="form-group col-6 m-0 px-1 py-0">
                            <!-- ko let: { pokeblockTypeFilter: Settings.getSetting('pokeblockTypeFilter') } -->
                            <label class="mb-1" for="held-item-type-filter">Type</label>
                            <select id="held-item-type-filter" name="pokeblockTypeFilter" autocomplete="off" class="custom-select custom-select-sm" 
                                data-bind="options: pokeblockTypeFilter.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: pokeblockTypeFilter.observableValue">
                            </select>
                            <!-- /ko -->
                        </div>
                    </div>
                    <div class="form-check align-middle mt-1">
                        <input type="checkbox" id="pokeblock-shiny-filter" class="form-check-input"
                            data-bind="checked: Settings.getSetting('pokeblockHideShinyPokemon').observableValue" />
                        <label for="pokeblock-shiny-filter" class="form-check-label" 
                            data-bind="text: Settings.getSetting('pokeblockHideShinyPokemon').displayName"></label>
                    </div>
                  </div>
                </div>
                <table class="table table-striped table-hover table-bordered table-sm m-0">
                  <thead>
                      <tr class="text-light">
                          <th class="text-left bg-dark align-middle">Pokémon</th>
                          <th class="text-left bg-dark align-middle">Contest Type</th>
                          <th class="text-left bg-dark align-middle">Appeal</th>
                          <th class="text-left bg-dark align-middle">Sheen</th>
                      </tr>
                  </thead>
                  <tbody data-bind="foreach: lazyLoad('lazyPokeblockList', $element, PartyController.getPokeblockSortedList, { reset: () => (DisplayObservables.modalState.pokeblockModal === 'hidden') }), childrenComplete: () => { lazyLoadCallback('lazypokeblockList'); }">
                    <tr class="clickable" data-bind="click: () => { $data.usePokeblock(PokeBlockController.currentlySelected(), PokeBlockController.getMultiplier()); }">
                      <td class="text-left text-truncate" style="max-width: 15vw;"><knockout data-bind="text: $data.displayName"></knockout><sup data-bind="visible: $data.shiny">✨</sup></td>
                        <td class="text-left tight" style="text-shadow: 0px 0px 1px black, 0px 0px 1px black, 0px 0px 1px black, 0px 0px 2px black, 0px 0px 2px black, 0px 0px 3px black;" data-bind="foreach: $data.currentContestTypes">
                          <span class="badge text-light px-1" data-bind="if: $data >= 0,
                                      style: { 'background-color': GameConstants.ContestColor[$data]}">
                            <small><strong
                              data-bind="text: ContestType[$data].toUpperCase()" style="color: white"></strong></small>
                          </span>
                        </td>
                      <td class="text-center tight text-truncate" style="max-width: 20vw;" data-bind="text: $data.calculateContestAppeal(true).toLocaleString('en-US')">Appeal</td>
                      <td class="text-center tight text-truncate" style="max-width: 20vw;" data-bind="text: $data.maxSheenTooltip">Sheen</td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- Contest battle won Modal -->
<div class="modal fade" data-keyboard="false" data-backdrop="static" id="contestWonModal" tabindex="-1" role="dialog"
aria-labelledby="contestWonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div style="width: 100%;">
                    <svg class="ribbon" xmlns="http://www.w3.org/2000/svg" width="80px" viewBox="0 0 1280 1280" xmlns:v="https://vecta.io/nano"
                        data-bind="attr: {'contest-type': ContestType[ContestRunner.type()]}">
                        <g data-bind="html: ContestHelper.getRibbonImage(ContestRunner.rank(), ContestRunner.type())"></g>
                    </svg>
                    <h5 class="modal-title" id="contestWonModalLabel"
                        data-bind="text: `${ContestRank[ContestRunner.rank()]} Rank Contest Won!`">Modal title</h5>
                </div>
            </div>
            <div class="modal-body">
                <p data-bind="text: `Congratulations! You have been awarded ${GameHelper.anOrA(ContestHelper.congratulatoryWord[ContestRunner.rank()])}
                ${ContestHelper.congratulatoryWord[ContestRunner.rank()]} ${ContestHelper.getRibbonImageDescription(ContestRunner.rank(), ContestRunner.type(), false)}!`"></p>
                <p data-bind="text: `You can now compete in ${ContestRank[ContestRunner.rank()]} Rank ${ContestType[ContestRunner.type()]} Encore Rounds!`"></p>
                <p data-bind="html: `<i>Your base frenzy Audience Appeal has increased by 1%!</i>`"</p>
                <!-- <p data-bind="html: `<i>Your Pokémon's max Contest Sheen has increased to ${ContestHelper.maxSheen()}!</i>`"></p> -->
            </div>
            <!-- ko if: ContestRunner.rank() === ContestRank['Brilliant Shining'] -->
            <h3>Thank you for playing!</h3>
            <!-- /ko -->
            <div class="modal-footer" style="justify-content: center;">
                <button type="button" class="btn btn-success" data-dismiss="modal">Accept</button>
            </div>
        </div>
    </div>
</div>


<!-- Moon Phase Modal -->
<div class="modal fade noselect" id="moonPhaseModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Moon Phases</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="small">Moon Phases rotate daily and influence the catch rate of Moon Balls. Additionally, some Pokémon move around according to the current phase.</p>
                <table class="table table-bordered mb-0">
                    <thead>
                        <tr>
                            <th class="align-middle text-left" colspan="2">Phase</th>
                            <th class="align-middle">Moon Ball Bonus</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: Object.values(MoonCycle.currentMoonPhases)">
                        <tr>
                            <td class="align-middle text-center tight p-2" data-bind="style: { 'background-color': $data.color }">
                                <img src="" width="30px" data-bind="attr: { src: `assets/images/moonCycle/${MoonCyclePhase[$data.phase]}.png` }">
                            </td>
                            <td class="align-middle text-left" data-bind="text: $data.description,
                                css: { 'bg-primary text-light': $data.phase === MoonCycle.currentMoonCyclePhase() }"></td>
                            <td class="align-middle" data-bind="text: `+${MoonCycle.catchChanceBonus($data.phase)}%`,
                                css: { 'bg-primary text-light': $data.phase === MoonCycle.currentMoonCyclePhase() }"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
// Check if we are running in an iframe
if (self !== top) {
    App = {};
    Game = {};
    document.body.innerHTML = `<div class="text-center">
        <h2>Please visit the official website to play this game <a target="_top" href="https://pokeclicker.com">https://pokeclicker.com</a></h2>
    </div>`;
}
</script>
</body>
</html>
